import{a as s,j as t,b as j}from"./inherits_browser.chunk.js";import"./entry.chunk.js";function v(n){const c="=".repeat((4-n.length%4)%4),d=(n+c).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(d),l=new Uint8Array(o.length);for(let i=0;i<o.length;++i)l[i]=o.charCodeAt(i);return l}function w({userId:n}){const[c,d]=s.useState([]),[o,l]=s.useState(null),[i,P]=s.useState(!1),[r,x]=s.useState("테스트 제목"),[a,y]=s.useState("이것은 백엔드에서 보낸 푸시 알림입니다!"),[p,g]=s.useState(!1),b="BDgnhdO6oZ0uD0vA9YlsOi_1FcMkxUUXOqbBQrscEctZGpvIszTkuQk99LR06fkQvejdwlbYvlDSoaEwvg91bwI",m=async()=>{if(Notification.permission!=="granted"&&await Notification.requestPermission()!=="granted"){alert("알림 권한이 거부되었습니다.");return}try{const u=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:v(b)});console.log("✅ 푸시 구독 성공:",JSON.stringify(u)),await fetch("/api/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),alert("푸시 알림 구독이 완료되었습니다!"),g(!0)}catch(e){console.error("❌ 푸시 구독 실패:",e),alert("푸시 알림 구독에 실패했습니다. 콘솔을 확인해주세요.")}},f=async()=>{if(!r||!a){alert("제목과 내용을 모두 입력해주세요.");return}console.log(`📨 백엔드로 푸시 알림 요청: 제목=${r}, 내용=${a}`);try{await fetch("/api/send-all",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:r,body:a})}),alert("백엔드로 알림 발송 요청을 보냈습니다.")}catch(e){console.error("❌ 알림 발송 요청 실패:",e),alert("알림 발송 요청에 실패했습니다. 콘솔을 확인해주세요.")}};return t.jsxs("div",{style:{display:"flex",gap:"20px"},children:[t.jsx("div",{className:"notification-container",style:{padding:"20px",border:"1px solid #ddd",width:"50%"},children:t.jsxs("h2",{children:["웹소켓 알림 목록 (사용자: ",n,")"]})}),t.jsxs("div",{className:"push-test-container",style:{padding:"20px",border:"1px solid #28a745",width:"50%"},children:[t.jsx("h2",{children:"🚀 웹 푸시 알림 테스트"}),t.jsx("p",{children:"백그라운드에서도 동작하는 알림을 테스트합니다."}),t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("button",{onClick:m,disabled:p,children:p?"✅ 푸시 구독 완료":"🔔 푸시 알림 구독하기"}),t.jsx("p",{style:{fontSize:"12px",color:"#666"},children:"브라우저에 알림을 받을 수 있도록 등록합니다. (최초 1회)"})]}),t.jsx("hr",{}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx("h3",{children:"백엔드에 알림 발송 요청하기"}),t.jsxs("div",{style:{marginBottom:"10px"},children:[t.jsx("label",{htmlFor:"push-title",style:{display:"block"},children:"제목:"}),t.jsx("input",{id:"push-title",type:"text",value:r,onChange:e=>x(e.target.value),style:{width:"90%",padding:"8px"}})]}),t.jsxs("div",{style:{marginBottom:"10px"},children:[t.jsx("label",{htmlFor:"push-body",style:{display:"block"},children:"내용:"}),t.jsx("textarea",{id:"push-body",value:a,onChange:e=>y(e.target.value),rows:"3",style:{width:"90%",padding:"8px"}})]}),t.jsx("button",{onClick:f,children:"📤 백엔드에 푸시 알림 요청"})]})]})]})}function S(){return t.jsx(w,{userId:"user1234"})}const h=document.getElementById("root");h&&j.createRoot(h).render(t.jsx(S,{}));
