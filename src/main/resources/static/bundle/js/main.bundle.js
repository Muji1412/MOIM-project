import{c as an,R as jr,r as oe,j as Y,a as hi}from"../chunk/client.chunk.js";import{r as pi}from"../chunk/inherits_browser.chunk.js";var ge={},je={},cn;function Br(){return cn||(cn=1,function(p){var x=je&&je.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();function S(f){if(!f)return S.__;Array.prototype.reduce||(Array.prototype.reduce=function(o,a){for(var i=a,t=0;t<this.length;t++)i=o(i,this[t],t,this);return i});var d="",c=("."+f).split(".").reduce(function(o,a,i,t){d?d+="."+a:d=a;var E=o["__"+d];return E===void 0&&(S.Logger.prototype=o,E=new S.Logger(d),o["__"+d]=E),E},S.__);return c}(function(f){f.requestId="",f.entryId=0,f._createXMLHttpRequest=function(){return new XMLHttpRequest},f._getTime=function(){return new Date().getTime()},f._console=console,f._appenderNames=[];function d(R,m,O){if(m[R]!==void 0){if(m[R]===null){delete O[R];return}O[R]=m[R]}}function c(R){if(f.enabled!=null&&!f.enabled)return!1;try{if(R.userAgentRegex&&!new RegExp(R.userAgentRegex).test(navigator.userAgent))return!1}catch{}try{if(R.ipRegex&&f.clientIP&&!new RegExp(R.ipRegex).test(f.clientIP))return!1}catch{}return!0}function o(R,m){try{if(R.disallow&&new RegExp(R.disallow).test(m))return!1}catch{}return!0}function a(R){return typeof R=="function"?R instanceof RegExp?R.toString():R():R}var i=function(){function R(m,O,M){this.msg=m,this.meta=O,this.finalString=M}return R}();function t(R){var m=a(R),O;switch(typeof m){case"string":return new i(m,null,m);case"number":return O=m.toString(),new i(O,null,O);case"boolean":return O=m.toString(),new i(O,null,O);case"undefined":return new i("undefined",null,"undefined");case"object":return m instanceof RegExp||m instanceof String||m instanceof Number||m instanceof Boolean?(O=m.toString(),new i(O,null,O)):(typeof f.serialize=="function"?O=f.serialize.call(this,m):O=JSON.stringify(m),new i("",m,O));default:return new i("unknown",null,"unknown")}}function E(R){return d("enabled",R,this),d("maxMessages",R,this),d("defaultAjaxUrl",R,this),d("clientIP",R,this),d("requestId",R,this),d("defaultBeforeSend",R,this),d("serialize",R,this),this}f.setOptions=E;function w(){return-2147483648}f.getAllLevel=w;function C(){return 1e3}f.getTraceLevel=C;function h(){return 2e3}f.getDebugLevel=h;function P(){return 3e3}f.getInfoLevel=P;function v(){return 4e3}f.getWarnLevel=v;function u(){return 5e3}f.getErrorLevel=u;function s(){return 6e3}f.getFatalLevel=s;function _(){return 2147483647}f.getOffLevel=_;function k(R){return R<=1e3?"trace":R<=2e3?"debug":R<=3e3?"info":R<=4e3?"warn":R<=5e3?"error":"fatal"}var b=function(){function R(m,O){this.inner=O,this.name="JL.Exception",this.message=t(m).finalString}return R}();f.Exception=b,b.prototype=new Error;var e=function(){function R(m,O,M,V,j){this.l=m,this.m=O,this.n=M,this.t=V,this.u=j}return R}();f.LogItem=e;function l(R,m,O){return f.entryId++,new e(R,m,O,f._getTime(),f.entryId)}function I(R){R.id&&(clearTimeout(R.id),R.id=null)}function n(R,m,O){var M=this;R.id||(R.id=setTimeout(function(){O.call(M)},m))}var y=function(){function R(m,O){this.appenderName=m,this.sendLogItems=O,this.level=f.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;var M="Trying to create an appender without a name or with an empty name";if(m==null)throw M;if(f._appenderNames.indexOf(m)!=-1)throw m?"Multiple appenders use the same name "+m:M;f._appenderNames.push(m)}return R.prototype.addLogItemsToBuffer=function(m){if(this.batchBuffer.length>=this.maxBatchSize){this.nbrLogItemsSkipped+=m.length;return}if(f.maxMessages!=null){if(f.maxMessages<1)return;f.maxMessages-=m.length}this.batchBuffer=this.batchBuffer.concat(m);var O=this;n(this.batchTimeoutTimer,this.batchTimeout,function(){O.sendBatch.call(O)})},R.prototype.batchBufferHasOverdueMessages=function(){for(var m=0;m<this.batchBuffer.length;m++){var O=f._getTime()-this.batchBuffer[m].t;if(O>this.batchTimeout)return!0}return!1},R.prototype.batchBufferHasStrandedMessage=function(){return f.maxMessages!=null&&f.maxMessages<1&&this.batchBuffer.length>0},R.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},R.prototype.onSendingEnded=function(){I(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},R.prototype.setOptions=function(m){if(d("level",m,this),d("ipRegex",m,this),d("userAgentRegex",m,this),d("disallow",m,this),d("sendWithBufferLevel",m,this),d("storeInBufferLevel",m,this),d("bufferSize",m,this),d("batchSize",m,this),d("maxBatchSize",m,this),d("batchTimeout",m,this),d("sendTimeout",m,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new f.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},R.prototype.log=function(m,O,M,V,j,B,W){var F;if(c(this)&&o(this,B)&&!(j<this.storeInBufferLevel)){if(F=l(j,B,W),j<this.level){this.bufferSize>0&&(this.buffer.push(F),this.buffer.length>this.bufferSize&&this.buffer.shift());return}this.addLogItemsToBuffer([F]),j>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete()}},R.prototype.sendBatch=function(){if(!(this.nbrLogItemsBeingSent>0)&&(I(this.batchTimeoutTimer),this.batchBuffer.length!=0)){this.nbrLogItemsBeingSent=this.batchBuffer.length;var m=this;n(this.sendTimeoutTimer,this.sendTimeout,function(){m.onSendingEnded.call(m)}),this.sendLogItems(this.batchBuffer,function(){m.batchBuffer.splice(0,m.nbrLogItemsBeingSent),m.nbrLogItemsSkipped>0&&(m.batchBuffer.push(l(v(),"Lost "+m.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",m.appenderName)),m.nbrLogItemsSkipped=0),m.onSendingEnded.call(m)})}},R}();f.Appender=y;var T=function(R){x(m,R);function m(O){return R.call(this,O,m.prototype.sendLogItemsAjax)||this}return m.prototype.setOptions=function(O){return d("url",O,this),d("beforeSend",O,this),R.prototype.setOptions.call(this,O),this},m.prototype.sendLogItemsAjax=function(O,M){try{if(!c(this))return;this.xhr&&this.xhr.readyState!=0&&this.xhr.readyState!=4&&this.xhr.abort(),this.xhr=f._createXMLHttpRequest();var V="/jsnlog.logger";f.defaultAjaxUrl!=null&&(V=f.defaultAjaxUrl),this.url&&(V=this.url),this.xhr.open("POST",V),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",f.requestId);var j=this;this.xhr.onreadystatechange=function(){j.xhr.readyState==4&&j.xhr.status>=200&&j.xhr.status<300&&M()};var B={r:f.requestId,lg:O};typeof this.beforeSend=="function"?this.beforeSend.call(this,this.xhr,B):typeof f.defaultBeforeSend=="function"&&f.defaultBeforeSend.call(this,this.xhr,B);var W=JSON.stringify(B);this.xhr.send(W)}catch{}},m}(y);f.AjaxAppender=T;var L=function(R){x(m,R);function m(O){return R.call(this,O,m.prototype.sendLogItemsConsole)||this}return m.prototype.clog=function(O){f._console.log(O)},m.prototype.cerror=function(O){f._console.error?f._console.error(O):this.clog(O)},m.prototype.cwarn=function(O){f._console.warn?f._console.warn(O):this.clog(O)},m.prototype.cinfo=function(O){f._console.info?f._console.info(O):this.clog(O)},m.prototype.cdebug=function(O){f._console.debug?f._console.debug(O):this.cinfo(O)},m.prototype.sendLogItemsConsole=function(O,M){try{if(!c(this)||!f._console)return;var V;for(V=0;V<O.length;++V){var j=O[V],B=j.n+": "+j.m;typeof window>"u"&&(B=new Date(j.t)+" | "+B),j.l<=f.getDebugLevel()?this.cdebug(B):j.l<=f.getInfoLevel()?this.cinfo(B):j.l<=f.getWarnLevel()?this.cwarn(B):this.cerror(B)}}catch{}M()},m}(y);f.ConsoleAppender=L;var D=function(){function R(m){this.loggerName=m,this.seenRegexes=[]}return R.prototype.setOptions=function(m){return d("level",m,this),d("userAgentRegex",m,this),d("disallow",m,this),d("ipRegex",m,this),d("appenders",m,this),d("onceOnly",m,this),this.seenRegexes=[],this},R.prototype.buildExceptionObject=function(m){var O={};return m.stack?O.stack=m.stack:O.e=m,m.message&&(O.message=m.message),m.name&&(O.name=m.name),m.data&&(O.data=m.data),m.inner&&(O.inner=this.buildExceptionObject(m.inner)),O},R.prototype.log=function(m,O,M){var V=0,j,B;if(!this.appenders)return this;if(m>=this.level&&c(this)&&(M?(B=this.buildExceptionObject(M),B.logData=a(O)):B=O,j=t(B),o(this,j.finalString))){if(this.onceOnly)for(V=this.onceOnly.length-1;V>=0;){if(new RegExp(this.onceOnly[V]).test(j.finalString)){if(this.seenRegexes[V])return this;this.seenRegexes[V]=!0}V--}for(j.meta=j.meta||{},V=this.appenders.length-1;V>=0;)this.appenders[V].log(k(m),j.msg,j.meta,function(){},m,j.finalString,this.loggerName),V--}return this},R.prototype.trace=function(m){return this.log(C(),m)},R.prototype.debug=function(m){return this.log(h(),m)},R.prototype.info=function(m){return this.log(P(),m)},R.prototype.warn=function(m){return this.log(v(),m)},R.prototype.error=function(m){return this.log(u(),m)},R.prototype.fatal=function(m){return this.log(s(),m)},R.prototype.fatalException=function(m,O){return this.log(s(),m,O)},R}();f.Logger=D;function r(R){return new T(R)}f.createAjaxAppender=r;function g(R){return new L(R)}f.createConsoleAppender=g;var N;typeof window<"u"?N=new T(""):N=new L(""),f.__=new f.Logger(""),f.__.setOptions({level:f.getDebugLevel(),appenders:[N]})})(S||(S={})),p.__esModule=!0,p.JL=S,typeof __jsnlog_configure=="function"&&__jsnlog_configure(S),typeof window<"u"&&!window.onerror&&(window.onerror=function(f,d,c,o,a){return S("onerrorLogger").fatalException({msg:"Uncaught Exception",errorMsg:f?f.message||f:"",url:d,"line number":c,column:o},a),!1}),typeof window<"u"&&!window.onunhandledrejection&&(window.onunhandledrejection=function(f){S("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:f.reason?f.reason.message:f.message||null},f.reason)})}(je)),je}var fe={},Be={},Et={},un;function qr(){return un||(un=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),p.LocalRecorderState=void 0,function(x){x.READY="READY",x.RECORDING="RECORDING",x.PAUSED="PAUSED",x.FINISHED="FINISHED"}(p.LocalRecorderState||(p.LocalRecorderState={}))}(Et)),Et}var qe={},Fe={},dn;function vi(){if(dn)return Fe;dn=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.ConsoleLogger=void 0;var p=function(){function x(S){this.logger=S,this.log=S.log,this.info=S.info,this.debug=S.debug,this.warn=S.warn,this.error=S.error}return x}();return Fe.ConsoleLogger=p,Fe}var bt={},ln;function Fr(){return ln||(ln=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),p.OpenViduLoggerConfiguration=void 0,function(x){x.disabled="disabled",x.debug="debug",x.debug_app="debug_app"}(p.OpenViduLoggerConfiguration||(p.OpenViduLoggerConfiguration={}))}(bt)),bt}var fn;function se(){if(fn)return qe;fn=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.OpenViduLogger=void 0;var p=Br(),x=vi(),S=Fr(),f=function(){function d(){this.JSNLOG_URL="/openvidu/elk/openvidu-browser-logs",this.MAX_JSNLOG_BATCH_LOG_MESSAGES=100,this.MAX_MSECONDS_BATCH_MESSAGES=5e3,this.MAX_LENGTH_STRING_JSON=1e3,this.defaultConsoleLogger=new x.ConsoleLogger(globalThis.console),this.isProdMode=!1,this.isJSNLogSetup=!1}return d.configureJSNLog=function(c,o){var a=this;try{if(globalThis.LOG_JSNLOG_RESULTS||this.instance&&c.isAtLeastPro&&this.instance.isOpenViduBrowserLogsDebugActive(c)&&this.instance.canConfigureJSNLog(c,this.instance)){c.sendBrowserLogs===S.OpenViduLoggerConfiguration.debug_app&&this.instance.replaceWindowConsole(),this.instance.isJSNLogSetup=!1,this.instance.info("Configuring JSNLogs.");var i=c.finalUserId,t=c.session.sessionId,E=function(C){var h=C.onreadystatechange;C.onreadystatechange=function(){a.isInvalidResponse(C)&&(Object.defineProperty(C,"readyState",{value:4}),Object.defineProperty(C,"status",{value:200}),a.instance.disableLogger()),h()},C.setRequestHeader("Authorization","Basic "+btoa("".concat(i,"%/%").concat(t)+":"+o)),C.setRequestHeader("X-Requested-With","XMLHttpRequest"),C.setRequestHeader("OV-Final-User-Id",i),C.setRequestHeader("OV-Session-Id",t),C.setRequestHeader("OV-Token",o)};this.instance.currentAppender=p.JL.createAjaxAppender("appender-".concat(i,"-").concat(t)),this.instance.currentAppender.setOptions({beforeSend:E,maxBatchSize:1e3,batchSize:this.instance.MAX_JSNLOG_BATCH_LOG_MESSAGES,batchTimeout:this.instance.MAX_MSECONDS_BATCH_MESSAGES});var w=function(C){var h=function(){var v=new WeakSet;return function(u,s){if(typeof s=="object"&&s!=null){if(v.has(s)||globalThis.HTMLElement&&s instanceof HTMLElement)return;v.add(s)}return s}},P=JSON.stringify(C,h());return P.length>a.instance.MAX_LENGTH_STRING_JSON&&(P="".concat(P.substring(0,a.instance.MAX_LENGTH_STRING_JSON),"...")),globalThis.LOG_JSNLOG_RESULTS&&console.log(P),P};p.JL.setOptions({defaultAjaxUrl:c.httpUri+this.instance.JSNLOG_URL,serialize:w,enabled:!0}),(0,p.JL)().setOptions({appenders:[this.instance.currentAppender]}),this.instance.isJSNLogSetup=!0,this.instance.loggingSessionId=t,this.instance.info("JSNLog configured.")}}catch(C){console.error("Error configuring JSNLog: "),console.error(C),this.instance.disableLogger()}},d.getInstance=function(){return d.instance||(d.instance=new d),d.instance},d.isInvalidResponse=function(c){return c.status==401||c.status==403||c.status==404||c.status==0},d.prototype.canConfigureJSNLog=function(c,o){return c.session.sessionId!=o.loggingSessionId},d.prototype.isOpenViduBrowserLogsDebugActive=function(c){return c.sendBrowserLogs===S.OpenViduLoggerConfiguration.debug||c.sendBrowserLogs===S.OpenViduLoggerConfiguration.debug_app},d.prototype.getConsoleWithJSNLog=function(){return function(c){return{log:function(){c.defaultConsoleLogger.log.apply(c.defaultConsoleLogger.logger,arguments),c.isJSNLogSetup&&(0,p.JL)().info(arguments)},info:function(){c.defaultConsoleLogger.info.apply(c.defaultConsoleLogger.logger,arguments),c.isJSNLogSetup&&(0,p.JL)().info(arguments)},debug:function(){c.defaultConsoleLogger.debug.apply(c.defaultConsoleLogger.logger,arguments)},warn:function(){c.defaultConsoleLogger.warn.apply(c.defaultConsoleLogger.logger,arguments),c.isJSNLogSetup&&(0,p.JL)().warn(arguments)},error:function(){c.defaultConsoleLogger.error.apply(c.defaultConsoleLogger.logger,arguments),c.isJSNLogSetup&&(0,p.JL)().error(arguments)}}}(this)},d.prototype.replaceWindowConsole=function(){globalThis.console=this.defaultConsoleLogger.logger,globalThis.console.log=this.getConsoleWithJSNLog().log,globalThis.console.info=this.getConsoleWithJSNLog().info,globalThis.console.debug=this.getConsoleWithJSNLog().debug,globalThis.console.warn=this.getConsoleWithJSNLog().warn,globalThis.console.error=this.getConsoleWithJSNLog().error},d.prototype.disableLogger=function(){p.JL.setOptions({enabled:!1}),this.isJSNLogSetup=!1,this.loggingSessionId=void 0,this.currentAppender=void 0,globalThis.console=this.defaultConsoleLogger.logger,globalThis.console.log=this.defaultConsoleLogger.log,globalThis.console.info=this.defaultConsoleLogger.info,globalThis.console.debug=this.defaultConsoleLogger.debug,globalThis.console.warn=this.defaultConsoleLogger.warn,globalThis.console.error=this.defaultConsoleLogger.error},d.prototype.log=function(){this.isProdMode||this.defaultConsoleLogger.log.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,p.JL)().info(arguments)},d.prototype.debug=function(){this.isProdMode||this.defaultConsoleLogger.debug.apply(this.defaultConsoleLogger.logger,arguments)},d.prototype.info=function(){this.isProdMode||this.defaultConsoleLogger.info.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,p.JL)().info(arguments)},d.prototype.warn=function(){this.defaultConsoleLogger.warn.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,p.JL)().warn(arguments)},d.prototype.error=function(){this.defaultConsoleLogger.error.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,p.JL)().error(arguments)},d.prototype.flush=function(){this.isJSNLogSetup&&this.currentAppender!=null&&this.currentAppender.sendBatch()},d.prototype.enableProdMode=function(){this.isProdMode=!0},d}();return qe.OpenViduLogger=f,qe}var Ue={},st={exports:{}};/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */var mi=st.exports,hn;function gi(){return hn||(hn=1,function(p,x){(function(){var S={function:!0,object:!0},f=S[typeof window]&&window||this,d=x,c=p&&!p.nodeType&&p,o=d&&c&&typeof an=="object"&&an;o&&(o.global===o||o.window===o||o.self===o)&&(f=o);var a=Math.pow(2,53)-1,i=/\bOpera/,t=Object.prototype,E=t.hasOwnProperty,w=t.toString;function C(n){return n=String(n),n.charAt(0).toUpperCase()+n.slice(1)}function h(n,y,T){var L={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return y&&T&&/^Win/i.test(n)&&!/^Windows Phone /i.test(n)&&(L=L[/[\d.]+$/.exec(n)])&&(n="Windows "+L),n=String(n),y&&T&&(n=n.replace(RegExp(y,"i"),T)),n=v(n.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),n}function P(n,y){var T=-1,L=n?n.length:0;if(typeof L=="number"&&L>-1&&L<=a)for(;++T<L;)y(n[T],T,n);else u(n,y)}function v(n){return n=e(n),/^(?:webOS|i(?:OS|P))/.test(n)?n:C(n)}function u(n,y){for(var T in n)E.call(n,T)&&y(n[T],T,n)}function s(n){return n==null?C(n):w.call(n).slice(8,-1)}function _(n,y){var T=n!=null?typeof n[y]:"number";return!/^(?:boolean|number|string|undefined)$/.test(T)&&(T=="object"?!!n[y]:!0)}function k(n){return String(n).replace(/([ -])(?!$)/g,"$1?")}function b(n,y){var T=null;return P(n,function(L,D){T=y(T,L,D,n)}),T}function e(n){return String(n).replace(/^ +| +$/g,"")}function l(n){var y=f,T=n&&typeof n=="object"&&s(n)!="String";T&&(y=n,n=null);var L=y.navigator||{},D=L.userAgent||"";n||(n=D);var r=T?!!L.likeChrome:/\bChrome\b/.test(n)&&!/internal|\n/i.test(w.toString()),g="Object",N=T?g:"ScriptBridgingProxyObject",R=T?g:"Environment",m=T&&y.java?"JavaPackage":s(y.java),O=T?g:"RuntimeObject",M=/\bJava/.test(m)&&y.java,V=M&&s(y.environment)==R,j=M?"a":"α",B=M?"b":"β",W=y.document||{},F=y.operamini||y.opera,G=i.test(G=T&&F?F["[[Class]]"]:s(F))?G:F=null,A,z=n,$=[],Z=null,K=n==D,U=K&&F&&typeof F.version=="function"&&F.version(),re,X=ci([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),q=di(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),J=on([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),ee=ui({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),H=li(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function ci(ie){return b(ie,function(te,Q){return te||RegExp("\\b"+(Q.pattern||k(Q))+"\\b","i").exec(n)&&(Q.label||Q)})}function ui(ie){return b(ie,function(te,Q,ue){return te||(Q[J]||Q[/^[a-z]+(?: +[a-z]+\b)*/i.exec(J)]||RegExp("\\b"+k(ue)+"(?:\\b|\\w*\\d)","i").exec(n))&&ue})}function di(ie){return b(ie,function(te,Q){return te||RegExp("\\b"+(Q.pattern||k(Q))+"\\b","i").exec(n)&&(Q.label||Q)})}function li(ie){return b(ie,function(te,Q){var ue=Q.pattern||k(Q);return!te&&(te=RegExp("\\b"+ue+"(?:/[\\d.]+|[ \\w.]*)","i").exec(n))&&(te=h(te,ue,Q.label||Q)),te})}function on(ie){return b(ie,function(te,Q){var ue=Q.pattern||k(Q);return!te&&(te=RegExp("\\b"+ue+" *\\d+[.\\w_]*","i").exec(n)||RegExp("\\b"+ue+" *\\w+-[\\w]*","i").exec(n)||RegExp("\\b"+ue+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(n))&&((te=String(Q.label&&!RegExp(ue,"i").test(Q.label)?Q.label:te).split("/"))[1]&&!/[\d.]+/.test(te[0])&&(te[0]+=" "+te[1]),Q=Q.label||Q,te=v(te[0].replace(RegExp(ue,"i"),Q).replace(RegExp("; *(?:"+Q+"[_-])?","i")," ").replace(RegExp("("+Q+")[-_.]?(\\w)","i"),"$1 $2"))),te})}function sn(ie){return b(ie,function(te,Q){return te||(RegExp(Q+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(n)||0)[1]||null})}function fi(){return this.description||""}if(X&&(X=[X]),/\bAndroid\b/.test(H)&&!J&&(A=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(n))&&(J=e(A[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),ee&&!J?J=on([ee]):ee&&J&&(J=J.replace(RegExp("^("+k(ee)+")[-_.\\s]","i"),ee+" ").replace(RegExp("^("+k(ee)+")[-_.]?(\\w)","i"),ee+" $2")),(A=/\bGoogle TV\b/.exec(J))&&(J=A[0]),/\bSimulator\b/i.test(n)&&(J=(J?J+" ":"")+"Simulator"),q=="Opera Mini"&&/\bOPiOS\b/.test(n)&&$.push("running in Turbo/Uncompressed mode"),q=="IE"&&/\blike iPhone OS\b/.test(n)?(A=l(n.replace(/like iPhone OS/,"")),ee=A.manufacturer,J=A.product):/^iP/.test(J)?(q||(q="Safari"),H="iOS"+((A=/ OS ([\d_]+)/i.exec(n))?" "+A[1].replace(/_/g,"."):"")):q=="Konqueror"&&/^Linux\b/i.test(H)?H="Kubuntu":ee&&ee!="Google"&&(/Chrome/.test(q)&&!/\bMobile Safari\b/i.test(n)||/\bVita\b/.test(J))||/\bAndroid\b/.test(H)&&/^Chrome/.test(q)&&/\bVersion\//i.test(n)?(q="Android Browser",H=/\bAndroid\b/.test(H)?H:"Android"):q=="Silk"?(/\bMobi/i.test(n)||(H="Android",$.unshift("desktop mode")),/Accelerated *= *true/i.test(n)&&$.unshift("accelerated")):q=="UC Browser"&&/\bUCWEB\b/.test(n)?$.push("speed mode"):q=="PaleMoon"&&(A=/\bFirefox\/([\d.]+)\b/.exec(n))?$.push("identifying as Firefox "+A[1]):q=="Firefox"&&(A=/\b(Mobile|Tablet|TV)\b/i.exec(n))?(H||(H="Firefox OS"),J||(J=A[1])):!q||(A=!/\bMinefield\b/i.test(n)&&/\b(?:Firefox|Safari)\b/.exec(q))?(q&&!J&&/[\/,]|^[^(]+?\)/.test(n.slice(n.indexOf(A+"/")+8))&&(q=null),(A=J||ee||H)&&(J||ee||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(H))&&(q=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(H)?H:A)+" Browser")):q=="Electron"&&(A=(/\bChrome\/([\d.]+)\b/.exec(n)||0)[1])&&$.push("Chromium "+A),U||(U=sn(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",k(q),"(?:Firefox|Minefield|NetFront)"])),(A=X=="iCab"&&parseFloat(U)>3&&"WebKit"||/\bOpera\b/.test(q)&&(/\bOPR\b/.test(n)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(n)&&!/^(?:Trident|EdgeHTML)$/.test(X)&&"WebKit"||!X&&/\bMSIE\b/i.test(n)&&(H=="Mac OS"?"Tasman":"Trident")||X=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(q)&&"NetFront")&&(X=[A]),q=="IE"&&(A=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(n)||0)[1])?(q+=" Mobile",H="Windows Phone "+(/\+$/.test(A)?A:A+".x"),$.unshift("desktop mode")):/\bWPDesktop\b/i.test(n)?(q="IE Mobile",H="Windows Phone 8.x",$.unshift("desktop mode"),U||(U=(/\brv:([\d.]+)/.exec(n)||0)[1])):q!="IE"&&X=="Trident"&&(A=/\brv:([\d.]+)/.exec(n))&&(q&&$.push("identifying as "+q+(U?" "+U:"")),q="IE",U=A[1]),K){if(_(y,"global"))if(M&&(A=M.lang.System,z=A.getProperty("os.arch"),H=H||A.getProperty("os.name")+" "+A.getProperty("os.version")),V){try{U=y.require("ringo/engine").version.join("."),q="RingoJS"}catch{(A=y.system)&&A.global.system==y.system&&(q="Narwhal",H||(H=A[0].os||null))}q||(q="Rhino")}else typeof y.process=="object"&&!y.process.browser&&(A=y.process)&&(typeof A.versions=="object"&&(typeof A.versions.electron=="string"?($.push("Node "+A.versions.node),q="Electron",U=A.versions.electron):typeof A.versions.nw=="string"&&($.push("Chromium "+U,"Node "+A.versions.node),q="NW.js",U=A.versions.nw)),q||(q="Node.js",z=A.arch,H=A.platform,U=/[\d.]+/.exec(A.version),U=U?U[0]:null));else s(A=y.runtime)==N?(q="Adobe AIR",H=A.flash.system.Capabilities.os):s(A=y.phantom)==O?(q="PhantomJS",U=(A=A.version||null)&&A.major+"."+A.minor+"."+A.patch):typeof W.documentMode=="number"&&(A=/\bTrident\/(\d+)/i.exec(n))?(U=[U,W.documentMode],(A=+A[1]+4)!=U[1]&&($.push("IE "+U[1]+" mode"),X&&(X[1]=""),U[1]=A),U=q=="IE"?String(U[1].toFixed(1)):U[0]):typeof W.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(q)&&($.push("masking as "+q+" "+U),q="IE",U="11.0",X=["Trident"],H="Windows");H=H&&v(H)}if(U&&(A=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(U)||/(?:alpha|beta)(?: ?\d)?/i.exec(n+";"+(K&&L.appMinorVersion))||/\bMinefield\b/i.test(n)&&"a")&&(Z=/b/i.test(A)?"beta":"alpha",U=U.replace(RegExp(A+"\\+?$"),"")+(Z=="beta"?B:j)+(/\d+\+?/.exec(A)||"")),q=="Fennec"||q=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(H))q="Firefox Mobile";else if(q=="Maxthon"&&U)U=U.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(J))J=="Xbox 360"&&(H=null),J=="Xbox 360"&&/\bIEMobile\b/.test(n)&&$.unshift("mobile mode");else if((/^(?:Chrome|IE|Opera)$/.test(q)||q&&!J&&!/Browser|Mobi/.test(q))&&(H=="Windows CE"||/Mobi/i.test(n)))q+=" Mobile";else if(q=="IE"&&K)try{y.external===null&&$.unshift("platform preview")}catch{$.unshift("embedded")}else(/\bBlackBerry\b/.test(J)||/\bBB10\b/.test(n))&&(A=(RegExp(J.replace(/ +/g," *")+"/([.\\d]+)","i").exec(n)||0)[1]||U)?(A=[A,/BB10/.test(n)],H=(A[1]?(J=null,ee="BlackBerry"):"Device Software")+" "+A[0],U=null):this!=u&&J!="Wii"&&(K&&F||/Opera/.test(q)&&/\b(?:MSIE|Firefox)\b/i.test(n)||q=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(H)||q=="IE"&&(H&&!/^Win/.test(H)&&U>5.5||/\bWindows XP\b/.test(H)&&U>8||U==8&&!/\bTrident\b/.test(n)))&&!i.test(A=l.call(u,n.replace(i,"")+";"))&&A.name&&(A="ing as "+A.name+((A=A.version)?" "+A:""),i.test(q)?(/\bIE\b/.test(A)&&H=="Mac OS"&&(H=null),A="identify"+A):(A="mask"+A,G?q=v(G.replace(/([a-z])([A-Z])/g,"$1 $2")):q="Opera",/\bIE\b/.test(A)&&(H=null),K||(U=null)),X=["Presto"],$.push(A));(A=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(n)||0)[1])&&(A=[parseFloat(A.replace(/\.(\d)$/,".0$1")),A],q=="Safari"&&A[1].slice(-1)=="+"?(q="WebKit Nightly",Z="alpha",U=A[1].slice(0,-1)):(U==A[1]||U==(A[2]=(/\bSafari\/([\d.]+\+?)/i.exec(n)||0)[1]))&&(U=null),A[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(n)||0)[1],A[0]==537.36&&A[2]==537.36&&parseFloat(A[1])>=28&&X=="WebKit"&&(X=["Blink"]),!K||!r&&!A[1]?(X&&(X[1]="like Safari"),A=(A=A[0],A<400?1:A<500?2:A<526?3:A<533?4:A<534?"4+":A<535?5:A<537?6:A<538?7:A<601?8:A<602?9:A<604?10:A<606?11:A<608?12:"12")):(X&&(X[1]="like Chrome"),A=A[1]||(A=A[0],A<530?1:A<532?2:A<532.05?3:A<533?4:A<534.03?5:A<534.07?6:A<534.1?7:A<534.13?8:A<534.16?9:A<534.24?10:A<534.3?11:A<535.01?12:A<535.02?"13+":A<535.07?15:A<535.11?16:A<535.19?17:A<536.05?18:A<536.1?19:A<537.01?20:A<537.11?"21+":A<537.13?23:A<537.18?24:A<537.24?25:A<537.36?26:X!="Blink"?"27":"28")),X&&(X[1]+=" "+(A+=typeof A=="number"?".x":/[.+]/.test(A)?"":"+")),q=="Safari"&&(!U||parseInt(U)>45)?U=A:q=="Chrome"&&/\bHeadlessChrome/i.test(n)&&$.unshift("headless")),q=="Opera"&&(A=/\bzbov|zvav$/.exec(H))?(q+=" ",$.unshift("desktop mode"),A=="zvav"?(q+="Mini",U=null):q+="Mobile",H=H.replace(RegExp(" *"+A+"$"),"")):q=="Safari"&&/\bChrome\b/.exec(X&&X[1])?($.unshift("desktop mode"),q="Chrome Mobile",U=null,/\bOS X\b/.test(H)?(ee="Apple",H="iOS 4.3+"):H=null):/\bSRWare Iron\b/.test(q)&&!U&&(U=sn("Chrome")),U&&U.indexOf(A=/[\d.]+$/.exec(H))==0&&n.indexOf("/"+A+"-")>-1&&(H=e(H.replace(A,""))),H&&H.indexOf(q)!=-1&&!RegExp(q+" OS").test(H)&&(H=H.replace(RegExp(" *"+k(q)+" *"),"")),X&&!/\b(?:Avant|Nook)\b/.test(q)&&(/Browser|Lunascape|Maxthon/.test(q)||q!="Safari"&&/^iOS/.test(H)&&/\bSafari\b/.test(X[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(q)&&X[1])&&(A=X[X.length-1])&&$.push(A),$.length&&($=["("+$.join("; ")+")"]),ee&&J&&J.indexOf(ee)<0&&$.push("on "+ee),J&&$.push((/^on /.test($[$.length-1])?"":"on ")+J),H&&(A=/ ([\d.+]+)$/.exec(H),re=A&&H.charAt(H.length-A[0].length-1)=="/",H={architecture:32,family:A&&!re?H.replace(A[0],""):H,version:A?A[1]:null,toString:function(){var ie=this.version;return this.family+(ie&&!re?" "+ie:"")+(this.architecture==64?" 64-bit":"")}}),(A=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(z))&&!/\bi686\b/i.test(z)?(H&&(H.architecture=64,H.family=H.family.replace(RegExp(" *"+A),"")),q&&(/\bWOW64\b/i.test(n)||K&&/\w(?:86|32)$/.test(L.cpuClass||L.platform)&&!/\bWin64; x64\b/i.test(n))&&$.unshift("32-bit")):H&&/^OS X/.test(H.family)&&q=="Chrome"&&parseFloat(U)>=39&&(H.architecture=64),n||(n=null);var ae={};return ae.description=n,ae.layout=X&&X[0],ae.manufacturer=ee,ae.name=q,ae.prerelease=Z,ae.product=J,ae.ua=n,ae.version=q&&U,ae.os=H||{architecture:null,family:null,version:null,toString:function(){return"null"}},ae.parse=l,ae.toString=fi,ae.version&&$.unshift(U),ae.name&&$.unshift(q),H&&q&&!(H==String(H).split(" ")[0]&&(H==q.split(" ")[0]||J))&&$.push(J?"("+H+")":"on "+H),$.length&&(ae.description=$.join(" ")),ae}var I=l();d&&c?u(I,function(n,y){d[y]=n}):f.platform=I}).call(mi)}(st,st.exports)),st.exports}var pn;function me(){if(pn)return Ue;pn=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.PlatformUtils=void 0;var p=gi(),x=function(){function S(){}return S.getInstance=function(){return this.instance||(this.instance=new S),S.instance},S.prototype.isChromeBrowser=function(){return p.name==="Chrome"},S.prototype.isSafariBrowser=function(){return p.name==="Safari"},S.prototype.isChromeMobileBrowser=function(){return p.name==="Chrome Mobile"},S.prototype.isFirefoxBrowser=function(){return p.name==="Firefox"},S.prototype.isFirefoxMobileBrowser=function(){return p.name==="Firefox Mobile"||p.name==="Firefox for iOS"},S.prototype.isOperaBrowser=function(){return p.name==="Opera"},S.prototype.isOperaMobileBrowser=function(){return p.name==="Opera Mobile"},S.prototype.isEdgeBrowser=function(){var f=p!=null&&p.version?parseFloat(p.version):-1;return p.name==="Microsoft Edge"&&f>=80},S.prototype.isEdgeMobileBrowser=function(){var f,d,c=p!=null&&p.version?parseFloat(p.version):-1;return p.name==="Microsoft Edge"&&(((f=p.os)===null||f===void 0?void 0:f.family)==="Android"||((d=p.os)===null||d===void 0?void 0:d.family)==="iOS")&&c>45},S.prototype.isAndroidBrowser=function(){return p.name==="Android Browser"},S.prototype.isElectron=function(){return p.name==="Electron"},S.prototype.isNodeJs=function(){return p.name==="Node.js"},S.prototype.isSamsungBrowser=function(){return p.name==="Samsung Internet Mobile"||p.name==="Samsung Internet"},S.prototype.isMotorolaEdgeDevice=function(){var f;return((f=p.product)===null||f===void 0?void 0:f.toLowerCase().includes("motorola edge"))||!1},S.prototype.isIPhoneOrIPad=function(){var f=p.ua?p.ua:navigator.userAgent,d="ontouchend"in document,c=/\b(\w*Macintosh\w*)\b/.test(f)&&d,o=/\b(\w*iPhone\w*)\b/.test(f)&&/\b(\w*Mobile\w*)\b/.test(f)&&d;return c||o},S.prototype.isIOSWithSafari=function(){var f=p.ua?p.ua:navigator.userAgent;return this.isIPhoneOrIPad()&&/\b(\w*Apple\w*)\b/.test(navigator.vendor)&&/\b(\w*Safari\w*)\b/.test(f)&&!/\b(\w*CriOS\w*)\b/.test(f)&&!/\b(\w*FxiOS\w*)\b/.test(f)},S.prototype.isIonicIos=function(){return this.isIPhoneOrIPad()&&p.ua.indexOf("Safari")===-1},S.prototype.isIonicAndroid=function(){return p.os.family==="Android"&&p.name=="Android Browser"},S.prototype.isMobileDevice=function(){return p.os.family==="iOS"||p.os.family==="Android"},S.prototype.isReactNative=function(){return!1},S.prototype.isChromium=function(){return this.isChromeBrowser()||this.isChromeMobileBrowser()||this.isOperaBrowser()||this.isOperaMobileBrowser()||this.isEdgeBrowser()||this.isEdgeMobileBrowser()||this.isSamsungBrowser()||this.isIonicAndroid()||this.isIonicIos()||this.isElectron()||this.isMotorolaEdgeDevice()},S.prototype.canScreenShare=function(){var f=p!=null&&p.version?parseFloat(p.version):-1;return this.isMobileDevice()?!1:this.isChromeBrowser()||this.isFirefoxBrowser()||this.isOperaBrowser()||this.isElectron()||this.isEdgeBrowser()||this.isSafariBrowser()&&f>=13},S.prototype.getName=function(){return p.name||""},S.prototype.getVersion=function(){return p.version||""},S.prototype.getFamily=function(){return p.os.family||""},S.prototype.getDescription=function(){return p.description||""},S}();return Ue.PlatformUtils=x,Ue}var St,vn;function Ei(){if(vn)return St;vn=1;function p(){this._types=Object.create(null),this._extensions=Object.create(null);for(let x=0;x<arguments.length;x++)this.define(arguments[x]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}return p.prototype.define=function(x,S){for(let f in x){let d=x[f].map(function(c){return c.toLowerCase()});f=f.toLowerCase();for(let c=0;c<d.length;c++){const o=d[c];if(o[0]!=="*"){if(!S&&o in this._types)throw new Error('Attempt to change mapping for "'+o+'" extension from "'+this._types[o]+'" to "'+f+'". Pass `force=true` to allow this, otherwise remove "'+o+'" from the list of extensions for "'+f+'".');this._types[o]=f}}if(S||!this._extensions[f]){const c=d[0];this._extensions[f]=c[0]!=="*"?c:c.substr(1)}}},p.prototype.getType=function(x){x=String(x);let S=x.replace(/^.*[/\\]/,"").toLowerCase(),f=S.replace(/^.*\./,"").toLowerCase(),d=S.length<x.length;return(f.length<S.length-1||!d)&&this._types[f]||null},p.prototype.getExtension=function(x){return x=/^\s*([^;\s]*)/.test(x)&&RegExp.$1,x&&this._extensions[x.toLowerCase()]||null},St=p,St}var yt,mn;function bi(){return mn||(mn=1,yt={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]}),yt}var wt,gn;function Si(){if(gn)return wt;gn=1;let p=Ei();return wt=new p(bi()),wt}var En;function Ur(){if(En)return Be;En=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.LocalRecorder=void 0;var p=qr(),x=se(),S=me(),f=Si(),d=x.OpenViduLogger.getInstance(),c,o=function(){function a(i){this.stream=i,this.chunks=[],c=S.PlatformUtils.getInstance(),this.connectionId=this.stream.connection?this.stream.connection.connectionId:"default-connection",this.id=this.stream.streamId+"_"+this.connectionId+"_localrecord",this.state=p.LocalRecorderState.READY}return a.prototype.record=function(i){var t=this;return new Promise(function(E,w){try{if(typeof i=="string"||i instanceof String)return w(`When calling LocalRecorder.record(options) parameter 'options' cannot be a string. Must be an object like { mimeType: "`.concat(i,'" }'));if(typeof MediaRecorder>"u")throw d.error("MediaRecorder not supported on your device. See compatibility in https://caniuse.com/#search=MediaRecorder"),Error("MediaRecorder not supported on your device. See compatibility in https://caniuse.com/#search=MediaRecorder");if(t.state!==p.LocalRecorderState.READY)throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '"+t.state+"'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before");d.log("Starting local recording of stream '"+t.stream.streamId+"' of connection '"+t.connectionId+"'"),i?i.mimeType||(i.mimeType="video/webm"):i={mimeType:"video/webm"},t.mediaRecorder=new MediaRecorder(t.stream.getMediaStream(),i),t.mediaRecorder.start()}catch(C){return w(C)}return t.mediaRecorder.ondataavailable=function(C){C.data.size>0&&t.chunks.push(C.data)},t.mediaRecorder.onerror=function(C){d.error("MediaRecorder error: ",C)},t.mediaRecorder.onstart=function(){d.log("MediaRecorder started (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onstop=function(){t.onStopDefault()},t.mediaRecorder.onpause=function(){d.log("MediaRecorder paused (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onresume=function(){d.log("MediaRecorder resumed (state="+t.mediaRecorder.state+")")},t.state=p.LocalRecorderState.RECORDING,E()})},a.prototype.stop=function(){var i=this;return new Promise(function(t,E){try{if(i.state===p.LocalRecorderState.READY||i.state===p.LocalRecorderState.FINISHED)throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '"+i.state+"'). Call 'LocalRecorder.start()' before");i.mediaRecorder.onstop=function(){return i.onStopDefault(),t()},i.mediaRecorder.stop()}catch(w){return E(w)}})},a.prototype.pause=function(){var i=this;return new Promise(function(t,E){try{return i.state!==p.LocalRecorderState.RECORDING?E(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '"+i.state+"'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")):(i.mediaRecorder.pause(),i.state=p.LocalRecorderState.PAUSED,t())}catch(w){return E(w)}})},a.prototype.resume=function(){var i=this;return new Promise(function(t,E){try{if(i.state!==p.LocalRecorderState.PAUSED)throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '"+i.state+"'). Call 'LocalRecorder.pause()' before");return i.mediaRecorder.resume(),i.state=p.LocalRecorderState.RECORDING,t()}catch(w){return E(w)}})},a.prototype.preview=function(i){if(this.state!==p.LocalRecorderState.FINISHED)throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");if(this.videoPreview=document.createElement("video"),this.videoPreview.id=this.id,this.videoPreview.autoplay=!0,c.isSafariBrowser()&&(this.videoPreview.playsInline=!0),typeof i=="string"){var t=document.getElementById(i);t&&(this.videoPreview=t.appendChild(this.videoPreview))}else this.videoPreview=i.appendChild(this.videoPreview);return this.videoPreview.src=this.videoPreviewSrc,this.videoPreview},a.prototype.clean=function(){var i=this,t=function(){delete i.blob,i.chunks=[],i.state=p.LocalRecorderState.READY};this.state===p.LocalRecorderState.RECORDING||this.state===p.LocalRecorderState.PAUSED?this.stop().then(function(){return t()}).catch(function(){return t()}):t()},a.prototype.download=function(){if(this.state!==p.LocalRecorderState.FINISHED)throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");var i=document.createElement("a");i.style.display="none",document.body.appendChild(i);var t=globalThis.URL.createObjectURL(this.blob);i.href=t,i.download=this.id+"."+f.getExtension(this.blob.type),i.click(),globalThis.URL.revokeObjectURL(t),document.body.removeChild(i)},a.prototype.getBlob=function(){if(this.state!==p.LocalRecorderState.FINISHED)throw Error("Call 'LocalRecord.stop()' before getting Blob file");return this.blob},a.prototype.uploadAsBinary=function(i,t){var E=this;return new Promise(function(w,C){if(E.state!==p.LocalRecorderState.FINISHED)return C(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+E.state+"'). Call 'LocalRecorder.stop()' before"));var h=new XMLHttpRequest;if(h.open("POST",i,!0),typeof t=="object")for(var P=0,v=Object.keys(t);P<v.length;P++){var u=v[P];h.setRequestHeader(u,t[u])}h.onreadystatechange=function(){if(h.readyState===4)return h.status.toString().charAt(0)==="2"?w(h.responseText):C(h.status)},h.send(E.blob)})},a.prototype.uploadAsMultipartfile=function(i,t){var E=this;return new Promise(function(w,C){if(E.state!==p.LocalRecorderState.FINISHED)return C(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+E.state+"'). Call 'LocalRecorder.stop()' before"));var h=new XMLHttpRequest;if(h.open("POST",i,!0),typeof t=="object")for(var P=0,v=Object.keys(t);P<v.length;P++){var u=v[P];h.setRequestHeader(u,t[u])}var s=new FormData;s.append("file",E.blob,E.id+"."+f.getExtension(E.blob.type)),h.onreadystatechange=function(){if(h.readyState===4)return h.status.toString().charAt(0)==="2"?w(h.responseText):C(h.status)},h.send(s)})},a.prototype.onStopDefault=function(){d.log("MediaRecorder stopped  (state="+this.mediaRecorder.state+")"),this.blob=new Blob(this.chunks,{type:this.mediaRecorder.mimeType}),this.chunks=[],this.videoPreviewSrc=globalThis.URL.createObjectURL(this.blob),this.state=p.LocalRecorderState.FINISHED},a}();return Be.LocalRecorder=o,Be}var de={},le={},We={},he={},He={},Ee={},$e={},bn;function ce(){if(bn)return $e;bn=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.Event=void 0;var p=function(){function x(S,f,d){this.hasBeenPrevented=!1,this.cancelable=S,this.target=f,this.type=d}return x.prototype.isDefaultPrevented=function(){return this.hasBeenPrevented},x.prototype.preventDefault=function(){this.callDefaultBehavior=function(){},this.hasBeenPrevented=!0},x}();return $e.Event=p,$e}var Sn;function Ae(){if(Sn)return Ee;Sn=1;var p=Ee&&Ee.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.StreamPropertyChangedEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a,i,t,E){var w=f.call(this,!1,c,"streamPropertyChanged")||this;return w.stream=o,w.changedProperty=a,w.newValue=i,w.oldValue=t,w.reason=E,w}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return Ee.StreamPropertyChangedEvent=S,Ee}var Ot={},yn;function Ve(){return yn||(yn=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),p.OpenViduError=p.OpenViduErrorName=void 0,function(S){S.BROWSER_NOT_SUPPORTED="BROWSER_NOT_SUPPORTED",S.DEVICE_ACCESS_DENIED="DEVICE_ACCESS_DENIED",S.DEVICE_ALREADY_IN_USE="DEVICE_ALREADY_IN_USE",S.SCREEN_CAPTURE_DENIED="SCREEN_CAPTURE_DENIED",S.SCREEN_SHARING_NOT_SUPPORTED="SCREEN_SHARING_NOT_SUPPORTED",S.SCREEN_EXTENSION_NOT_INSTALLED="SCREEN_EXTENSION_NOT_INSTALLED",S.SCREEN_EXTENSION_DISABLED="SCREEN_EXTENSION_DISABLED",S.INPUT_VIDEO_DEVICE_NOT_FOUND="INPUT_VIDEO_DEVICE_NOT_FOUND",S.INPUT_AUDIO_DEVICE_NOT_FOUND="INPUT_AUDIO_DEVICE_NOT_FOUND",S.INPUT_AUDIO_DEVICE_GENERIC_ERROR="INPUT_AUDIO_DEVICE_GENERIC_ERROR",S.NO_INPUT_SOURCE_SET="NO_INPUT_SOURCE_SET",S.PUBLISHER_PROPERTIES_ERROR="PUBLISHER_PROPERTIES_ERROR",S.OPENVIDU_PERMISSION_DENIED="OPENVIDU_PERMISSION_DENIED",S.OPENVIDU_NOT_CONNECTED="OPENVIDU_NOT_CONNECTED",S.VIRTUAL_BACKGROUND_ERROR="VIRTUAL_BACKGROUND_ERROR",S.GENERIC_ERROR="GENERIC_ERROR"}(p.OpenViduErrorName||(p.OpenViduErrorName={}));var x=function(){function S(f,d){this.name=f,this.message=d}return S}();p.OpenViduError=x}(Ot)),Ot}var wn;function zt(){if(wn)return He;wn=1,Object.defineProperty(He,"__esModule",{value:!0}),He.Filter=void 0;var p=Ae(),x=Ve(),S=se(),f=S.OpenViduLogger.getInstance(),d=function(){function c(o,a){this.handlers=new Map,this.type=o,this.options=a}return c.prototype.execMethod=function(o,a){var i=this;return new Promise(function(t,E){var w;f.info("Executing filter method to stream "+i.stream.streamId);var C,h=function(u){f.info("Filter method successfully executed on Stream "+i.stream.streamId);var s=Object.assign({},i.stream.filter);return i.stream.filter.lastExecMethod={method:o,params:C},u&&(i.stream.session.emitEvent("streamPropertyChanged",[new p.StreamPropertyChangedEvent(i.stream.session,i.stream,"filter",i.stream.filter,s,"execFilterMethod")]),i.stream.streamManager.emitEvent("streamPropertyChanged",[new p.StreamPropertyChangedEvent(i.stream.streamManager,i.stream,"filter",i.stream.filter,s,"execFilterMethod")])),t()};if(i.type.startsWith("VB:")){if(typeof a=="string")try{a=JSON.parse(a)}catch(u){return E(new x.OpenViduError(x.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"Wrong params syntax: "+u))}if(C=a,o==="update")if(!((w=i.stream.virtualBackgroundSinkElements)===null||w===void 0)&&w.VB)i.stream.virtualBackgroundSinkElements.VB.updateValues(a).then(function(){return h(!1)}).catch(function(u){return u.name===x.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR?E(new x.OpenViduError(u.name,u.message)):E(new x.OpenViduError(x.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"Error updating values on Virtual Background filter: "+u))});else return E(new x.OpenViduError(x.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"There is no Virtual Background filter applied"));else return E(new x.OpenViduError(x.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,'Unknown Virtual Background method "'.concat(o,'"')))}else{var P=void 0;if(typeof a!="string")try{P=JSON.stringify(a)}catch{var v="'params' property must be a JSON formatted object";return f.error(v),E(v)}else P=a;C=P,i.stream.session.openvidu.sendRequest("execFilterMethod",{streamId:i.stream.streamId,method:o,params:P},function(u,s){return u?(f.error("Error executing filter method for Stream "+i.stream.streamId,u),u.code===401?E(new x.OpenViduError(x.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to execute a filter method")):E(u)):h(!0)})}})},c.prototype.addEventListener=function(o,a){var i=this;return new Promise(function(t,E){f.info("Adding filter event listener to event "+o+" to stream "+i.stream.streamId),i.stream.session.openvidu.sendRequest("addFilterEventListener",{streamId:i.stream.streamId,eventType:o},function(w,C){return w?(f.error("Error adding filter event listener to event "+o+"for Stream "+i.stream.streamId,w),w.code===401?E(new x.OpenViduError(x.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):E(w)):(i.handlers.set(o,a),f.info("Filter event listener to event "+o+" successfully applied on Stream "+i.stream.streamId),t())})})},c.prototype.removeEventListener=function(o){var a=this;return new Promise(function(i,t){f.info("Removing filter event listener to event "+o+" to stream "+a.stream.streamId),a.stream.session.openvidu.sendRequest("removeFilterEventListener",{streamId:a.stream.streamId,eventType:o},function(E,w){return E?(f.error("Error removing filter event listener to event "+o+"for Stream "+a.stream.streamId,E),E.code===401?t(new x.OpenViduError(x.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):t(E)):(a.handlers.delete(o),f.info("Filter event listener to event "+o+" successfully removed on Stream "+a.stream.streamId),i())})})},c}();return He.Filter=d,He}var be={},Se={},Ge={},ht={exports:{}};/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */var yi=ht.exports,On;function Xt(){return On||(On=1,function(p){(function(x){function S(){}var f=S.prototype,d=x.EventEmitter;function c(i,t){for(var E=i.length;E--;)if(i[E].listener===t)return E;return-1}function o(i){return function(){return this[i].apply(this,arguments)}}f.getListeners=function(t){var E=this._getEvents(),w,C;if(t instanceof RegExp){w={};for(C in E)E.hasOwnProperty(C)&&t.test(C)&&(w[C]=E[C])}else w=E[t]||(E[t]=[]);return w},f.flattenListeners=function(t){var E=[],w;for(w=0;w<t.length;w+=1)E.push(t[w].listener);return E},f.getListenersAsObject=function(t){var E=this.getListeners(t),w;return E instanceof Array&&(w={},w[t]=E),w||E};function a(i){return typeof i=="function"||i instanceof RegExp?!0:i&&typeof i=="object"?a(i.listener):!1}f.addListener=function(t,E){if(!a(E))throw new TypeError("listener must be a function");var w=this.getListenersAsObject(t),C=typeof E=="object",h;for(h in w)w.hasOwnProperty(h)&&c(w[h],E)===-1&&w[h].push(C?E:{listener:E,once:!1});return this},f.on=o("addListener"),f.addOnceListener=function(t,E){return this.addListener(t,{listener:E,once:!0})},f.once=o("addOnceListener"),f.defineEvent=function(t){return this.getListeners(t),this},f.defineEvents=function(t){for(var E=0;E<t.length;E+=1)this.defineEvent(t[E]);return this},f.removeListener=function(t,E){var w=this.getListenersAsObject(t),C,h;for(h in w)w.hasOwnProperty(h)&&(C=c(w[h],E),C!==-1&&w[h].splice(C,1));return this},f.off=o("removeListener"),f.addListeners=function(t,E){return this.manipulateListeners(!1,t,E)},f.removeListeners=function(t,E){return this.manipulateListeners(!0,t,E)},f.manipulateListeners=function(t,E,w){var C,h,P=t?this.removeListener:this.addListener,v=t?this.removeListeners:this.addListeners;if(typeof E=="object"&&!(E instanceof RegExp))for(C in E)E.hasOwnProperty(C)&&(h=E[C])&&(typeof h=="function"?P.call(this,C,h):v.call(this,C,h));else for(C=w.length;C--;)P.call(this,E,w[C]);return this},f.removeEvent=function(t){var E=typeof t,w=this._getEvents(),C;if(E==="string")delete w[t];else if(t instanceof RegExp)for(C in w)w.hasOwnProperty(C)&&t.test(C)&&delete w[C];else delete this._events;return this},f.removeAllListeners=o("removeEvent"),f.emitEvent=function(t,E){var w=this.getListenersAsObject(t),C,h,P,v,u;for(v in w)if(w.hasOwnProperty(v))for(C=w[v].slice(0),P=0;P<C.length;P++)h=C[P],h.once===!0&&this.removeListener(t,h.listener),u=h.listener.apply(this,E||[]),u===this._getOnceReturnValue()&&this.removeListener(t,h.listener);return this},f.trigger=o("emitEvent"),f.emit=function(t){var E=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,E)},f.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},f._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},f._getEvents=function(){return this._events||(this._events={})},S.noConflict=function(){return x.EventEmitter=d,S},p.exports?p.exports=S:x.EventEmitter=S})(typeof window<"u"?window:yi||{})}(ht)),ht.exports}var Rn;function Jt(){if(Rn)return Ge;Rn=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.EventDispatcher=void 0;var p=se(),x=Xt(),S=p.OpenViduLogger.getInstance(),f=function(){function d(){this.userHandlerArrowHandler=new WeakMap,this.ee=new x}return d.prototype.onAux=function(c,o,a){var i=function(t){t?S.debug(o,t):S.debug(o),a(t)};return this.userHandlerArrowHandler.set(a,i),this.ee.on(c,i),this},d.prototype.onceAux=function(c,o,a){var i=this,t=function(E){E?S.debug(o,E):S.debug(o),a(E),i.userHandlerArrowHandler.delete(a)};return this.userHandlerArrowHandler.set(a,t),this.ee.once(c,t),this},d.prototype.offAux=function(c,o){if(!o)this.ee.removeAllListeners(c);else{var a=this.userHandlerArrowHandler.get(o);a&&this.ee.off(c,a),this.userHandlerArrowHandler.delete(o)}return this},d}();return Ge.EventDispatcher=f,Ge}var ye={},Cn;function Kt(){if(Cn)return ye;Cn=1;var p=ye&&ye.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(ye,"__esModule",{value:!0}),ye.StreamManagerEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a){var i=f.call(this,!1,c,o)||this;return i.value=a,i}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return ye.StreamManagerEvent=S,ye}var we={},_n;function Wr(){if(_n)return we;_n=1;var p=we&&we.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(we,"__esModule",{value:!0}),we.VideoElementEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a){var i=f.call(this,!1,o,a)||this;return i.element=c,i}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return we.VideoElementEvent=S,we}var ze={},In;function De(){return In||(In=1,function(p){var x=ze&&ze.__extends||function(){var d=function(c,o){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,i){a.__proto__=i}||function(a,i){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(a[t]=i[t])},d(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");d(c,o);function a(){this.constructor=c}c.prototype=o===null?Object.create(o):(a.prototype=o.prototype,new a)}}();Object.defineProperty(p,"__esModule",{value:!0}),p.ExceptionEvent=p.ExceptionEventName=void 0;var S=ce();(function(d){d.ICE_CANDIDATE_ERROR="ICE_CANDIDATE_ERROR",d.ICE_CONNECTION_FAILED="ICE_CONNECTION_FAILED",d.ICE_CONNECTION_DISCONNECTED="ICE_CONNECTION_DISCONNECTED",d.NO_STREAM_PLAYING_EVENT="NO_STREAM_PLAYING_EVENT",d.SPEECH_TO_TEXT_DISCONNECTED="SPEECH_TO_TEXT_DISCONNECTED"})(p.ExceptionEventName||(p.ExceptionEventName={}));var f=function(d){x(c,d);function c(o,a,i,t,E){var w=d.call(this,!1,o,"exception")||this;return w.name=a,w.origin=i,w.message=t,w.data=E,w}return c.prototype.callDefaultBehavior=function(){},c}(S.Event);p.ExceptionEvent=f}(ze)),ze}var Rt={},Pn;function pt(){return Pn||(Pn=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),p.VideoInsertMode=void 0,function(x){x.AFTER="AFTER",x.APPEND="APPEND",x.BEFORE="BEFORE",x.PREPEND="PREPEND",x.REPLACE="REPLACE"}(p.VideoInsertMode||(p.VideoInsertMode={}))}(Rt)),Rt}var Tn;function Yt(){if(Tn)return Se;Tn=1;var p=Se&&Se.__extends||function(){var w=function(C,h){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,v){P.__proto__=v}||function(P,v){for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(P[u]=v[u])},w(C,h)};return function(C,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");w(C,h);function P(){this.constructor=C}C.prototype=h===null?Object.create(h):(P.prototype=h.prototype,new P)}}();Object.defineProperty(Se,"__esModule",{value:!0}),Se.StreamManager=void 0;var x=Jt(),S=Kt(),f=Wr(),d=De(),c=pt(),o=se(),a=me(),i=o.OpenViduLogger.getInstance(),t,E=function(w){p(C,w);function C(h,P){var v=w.call(this)||this;if(v.videos=[],v.lazyLaunchVideoElementCreatedEvent=!1,t=a.PlatformUtils.getInstance(),v.stream=h,v.stream.streamManager=v,v.remote=!v.stream.isLocal(),P){var u=void 0;typeof P=="string"?u=document.getElementById(P):P instanceof HTMLElement&&(u=P),u&&(v.firstVideoElement={targetElement:u,video:document.createElement("video"),id:"",canplayListenerAdded:!1},(t.isSafariBrowser()||t.isIPhoneOrIPad()&&(t.isChromeMobileBrowser()||t.isEdgeMobileBrowser()||t.isOperaMobileBrowser()||t.isFirefoxMobileBrowser()))&&(v.firstVideoElement.video.playsInline=!0),v.targetElement=u,v.element=u)}return v.canPlayListener=function(){v.deactivateStreamPlayingEventExceptionTimeout(),v.ee.emitEvent("streamPlaying",[new S.StreamManagerEvent(v,"streamPlaying",void 0)])},v}return C.prototype.on=function(h,P){return w.prototype.onAux.call(this,h,"Event '"+h+"' triggered by '"+(this.remote?"Subscriber":"Publisher")+"'",P),h==="videoElementCreated"&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&(this.ee.emitEvent("videoElementCreated",[new f.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!1),h==="streamPlaying"&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&this.videos[0].video.paused===!1&&this.videos[0].video.ended===!1&&this.videos[0].video.readyState===4&&this.ee.emitEvent("streamPlaying",[new S.StreamManagerEvent(this,"streamPlaying",void 0)]),this.stream.hasAudio&&(h==="publisherStartSpeaking"&&this.stream.enableHarkSpeakingEvent(),h==="publisherStopSpeaking"&&this.stream.enableHarkStoppedSpeakingEvent(),h==="streamAudioVolumeChange"&&this.stream.enableHarkVolumeChangeEvent(!1)),this},C.prototype.once=function(h,P){return w.prototype.onceAux.call(this,h,"Event '"+h+"' triggered once by '"+(this.remote?"Subscriber":"Publisher")+"'",P),h==="videoElementCreated"&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&this.ee.emitEvent("videoElementCreated",[new f.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),h==="streamPlaying"&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&this.videos[0].video.paused===!1&&this.videos[0].video.ended===!1&&this.videos[0].video.readyState===4&&this.ee.emitEvent("streamPlaying",[new S.StreamManagerEvent(this,"streamPlaying",void 0)]),this.stream.hasAudio&&(h==="publisherStartSpeaking"&&this.stream.enableOnceHarkSpeakingEvent(),h==="publisherStopSpeaking"&&this.stream.enableOnceHarkStoppedSpeakingEvent(),h==="streamAudioVolumeChange"&&this.stream.enableOnceHarkVolumeChangeEvent(!1)),this},C.prototype.off=function(h,P){if(w.prototype.offAux.call(this,h,P),h==="publisherStartSpeaking"){var v=this.ee.getListeners(h).length+this.stream.session.ee.getListeners(h).length;v===0&&this.stream.disableHarkSpeakingEvent(!1)}if(h==="publisherStopSpeaking"){var u=this.ee.getListeners(h).length+this.stream.session.ee.getListeners(h).length;u===0&&this.stream.disableHarkStoppedSpeakingEvent(!1)}if(h==="streamAudioVolumeChange"){var s=this.ee.getListeners(h).length;s===0&&this.stream.disableHarkVolumeChangeEvent(!1)}return this},C.prototype.addVideoElement=function(h){this.initializeVideoProperties(h),!this.remote&&this.stream.displayMyRemote()&&h.srcObject!==this.stream.getMediaStream()&&(h.srcObject=this.stream.getMediaStream());for(var P=0,v=this.videos;P<v.length;P++){var u=v[P];if(u.video===h)return 0}for(var s=1,_=0,k=this.stream.session.streamManagers;_<k.length;_++){var b=k[_];if(b.disassociateVideo(h)){s=-1;break}}return this.stream.session.streamManagers.forEach(function(e){e.disassociateVideo(h)}),this.pushNewStreamManagerVideo({video:h,id:h.id,canplayListenerAdded:!1}),i.info("New video element associated to ",this),s},C.prototype.createVideoElement=function(h,P){var v;if(typeof h=="string"){if(v=document.getElementById(h),!v)throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+h)}else if(h instanceof HTMLElement)v=h;else throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+h);var u=this.createVideo();this.initializeVideoProperties(u);var s=P||c.VideoInsertMode.APPEND;switch(s){case c.VideoInsertMode.AFTER:v.parentNode.insertBefore(u,v.nextSibling);break;case c.VideoInsertMode.APPEND:v.appendChild(u);break;case c.VideoInsertMode.BEFORE:v.parentNode.insertBefore(u,v);break;case c.VideoInsertMode.PREPEND:v.insertBefore(u,v.childNodes[0]);break;case c.VideoInsertMode.REPLACE:v.parentNode.replaceChild(u,v);break;default:s=c.VideoInsertMode.APPEND,v.appendChild(u);break}var _={targetElement:v,video:u,insertMode:s,id:u.id,canplayListenerAdded:!1};return this.pushNewStreamManagerVideo(_),this.ee.emitEvent("videoElementCreated",[new f.VideoElementEvent(_.video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!!this.firstVideoElement,u},C.prototype.updatePublisherSpeakingEventsOptions=function(h){var P=this.stream.harkOptions?this.stream.harkOptions:this.stream.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{},v=typeof h.interval=="number"?h.interval:typeof P.interval=="number"?P.interval:100,u=typeof h.threshold=="number"?h.threshold:typeof P.threshold=="number"?P.threshold:-50;this.stream.harkOptions={interval:v,threshold:u},this.stream.speechEvent&&(this.stream.speechEvent.setInterval(v),this.stream.speechEvent.setThreshold(u))},C.prototype.initializeVideoProperties=function(h){!this.remote&&this.stream.displayMyRemote()||h.srcObject!==this.stream.getMediaStream()&&(h.srcObject=this.stream.getMediaStream()),h.autoplay=!0,h.controls=!1,(t.isSafariBrowser()||t.isIPhoneOrIPad()&&(t.isChromeMobileBrowser()||t.isEdgeMobileBrowser()||t.isOperaMobileBrowser()||t.isFirefoxMobileBrowser()))&&(h.playsInline=!0),h.id||(h.id=(this.remote?"remote-":"local-")+"video-"+this.stream.streamId,!this.id&&this.targetElement&&(this.id=h.id)),this.remote&&this.isMirroredVideo(h)?this.removeMirrorVideo(h):!this.remote&&!this.stream.displayMyRemote()&&(h.muted=!0,this.isMirroredVideo(h)&&!this.stream.outboundStreamOpts.publisherProperties.mirror?this.removeMirrorVideo(h):this.stream.outboundStreamOpts.publisherProperties.mirror&&!this.stream.isSendScreen()&&this.mirrorVideo(h))},C.prototype.removeAllVideos=function(){for(var h=this,P=this.stream.session.streamManagers.length-1;P>=0;--P)this.stream.session.streamManagers[P]===this&&this.stream.session.streamManagers.splice(P,1);this.videos.forEach(function(v){v.video&&v.video.removeEventListener&&v.video.removeEventListener("canplay",h.canPlayListener),v.canplayListenerAdded=!1,v.targetElement&&(v.video.parentNode.removeChild(v.video),h.ee.emitEvent("videoElementDestroyed",[new f.VideoElementEvent(v.video,h,"videoElementDestroyed")])),h.removeSrcObject(v),h.videos=h.videos.filter(function(u){return!u.targetElement})})},C.prototype.disassociateVideo=function(h){for(var P=!1,v=0;v<this.videos.length;v++)if(this.videos[v].video===h){this.videos[v].video.removeEventListener("canplay",this.canPlayListener),this.videos.splice(v,1),P=!0,i.info("Video element disassociated from ",this);break}return P},C.prototype.addPlayEventToFirstVideo=function(){this.videos[0]&&this.videos[0].video&&!this.videos[0].canplayListenerAdded&&(this.activateStreamPlayingEventExceptionTimeout(),this.videos[0].video.addEventListener("canplay",this.canPlayListener),this.videos[0].canplayListenerAdded=!0)},C.prototype.updateMediaStream=function(h){this.videos.forEach(function(P){if(P.video.srcObject=h,t.isIonicIos()){var v=P.video.parentElement,u=P.video;v.replaceChild(u,P.video),P.video=u}})},C.prototype.emitEvent=function(h,P){this.ee.emitEvent(h,P)},C.prototype.createVideo=function(){return document.createElement("video")},C.prototype.removeSrcObject=function(h){h.video.srcObject=null,this.deactivateStreamPlayingEventExceptionTimeout()},C.prototype.pushNewStreamManagerVideo=function(h){this.videos.push(h),this.addPlayEventToFirstVideo(),this.stream.session.streamManagers.indexOf(this)===-1&&this.stream.session.streamManagers.push(this)},C.prototype.mirrorVideo=function(h){t.isIonicIos()||(h.style.transform="rotateY(180deg)",h.style.webkitTransform="rotateY(180deg)")},C.prototype.removeMirrorVideo=function(h){h.style.transform="unset",h.style.webkitTransform="unset"},C.prototype.isMirroredVideo=function(h){return h.style.transform==="rotateY(180deg)"||h.style.webkitTransform==="rotateY(180deg)"},C.prototype.activateStreamPlayingEventExceptionTimeout=function(){var h=this;if(this.remote&&this.streamPlayingEventExceptionTimeout==null){var P=this.stream.session.openvidu.advancedConfiguration.noStreamPlayingEventExceptionTimeout||4e3;this.streamPlayingEventExceptionTimeout=setTimeout(function(){var v="StreamManager of Stream "+h.stream.streamId+" ("+(h.remote?"Subscriber":"Publisher")+') did not trigger "streamPlaying" event in '+P+" ms";i.warn(v),h.stream.session.emitEvent("exception",[new d.ExceptionEvent(h.stream.session,d.ExceptionEventName.NO_STREAM_PLAYING_EVENT,h,v)]),delete h.streamPlayingEventExceptionTimeout},P)}},C.prototype.deactivateStreamPlayingEventExceptionTimeout=function(){clearTimeout(this.streamPlayingEventExceptionTimeout),delete this.streamPlayingEventExceptionTimeout},C}(x.EventDispatcher);return Se.StreamManager=E,Se}var xn;function Qt(){if(xn)return be;xn=1;var p=be&&be.__extends||function(){var c=function(o,a){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var E in t)Object.prototype.hasOwnProperty.call(t,E)&&(i[E]=t[E])},c(o,a)};return function(o,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");c(o,a);function i(){this.constructor=o}o.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(be,"__esModule",{value:!0}),be.Subscriber=void 0;var x=Yt(),S=se(),f=S.OpenViduLogger.getInstance(),d=function(c){p(o,c);function o(a,i,t){var E=c.call(this,a,i)||this;return E.element=E.targetElement,E.stream=a,E.properties=t,E}return o.prototype.subscribeToAudio=function(a){return this.stream.getMediaStream().getAudioTracks().forEach(function(i){i.enabled=a}),this.stream.audioActive=a,f.info("'Subscriber' has "+(a?"subscribed to":"unsubscribed from")+" its audio stream"),this},o.prototype.subscribeToVideo=function(a){return this.stream.getMediaStream().getVideoTracks().forEach(function(i){i.enabled=a}),this.stream.videoActive=a,f.info("'Subscriber' has "+(a?"subscribed to":"unsubscribed from")+" its video stream"),this},o.prototype.replaceTrackInMediaStream=function(a,i){var t=this.stream.getMediaStream(),E;a.kind==="video"?(E=t.getVideoTracks()[0],i&&(this.stream.lastVideoTrackConstraints=a.getConstraints())):E=t.getAudioTracks()[0],t.removeTrack(E),E.stop(),t.addTrack(a)},o}(x.StreamManager);return be.Subscriber=d,be}var ne={},Ct,kn;function wi(){if(kn)return Ct;kn=1;var p=["stun:","turn:"];return Ct=function(x){var S=(x||{}).url||x,f,d,c={};return typeof S!="string"&&!(S instanceof String)||(S=S.trim(),f=p[p.indexOf(S.slice(0,5))],!f)?x:(S=S.slice(5),d=S.split("@"),c.username=x.username,c.credential=x.credential,d.length>1&&(S=d[1],d=d[0].split(":"),c.username=d[0],c.credential=(x||{}).credential||d[1]||""),c.url=f+S,c.urls=[c.url],c)},Ct}const Oi=["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"],Ri=[];var _t,Nn;function Ci(){if(Nn)return _t;Nn=1;var p=wi(),x=function(S){var f={stun:(S||{}).stun||Oi,turn:(S||{}).turn||Ri},d=(S||{}).stunCount||2,c=(S||{}).turnCount||0,o;function a(i,t){for(var E=[],w=[].concat(f[i]),C;w.length&&E.length<t;)C=Math.random()*w.length|0,E=E.concat(w.splice(C,1));return E.map(function(h){return typeof h!="string"&&!(h instanceof String)?h:p(i+":"+h)})}return o=[].concat(a("stun",d)),c&&(o=o.concat(a("turn",c))),o};return _t=x,_t}var It={},Xe={},at={},Ln;function Hr(){if(Ln)return at;Ln=1,Object.defineProperty(at,"__esModule",{value:!0}),at.default=S;let p;const x=new Uint8Array(16);function S(){if(!p&&(p=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!p))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(x)}return at}var Me={},Je={},Ke={},Mn;function _i(){if(Mn)return Ke;Mn=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.default=void 0;var p=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;return Ke.default=p,Ke}var An;function vt(){if(An)return Je;An=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.default=void 0;var p=x(_i());function x(d){return d&&d.__esModule?d:{default:d}}function S(d){return typeof d=="string"&&p.default.test(d)}var f=S;return Je.default=f,Je}var Vn;function mt(){if(Vn)return Me;Vn=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0,Me.unsafeStringify=f;var p=x(vt());function x(o){return o&&o.__esModule?o:{default:o}}const S=[];for(let o=0;o<256;++o)S.push((o+256).toString(16).slice(1));function f(o,a=0){return S[o[a+0]]+S[o[a+1]]+S[o[a+2]]+S[o[a+3]]+"-"+S[o[a+4]]+S[o[a+5]]+"-"+S[o[a+6]]+S[o[a+7]]+"-"+S[o[a+8]]+S[o[a+9]]+"-"+S[o[a+10]]+S[o[a+11]]+S[o[a+12]]+S[o[a+13]]+S[o[a+14]]+S[o[a+15]]}function d(o,a=0){const i=f(o,a);if(!(0,p.default)(i))throw TypeError("Stringified UUID is invalid");return i}var c=d;return Me.default=c,Me}var Dn;function Ii(){if(Dn)return Xe;Dn=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.default=void 0;var p=S(Hr()),x=mt();function S(t){return t&&t.__esModule?t:{default:t}}let f,d,c=0,o=0;function a(t,E,w){let C=E&&w||0;const h=E||new Array(16);t=t||{};let P=t.node||f,v=t.clockseq!==void 0?t.clockseq:d;if(P==null||v==null){const e=t.random||(t.rng||p.default)();P==null&&(P=f=[e[0]|1,e[1],e[2],e[3],e[4],e[5]]),v==null&&(v=d=(e[6]<<8|e[7])&16383)}let u=t.msecs!==void 0?t.msecs:Date.now(),s=t.nsecs!==void 0?t.nsecs:o+1;const _=u-c+(s-o)/1e4;if(_<0&&t.clockseq===void 0&&(v=v+1&16383),(_<0||u>c)&&t.nsecs===void 0&&(s=0),s>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=u,o=s,d=v,u+=122192928e5;const k=((u&268435455)*1e4+s)%4294967296;h[C++]=k>>>24&255,h[C++]=k>>>16&255,h[C++]=k>>>8&255,h[C++]=k&255;const b=u/4294967296*1e4&268435455;h[C++]=b>>>8&255,h[C++]=b&255,h[C++]=b>>>24&15|16,h[C++]=b>>>16&255,h[C++]=v>>>8|128,h[C++]=v&255;for(let e=0;e<6;++e)h[C+e]=P[e];return E||(0,x.unsafeStringify)(h)}var i=a;return Xe.default=i,Xe}var Ye={},ve={},Qe={},jn;function $r(){if(jn)return Qe;jn=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.default=void 0;var p=x(vt());function x(d){return d&&d.__esModule?d:{default:d}}function S(d){if(!(0,p.default)(d))throw TypeError("Invalid UUID");let c;const o=new Uint8Array(16);return o[0]=(c=parseInt(d.slice(0,8),16))>>>24,o[1]=c>>>16&255,o[2]=c>>>8&255,o[3]=c&255,o[4]=(c=parseInt(d.slice(9,13),16))>>>8,o[5]=c&255,o[6]=(c=parseInt(d.slice(14,18),16))>>>8,o[7]=c&255,o[8]=(c=parseInt(d.slice(19,23),16))>>>8,o[9]=c&255,o[10]=(c=parseInt(d.slice(24,36),16))/1099511627776&255,o[11]=c/4294967296&255,o[12]=c>>>24&255,o[13]=c>>>16&255,o[14]=c>>>8&255,o[15]=c&255,o}var f=S;return Qe.default=f,Qe}var Bn;function Gr(){if(Bn)return ve;Bn=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.URL=ve.DNS=void 0,ve.default=o;var p=mt(),x=S($r());function S(a){return a&&a.__esModule?a:{default:a}}function f(a){a=unescape(encodeURIComponent(a));const i=[];for(let t=0;t<a.length;++t)i.push(a.charCodeAt(t));return i}const d="6ba7b810-9dad-11d1-80b4-00c04fd430c8";ve.DNS=d;const c="6ba7b811-9dad-11d1-80b4-00c04fd430c8";ve.URL=c;function o(a,i,t){function E(w,C,h,P){var v;if(typeof w=="string"&&(w=f(w)),typeof C=="string"&&(C=(0,x.default)(C)),((v=C)===null||v===void 0?void 0:v.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+w.length);if(u.set(C),u.set(w,C.length),u=t(u),u[6]=u[6]&15|i,u[8]=u[8]&63|128,h){P=P||0;for(let s=0;s<16;++s)h[P+s]=u[s];return h}return(0,p.unsafeStringify)(u)}try{E.name=a}catch{}return E.DNS=d,E.URL=c,E}return ve}var Ze={},qn;function Pi(){if(qn)return Ze;qn=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.default=void 0;function p(h){if(typeof h=="string"){const P=unescape(encodeURIComponent(h));h=new Uint8Array(P.length);for(let v=0;v<P.length;++v)h[v]=P.charCodeAt(v)}return x(f(d(h),h.length*8))}function x(h){const P=[],v=h.length*32,u="0123456789abcdef";for(let s=0;s<v;s+=8){const _=h[s>>5]>>>s%32&255,k=parseInt(u.charAt(_>>>4&15)+u.charAt(_&15),16);P.push(k)}return P}function S(h){return(h+64>>>9<<4)+14+1}function f(h,P){h[P>>5]|=128<<P%32,h[S(P)-1]=P;let v=1732584193,u=-271733879,s=-1732584194,_=271733878;for(let k=0;k<h.length;k+=16){const b=v,e=u,l=s,I=_;v=i(v,u,s,_,h[k],7,-680876936),_=i(_,v,u,s,h[k+1],12,-389564586),s=i(s,_,v,u,h[k+2],17,606105819),u=i(u,s,_,v,h[k+3],22,-1044525330),v=i(v,u,s,_,h[k+4],7,-176418897),_=i(_,v,u,s,h[k+5],12,1200080426),s=i(s,_,v,u,h[k+6],17,-1473231341),u=i(u,s,_,v,h[k+7],22,-45705983),v=i(v,u,s,_,h[k+8],7,1770035416),_=i(_,v,u,s,h[k+9],12,-1958414417),s=i(s,_,v,u,h[k+10],17,-42063),u=i(u,s,_,v,h[k+11],22,-1990404162),v=i(v,u,s,_,h[k+12],7,1804603682),_=i(_,v,u,s,h[k+13],12,-40341101),s=i(s,_,v,u,h[k+14],17,-1502002290),u=i(u,s,_,v,h[k+15],22,1236535329),v=t(v,u,s,_,h[k+1],5,-165796510),_=t(_,v,u,s,h[k+6],9,-1069501632),s=t(s,_,v,u,h[k+11],14,643717713),u=t(u,s,_,v,h[k],20,-373897302),v=t(v,u,s,_,h[k+5],5,-701558691),_=t(_,v,u,s,h[k+10],9,38016083),s=t(s,_,v,u,h[k+15],14,-660478335),u=t(u,s,_,v,h[k+4],20,-405537848),v=t(v,u,s,_,h[k+9],5,568446438),_=t(_,v,u,s,h[k+14],9,-1019803690),s=t(s,_,v,u,h[k+3],14,-187363961),u=t(u,s,_,v,h[k+8],20,1163531501),v=t(v,u,s,_,h[k+13],5,-1444681467),_=t(_,v,u,s,h[k+2],9,-51403784),s=t(s,_,v,u,h[k+7],14,1735328473),u=t(u,s,_,v,h[k+12],20,-1926607734),v=E(v,u,s,_,h[k+5],4,-378558),_=E(_,v,u,s,h[k+8],11,-2022574463),s=E(s,_,v,u,h[k+11],16,1839030562),u=E(u,s,_,v,h[k+14],23,-35309556),v=E(v,u,s,_,h[k+1],4,-1530992060),_=E(_,v,u,s,h[k+4],11,1272893353),s=E(s,_,v,u,h[k+7],16,-155497632),u=E(u,s,_,v,h[k+10],23,-1094730640),v=E(v,u,s,_,h[k+13],4,681279174),_=E(_,v,u,s,h[k],11,-358537222),s=E(s,_,v,u,h[k+3],16,-722521979),u=E(u,s,_,v,h[k+6],23,76029189),v=E(v,u,s,_,h[k+9],4,-640364487),_=E(_,v,u,s,h[k+12],11,-421815835),s=E(s,_,v,u,h[k+15],16,530742520),u=E(u,s,_,v,h[k+2],23,-995338651),v=w(v,u,s,_,h[k],6,-198630844),_=w(_,v,u,s,h[k+7],10,1126891415),s=w(s,_,v,u,h[k+14],15,-1416354905),u=w(u,s,_,v,h[k+5],21,-57434055),v=w(v,u,s,_,h[k+12],6,1700485571),_=w(_,v,u,s,h[k+3],10,-1894986606),s=w(s,_,v,u,h[k+10],15,-1051523),u=w(u,s,_,v,h[k+1],21,-2054922799),v=w(v,u,s,_,h[k+8],6,1873313359),_=w(_,v,u,s,h[k+15],10,-30611744),s=w(s,_,v,u,h[k+6],15,-1560198380),u=w(u,s,_,v,h[k+13],21,1309151649),v=w(v,u,s,_,h[k+4],6,-145523070),_=w(_,v,u,s,h[k+11],10,-1120210379),s=w(s,_,v,u,h[k+2],15,718787259),u=w(u,s,_,v,h[k+9],21,-343485551),v=c(v,b),u=c(u,e),s=c(s,l),_=c(_,I)}return[v,u,s,_]}function d(h){if(h.length===0)return[];const P=h.length*8,v=new Uint32Array(S(P));for(let u=0;u<P;u+=8)v[u>>5]|=(h[u/8]&255)<<u%32;return v}function c(h,P){const v=(h&65535)+(P&65535);return(h>>16)+(P>>16)+(v>>16)<<16|v&65535}function o(h,P){return h<<P|h>>>32-P}function a(h,P,v,u,s,_){return c(o(c(c(P,h),c(u,_)),s),v)}function i(h,P,v,u,s,_,k){return a(P&v|~P&u,h,P,s,_,k)}function t(h,P,v,u,s,_,k){return a(P&u|v&~u,h,P,s,_,k)}function E(h,P,v,u,s,_,k){return a(P^v^u,h,P,s,_,k)}function w(h,P,v,u,s,_,k){return a(v^(P|~u),h,P,s,_,k)}var C=p;return Ze.default=C,Ze}var Fn;function Ti(){if(Fn)return Ye;Fn=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.default=void 0;var p=S(Gr()),x=S(Pi());function S(c){return c&&c.__esModule?c:{default:c}}var d=(0,p.default)("v3",48,x.default);return Ye.default=d,Ye}var et={},tt={},Un;function xi(){if(Un)return tt;Un=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.default=void 0;var x={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};return tt.default=x,tt}var Wn;function ki(){if(Wn)return et;Wn=1,Object.defineProperty(et,"__esModule",{value:!0}),et.default=void 0;var p=f(xi()),x=f(Hr()),S=mt();function f(o){return o&&o.__esModule?o:{default:o}}function d(o,a,i){if(p.default.randomUUID&&!a&&!o)return p.default.randomUUID();o=o||{};const t=o.random||(o.rng||x.default)();if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,a){i=i||0;for(let E=0;E<16;++E)a[i+E]=t[E];return a}return(0,S.unsafeStringify)(t)}var c=d;return et.default=c,et}var nt={},rt={},Hn;function Ni(){if(Hn)return rt;Hn=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.default=void 0;function p(d,c,o,a){switch(d){case 0:return c&o^~c&a;case 1:return c^o^a;case 2:return c&o^c&a^o&a;case 3:return c^o^a}}function x(d,c){return d<<c|d>>>32-c}function S(d){const c=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof d=="string"){const E=unescape(encodeURIComponent(d));d=[];for(let w=0;w<E.length;++w)d.push(E.charCodeAt(w))}else Array.isArray(d)||(d=Array.prototype.slice.call(d));d.push(128);const a=d.length/4+2,i=Math.ceil(a/16),t=new Array(i);for(let E=0;E<i;++E){const w=new Uint32Array(16);for(let C=0;C<16;++C)w[C]=d[E*64+C*4]<<24|d[E*64+C*4+1]<<16|d[E*64+C*4+2]<<8|d[E*64+C*4+3];t[E]=w}t[i-1][14]=(d.length-1)*8/Math.pow(2,32),t[i-1][14]=Math.floor(t[i-1][14]),t[i-1][15]=(d.length-1)*8&4294967295;for(let E=0;E<i;++E){const w=new Uint32Array(80);for(let s=0;s<16;++s)w[s]=t[E][s];for(let s=16;s<80;++s)w[s]=x(w[s-3]^w[s-8]^w[s-14]^w[s-16],1);let C=o[0],h=o[1],P=o[2],v=o[3],u=o[4];for(let s=0;s<80;++s){const _=Math.floor(s/20),k=x(C,5)+p(_,h,P,v)+u+c[_]+w[s]>>>0;u=v,v=P,P=x(h,30)>>>0,h=C,C=k}o[0]=o[0]+C>>>0,o[1]=o[1]+h>>>0,o[2]=o[2]+P>>>0,o[3]=o[3]+v>>>0,o[4]=o[4]+u>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,o[0]&255,o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,o[1]&255,o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,o[2]&255,o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,o[3]&255,o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,o[4]&255]}var f=S;return rt.default=f,rt}var $n;function Li(){if($n)return nt;$n=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.default=void 0;var p=S(Gr()),x=S(Ni());function S(c){return c&&c.__esModule?c:{default:c}}var d=(0,p.default)("v5",80,x.default);return nt.default=d,nt}var it={},Gn;function Mi(){if(Gn)return it;Gn=1,Object.defineProperty(it,"__esModule",{value:!0}),it.default=void 0;var p="00000000-0000-0000-0000-000000000000";return it.default=p,it}var ot={},zn;function Ai(){if(zn)return ot;zn=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.default=void 0;var p=x(vt());function x(d){return d&&d.__esModule?d:{default:d}}function S(d){if(!(0,p.default)(d))throw TypeError("Invalid UUID");return parseInt(d.slice(14,15),16)}var f=S;return ot.default=f,ot}var Xn;function zr(){return Xn||(Xn=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),Object.defineProperty(p,"NIL",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(p,"parse",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(p,"stringify",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(p,"v1",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(p,"v3",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(p,"v4",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(p,"v5",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(p,"validate",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(p,"version",{enumerable:!0,get:function(){return o.default}});var x=E(Ii()),S=E(Ti()),f=E(ki()),d=E(Li()),c=E(Mi()),o=E(Ai()),a=E(vt()),i=E(mt()),t=E($r());function E(w){return w&&w.__esModule?w:{default:w}}}(It)),It}var Jn;function Vi(){if(Jn)return ne;Jn=1;var p=ne&&ne.__extends||function(){var P=function(v,u){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,_){s.__proto__=_}||function(s,_){for(var k in _)Object.prototype.hasOwnProperty.call(_,k)&&(s[k]=_[k])},P(v,u)};return function(v,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");P(v,u);function s(){this.constructor=v}v.prototype=u===null?Object.create(u):(s.prototype=u.prototype,new s)}}(),x=ne&&ne.__assign||function(){return x=Object.assign||function(P){for(var v,u=1,s=arguments.length;u<s;u++){v=arguments[u];for(var _ in v)Object.prototype.hasOwnProperty.call(v,_)&&(P[_]=v[_])}return P},x.apply(this,arguments)},S=ne&&ne.__awaiter||function(P,v,u,s){function _(k){return k instanceof u?k:new u(function(b){b(k)})}return new(u||(u=Promise))(function(k,b){function e(n){try{I(s.next(n))}catch(y){b(y)}}function l(n){try{I(s.throw(n))}catch(y){b(y)}}function I(n){n.done?k(n.value):_(n.value).then(e,l)}I((s=s.apply(P,v||[])).next())})},f=ne&&ne.__generator||function(P,v){var u={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},s,_,k,b;return b={next:e(0),throw:e(1),return:e(2)},typeof Symbol=="function"&&(b[Symbol.iterator]=function(){return this}),b;function e(I){return function(n){return l([I,n])}}function l(I){if(s)throw new TypeError("Generator is already executing.");for(;b&&(b=0,I[0]&&(u=0)),u;)try{if(s=1,_&&(k=I[0]&2?_.return:I[0]?_.throw||((k=_.return)&&k.call(_),0):_.next)&&!(k=k.call(_,I[1])).done)return k;switch(_=0,k&&(I=[I[0]&2,k.value]),I[0]){case 0:case 1:k=I;break;case 4:return u.label++,{value:I[1],done:!1};case 5:u.label++,_=I[1],I=[0];continue;case 7:I=u.ops.pop(),u.trys.pop();continue;default:if(k=u.trys,!(k=k.length>0&&k[k.length-1])&&(I[0]===6||I[0]===2)){u=0;continue}if(I[0]===3&&(!k||I[1]>k[0]&&I[1]<k[3])){u.label=I[1];break}if(I[0]===6&&u.label<k[1]){u.label=k[1],k=I;break}if(k&&u.label<k[2]){u.label=k[2],u.ops.push(I);break}k[2]&&u.ops.pop(),u.trys.pop();continue}I=v.call(P,u)}catch(n){I=[6,n],_=0}finally{s=k=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}};Object.defineProperty(ne,"__esModule",{value:!0}),ne.WebRtcPeerSendrecv=ne.WebRtcPeerSendonly=ne.WebRtcPeerRecvonly=ne.WebRtcPeer=void 0;var d=Ci(),c=zr(),o=De(),a=se(),i=me(),t=a.OpenViduLogger.getInstance(),E=function(){function P(v){var u=this;this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],this.iceCandidateList=[],i.PlatformUtils.getInstance(),this.configuration=x(x({},v),{iceServers:v.iceServers&&v.iceServers.length>0?v.iceServers:d(),rtcConfiguration:v.rtcConfiguration!==void 0?v.rtcConfiguration:{},mediaStream:v.mediaStream!==void 0?v.mediaStream:null,mode:v.mode?v.mode:"sendrecv",id:v.id?v.id:this.generateUniqueId()}),t.debug(`[WebRtcPeer] configuration:
`.concat(JSON.stringify(this.configuration,null,2)));var s=this.configuration.rtcConfiguration?this.configuration.rtcConfiguration:{iceServers:this.configuration.iceServers};!s.iceServers&&this.configuration.iceServers&&(s.iceServers=this.configuration.iceServers),this.pc=new RTCPeerConnection(s),this.pc.addEventListener("icecandidate",function(_){if(_.candidate!==null){var k=_.candidate,b=new RTCIceCandidate(k);u.configuration.onIceCandidate(b),b.candidate!==""&&u.localCandidatesQueue.push(b)}}),this.pc.addEventListener("signalingstatechange",function(){return S(u,void 0,void 0,function(){var _,k;return f(this,function(b){switch(b.label){case 0:if(this.pc.signalingState!=="stable")return[3,6];b.label=1;case 1:if(!(this.iceCandidateList.length>0))return[3,6];_=this.iceCandidateList.shift(),b.label=2;case 2:return b.trys.push([2,4,,5]),[4,this.pc.addIceCandidate(_)];case 3:return b.sent(),[3,5];case 4:return k=b.sent(),t.error("Error when calling RTCPeerConnection#addIceCandidate for RTCPeerConnection "+this.getId(),k),[3,5];case 5:return[3,1];case 6:return[2]}})})})}return P.prototype.getId=function(){return this.configuration.id},P.prototype.dispose=function(){if(t.debug("Disposing WebRtcPeer"),this.pc){if(this.pc.signalingState==="closed")return;this.pc.close(),this.remoteCandidatesQueue=[],this.localCandidatesQueue=[]}},P.prototype.createOfferLegacy=function(){this.configuration.mediaStream&&this.deprecatedPeerConnectionTrackApi();var v=this.configuration.mediaConstraints.audio,u=this.configuration.mediaConstraints.video,s={offerToReceiveAudio:this.configuration.mode!=="sendonly"&&v,offerToReceiveVideo:this.configuration.mode!=="sendonly"&&u};return t.debug("[createOfferLegacy] RTCPeerConnection.createOffer() options:",JSON.stringify(s)),this.pc.createOffer(s)},P.prototype.createOffer=function(){var v,u,s,_,k,b,e,l;return S(this,void 0,void 0,function(){var I,n,y,T,L,D,r,g,N,R,m,O,M,V,j,B,W,Z,F,G,A,z,$,Z;return f(this,function(K){switch(K.label){case 0:if("addTransceiver"in this.pc)t.debug("[createOffer] Method RTCPeerConnection.addTransceiver() is available; using it");else return t.warn("[createOffer] Method RTCPeerConnection.addTransceiver() is NOT available; using LEGACY offerToReceive{Audio,Video}"),[2,this.createOfferLegacy()];if(this.configuration.mode==="recvonly")return[3,7];if(!this.configuration.mediaStream)throw new Error("[WebRtcPeer.createOffer] Direction is '".concat(this.configuration.mode,"', but no stream was configured to be sent"));I=0,n=this.configuration.mediaStream.getTracks(),K.label=1;case 1:if(!(I<n.length))return[3,6];if(y=n[I],T={direction:this.configuration.mode,streams:[this.configuration.mediaStream]},y.kind==="video"&&this.configuration.simulcast)for(L=y.getSettings(),D=y.getConstraints(),r=(s=(u=(v=L.width)!==null&&v!==void 0?v:D.width.ideal)!==null&&u!==void 0?u:D.width)!==null&&s!==void 0?s:0,g=(b=(k=(_=L.height)!==null&&_!==void 0?_:D.height.ideal)!==null&&k!==void 0?k:D.height)!==null&&b!==void 0?b:0,t.info("[createOffer] Video track dimensions: ".concat(r,"x").concat(g)),N=r*g,R=0,N>=960*540?R=3:N>=480*270?R=2:R=1,T.sendEncodings=[],m=0;m<R;m++)O=Math.pow(2,R-m-1),M={rid:"rdiv"+O.toString(),scalabilityMode:"L1T1"},["detail","text"].includes(y.contentHint)?(M.scaleResolutionDownBy=1,M.maxFramerate=Math.floor(30/O)):M.scaleResolutionDownBy=O,T.sendEncodings.push(M);if(V=this.pc.addTransceiver(y,T),y.kind!=="video")return[3,5];if(j=V.sender.getParameters(),B=!1,!((e=j.degradationPreference)===null||e===void 0)&&e.length||(["detail","text"].includes(y.contentHint)?j.degradationPreference="maintain-resolution":j.degradationPreference="balanced",t.info("[createOffer] Video sender Degradation Preference set: ".concat(j.degradationPreference)),B=!0),this.configuration.simulcast&&((l=j.encodings)===null||l===void 0?void 0:l.length)!==T.sendEncodings.length&&(j.encodings=T.sendEncodings,B=!0),!B)return[3,5];t.debug("[createOffer] Setting new RTCRtpSendParameters to video sender"),K.label=2;case 2:return K.trys.push([2,4,,5]),[4,V.sender.setParameters(j)];case 3:return K.sent(),[3,5];case 4:throw W=K.sent(),Z="[WebRtcPeer.createOffer] Cannot set RTCRtpSendParameters to video sender",W instanceof Error&&(Z+=": ".concat(W.message)),new Error(Z);case 5:return I++,[3,1];case 6:return[3,8];case 7:for(F=0,G=["audio","video"];F<G.length;F++)A=G[F],this.configuration.mediaConstraints[A]&&(this.configuration.mediaStream=new MediaStream,this.pc.addTransceiver(A,{direction:this.configuration.mode,streams:[this.configuration.mediaStream]}));K.label=8;case 8:return K.trys.push([8,10,,11]),[4,this.pc.createOffer()];case 9:return z=K.sent(),[3,11];case 10:throw $=K.sent(),Z="[WebRtcPeer.createOffer] Browser failed creating an SDP Offer",$ instanceof Error&&(Z+=": ".concat($.message)),new Error(Z);case 11:return[2,z]}})})},P.prototype.deprecatedPeerConnectionTrackApi=function(){for(var v=0,u=this.configuration.mediaStream.getTracks();v<u.length;v++){var s=u[v];this.pc.addTrack(s,this.configuration.mediaStream)}},P.prototype.createAnswer=function(){var v=this;return new Promise(function(u,s){if("getTransceivers"in v.pc){t.debug("[createAnswer] Method RTCPeerConnection.getTransceivers() is available; using it");for(var _=function(T){if(!v.configuration.mediaConstraints[T])return"continue";var L=v.pc.getTransceivers().find(function(D){return D.receiver.track.kind===T});if(L)L.direction=v.configuration.mode;else return{value:s(new Error("".concat(T," requested, but no transceiver was created from remote description")))}},k=0,b=["audio","video"];k<b.length;k++){var e=b[k],l=_(e);if(typeof l=="object")return l.value}v.pc.createAnswer().then(function(T){return u(T)}).catch(function(T){return s(T)})}else{var I=void 0,n=!0;if(v.configuration.mediaConstraints){I=typeof v.configuration.mediaConstraints.audio=="boolean"?v.configuration.mediaConstraints.audio:!0,n=typeof v.configuration.mediaConstraints.video=="boolean"?v.configuration.mediaConstraints.video:!0;var y={offerToReceiveAudio:I,offerToReceiveVideo:n};v.pc.createAnswer(y).then(function(T){return u(T)}).catch(function(T){return s(T)})}}})},P.prototype.processLocalOffer=function(v){var u=this;return new Promise(function(s,_){u.pc.setLocalDescription(v).then(function(){var k=u.pc.localDescription;return k?(t.debug("Local description set",k.sdp),s()):_("Local description is not defined")}).catch(function(k){return _(k)})})},P.prototype.processRemoteOffer=function(v){var u=this;return new Promise(function(s,_){var k={type:"offer",sdp:v};if(t.debug("SDP offer received, setting remote description",k),u.pc.signalingState==="closed")return _("RTCPeerConnection is closed when trying to set remote description");u.setRemoteDescription(k).then(function(){return s()}).catch(function(b){return _(b)})})},P.prototype.processLocalAnswer=function(v){var u=this;return new Promise(function(s,_){if(t.debug("SDP answer created, setting local description"),u.pc.signalingState==="closed")return _("RTCPeerConnection is closed when trying to set local description");u.pc.setLocalDescription(v).then(function(){return s()}).catch(function(k){return _(k)})})},P.prototype.processRemoteAnswer=function(v){var u=this;return new Promise(function(s,_){var k={type:"answer",sdp:v};if(t.debug("SDP answer received, setting remote description"),u.pc.signalingState==="closed")return _("RTCPeerConnection is closed when trying to set remote description");u.setRemoteDescription(k).then(function(){s()}).catch(function(b){return _(b)})})},P.prototype.setRemoteDescription=function(v){return S(this,void 0,void 0,function(){return f(this,function(u){return[2,this.pc.setRemoteDescription(v)]})})},P.prototype.addIceCandidate=function(v){var u=this;return new Promise(function(s,_){switch(t.debug("Remote ICE candidate received",v),u.remoteCandidatesQueue.push(v),u.pc.signalingState){case"closed":_(new Error("PeerConnection object is closed"));break;case"stable":u.pc.remoteDescription?u.pc.addIceCandidate(v).then(function(){return s()}).catch(function(k){return _(k)}):(u.iceCandidateList.push(v),s());break;default:u.iceCandidateList.push(v),s()}})},P.prototype.addIceConnectionStateChangeListener=function(v){var u=this;this.pc.addEventListener("iceconnectionstatechange",function(){var s=u.pc.iceConnectionState;switch(s){case"disconnected":var _="IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "disconnected". Possible network disconnection';t.warn(_),u.configuration.onIceConnectionStateException(o.ExceptionEventName.ICE_CONNECTION_DISCONNECTED,_);break;case"failed":var k="IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') to "failed"';t.error(k),u.configuration.onIceConnectionStateException(o.ExceptionEventName.ICE_CONNECTION_FAILED,k);break;case"closed":t.log("IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "closed"');break;case"new":t.log("IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "new"');break;case"checking":t.log("IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "checking"');break;case"connected":t.log("IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "connected"');break;case"completed":t.log("IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "completed"');break}})},P.prototype.generateUniqueId=function(){return(0,c.v4)()},P}();ne.WebRtcPeer=E;var w=function(P){p(v,P);function v(u){return u.mode="recvonly",P.call(this,u)||this}return v}(E);ne.WebRtcPeerRecvonly=w;var C=function(P){p(v,P);function v(u){return u.mode="sendonly",P.call(this,u)||this}return v}(E);ne.WebRtcPeerSendonly=C;var h=function(P){p(v,P);function v(u){return u.mode="sendrecv",P.call(this,u)||this}return v}(E);return ne.WebRtcPeerSendrecv=h,ne}var pe={},Kn;function Di(){if(Kn)return pe;Kn=1;var p=pe&&pe.__awaiter||function(a,i,t,E){function w(C){return C instanceof t?C:new t(function(h){h(C)})}return new(t||(t=Promise))(function(C,h){function P(s){try{u(E.next(s))}catch(_){h(_)}}function v(s){try{u(E.throw(s))}catch(_){h(_)}}function u(s){s.done?C(s.value):w(s.value).then(P,v)}u((E=E.apply(a,i||[])).next())})},x=pe&&pe.__generator||function(a,i){var t={label:0,sent:function(){if(C[0]&1)throw C[1];return C[1]},trys:[],ops:[]},E,w,C,h;return h={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function P(u){return function(s){return v([u,s])}}function v(u){if(E)throw new TypeError("Generator is already executing.");for(;h&&(h=0,u[0]&&(t=0)),t;)try{if(E=1,w&&(C=u[0]&2?w.return:u[0]?w.throw||((C=w.return)&&C.call(w),0):w.next)&&!(C=C.call(w,u[1])).done)return C;switch(w=0,C&&(u=[u[0]&2,C.value]),u[0]){case 0:case 1:C=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,w=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(C=t.trys,!(C=C.length>0&&C[C.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!C||u[1]>C[0]&&u[1]<C[3])){t.label=u[1];break}if(u[0]===6&&t.label<C[1]){t.label=C[1],C=u;break}if(C&&t.label<C[2]){t.label=C[2],t.ops.push(u);break}C[2]&&t.ops.pop(),t.trys.pop();continue}u=i.call(a,t)}catch(s){u=[6,s],w=0}finally{E=C=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(pe,"__esModule",{value:!0}),pe.WebRtcStats=void 0;var S=se(),f=me(),d=S.OpenViduLogger.getInstance(),c,o=function(){function a(i){this.stream=i,this.STATS_ITEM_NAME="webrtc-stats-config",this.webRtcStatsEnabled=!1,this.statsInterval=1,c=f.PlatformUtils.getInstance()}return a.prototype.isEnabled=function(){return this.webRtcStatsEnabled},a.prototype.initWebRtcStats=function(){var i=this,t;try{t=localStorage.getItem(this.STATS_ITEM_NAME)}catch{}if(t){this.webRtcStatsEnabled=!0;var E=JSON.parse(t);d.warn("WebRtc stats enabled for stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId),d.warn("localStorage item: "+JSON.stringify(E)),this.POST_URL=E.httpEndpoint,this.statsInterval=E.interval,this.webRtcStatsIntervalId=setInterval(function(){return p(i,void 0,void 0,function(){return x(this,function(w){switch(w.label){case 0:return[4,this.sendStatsToHttpEndpoint()];case 1:return w.sent(),[2]}})})},this.statsInterval*1e3)}else d.debug("WebRtc stats not enabled")},a.prototype.getSelectedIceCandidateInfo=function(){var i=this;return new Promise(function(t,E){return p(i,void 0,void 0,function(){var w,C,h,P,v,u,s,_,k,b,e,l,I,n,D,r,y,T,R,L,D,r,g,N,R;return x(this,function(m){switch(m.label){case 0:return[4,this.stream.getRTCPeerConnection().getStats()];case 1:if(w=m.sent(),h=new Map,P=new Map,v=new Map,w.forEach(function(O){switch(O.type==="transport"&&(c.isChromium()||c.isSafariBrowser()||c.isReactNative())&&(C=O),O.type){case"candidate-pair":h.set(O.id,O);break;case"local-candidate":P.set(O.id,O);break;case"remote-candidate":v.set(O.id,O);break}}),C!=null)s=C.selectedCandidatePairId,u=h.get(s);else for(_=h.size,k=h.values(),b=0;b<_;b++)if(e=k.next().value,e.selected){u=e;break}if(l=u.localCandidateId,I=u.remoteCandidateId,n=P.get(l),n)for(D=this.stream.getLocalIceCandidateList(),r=D.filter(function(O){return!!O.candidate&&(O.candidate.indexOf(n.ip)>=0||O.candidate.indexOf(n.address)>=0)&&O.candidate.indexOf(n.port)>=0}),n.raw=[],y=0,T=r;y<T.length;y++)R=T[y],n.raw.push(R.candidate);else n="ERROR: No active local ICE candidate. Probably ICE-TCP is being used";if(L=v.get(I),L)for(D=this.stream.getRemoteIceCandidateList(),r=D.filter(function(O){return!!O.candidate&&(O.candidate.indexOf(L.ip)>=0||O.candidate.indexOf(L.address)>=0)&&O.candidate.indexOf(L.port)>=0}),L.raw=[],g=0,N=r;g<N.length;g++)R=N[g],L.raw.push(R.candidate);else L="ERROR: No active remote ICE candidate. Probably ICE-TCP is being used";return[2,t({localCandidate:n,remoteCandidate:L})]}})})})},a.prototype.stopWebRtcStats=function(){this.webRtcStatsEnabled&&(clearInterval(this.webRtcStatsIntervalId),d.warn("WebRtc stats stopped for disposed stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId))},a.prototype.sendStats=function(i,t){return p(this,void 0,void 0,function(){var E,w;return x(this,function(C){switch(C.label){case 0:return C.trys.push([0,2,,3]),E={headers:{"Content-type":"application/json"},body:JSON.stringify(t),method:"POST"},[4,fetch(i,E)];case 1:return C.sent(),[3,3];case 2:return w=C.sent(),d.error("sendStats error: ".concat(JSON.stringify(w))),[3,3];case 3:return[2]}})})},a.prototype.sendStatsToHttpEndpoint=function(){return p(this,void 0,void 0,function(){var i,t,E;return x(this,function(w){switch(w.label){case 0:return w.trys.push([0,3,,4]),[4,this.getCommonStats()];case 1:return i=w.sent(),t=this.generateJSONStatsResponse(i),[4,this.sendStats(this.POST_URL,t)];case 2:return w.sent(),[3,4];case 3:return E=w.sent(),d.log(E),[3,4];case 4:return[2]}})})},a.prototype.getCommonStats=function(){return p(this,void 0,void 0,function(){var i=this;return x(this,function(t){return[2,new Promise(function(E,w){return p(i,void 0,void 0,function(){var C,h,P,v,u,s=this;return x(this,function(_){switch(_.label){case 0:return _.trys.push([0,2,,3]),[4,this.stream.getRTCPeerConnection().getStats()];case 1:return C=_.sent(),h=this.getWebRtcStatsResponseOutline(),P=["framesReceived","framesDropped","framesSent","frameHeight","frameWidth"],v=["availableOutgoingBitrate","currentRoundTripTime"],C.forEach(function(k){var b=k.mediaType!=null?k.mediaType:k.kind,e=function(l,I){k[I]!=null&&h[l]!=null&&(!b&&P.indexOf(I)>-1&&(b="video"),l!=null&&b!=null&&I!=null&&h[l][b]!=null?h[l][b][I]=Number(k[I]):l!=null&&I!=null&&v.includes(I)&&(h[l][I]=Number(k[I])))};switch(k.type){case"outbound-rtp":e("outbound","bytesSent"),e("outbound","packetsSent"),e("outbound","framesEncoded"),e("outbound","nackCount"),e("outbound","firCount"),e("outbound","pliCount"),e("outbound","qpSum");break;case"inbound-rtp":e("inbound","bytesReceived"),e("inbound","packetsReceived"),e("inbound","packetsLost"),e("inbound","jitter"),e("inbound","framesDecoded"),e("inbound","nackCount"),e("inbound","firCount"),e("inbound","pliCount");break;case"track":e("inbound","jitterBufferDelay"),e("inbound","framesReceived"),e("outbound","framesDropped"),e("outbound","framesSent"),e(s.stream.isLocal()?"outbound":"inbound","frameHeight"),e(s.stream.isLocal()?"outbound":"inbound","frameWidth");break;case"candidate-pair":e("candidatepair","currentRoundTripTime"),e("candidatepair","availableOutgoingBitrate");break}}),(!(h!=null&&h.candidatepair)||Object.keys(h.candidatepair).length===0)&&delete h.candidatepair,[2,E(h)];case 2:return u=_.sent(),d.error("Error getting common stats: ",u),[2,w(u)];case 3:return[2]}})})})]})})},a.prototype.generateJSONStatsResponse=function(i){return{"@timestamp":new Date().toISOString(),participant_id:this.stream.connection.data,session_id:this.stream.session.sessionId,platform:c.getName(),platform_description:c.getDescription(),stream:"webRTC",webrtc_stats:i}},a.prototype.getWebRtcStatsResponseOutline=function(){return this.stream.isLocal()?{outbound:{audio:{},video:{}},candidatepair:{}}:{inbound:{audio:{},video:{}}}},a}();return pe.WebRtcStats=o,pe}var Oe={},Yn;function Xr(){if(Yn)return Oe;Yn=1;var p=Oe&&Oe.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.PublisherSpeakingEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a,i){var t=f.call(this,!1,c,o)||this;return t.type=o,t.connection=a,t.streamId=i,t}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return Oe.PublisherSpeakingEvent=S,Oe}var Pt={},Qn;function Zt(){return Qn||(Qn=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),p.TypeOfVideo=void 0,function(x){x.CAMERA="CAMERA",x.SCREEN="SCREEN",x.CUSTOM="CUSTOM",x.IPCAM="IPCAM"}(p.TypeOfVideo||(p.TypeOfVideo={}))}(Pt)),Pt}var Tt,Zn;function ji(){if(Zn)return Tt;Zn=1,Tt=p;function p(){}return p.mixin=function(x){var S=x.prototype||x;S.isWildEmitter=!0,S.on=function(f,d,c){this.callbacks=this.callbacks||{};var o=arguments.length===3,a=o?arguments[1]:void 0,i=o?arguments[2]:arguments[1];return i._groupName=a,(this.callbacks[f]=this.callbacks[f]||[]).push(i),this},S.once=function(f,d,c){var o=this,a=arguments.length===3,i=a?arguments[1]:void 0,t=a?arguments[2]:arguments[1];function E(){o.off(f,E),t.apply(this,arguments)}return this.on(f,i,E),this},S.releaseGroup=function(f){this.callbacks=this.callbacks||{};var d,c,o,a;for(d in this.callbacks)for(a=this.callbacks[d],c=0,o=a.length;c<o;c++)a[c]._groupName===f&&(a.splice(c,1),c--,o--);return this},S.off=function(f,d){this.callbacks=this.callbacks||{};var c=this.callbacks[f],o;return c?arguments.length===1?(delete this.callbacks[f],this):(o=c.indexOf(d),o!==-1&&(c.splice(o,1),c.length===0&&delete this.callbacks[f]),this):this},S.emit=function(f){this.callbacks=this.callbacks||{};var d=[].slice.call(arguments,1),c=this.callbacks[f],o=this.getWildcardCallbacks(f),a,i,t;if(c)for(t=c.slice(),a=0,i=t.length;a<i&&t[a];++a)t[a].apply(this,d);if(o)for(i=o.length,t=o.slice(),a=0,i=t.length;a<i&&t[a];++a)t[a].apply(this,[f].concat(d));return this},S.getWildcardCallbacks=function(f){this.callbacks=this.callbacks||{};var d,c,o=[];for(d in this.callbacks)c=d.split("*"),(d==="*"||c.length===2&&f.slice(0,c[0].length)===c[0])&&(o=o.concat(this.callbacks[d]));return o}},p.mixin(p),Tt}var xt,er;function Bi(){if(er)return xt;er=1;var p=ji();function x(d,c){var o=-1/0;d.getFloatFrequencyData(c);for(var a=4,i=c.length;a<i;a++)c[a]>o&&c[a]<0&&(o=c[a]);return o}var S;typeof window<"u"&&(S=window.AudioContext||window.webkitAudioContext);var f=null;return xt=function(d,a){var o=new p;if(!S)return o;var a=a||{},i=a.smoothing||.1,t=a.interval||50,E=a.threshold,w=a.play,C=a.history||10,h=!0;f=a.audioContext||f||new S;var P,v,u;u=f.createAnalyser(),u.fftSize=512,u.smoothingTimeConstant=i,v=new Float32Array(u.frequencyBinCount),d.jquery&&(d=d[0]),d instanceof HTMLAudioElement||d instanceof HTMLVideoElement?(P=f.createMediaElementSource(d),typeof w>"u"&&(w=!0),E=E||-50):(P=f.createMediaStreamSource(d),E=E||-50),P.connect(u),w&&u.connect(f.destination),o.speaking=!1,o.suspend=function(){return f.suspend()},o.resume=function(){return f.resume()},Object.defineProperty(o,"state",{get:function(){return f.state}}),f.onstatechange=function(){o.emit("state_change",f.state)},o.setThreshold=function(k){E=k},o.setInterval=function(k){t=k},o.stop=function(){h=!1,o.emit("volume_change",-100,E),o.speaking&&(o.speaking=!1,o.emit("stopped_speaking")),u.disconnect(),P.disconnect()},o.speakingHistory=[];for(var s=0;s<C;s++)o.speakingHistory.push(0);var _=function(){setTimeout(function(){if(h){var k=x(u,v);o.emit("volume_change",k,E);var b=0;if(k>E&&!o.speaking){for(var e=o.speakingHistory.length-3;e<o.speakingHistory.length;e++)b+=o.speakingHistory[e];b>=2&&(o.speaking=!0,o.emit("speaking"))}else if(k<E&&o.speaking){for(var e=0;e<o.speakingHistory.length;e++)b+=o.speakingHistory[e];b==0&&(o.speaking=!1,o.emit("stopped_speaking"))}o.speakingHistory.shift(),o.speakingHistory.push(0+(k>E)),_()}},t)};return _(),o},xt}var tr;function en(){if(tr)return he;tr=1;var p=he&&he.__awaiter||function(b,e,l,I){function n(y){return y instanceof l?y:new l(function(T){T(y)})}return new(l||(l=Promise))(function(y,T){function L(g){try{r(I.next(g))}catch(N){T(N)}}function D(g){try{r(I.throw(g))}catch(N){T(N)}}function r(g){g.done?y(g.value):n(g.value).then(L,D)}r((I=I.apply(b,e||[])).next())})},x=he&&he.__generator||function(b,e){var l={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},I,n,y,T;return T={next:L(0),throw:L(1),return:L(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function L(r){return function(g){return D([r,g])}}function D(r){if(I)throw new TypeError("Generator is already executing.");for(;T&&(T=0,r[0]&&(l=0)),l;)try{if(I=1,n&&(y=r[0]&2?n.return:r[0]?n.throw||((y=n.return)&&y.call(n),0):n.next)&&!(y=y.call(n,r[1])).done)return y;switch(n=0,y&&(r=[r[0]&2,y.value]),r[0]){case 0:case 1:y=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,n=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(y=l.trys,!(y=y.length>0&&y[y.length-1])&&(r[0]===6||r[0]===2)){l=0;continue}if(r[0]===3&&(!y||r[1]>y[0]&&r[1]<y[3])){l.label=r[1];break}if(r[0]===6&&l.label<y[1]){l.label=y[1],y=r;break}if(y&&l.label<y[2]){l.label=y[2],l.ops.push(r);break}y[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(b,l)}catch(g){r=[6,g],n=0}finally{I=y=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(he,"__esModule",{value:!0}),he.Stream=void 0;var S=zt(),f=Qt(),d=Vi(),c=Di(),o=De(),a=Xr(),i=Kt(),t=Ae(),E=Ve(),w=Zt(),C=se(),h=me(),P=zr(),v=Bi(),u=Xt(),s=C.OpenViduLogger.getInstance(),_,k=function(){function b(e,l){var I=this;this.isSubscribeToRemote=!1,this.isLocalStreamReadyToPublish=!1,this.isLocalStreamPublished=!1,this.publishedOnce=!1,this.harkSpeakingEnabled=!1,this.harkSpeakingEnabledOnce=!1,this.harkStoppedSpeakingEnabled=!1,this.harkStoppedSpeakingEnabledOnce=!1,this.harkVolumeChangeEnabled=!1,this.harkVolumeChangeEnabledOnce=!1,this.ee=new u,_=h.PlatformUtils.getInstance(),this.session=e,l.hasOwnProperty("id")?(this.inboundStreamOpts=l,this.streamId=this.inboundStreamOpts.id,this.creationTime=this.inboundStreamOpts.createdAt,this.hasAudio=this.inboundStreamOpts.hasAudio,this.hasVideo=this.inboundStreamOpts.hasVideo,this.hasAudio&&(this.audioActive=this.inboundStreamOpts.audioActive),this.hasVideo&&(this.videoActive=this.inboundStreamOpts.videoActive,this.typeOfVideo=this.inboundStreamOpts.typeOfVideo?this.inboundStreamOpts.typeOfVideo:void 0,this.frameRate=this.inboundStreamOpts.frameRate===-1?void 0:this.inboundStreamOpts.frameRate,this.videoDimensions=this.inboundStreamOpts.videoDimensions),this.inboundStreamOpts.filter&&Object.keys(this.inboundStreamOpts.filter).length>0&&(this.inboundStreamOpts.filter.lastExecMethod&&Object.keys(this.inboundStreamOpts.filter.lastExecMethod).length===0&&delete this.inboundStreamOpts.filter.lastExecMethod,this.filter=this.inboundStreamOpts.filter)):(this.outboundStreamOpts=l,this.hasAudio=this.isSendAudio(),this.hasVideo=this.isSendVideo(),this.hasAudio&&(this.audioActive=!!this.outboundStreamOpts.publisherProperties.publishAudio),this.hasVideo&&(this.videoActive=!!this.outboundStreamOpts.publisherProperties.publishVideo,this.frameRate=this.outboundStreamOpts.publisherProperties.frameRate,typeof MediaStreamTrack<"u"&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?this.typeOfVideo=w.TypeOfVideo.CUSTOM:this.typeOfVideo=this.isSendScreen()?w.TypeOfVideo.SCREEN:w.TypeOfVideo.CAMERA),this.outboundStreamOpts.publisherProperties.filter&&(this.filter=this.outboundStreamOpts.publisherProperties.filter)),this.ee.on("mediastream-updated",function(){var n;I.streamManager.updateMediaStream(I.mediaStream),s.debug("Video srcObject ["+((n=I.mediaStream)===null||n===void 0?void 0:n.id)+"] updated in stream ["+I.streamId+"]")})}return b.prototype.reconnect=function(){return this.reconnectStream("API")},b.prototype.applyFilter=function(e,l){var I=this;return new Promise(function(n,y){return p(I,void 0,void 0,function(){var T,L,D,r,g,N,R=this;return x(this,function(m){if(this.filter)return[2,y(new E.OpenViduError(E.OpenViduErrorName.GENERIC_ERROR,"There is already a filter applied to Stream "+this.streamId))];if(T=function(O,M){if(O)return s.error("Error applying filter for Stream "+R.streamId,O),O.code===401?y(new E.OpenViduError(E.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to apply a filter")):y(O);s.info("Filter successfully applied on Stream "+R.streamId);var V=R.filter;return R.filter=new S.Filter(e,l),R.filter.stream=R,M&&(R.session.emitEvent("streamPropertyChanged",[new t.StreamPropertyChangedEvent(R.session,R,"filter",R.filter,V,"applyFilter")]),R.streamManager.emitEvent("streamPropertyChanged",[new t.StreamPropertyChangedEvent(R.streamManager,R,"filter",R.filter,V,"applyFilter")])),n(R.filter)},e.startsWith("VB:")){if(!this.hasVideo)return[2,y(new E.OpenViduError(E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"The Virtual Background filter requires a video track to be applied"))];if(!this.mediaStream||this.streamManager.videos.length===0)return[2,y(new E.OpenViduError(E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"The StreamManager requires some video element to be attached to it in order to apply a Virtual Background filter"))];if(this.session.token?L=this.session.token:L=l.token,!L)return[2,y(new E.OpenViduError(E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,'Virtual Background requires the client to be connected to a Session or to have a "token" property available in "options" parameter with a valid OpenVidu token'))];if(D=this.session.getTokenParams(L),D.edition!=="pro"&&D.edition!=="enterprise")return[2,y(new E.OpenViduError(E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"OpenVidu Virtual Background API is available from OpenVidu Pro edition onwards"))];L=encodeURIComponent(btoa(L)),s.info("Applying Virtual Background to stream "+this.streamId),r=function(){return p(R,void 0,void 0,function(){var O,M,V,j,B,W,F;return x(this,function(G){switch(G.label){case 0:return G.trys.push([0,8,,9]),O=this.streamId+"_"+(0,P.v4)(),M=this.mediaStream.clone(),V=this.streamManager.videos[0].video.cloneNode(!1),V.id=VirtualBackground.VirtualBackground.SOURCE_VIDEO_PREFIX+O,V.srcObject=M,V.muted=!0,this.virtualBackgroundSourceElements={videoClone:V,mediaStreamClone:M},VirtualBackground.VirtualBackground.hideHtmlElement(V,!1),VirtualBackground.VirtualBackground.appendHtmlElementToHiddenContainer(V,O),[4,V.play()];case 1:switch(G.sent(),j=new VirtualBackground.VirtualBackground({id:O,openviduServerUrl:new URL(D.httpUri),openviduToken:L,inputVideo:V,inputResolution:"160x96",outputFramerate:24}),B=void 0,W=e,W){case"VB:blur":return[3,2];case"VB:image":return[3,4]}return[3,6];case 2:return[4,j.backgroundBlur(l)];case 3:return B=G.sent(),[3,7];case 4:return[4,j.backgroundImage(l)];case 5:return B=G.sent(),[3,7];case 6:throw new Error("Unknown Virtual Background filter: "+e);case 7:return this.virtualBackgroundSinkElements={VB:j,video:B},V.style.display="none",this.streamManager.remote?this.streamManager.replaceTrackInMediaStream(this.virtualBackgroundSinkElements.video.srcObject.getVideoTracks()[0],!1):this.streamManager.replaceTrackAux(this.virtualBackgroundSinkElements.video.srcObject.getVideoTracks()[0],!1),T(void 0,!1),[3,9];case 8:return F=G.sent(),F.name===E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR?T(new E.OpenViduError(E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,F.message),!1):T(F,!1),[3,9];case 9:return[2]}})})},typeof VirtualBackground>"u"?(g=document.createElement("script"),g.type="text/javascript",g.src=D.httpUri+"/openvidu/virtual-background/openvidu-virtual-background.js?token="+L,g.onload=function(){return p(R,void 0,void 0,function(){var O;return x(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),[4,r()];case 1:return M.sent(),n(new S.Filter(e,l)),[3,3];case 2:return O=M.sent(),y(O),[3,3];case 3:return[2]}})})},document.body.appendChild(g)):r().then(function(){return n(new S.Filter(e,l))}).catch(function(O){return y(O)})}else{if(!this.session.sessionConnected())return[2,y(this.session.notConnectedError())];s.info("Applying server filter to stream "+this.streamId),l=l??{},N=l,typeof N!="string"&&(N=JSON.stringify(N)),this.session.openvidu.sendRequest("applyFilter",{streamId:this.streamId,type:e,options:N},function(O,M){T(O,!0)})}return[2]})})})},b.prototype.removeFilter=function(){return p(this,void 0,void 0,function(){return x(this,function(e){switch(e.label){case 0:return[4,this.removeFilterAux(!1)];case 1:return[2,e.sent()]}})})},b.prototype.getRTCPeerConnection=function(){return this.webRtcPeer.pc},b.prototype.getMediaStream=function(){return this.mediaStream},b.prototype.removeFilterAux=function(e){var l=this;return new Promise(function(I,n){return p(l,void 0,void 0,function(){var y,T,L,D=this,r;return x(this,function(g){switch(g.label){case 0:if(y=function(N,R){if(N)return delete D.filter,s.error("Error removing filter for Stream "+D.streamId,N),N.code===401?n(new E.OpenViduError(E.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to remove a filter")):n(N);s.info("Filter successfully removed from Stream "+D.streamId);var m=D.filter;return delete D.filter,R&&(D.session.emitEvent("streamPropertyChanged",[new t.StreamPropertyChangedEvent(D.session,D,"filter",D.filter,m,"applyFilter")]),D.streamManager.emitEvent("streamPropertyChanged",[new t.StreamPropertyChangedEvent(D.streamManager,D,"filter",D.filter,m,"applyFilter")])),I()},!this.filter)return[3,11];if(!(!((r=this.filter)===null||r===void 0)&&r.type.startsWith("VB:")))return[3,9];g.label=1;case 1:return g.trys.push([1,7,,8]),T=this.virtualBackgroundSourceElements.mediaStreamClone,e?[3,5]:this.streamManager.remote?(this.streamManager.replaceTrackInMediaStream(T.getVideoTracks()[0],!1),[3,4]):[3,2];case 2:return[4,this.streamManager.replaceTrackAux(T.getVideoTracks()[0],!1)];case 3:g.sent(),g.label=4;case 4:return[3,6];case 5:T.getTracks().forEach(function(N){return N.stop()}),g.label=6;case 6:return this.virtualBackgroundSinkElements.VB.cleanUp(),delete this.virtualBackgroundSinkElements,delete this.virtualBackgroundSourceElements,[2,y(void 0,!1)];case 7:return L=g.sent(),[2,y(L,!1)];case 8:return[3,10];case 9:if(!this.session.sessionConnected())return[2,n(this.session.notConnectedError())];s.info("Removing filter of stream "+this.streamId),this.session.openvidu.sendRequest("removeFilter",{streamId:this.streamId},function(N,R){return y(N,!0)}),g.label=10;case 10:return[3,12];case 11:return[2,n(new E.OpenViduError(E.OpenViduErrorName.GENERIC_ERROR,"Stream "+this.streamId+" has no filter applied"))];case 12:return[2]}})})})},b.prototype.setMediaStream=function(e){this.mediaStream=e},b.prototype.updateMediaStreamInVideos=function(){this.ee.emitEvent("mediastream-updated",[])},b.prototype.getWebRtcPeer=function(){return this.webRtcPeer},b.prototype.subscribeToMyRemote=function(e){this.isSubscribeToRemote=e},b.prototype.setOutboundStreamOptions=function(e){this.outboundStreamOpts=e},b.prototype.subscribe=function(){var e=this;return new Promise(function(l,I){e.initWebRtcPeerReceive(!1).then(function(){return l()}).catch(function(n){return I(n)})})},b.prototype.publish=function(){var e=this;return new Promise(function(l,I){e.isLocalStreamReadyToPublish?e.initWebRtcPeerSend(!1).then(function(){return l()}).catch(function(n){return I(n)}):e.ee.once("stream-ready-to-publish",function(){e.publish().then(function(){return l()}).catch(function(n){return I(n)})})})},b.prototype.disposeWebRtcPeer=function(){var e;this.webRtcPeer&&(this.webRtcPeer.dispose(),e=this.webRtcPeer.getId()),this.stopWebRtcStats(),s.info((this.outboundStreamOpts?"Outbound ":"Inbound ")+"RTCPeerConnection with id ["+e+"] from 'Stream' with id ["+this.streamId+"] is now closed")},b.prototype.disposeMediaStream=function(){return p(this,void 0,void 0,function(){var e;return x(this,function(l){switch(l.label){case 0:if(!(this.filter&&this.filter.type.startsWith("VB:")))return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.removeFilterAux(!0)];case 2:return l.sent(),console.debug("Success removing Virtual Background filter for stream ".concat(this.streamId)),[3,4];case 3:return e=l.sent(),console.error("Error removing Virtual Background filter for stream ".concat(this.streamId),e),[3,4];case 4:return this.mediaStream&&(this.mediaStream.getAudioTracks().forEach(function(I){I.stop()}),this.mediaStream.getVideoTracks().forEach(function(I){I.stop()}),delete this.mediaStream),this.localMediaStreamWhenSubscribedToRemote&&(this.localMediaStreamWhenSubscribedToRemote.getAudioTracks().forEach(function(I){I.stop()}),this.localMediaStreamWhenSubscribedToRemote.getVideoTracks().forEach(function(I){I.stop()}),delete this.localMediaStreamWhenSubscribedToRemote),this.speechEvent&&(this.speechEvent.stop&&this.speechEvent.stop(),delete this.speechEvent),s.info((this.outboundStreamOpts?"Local ":"Remote ")+"MediaStream from 'Stream' with id ["+this.streamId+"] is now disposed"),[2]}})})},b.prototype.displayMyRemote=function(){return this.isSubscribeToRemote},b.prototype.isSendAudio=function(){return!!this.outboundStreamOpts&&this.outboundStreamOpts.publisherProperties.audioSource!==null&&this.outboundStreamOpts.publisherProperties.audioSource!==!1},b.prototype.isSendVideo=function(){return!!this.outboundStreamOpts&&this.outboundStreamOpts.publisherProperties.videoSource!==null&&this.outboundStreamOpts.publisherProperties.videoSource!==!1},b.prototype.isSendScreen=function(){var e=!1;if(typeof MediaStreamTrack<"u"&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack){var l=this.outboundStreamOpts.publisherProperties.videoSource.getSettings();l.displaySurface&&(e=["monitor","window","browser"].includes(l.displaySurface))}return!e&&_.isElectron()&&(e=typeof this.outboundStreamOpts.publisherProperties.videoSource=="string"&&this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")),e||(e=this.outboundStreamOpts.publisherProperties.videoSource==="screen"),!!this.outboundStreamOpts&&e},b.prototype.enableHarkSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkSpeakingEnabled&&this.speechEvent&&(this.harkSpeakingEnabled=!0,this.speechEvent.on("speaking",function(){e.session.emitEvent("publisherStartSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStartSpeaking",[new a.PublisherSpeakingEvent(e.streamManager,"publisherStartSpeaking",e.connection,e.streamId)]),e.harkSpeakingEnabledOnce=!1}))},b.prototype.enableOnceHarkSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkSpeakingEnabledOnce&&this.speechEvent&&(this.harkSpeakingEnabledOnce=!0,this.speechEvent.once("speaking",function(){e.harkSpeakingEnabledOnce&&(e.session.emitEvent("publisherStartSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStartSpeaking",[new a.PublisherSpeakingEvent(e.streamManager,"publisherStartSpeaking",e.connection,e.streamId)])),e.disableHarkSpeakingEvent(!0)}))},b.prototype.disableHarkSpeakingEvent=function(e){if(this.speechEvent){if(this.harkSpeakingEnabledOnce=!1,e){if(this.harkSpeakingEnabled)return}else this.harkSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},b.prototype.enableHarkStoppedSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkStoppedSpeakingEnabled&&this.speechEvent&&(this.harkStoppedSpeakingEnabled=!0,this.speechEvent.on("stopped_speaking",function(){e.session.emitEvent("publisherStopSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStopSpeaking",[new a.PublisherSpeakingEvent(e.streamManager,"publisherStopSpeaking",e.connection,e.streamId)]),e.harkStoppedSpeakingEnabledOnce=!1}))},b.prototype.enableOnceHarkStoppedSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkStoppedSpeakingEnabledOnce&&this.speechEvent&&(this.harkStoppedSpeakingEnabledOnce=!0,this.speechEvent.once("stopped_speaking",function(){e.harkStoppedSpeakingEnabledOnce&&(e.session.emitEvent("publisherStopSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStopSpeaking",[new a.PublisherSpeakingEvent(e.streamManager,"publisherStopSpeaking",e.connection,e.streamId)])),e.disableHarkStoppedSpeakingEvent(!0)}))},b.prototype.disableHarkStoppedSpeakingEvent=function(e){if(this.speechEvent){if(this.harkStoppedSpeakingEnabledOnce=!1,e){if(this.harkStoppedSpeakingEnabled)return}else this.harkStoppedSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce?this.speechEvent.off("stopped_speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},b.prototype.enableHarkVolumeChangeEvent=function(e){var l=this;this.setHarkListenerIfNotExists()?(!this.harkVolumeChangeEnabled||e)&&(this.harkVolumeChangeEnabled=!0,this.speechEvent.on("volume_change",function(I){var n=l.speechEvent.oldVolumeValue,y={newValue:I,oldValue:n};l.speechEvent.oldVolumeValue=I,l.streamManager.emitEvent("streamAudioVolumeChange",[new i.StreamManagerEvent(l.streamManager,"streamAudioVolumeChange",y)])})):this.harkVolumeChangeEnabled=!0},b.prototype.enableOnceHarkVolumeChangeEvent=function(e){var l=this;this.setHarkListenerIfNotExists()?(!this.harkVolumeChangeEnabledOnce||e)&&(this.harkVolumeChangeEnabledOnce=!0,this.speechEvent.once("volume_change",function(I){var n=l.speechEvent.oldVolumeValue,y={newValue:I,oldValue:n};l.speechEvent.oldVolumeValue=I,l.disableHarkVolumeChangeEvent(!0),l.streamManager.emitEvent("streamAudioVolumeChange",[new i.StreamManagerEvent(l.streamManager,"streamAudioVolumeChange",y)])})):this.harkVolumeChangeEnabledOnce=!0},b.prototype.disableHarkVolumeChangeEvent=function(e){if(this.speechEvent){if(this.harkVolumeChangeEnabledOnce=!1,e){if(this.harkVolumeChangeEnabled)return}else this.harkVolumeChangeEnabled=!1;this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("volume_change"):(this.speechEvent.stop(),delete this.speechEvent)}},b.prototype.isLocal=function(){return!this.inboundStreamOpts&&!!this.outboundStreamOpts},b.prototype.getSelectedIceCandidate=function(){var e=this;return new Promise(function(l,I){e.webRtcStats.getSelectedIceCandidateInfo().then(function(n){return l(n)}).catch(function(n){return I(n)})})},b.prototype.getRemoteIceCandidateList=function(){return this.webRtcPeer.remoteCandidatesQueue},b.prototype.getLocalIceCandidateList=function(){return this.webRtcPeer.localCandidatesQueue},b.prototype.streamIceConnectionStateBroken=function(){if(!this.getWebRtcPeer()||!this.getRTCPeerConnection())return!1;if(this.session.openvidu.advancedConfiguration.forceMediaReconnectionAfterNetworkDrop)return s.warn('OpenVidu Browser advanced configuration option "forceMediaReconnectionAfterNetworkDrop" is enabled. Stream '.concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") will force a reconnection")),!0;var e=this.getRTCPeerConnection().iceConnectionState;return e!=="connected"&&e!=="completed"},b.prototype.setHarkListenerIfNotExists=function(){if(this.mediaStream){if(!this.speechEvent){var e=this.harkOptions?this.harkOptions:this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{};e.interval=typeof e.interval=="number"?e.interval:100,e.threshold=typeof e.threshold=="number"?e.threshold:-50,this.speechEvent=v(this.mediaStream,e)}return!0}return!1},b.prototype.setupReconnectionEventEmitter=function(e,l){return this.reconnectionEventEmitter==null?(this.reconnectionEventEmitter=new u,!1):(console.warn("Trying to reconnect stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") but an ongoing reconnection process is active. Waiting for response...")),this.reconnectionEventEmitter.once("success",function(){return e()}),this.reconnectionEventEmitter.once("error",function(I){return l(I)}),!0)},b.prototype.initWebRtcPeerSend=function(e){var l=this;return new Promise(function(I,n){var y;if(e){if(l.setupReconnectionEventEmitter(I,n))return}else l.initHarkEvents();var T=function(){var g;return e&&((g=l.reconnectionEventEmitter)===null||g===void 0||g.emitEvent("success"),delete l.reconnectionEventEmitter),I()},L=function(g){var N;return e&&((N=l.reconnectionEventEmitter)===null||N===void 0||N.emitEvent("error",[g]),delete l.reconnectionEventEmitter),n(g)},D=function(g){s.debug("Sending SDP offer to publish as "+l.streamId,g);var N=e?"reconnectStream":"publishVideo",R;if(e)R={stream:l.streamId,sdpString:g};else{var m=void 0;l.isSendVideo()&&(m=typeof MediaStreamTrack<"u"&&l.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?w.TypeOfVideo.CUSTOM:l.isSendScreen()?w.TypeOfVideo.SCREEN:w.TypeOfVideo.CAMERA),R={doLoopback:l.displayMyRemote()||!1,hasAudio:l.isSendAudio(),hasVideo:l.isSendVideo(),audioActive:l.audioActive,videoActive:l.videoActive,typeOfVideo:m,frameRate:l.frameRate?l.frameRate:-1,videoDimensions:JSON.stringify(l.videoDimensions),filter:l.outboundStreamOpts.publisherProperties.filter,sdpOffer:g}}l.session.openvidu.sendRequest(N,R,function(O,M){O?O.code===401?L(new E.OpenViduError(E.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to publish")):L("Error on publishVideo: "+JSON.stringify(O)):l.webRtcPeer.processRemoteAnswer(M.sdpAnswer).then(function(){l.streamId=M.id,l.creationTime=M.createdAt,l.isLocalStreamPublished=!0,l.publishedOnce=!0,l.displayMyRemote()&&(l.localMediaStreamWhenSubscribedToRemote=l.mediaStream,l.remotePeerSuccessfullyEstablished(e)),e?l.ee.emitEvent("stream-reconnected-by-publisher",[]):l.ee.emitEvent("stream-created-by-publisher",[]),l.initWebRtcStats(),s.info("'Publisher' ("+l.streamId+") successfully "+(e?"reconnected":"published")+" to session"),T()}).catch(function(V){L(V)})})},r={mediaConstraints:{audio:l.hasAudio,video:l.hasVideo},simulcast:(y=l.outboundStreamOpts.publisherProperties.videoSimulcast)!==null&&y!==void 0?y:l.session.openvidu.videoSimulcast,onIceCandidate:l.connection.sendIceCandidate.bind(l.connection),onIceConnectionStateException:l.onIceConnectionStateExceptionHandler.bind(l),iceServers:l.getIceServersConf(),rtcConfiguration:l.session.openvidu.advancedConfiguration.rtcConfiguration,mediaStream:l.mediaStream,mediaServer:l.session.openvidu.mediaServer,typeOfVideo:l.typeOfVideo?w.TypeOfVideo[l.typeOfVideo]:void 0};l.session.openvidu.mediaServer!=="mediasoup"&&(r.simulcast=!1),e&&l.disposeWebRtcPeer(),l.displayMyRemote()?l.webRtcPeer=new d.WebRtcPeerSendrecv(r):l.webRtcPeer=new d.WebRtcPeerSendonly(r),l.webRtcPeer.addIceConnectionStateChangeListener("publisher of "+l.connection.connectionId),l.webRtcPeer.createOffer().then(function(g){l.webRtcPeer.processLocalOffer(g).then(function(){D(g.sdp)}).catch(function(N){L(new Error("(publish) SDP process local offer error: "+JSON.stringify(N)))})}).catch(function(g){L(new Error("(publish) SDP create offer error: "+JSON.stringify(g)))})})},b.prototype.finalResolveForSubscription=function(e,l){var I;return s.info("'Subscriber' ("+this.streamId+") successfully "+(e?"reconnected":"subscribed")),this.remotePeerSuccessfullyEstablished(e),this.initWebRtcStats(),e&&((I=this.reconnectionEventEmitter)===null||I===void 0||I.emitEvent("success"),delete this.reconnectionEventEmitter),l()},b.prototype.finalRejectForSubscription=function(e,l,I){var n;return s.error("Error for 'Subscriber' ("+this.streamId+") while trying to "+(e?"reconnect":"subscribe")+": "+l.toString()),e&&((n=this.reconnectionEventEmitter)===null||n===void 0||n.emitEvent("error",[l]),delete this.reconnectionEventEmitter),I(l)},b.prototype.initWebRtcPeerReceive=function(e){var l=this;return new Promise(function(I,n){e&&l.setupReconnectionEventEmitter(I,n)||(l.session.openvidu.mediaServer==="mediasoup"?l.initWebRtcPeerReceiveFromServer(e).then(function(){return l.finalResolveForSubscription(e,I)}).catch(function(y){return l.finalRejectForSubscription(e,y,n)}):l.initWebRtcPeerReceiveFromClient(e).then(function(){return l.finalResolveForSubscription(e,I)}).catch(function(y){return l.finalRejectForSubscription(e,y,n)}))})},b.prototype.initWebRtcPeerReceiveFromClient=function(e){var l=this;return new Promise(function(I,n){l.completeWebRtcPeerReceive(e,!1).then(function(y){l.webRtcPeer.processRemoteAnswer(y.sdpAnswer).then(function(){return I()}).catch(function(T){return n(T)})}).catch(function(y){return n(y)})})},b.prototype.initWebRtcPeerReceiveFromServer=function(e){var l=this;return new Promise(function(I,n){l.session.openvidu.sendRequest("prepareReceiveVideoFrom",{sender:l.streamId,reconnect:e},function(y,T){if(y)return n(new Error("Error on prepareReceiveVideoFrom: "+JSON.stringify(y)));l.completeWebRtcPeerReceive(e,!1,T.sdpOffer).then(function(){return I()}).catch(function(L){return n(L)})})})},b.prototype.completeWebRtcPeerReceive=function(e,l,I){var n=this;return new Promise(function(y,T){s.debug("'Session.subscribe(Stream)' called");var L=function(r){s.debug("Sending local SDP ".concat(I?"answer":"offer"," to subscribe to ").concat(n.streamId),r);var g=e?"reconnectStream":"receiveVideoFrom",N={};N[e?"stream":"sender"]=n.streamId,I?N[e?"sdpString":"sdpAnswer"]=r:N.sdpOffer=r,e&&(N.forciblyReconnect=l),n.session.openvidu.sendRequest(g,N,function(R,m){return R?T(new Error("Error on "+g+" : "+JSON.stringify(R))):y(m)})},D={mediaConstraints:{audio:n.hasAudio,video:n.hasVideo},simulcast:!1,onIceCandidate:n.connection.sendIceCandidate.bind(n.connection),onIceConnectionStateException:n.onIceConnectionStateExceptionHandler.bind(n),iceServers:n.getIceServersConf(),rtcConfiguration:n.session.openvidu.advancedConfiguration.rtcConfiguration,mediaServer:n.session.openvidu.mediaServer,typeOfVideo:n.typeOfVideo?w.TypeOfVideo[n.typeOfVideo]:void 0};e&&n.disposeWebRtcPeer(),n.webRtcPeer=new d.WebRtcPeerRecvonly(D),n.webRtcPeer.addIceConnectionStateChangeListener(n.streamId),I?n.webRtcPeer.processRemoteOffer(I).then(function(){n.webRtcPeer.createAnswer().then(function(r){n.webRtcPeer.processLocalAnswer(r).then(function(){L(r.sdp)}).catch(function(g){return T(new Error("(subscribe) SDP process local answer error: "+JSON.stringify(g)))})}).catch(function(r){return T(new Error("(subscribe) SDP create answer error: "+JSON.stringify(r)))})}).catch(function(r){return T(new Error("(subscribe) SDP process remote offer error: "+JSON.stringify(r)))}):n.webRtcPeer.createOffer().then(function(r){n.webRtcPeer.processLocalOffer(r).then(function(){L(r.sdp)}).catch(function(g){return T(new Error("(subscribe) SDP process local offer error: "+JSON.stringify(g)))})}).catch(function(r){return T(new Error("(subscribe) SDP create offer error: "+JSON.stringify(r)))})})},b.prototype.remotePeerSuccessfullyEstablished=function(e){e&&this.mediaStream!=null&&this.disposeMediaStream(),this.mediaStream=new MediaStream;for(var l,I=0,n=this.webRtcPeer.pc.getReceivers();I<n.length;I++)l=n[I],l.track&&this.mediaStream.addTrack(l.track);if(s.debug("Peer remote stream",this.mediaStream),this.mediaStream){if(this.streamManager instanceof f.Subscriber){if(this.mediaStream.getAudioTracks()[0]){var y=e?this.audioActive:!!this.streamManager.properties.subscribeToAudio;this.mediaStream.getAudioTracks()[0].enabled=y}if(this.mediaStream.getVideoTracks()[0]){var y=e?this.videoActive:!!this.videoActive&&!!this.streamManager.properties.subscribeToVideo;this.mediaStream.getVideoTracks()[0].enabled=y}}this.updateMediaStreamInVideos(),this.initHarkEvents()}},b.prototype.initHarkEvents=function(){this.mediaStream.getAudioTracks()[0]&&(this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!0,this.streamManager)&&this.enableOnceHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.streamManager)&&this.enableHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!0,this.streamManager)&&this.enableOnceHarkStoppedSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.streamManager)&&this.enableHarkStoppedSpeakingEvent(),this.harkVolumeChangeEnabledOnce&&this.enableOnceHarkVolumeChangeEvent(!0),this.harkVolumeChangeEnabled&&this.enableHarkVolumeChangeEvent(!0))},b.prototype.onIceConnectionStateExceptionHandler=function(e,l,I){switch(e){case o.ExceptionEventName.ICE_CONNECTION_FAILED:this.onIceConnectionFailed();break;case o.ExceptionEventName.ICE_CONNECTION_DISCONNECTED:this.onIceConnectionDisconnected();break}this.session.emitEvent("exception",[new o.ExceptionEvent(this.session,e,this,l,I)])},b.prototype.onIceConnectionFailed=function(){s.log("[ICE_CONNECTION_FAILED] Handling ICE_CONNECTION_FAILED event. Reconnecting stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",")")),this.reconnectStreamAndLogResultingIceConnectionState(o.ExceptionEventName.ICE_CONNECTION_FAILED)},b.prototype.onIceConnectionDisconnected=function(){var e=this;s.log("[ICE_CONNECTION_DISCONNECTED] Handling ICE_CONNECTION_DISCONNECTED event. Waiting for ICE to be restored and reconnect stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") if not possible"));var l=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3;this.awaitWebRtcPeerConnectionState(l).then(function(I){switch(I){case"failed":s.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(e.streamId," (").concat(e.isLocal()?"Publisher":"Subscriber",") is now failed after ICE_CONNECTION_DISCONNECTED"));break;case"connected":case"completed":s.log("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(e.streamId," (").concat(e.isLocal()?"Publisher":"Subscriber",") automatically restored after ICE_CONNECTION_DISCONNECTED. Current ICE connection state: ").concat(I));break;case"closed":case"checking":case"new":case"disconnected":s.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(e.streamId," (").concat(e.isLocal()?"Publisher":"Subscriber",") couldn't be restored after ICE_CONNECTION_DISCONNECTED event. Current ICE connection state after ").concat(l," ms: ").concat(I)),e.reconnectStreamAndLogResultingIceConnectionState(o.ExceptionEventName.ICE_CONNECTION_DISCONNECTED);break}})},b.prototype.reconnectStreamAndLogResultingIceConnectionState=function(e){return p(this,void 0,void 0,function(){var l,I;return x(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.reconnectStreamAndReturnIceConnectionState(e)];case 1:switch(l=n.sent(),l){case"connected":case"completed":s.log("[".concat(e,"] Stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") successfully reconnected after ").concat(e,". Current ICE connection state: ").concat(l));break;default:s.error("[".concat(e,"] Stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") failed to reconnect after ").concat(e,". Current ICE connection state: ").concat(l));break}return[3,3];case 2:return I=n.sent(),s.error("[".concat(e,"] Error reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") after ").concat(e,": ").concat(I)),[3,3];case 3:return[2]}})})},b.prototype.reconnectStreamAndReturnIceConnectionState=function(e){return p(this,void 0,void 0,function(){var l,I;return x(this,function(n){switch(n.label){case 0:s.log("[".concat(e,"] Reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") after event ").concat(e)),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.reconnectStream(e)];case 2:return n.sent(),l=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3,[2,this.awaitWebRtcPeerConnectionState(l)];case 3:return I=n.sent(),s.warn("[".concat(e,"] Error reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber","). Reason: ").concat(I)),[2,this.awaitWebRtcPeerConnectionState(1)];case 4:return[2]}})})},b.prototype.awaitWebRtcPeerConnectionState=function(e){return p(this,void 0,void 0,function(){var l,I,n,y;return x(this,function(T){switch(T.label){case 0:l=this.getRTCPeerConnection().iceConnectionState,I=150,n=Math.ceil(e/I),y=0,T.label=1;case 1:return y<n?(l=this.getRTCPeerConnection().iceConnectionState,l==="connected"||l==="completed"?[3,4]:[4,new Promise(function(L){return setTimeout(L,I)})]):[3,4];case 2:T.sent(),T.label=3;case 3:return y++,[3,1];case 4:return[2,l]}})})},b.prototype.reconnectStream=function(e){return p(this,void 0,void 0,function(){var l,I;return x(this,function(n){switch(n.label){case 0:return[4,this.isWebsocketConnected(e,3e3)];case 1:if(l=n.sent(),l)return s.log("[".concat(e,"] Trying to reconnect stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") and the websocket is opened")),this.isLocal()?[2,this.initWebRtcPeerSend(!0)]:[2,this.initWebRtcPeerReceive(!0)];throw I="[".concat(e,"] Trying to reconnect stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") but the websocket wasn't opened"),s.error(I),Error(I)}})})},b.prototype.isWebsocketConnected=function(e,l){var I=this;return new Promise(function(n,y){var T=I.session.openvidu.getWsReadyState();if(T===1){var L=setTimeout(function(){return console.warn("[".concat(e,"] Websocket timeout of ").concat(l,"ms")),n(!1)},l);I.session.openvidu.sendRequest("echo",{},function(D,r){return clearTimeout(L),D?(console.warn("[".concat(e,"] Websocket 'echo' returned error: ").concat(D)),n(!1)):n(!0)})}else return console.warn("[".concat(e,"] Websocket readyState is ").concat(T)),n(!1)})},b.prototype.initWebRtcStats=function(){this.webRtcStats=new c.WebRtcStats(this),this.webRtcStats.initWebRtcStats()},b.prototype.stopWebRtcStats=function(){this.webRtcStats&&this.webRtcStats.isEnabled()&&this.webRtcStats.stopWebRtcStats()},b.prototype.getIceServersConf=function(){var e,l;return this.session.openvidu.advancedConfiguration.iceServers?l=this.session.openvidu.advancedConfiguration.iceServers==="freeice"?void 0:this.session.openvidu.advancedConfiguration.iceServers:!((e=this.session.openvidu.advancedConfiguration.rtcConfiguration)===null||e===void 0)&&e.iceServers?l=this.session.openvidu.advancedConfiguration.rtcConfiguration.iceServers:this.session.openvidu.iceServers?l=this.session.openvidu.iceServers:l=void 0,l},b.prototype.gatherStatsForPeer=function(){var e=this;return new Promise(function(l,I){e.isLocal()?e.getRTCPeerConnection().getSenders().forEach(function(n){return n.getStats().then(function(y){y.forEach(function(T){if(e.isReportWanted(T)){var L={};L.type=T.type,L.timestamp=T.timestamp,L.id=T.id,T.type==="outbound-rtp"&&(L.ssrc=T.ssrc,L.firCount=T.firCount,L.pliCount=T.pliCount,L.nackCount=T.nackCount,L.qpSum=T.qpSum,T.kind?L.mediaType=T.kind:T.mediaType?L.mediaType=T.mediaType:L.mediaType=T.id.indexOf("VideoStream")!==-1?"video":"audio",L.mediaType==="video"&&(L.framesEncoded=T.framesEncoded),L.packetsSent=T.packetsSent,L.bytesSent=T.bytesSent),T.type==="candidate-pair"&&T.totalRoundTripTime!==void 0&&(L.availableOutgoingBitrate=T.availableOutgoingBitrate,L.rtt=T.currentRoundTripTime,L.averageRtt=T.totalRoundTripTime/T.responsesReceived),T.type==="remote-inbound-rtp"||T.type,s.log(L)}})})}):e.getRTCPeerConnection().getReceivers().forEach(function(n){return n.getStats().then(function(y){y.forEach(function(T){if(e.isReportWanted(T)){var L={};L.type=T.type,L.timestamp=T.timestamp,L.id=T.id,T.type==="inbound-rtp"&&(L.ssrc=T.ssrc,L.firCount=T.firCount,L.pliCount=T.pliCount,L.nackCount=T.nackCount,L.qpSum=T.qpSum,T.kind?L.mediaType=T.kind:T.mediaType?L.mediaType=T.mediaType:L.mediaType=T.id.indexOf("VideoStream")!==-1?"video":"audio",L.mediaType==="video"&&(L.framesDecoded=T.framesDecoded),L.packetsReceived=T.packetsReceived,L.packetsLost=T.packetsLost,L.jitter=T.jitter,L.bytesReceived=T.bytesReceived),T.type==="candidate-pair"&&T.totalRoundTripTime!==void 0&&(L.availableIncomingBitrate=T.availableIncomingBitrate,L.rtt=T.currentRoundTripTime,L.averageRtt=T.totalRoundTripTime/T.responsesReceived),T.type==="remote-inbound-rtp"||T.type,s.log(L)}})})})})},b.prototype.isReportWanted=function(e){return e.type==="inbound-rtp"&&!this.isLocal()||e.type==="outbound-rtp"&&this.isLocal()||e.type==="candidate-pair"&&e.nominated&&e.bytesSent>0},b}();return he.Stream=k,he}var nr;function Jr(){if(nr)return We;nr=1,Object.defineProperty(We,"__esModule",{value:!0}),We.Connection=void 0;var p=en(),x=se(),S=De(),f=x.OpenViduLogger.getInstance(),d=function(){function c(o,a){this.session=o,this.disposed=!1;var i="'Connection' created ";a.role?(this.localOptions=a,this.connectionId=this.localOptions.id,this.creationTime=this.localOptions.createdAt,this.data=this.localOptions.metadata,this.rpcSessionId=this.localOptions.sessionId,this.role=this.localOptions.role,this.record=this.localOptions.record,i+="(local)"):(this.remoteOptions=a,this.connectionId=this.remoteOptions.id,this.creationTime=this.remoteOptions.createdAt,this.remoteOptions.metadata&&(this.data=this.remoteOptions.metadata),this.remoteOptions.streams&&this.initRemoteStreams(this.remoteOptions.streams),i+="(remote) with 'connectionId' ["+this.remoteOptions.id+"]"),f.info(i)}return c.prototype.sendIceCandidate=function(o){var a=this;this.disposed?f.warn("Connection ".concat(this.connectionId," disposed when trying to send an ICE candidate. ICE candidate not sent")):(f.debug((this.stream.outboundStreamOpts?"Local":"Remote")+"candidate for"+this.connectionId,o),this.session.openvidu.sendRequest("onIceCandidate",{endpointName:this.connectionId,candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex},function(i,t){i&&(f.error("Error sending ICE candidate: "+JSON.stringify(i)),a.session.emitEvent("exception",[new S.ExceptionEvent(a.session,S.ExceptionEventName.ICE_CANDIDATE_ERROR,a.session,"There was an unexpected error on the server-side processing an ICE candidate generated and sent by the client-side",i)]))}))},c.prototype.initRemoteStreams=function(o){var a=this;o.forEach(function(i){var t={id:i.id,createdAt:i.createdAt,connection:a,hasAudio:i.hasAudio,hasVideo:i.hasVideo,audioActive:i.audioActive,videoActive:i.videoActive,typeOfVideo:i.typeOfVideo,frameRate:i.frameRate,videoDimensions:i.videoDimensions?JSON.parse(i.videoDimensions):void 0,filter:i.filter?i.filter:void 0},E=new p.Stream(a.session,t);a.addStream(E)}),f.info("Remote 'Connection' with 'connectionId' ["+this.connectionId+"] is now configured for receiving Streams with options: ",this.stream.inboundStreamOpts)},c.prototype.addStream=function(o){o.connection=this,this.stream=o},c.prototype.removeStream=function(){delete this.stream},c.prototype.dispose=function(){this.disposed=!0,this.removeStream()},c}();return We.Connection=d,We}var Re={},rr;function Kr(){if(rr)return Re;rr=1;var p=Re&&Re.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Re,"__esModule",{value:!0}),Re.ConnectionEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a,i,t){var E=f.call(this,c,o,a)||this;return E.connection=i,E.reason=t,E}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return Re.ConnectionEvent=S,Re}var Ce={},ir;function Yr(){if(ir)return Ce;ir=1;var p=Ce&&Ce.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.FilterEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a){var i=f.call(this,!1,c,o)||this;return i.data=a,i}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return Ce.FilterEvent=S,Ce}var _e={},or;function Qr(){if(or)return _e;or=1;var p=_e&&_e.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(_e,"__esModule",{value:!0}),_e.RecordingEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a,i,t){var E=f.call(this,!1,c,o)||this;return E.id=a,i!==a&&(E.name=i),E.reason=t,E}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return _e.RecordingEvent=S,_e}var Ie={},sr;function tn(){if(sr)return Ie;sr=1;var p=Ie&&Ie.__extends||function(){var c=function(o,a){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var E in t)Object.prototype.hasOwnProperty.call(t,E)&&(i[E]=t[E])},c(o,a)};return function(o,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");c(o,a);function i(){this.constructor=o}o.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.SessionDisconnectedEvent=void 0;var x=ce(),S=se(),f=S.OpenViduLogger.getInstance(),d=function(c){p(o,c);function o(a,i){var t=c.call(this,!0,a,"sessionDisconnected")||this;return t.reason=i,t}return o.prototype.callDefaultBehavior=function(){f.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'");var a=this.target;a.remoteConnections.forEach(function(i){var t,E,w,C,h,P,v,u,s=i.connectionId;if(!((t=a.remoteConnections.get(s))===null||t===void 0)&&t.stream){(E=a.remoteConnections.get(s))===null||E===void 0||E.stream.disposeWebRtcPeer(),(w=a.remoteConnections.get(s))===null||w===void 0||w.stream.disposeMediaStream(),!((C=a.remoteConnections.get(s))===null||C===void 0)&&C.stream.streamManager&&((h=a.remoteConnections.get(s))===null||h===void 0||h.stream.streamManager.removeAllVideos());var _=(v=(P=a.remoteConnections.get(s))===null||P===void 0?void 0:P.stream)===null||v===void 0?void 0:v.streamId;_&&a.remoteStreamsCreated.delete(_),(u=a.remoteConnections.get(s))===null||u===void 0||u.dispose()}a.remoteConnections.delete(s)})},o}(x.Event);return Ie.SessionDisconnectedEvent=d,Ie}var Pe={},ar;function Zr(){if(ar)return Pe;ar=1;var p=Pe&&Pe.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.SignalEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a,i){var t=f.call(this,!1,c,"signal")||this;return o&&(t.type="signal:"+o),t.data=a,t.from=i,t}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return Pe.SignalEvent=S,Pe}var Te={},cr;function ei(){if(cr)return Te;cr=1;var p=Te&&Te.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Te,"__esModule",{value:!0}),Te.SpeechToTextEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a,i,t,E){var w=f.call(this,!1,c,"speechToTextMessage")||this;return w.connection=o,w.text=a,w.reason=i,w.raw=t,w.lang=E,w}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return Te.SpeechToTextEvent=S,Te}var xe={},ur;function nn(){if(ur)return xe;ur=1;var p=xe&&xe.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,w){E.__proto__=w}||function(E,w){for(var C in w)Object.prototype.hasOwnProperty.call(w,C)&&(E[C]=w[C])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function E(){this.constructor=i}i.prototype=t===null?Object.create(t):(E.prototype=t.prototype,new E)}}();Object.defineProperty(xe,"__esModule",{value:!0}),xe.StreamEvent=void 0;var x=ce(),S=rn(),f=gt(),d=se(),c=d.OpenViduLogger.getInstance(),o=function(a){p(i,a);function i(t,E,w,C,h){var P=a.call(this,t,E,w)||this;return P.stream=C,P.reason=h,P}return i.prototype.callDefaultBehavior=function(){if(this.type==="streamDestroyed"){if(this.target instanceof f.Session)c.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'"),this.stream.disposeWebRtcPeer();else if(this.target instanceof S.Publisher){c.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Publisher'"),clearInterval(this.target.screenShareResizeInterval),this.stream.isLocalStreamReadyToPublish=!1;for(var t=this.target.openvidu.publishers,E=0;E<t.length;E++)if(t[E]===this.target){t.splice(E,1);break}}this.stream.disposeMediaStream(),this.stream.streamManager&&this.stream.streamManager.removeAllVideos(),this.stream.session.remoteStreamsCreated.delete(this.stream.streamId);var w=this.stream.session.remoteConnections.get(this.stream.connection.connectionId);if(w&&w.remoteOptions)for(var C=w.remoteOptions.streams,E=C.length-1;E>=0;--E)C[E].id===this.stream.streamId&&C.splice(E,1)}},i}(x.Event);return xe.StreamEvent=o,xe}var ke={},dr;function ti(){if(dr)return ke;dr=1;var p=ke&&ke.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(ke,"__esModule",{value:!0}),ke.ConnectionPropertyChangedEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a,i,t){var E=f.call(this,!1,c,"connectionPropertyChanged")||this;return E.connection=o,E.changedProperty=a,E.newValue=i,E.oldValue=t,E}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return ke.ConnectionPropertyChangedEvent=S,ke}var Ne={},lr;function ni(){if(lr)return Ne;lr=1;var p=Ne&&Ne.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.NetworkQualityLevelChangedEvent=void 0;var x=ce(),S=function(f){p(d,f);function d(c,o,a,i){var t=f.call(this,!1,c,"networkQualityLevelChanged")||this;return t.newValue=o,t.oldValue=a,t.connection=i,t}return d.prototype.callDefaultBehavior=function(){},d}(x.Event);return Ne.NetworkQualityLevelChangedEvent=S,Ne}var kt,fr;function ri(){if(fr)return kt;fr=1;var p={};return kt=typeof process=="object"&&p&&p.NODE_DEBUG&&/\bsemver\b/i.test(p.NODE_DEBUG)?(...S)=>console.error("SEMVER",...S):()=>{},kt}var Nt,hr;function ii(){if(hr)return Nt;hr=1;const p="2.0.0",x=256,S=Number.MAX_SAFE_INTEGER||9007199254740991,f=16,d=x-6;return Nt={MAX_LENGTH:x,MAX_SAFE_COMPONENT_LENGTH:f,MAX_SAFE_BUILD_LENGTH:d,MAX_SAFE_INTEGER:S,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:p,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Nt}var ct={exports:{}},pr;function qi(){return pr||(pr=1,function(p,x){const{MAX_SAFE_COMPONENT_LENGTH:S,MAX_SAFE_BUILD_LENGTH:f,MAX_LENGTH:d}=ii(),c=ri();x=p.exports={};const o=x.re=[],a=x.safeRe=[],i=x.src=[],t=x.t={};let E=0;const w="[a-zA-Z0-9-]",C=[["\\s",1],["\\d",d],[w,f]],h=v=>{for(const[u,s]of C)v=v.split(`${u}*`).join(`${u}{0,${s}}`).split(`${u}+`).join(`${u}{1,${s}}`);return v},P=(v,u,s)=>{const _=h(u),k=E++;c(v,k,u),t[v]=k,i[k]=u,o[k]=new RegExp(u,s?"g":void 0),a[k]=new RegExp(_,s?"g":void 0)};P("NUMERICIDENTIFIER","0|[1-9]\\d*"),P("NUMERICIDENTIFIERLOOSE","\\d+"),P("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${w}*`),P("MAINVERSION",`(${i[t.NUMERICIDENTIFIER]})\\.(${i[t.NUMERICIDENTIFIER]})\\.(${i[t.NUMERICIDENTIFIER]})`),P("MAINVERSIONLOOSE",`(${i[t.NUMERICIDENTIFIERLOOSE]})\\.(${i[t.NUMERICIDENTIFIERLOOSE]})\\.(${i[t.NUMERICIDENTIFIERLOOSE]})`),P("PRERELEASEIDENTIFIER",`(?:${i[t.NUMERICIDENTIFIER]}|${i[t.NONNUMERICIDENTIFIER]})`),P("PRERELEASEIDENTIFIERLOOSE",`(?:${i[t.NUMERICIDENTIFIERLOOSE]}|${i[t.NONNUMERICIDENTIFIER]})`),P("PRERELEASE",`(?:-(${i[t.PRERELEASEIDENTIFIER]}(?:\\.${i[t.PRERELEASEIDENTIFIER]})*))`),P("PRERELEASELOOSE",`(?:-?(${i[t.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[t.PRERELEASEIDENTIFIERLOOSE]})*))`),P("BUILDIDENTIFIER",`${w}+`),P("BUILD",`(?:\\+(${i[t.BUILDIDENTIFIER]}(?:\\.${i[t.BUILDIDENTIFIER]})*))`),P("FULLPLAIN",`v?${i[t.MAINVERSION]}${i[t.PRERELEASE]}?${i[t.BUILD]}?`),P("FULL",`^${i[t.FULLPLAIN]}$`),P("LOOSEPLAIN",`[v=\\s]*${i[t.MAINVERSIONLOOSE]}${i[t.PRERELEASELOOSE]}?${i[t.BUILD]}?`),P("LOOSE",`^${i[t.LOOSEPLAIN]}$`),P("GTLT","((?:<|>)?=?)"),P("XRANGEIDENTIFIERLOOSE",`${i[t.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),P("XRANGEIDENTIFIER",`${i[t.NUMERICIDENTIFIER]}|x|X|\\*`),P("XRANGEPLAIN",`[v=\\s]*(${i[t.XRANGEIDENTIFIER]})(?:\\.(${i[t.XRANGEIDENTIFIER]})(?:\\.(${i[t.XRANGEIDENTIFIER]})(?:${i[t.PRERELEASE]})?${i[t.BUILD]}?)?)?`),P("XRANGEPLAINLOOSE",`[v=\\s]*(${i[t.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[t.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[t.XRANGEIDENTIFIERLOOSE]})(?:${i[t.PRERELEASELOOSE]})?${i[t.BUILD]}?)?)?`),P("XRANGE",`^${i[t.GTLT]}\\s*${i[t.XRANGEPLAIN]}$`),P("XRANGELOOSE",`^${i[t.GTLT]}\\s*${i[t.XRANGEPLAINLOOSE]}$`),P("COERCEPLAIN",`(^|[^\\d])(\\d{1,${S}})(?:\\.(\\d{1,${S}}))?(?:\\.(\\d{1,${S}}))?`),P("COERCE",`${i[t.COERCEPLAIN]}(?:$|[^\\d])`),P("COERCEFULL",i[t.COERCEPLAIN]+`(?:${i[t.PRERELEASE]})?(?:${i[t.BUILD]})?(?:$|[^\\d])`),P("COERCERTL",i[t.COERCE],!0),P("COERCERTLFULL",i[t.COERCEFULL],!0),P("LONETILDE","(?:~>?)"),P("TILDETRIM",`(\\s*)${i[t.LONETILDE]}\\s+`,!0),x.tildeTrimReplace="$1~",P("TILDE",`^${i[t.LONETILDE]}${i[t.XRANGEPLAIN]}$`),P("TILDELOOSE",`^${i[t.LONETILDE]}${i[t.XRANGEPLAINLOOSE]}$`),P("LONECARET","(?:\\^)"),P("CARETTRIM",`(\\s*)${i[t.LONECARET]}\\s+`,!0),x.caretTrimReplace="$1^",P("CARET",`^${i[t.LONECARET]}${i[t.XRANGEPLAIN]}$`),P("CARETLOOSE",`^${i[t.LONECARET]}${i[t.XRANGEPLAINLOOSE]}$`),P("COMPARATORLOOSE",`^${i[t.GTLT]}\\s*(${i[t.LOOSEPLAIN]})$|^$`),P("COMPARATOR",`^${i[t.GTLT]}\\s*(${i[t.FULLPLAIN]})$|^$`),P("COMPARATORTRIM",`(\\s*)${i[t.GTLT]}\\s*(${i[t.LOOSEPLAIN]}|${i[t.XRANGEPLAIN]})`,!0),x.comparatorTrimReplace="$1$2$3",P("HYPHENRANGE",`^\\s*(${i[t.XRANGEPLAIN]})\\s+-\\s+(${i[t.XRANGEPLAIN]})\\s*$`),P("HYPHENRANGELOOSE",`^\\s*(${i[t.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[t.XRANGEPLAINLOOSE]})\\s*$`),P("STAR","(<|>)?=?\\s*\\*"),P("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),P("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(ct,ct.exports)),ct.exports}var Lt,vr;function Fi(){if(vr)return Lt;vr=1;const p=Object.freeze({loose:!0}),x=Object.freeze({});return Lt=f=>f?typeof f!="object"?p:f:x,Lt}var Mt,mr;function Ui(){if(mr)return Mt;mr=1;const p=/^[0-9]+$/,x=(f,d)=>{const c=p.test(f),o=p.test(d);return c&&o&&(f=+f,d=+d),f===d?0:c&&!o?-1:o&&!c?1:f<d?-1:1};return Mt={compareIdentifiers:x,rcompareIdentifiers:(f,d)=>x(d,f)},Mt}var At,gr;function oi(){if(gr)return At;gr=1;const p=ri(),{MAX_LENGTH:x,MAX_SAFE_INTEGER:S}=ii(),{safeRe:f,t:d}=qi(),c=Fi(),{compareIdentifiers:o}=Ui();class a{constructor(t,E){if(E=c(E),t instanceof a){if(t.loose===!!E.loose&&t.includePrerelease===!!E.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>x)throw new TypeError(`version is longer than ${x} characters`);p("SemVer",t,E),this.options=E,this.loose=!!E.loose,this.includePrerelease=!!E.includePrerelease;const w=t.trim().match(E.loose?f[d.LOOSE]:f[d.FULL]);if(!w)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+w[1],this.minor=+w[2],this.patch=+w[3],this.major>S||this.major<0)throw new TypeError("Invalid major version");if(this.minor>S||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>S||this.patch<0)throw new TypeError("Invalid patch version");w[4]?this.prerelease=w[4].split(".").map(C=>{if(/^[0-9]+$/.test(C)){const h=+C;if(h>=0&&h<S)return h}return C}):this.prerelease=[],this.build=w[5]?w[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(p("SemVer.compare",this.version,this.options,t),!(t instanceof a)){if(typeof t=="string"&&t===this.version)return 0;t=new a(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof a||(t=new a(t,this.options)),o(this.major,t.major)||o(this.minor,t.minor)||o(this.patch,t.patch)}comparePre(t){if(t instanceof a||(t=new a(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let E=0;do{const w=this.prerelease[E],C=t.prerelease[E];if(p("prerelease compare",E,w,C),w===void 0&&C===void 0)return 0;if(C===void 0)return 1;if(w===void 0)return-1;if(w===C)continue;return o(w,C)}while(++E)}compareBuild(t){t instanceof a||(t=new a(t,this.options));let E=0;do{const w=this.build[E],C=t.build[E];if(p("build compare",E,w,C),w===void 0&&C===void 0)return 0;if(C===void 0)return 1;if(w===void 0)return-1;if(w===C)continue;return o(w,C)}while(++E)}inc(t,E,w){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",E,w);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",E,w);break;case"prepatch":this.prerelease.length=0,this.inc("patch",E,w),this.inc("pre",E,w);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",E,w),this.inc("pre",E,w);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const C=Number(w)?1:0;if(!E&&w===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[C];else{let h=this.prerelease.length;for(;--h>=0;)typeof this.prerelease[h]=="number"&&(this.prerelease[h]++,h=-2);if(h===-1){if(E===this.prerelease.join(".")&&w===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(C)}}if(E){let h=[E,C];w===!1&&(h=[E]),o(this.prerelease[0],E)===0?isNaN(this.prerelease[1])&&(this.prerelease=h):this.prerelease=h}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return At=a,At}var Vt,Er;function Wi(){if(Er)return Vt;Er=1;const p=oi();return Vt=(S,f)=>new p(S,f).major,Vt}var Dt,br;function Hi(){if(br)return Dt;br=1;const p=oi();return Dt=(S,f)=>new p(S,f).minor,Dt}var Sr;function gt(){if(Sr)return le;Sr=1;var p=le&&le.__extends||function(){var L=function(D,r){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,N){g.__proto__=N}||function(g,N){for(var R in N)Object.prototype.hasOwnProperty.call(N,R)&&(g[R]=N[R])},L(D,r)};return function(D,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");L(D,r);function g(){this.constructor=D}D.prototype=r===null?Object.create(r):(g.prototype=r.prototype,new g)}}(),x=le&&le.__awaiter||function(L,D,r,g){function N(R){return R instanceof r?R:new r(function(m){m(R)})}return new(r||(r=Promise))(function(R,m){function O(j){try{V(g.next(j))}catch(B){m(B)}}function M(j){try{V(g.throw(j))}catch(B){m(B)}}function V(j){j.done?R(j.value):N(j.value).then(O,M)}V((g=g.apply(L,D||[])).next())})},S=le&&le.__generator||function(L,D){var r={label:0,sent:function(){if(R[0]&1)throw R[1];return R[1]},trys:[],ops:[]},g,N,R,m;return m={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function O(V){return function(j){return M([V,j])}}function M(V){if(g)throw new TypeError("Generator is already executing.");for(;m&&(m=0,V[0]&&(r=0)),r;)try{if(g=1,N&&(R=V[0]&2?N.return:V[0]?N.throw||((R=N.return)&&R.call(N),0):N.next)&&!(R=R.call(N,V[1])).done)return R;switch(N=0,R&&(V=[V[0]&2,R.value]),V[0]){case 0:case 1:R=V;break;case 4:return r.label++,{value:V[1],done:!1};case 5:r.label++,N=V[1],V=[0];continue;case 7:V=r.ops.pop(),r.trys.pop();continue;default:if(R=r.trys,!(R=R.length>0&&R[R.length-1])&&(V[0]===6||V[0]===2)){r=0;continue}if(V[0]===3&&(!R||V[1]>R[0]&&V[1]<R[3])){r.label=V[1];break}if(V[0]===6&&r.label<R[1]){r.label=R[1],R=V;break}if(R&&r.label<R[2]){r.label=R[2],r.ops.push(V);break}R[2]&&r.ops.pop(),r.trys.pop();continue}V=D.call(L,r)}catch(j){V=[6,j],N=0}finally{g=R=0}if(V[0]&5)throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}};Object.defineProperty(le,"__esModule",{value:!0}),le.Session=void 0;var f=Jr(),d=zt(),c=Qt(),o=Jt(),a=Kr(),i=Yr(),t=Qr(),E=tn(),w=Zr(),C=ei(),h=nn(),P=Ae(),v=ti(),u=ni(),s=Ve(),_=pt(),k=se(),b=me(),e=Wi(),l=Hi(),I=De(),n=k.OpenViduLogger.getInstance(),y,T=function(L){p(D,L);function D(r){var g=L.call(this)||this;return g.streamManagers=[],g.remoteStreamsCreated=new Map,g.remoteConnections=new Map,y=b.PlatformUtils.getInstance(),g.openvidu=r,g}return D.prototype.connect=function(r,g){var N=this;return new Promise(function(R,m){if(N.processToken(r),N.openvidu.checkSystemRequirements())N.options={sessionId:N.sessionId,participantId:r,metadata:g?N.stringClientMetadata(g):""},N.connectAux(r).then(function(){return R()}).catch(function(O){return m(O)});else return m(new s.OpenViduError(s.OpenViduErrorName.BROWSER_NOT_SUPPORTED,"Browser "+y.getName()+" (version "+y.getVersion()+") for "+y.getFamily()+" is not supported in OpenVidu"))})},D.prototype.disconnect=function(){this.leave(!1,"disconnect")},D.prototype.subscribe=function(r,g,N,R){var m={};N&&typeof N!="function"?m={insertMode:typeof N.insertMode<"u"?typeof N.insertMode=="string"?_.VideoInsertMode[N.insertMode]:m.insertMode:_.VideoInsertMode.APPEND,subscribeToAudio:typeof N.subscribeToAudio<"u"?N.subscribeToAudio:!0,subscribeToVideo:typeof N.subscribeToVideo<"u"?N.subscribeToVideo:!0}:m={insertMode:_.VideoInsertMode.APPEND,subscribeToAudio:!0,subscribeToVideo:!0};var O=void 0;if(N&&typeof N=="function"?O=N:R&&(O=R),!this.sessionConnected())throw O!==void 0&&O(this.notConnectedError()),this.notConnectedError();n.info("Subscribing to "+r.connection.connectionId),r.subscribe().then(function(){n.info("Subscribed correctly to "+r.connection.connectionId),O!==void 0&&O(void 0)}).catch(function(V){O!==void 0&&O(V)});var M=new c.Subscriber(r,g,m);return M.targetElement&&r.streamManager.createVideoElement(M.targetElement,m.insertMode),M},D.prototype.subscribeAsync=function(r,g,N){var R=this;return new Promise(function(m,O){if(!R.sessionConnected())return O(R.notConnectedError());var M,V=function(j){return j?O(j):m(M)};N?M=R.subscribe(r,g,N,V):M=R.subscribe(r,g,V)})},D.prototype.unsubscribe=function(r){var g=this;return new Promise(function(N,R){if(g.sessionConnected()){var m=r.stream.connection.connectionId;n.info("Unsubscribing from "+m),g.openvidu.sendRequest("unsubscribeFromVideo",{sender:r.stream.connection.connectionId},function(O,M){return O?(n.error("Error unsubscribing from "+m),R(O)):(n.info("Unsubscribed correctly from "+m),r.stream.streamManager.removeAllVideos(),r.stream.disposeWebRtcPeer(),r.stream.disposeMediaStream(),N())})}else return R(g.notConnectedError())})},D.prototype.publish=function(r){var g=this;return new Promise(function(N,R){if(!g.sessionConnected())return R(g.notConnectedError());r.session=g,r.stream.session=g,r.stream.publishedOnce?r.initialize().then(function(){g.connection.addStream(r.stream),r.reestablishStreamPlayingEvent(),r.stream.publish().then(function(){return g.sendVideoData(r,8,!0,5),N()}).catch(function(m){return R(m)})}).catch(function(m){return R(m)}):(g.connection.addStream(r.stream),r.stream.publish().then(function(){return g.sendVideoData(r,8,!0,5),N()}).catch(function(m){return R(m)}))})},D.prototype.unpublish=function(r){var g=this;return new Promise(function(N,R){if(!g.sessionConnected())throw g.notConnectedError();var m=r.stream;if(m.connection){if(m.connection!==g.connection)return R(new Error("The associated Connection object of this Publisher is not your local Connection.  Only moderators can force unpublish on remote Streams via 'forceUnpublish' method"));n.info("Unpublishing local media ("+m.connection.connectionId+")"),g.openvidu.sendRequest("unpublishVideo",function(O,M){if(O)return R(O);n.info("Media unpublished correctly"),m.disposeWebRtcPeer(),m.connection.stream==m&&delete m.connection.stream;var V=new h.StreamEvent(!0,r,"streamDestroyed",r.stream,"unpublish");return r.emitEvent("streamDestroyed",[V]),V.callDefaultBehavior(),N()})}else return R(new Error("The associated Connection object of this Publisher is null"))})},D.prototype.forceDisconnect=function(r){var g=this;return new Promise(function(N,R){if(!g.sessionConnected())return R(g.notConnectedError());n.info("Forcing disconnect for connection "+r.connectionId),g.openvidu.sendRequest("forceDisconnect",{connectionId:r.connectionId},function(m,O){return m?(n.error("Error forcing disconnect for Connection "+r.connectionId,m),m.code===401?R(new s.OpenViduError(s.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force a disconnection")):R(m)):(n.info("Forcing disconnect correctly for Connection "+r.connectionId),N())})})},D.prototype.forceUnpublish=function(r){var g=this;return new Promise(function(N,R){if(!g.sessionConnected())return R(g.notConnectedError());n.info("Forcing unpublish for stream "+r.streamId),g.openvidu.sendRequest("forceUnpublish",{streamId:r.streamId},function(m,O){return m?(n.error("Error forcing unpublish for Stream "+r.streamId,m),m.code===401?R(new s.OpenViduError(s.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force an unpublishing")):R(m)):(n.info("Forcing unpublish correctly for Stream "+r.streamId),N())})})},D.prototype.signal=function(r){var g=this;return new Promise(function(N,R){if(!g.sessionConnected())return R(g.notConnectedError());var m={};if(r.to&&r.to.length>0){var O=[];r.to.forEach(function(V){V.connectionId&&O.push(V.connectionId)}),m.to=O}else m.to=[];m.data=r.data?r.data:"";var M=r.type?r.type:"signal";M&&M.substring(0,7)!=="signal:"&&(M="signal:"+M),m.type=M,g.openvidu.sendRequest("sendMessage",{message:JSON.stringify(m)},function(V,j){return V?R(V):N()})})},D.prototype.subscribeToSpeechToText=function(r,g){var N=this;return new Promise(function(R,m){N.openvidu.sendRequest("subscribeToSpeechToText",{connectionId:r.connection.connectionId,lang:g},function(O,M){return O?m(O):R()})})},D.prototype.unsubscribeFromSpeechToText=function(r){var g=this;return new Promise(function(N,R){g.openvidu.sendRequest("unsubscribeFromSpeechToText",{connectionId:r.connection.connectionId},function(m,O){return m?R(m):N()})})},D.prototype.on=function(r,g){var N,R,m,O;return L.prototype.onAux.call(this,r,"Event '"+r+"' triggered by 'Session'",g),r==="publisherStartSpeaking"&&(this.remoteConnections.forEach(function(M){var V;!((V=M.stream)===null||V===void 0)&&V.hasAudio&&M.stream.enableHarkSpeakingEvent()}),!((R=(N=this.connection)===null||N===void 0?void 0:N.stream)===null||R===void 0)&&R.hasAudio&&this.connection.stream.enableHarkSpeakingEvent()),r==="publisherStopSpeaking"&&(this.remoteConnections.forEach(function(M){var V;!((V=M.stream)===null||V===void 0)&&V.hasAudio&&M.stream.enableHarkStoppedSpeakingEvent()}),!((O=(m=this.connection)===null||m===void 0?void 0:m.stream)===null||O===void 0)&&O.hasAudio&&this.connection.stream.enableHarkStoppedSpeakingEvent()),this},D.prototype.once=function(r,g){var N,R,m,O;return L.prototype.onceAux.call(this,r,"Event '"+r+"' triggered once by 'Session'",g),r==="publisherStartSpeaking"&&(this.remoteConnections.forEach(function(M){var V;!((V=M.stream)===null||V===void 0)&&V.hasAudio&&M.stream.enableOnceHarkSpeakingEvent()}),!((R=(N=this.connection)===null||N===void 0?void 0:N.stream)===null||R===void 0)&&R.hasAudio&&this.connection.stream.enableOnceHarkSpeakingEvent()),r==="publisherStopSpeaking"&&(this.remoteConnections.forEach(function(M){var V;!((V=M.stream)===null||V===void 0)&&V.hasAudio&&M.stream.enableOnceHarkStoppedSpeakingEvent()}),!((O=(m=this.connection)===null||m===void 0?void 0:m.stream)===null||O===void 0)&&O.hasAudio&&this.connection.stream.enableOnceHarkStoppedSpeakingEvent()),this},D.prototype.off=function(r,g){var N=this,R,m,O,M;return L.prototype.offAux.call(this,r,g),r==="publisherStartSpeaking"&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1)||(this.remoteConnections.forEach(function(V){var j;!((j=V.stream)===null||j===void 0)&&j.streamManager&&(N.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,V.stream.streamManager)||V.stream.disableHarkSpeakingEvent(!1))}),!((m=(R=this.connection)===null||R===void 0?void 0:R.stream)===null||m===void 0)&&m.streamManager&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkSpeakingEvent(!1)))),r==="publisherStopSpeaking"&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1)||(this.remoteConnections.forEach(function(V){var j;!((j=V.stream)===null||j===void 0)&&j.streamManager&&(N.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,V.stream.streamManager)||V.stream.disableHarkStoppedSpeakingEvent(!1))}),!((M=(O=this.connection)===null||O===void 0?void 0:O.stream)===null||M===void 0)&&M.streamManager&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkStoppedSpeakingEvent(!1)))),this},D.prototype.onParticipantJoined=function(r){var g=this;this.getConnection(r.id,"").then(function(N){n.warn("Connection "+N.connectionId+" already exists in connections list")}).catch(function(N){var R=new f.Connection(g,r);g.remoteConnections.set(r.id,R),g.ee.emitEvent("connectionCreated",[new a.ConnectionEvent(!1,g,"connectionCreated",R,"")])})},D.prototype.onParticipantLeft=function(r){var g=this;this.getRemoteConnection(r.connectionId,"onParticipantLeft").then(function(N){if(N.stream){var R=N.stream,m=new h.StreamEvent(!0,g,"streamDestroyed",R,r.reason);g.ee.emitEvent("streamDestroyed",[m]),m.callDefaultBehavior(),g.remoteStreamsCreated.delete(R.streamId)}N.dispose(),g.remoteConnections.delete(N.connectionId),g.ee.emitEvent("connectionDestroyed",[new a.ConnectionEvent(!1,g,"connectionDestroyed",N,r.reason)])}).catch(function(N){n.error(N)})},D.prototype.onParticipantPublished=function(r){var g=this,N=function(m){g.remoteConnections.set(m.connectionId,m),g.remoteStreamsCreated.get(m.stream.streamId)||g.ee.emitEvent("streamCreated",[new h.StreamEvent(!1,g,"streamCreated",m.stream,"")]),g.remoteStreamsCreated.set(m.stream.streamId,!0)},R;this.getRemoteConnection(r.id,"onParticipantPublished").then(function(m){R=m,r.metadata=m.data,R.remoteOptions=r,R.initRemoteStreams(r.streams),N(R)}).catch(function(m){R=new f.Connection(g,r),N(R)})},D.prototype.onParticipantUnpublished=function(r){var g=this;r.connectionId===this.connection.connectionId?this.stopPublisherStream(r.reason):this.getRemoteConnection(r.connectionId,"onParticipantUnpublished").then(function(N){var R=new h.StreamEvent(!0,g,"streamDestroyed",N.stream,r.reason);if(g.ee.emitEvent("streamDestroyed",[R]),R.callDefaultBehavior(),N.stream!=null){var m=N.stream.streamId;g.remoteStreamsCreated.delete(m),N.removeStream()}}).catch(function(N){n.error(N)})},D.prototype.onParticipantEvicted=function(r){r.connectionId===this.connection.connectionId&&this.sessionId&&!this.connection.disposed&&this.leave(!0,r.reason)},D.prototype.onNewMessage=function(r){var g=this;n.info("New signal: "+JSON.stringify(r));var N=r.type?r.type.replace(/^(signal:)/,""):void 0;r.from?this.getConnection(r.from,"Connection '"+r.from+"' unknown when 'onNewMessage'. Existing remote connections: "+JSON.stringify(this.remoteConnections.keys())+". Existing local connection: "+this.connection.connectionId).then(function(R){g.ee.emitEvent("signal",[new w.SignalEvent(g,N,r.data,R)]),r.type&&r.type!=="signal"&&g.ee.emitEvent(r.type,[new w.SignalEvent(g,N,r.data,R)])}).catch(function(R){n.error(R)}):(this.ee.emitEvent("signal",[new w.SignalEvent(this,N,r.data,void 0)]),r.type&&r.type!=="signal"&&this.ee.emitEvent(r.type,[new w.SignalEvent(this,N,r.data,void 0)]))},D.prototype.onStreamPropertyChanged=function(r){var g=this,N=function(R){var m,O;if(R.stream&&R.stream.streamId===r.streamId){var M=R.stream,V=void 0;switch(r.property){case"audioActive":V=M.audioActive,r.newValue=r.newValue==="true",M.audioActive=r.newValue;break;case"videoActive":V=M.videoActive,r.newValue=r.newValue==="true",M.videoActive=r.newValue;var j=(O=(m=M==null?void 0:M.getMediaStream())===null||m===void 0?void 0:m.getVideoTracks())===null||O===void 0?void 0:O[0];j&&!j.enabled&&M.videoActive&&(j.enabled=!0);break;case"videoTrack":r.newValue=JSON.parse(r.newValue);break;case"audioTrack":r.newValue=JSON.parse(r.newValue);break;case"videoDimensions":V=M.videoDimensions,r.newValue=JSON.parse(JSON.parse(r.newValue)),M.videoDimensions=r.newValue;break;case"filter":V=M.filter,r.newValue=Object.keys(r.newValue).length>0?r.newValue:void 0,r.newValue!==void 0?(M.filter=new d.Filter(r.newValue.type,r.newValue.options),M.filter.stream=M,r.newValue.lastExecMethod&&(M.filter.lastExecMethod=r.newValue.lastExecMethod)):delete M.filter,r.newValue=M.filter;break}g.ee.emitEvent("streamPropertyChanged",[new P.StreamPropertyChangedEvent(g,M,r.property,r.newValue,V,r.reason)]),M.streamManager&&M.streamManager.emitEvent("streamPropertyChanged",[new P.StreamPropertyChangedEvent(M.streamManager,M,r.property,r.newValue,V,r.reason)])}else n.error("No stream with streamId '"+r.streamId+"' found for connection '"+r.connectionId+"' on 'streamPropertyChanged' event")};r.connectionId===this.connection.connectionId?N(this.connection):this.getRemoteConnection(r.connectionId,"onStreamPropertyChanged").then(function(R){N(R)}).catch(function(R){n.error(R)})},D.prototype.onConnectionPropertyChanged=function(r){var g;switch(r.property){case"role":g=this.connection.role.slice(),this.connection.role=r.newValue,this.connection.localOptions.role=r.newValue;break;case"record":g=this.connection.record,r.newValue=r.newValue==="true",this.connection.record=r.newValue,this.connection.localOptions.record=r.newValue;break}this.ee.emitEvent("connectionPropertyChanged",[new v.ConnectionPropertyChangedEvent(this,this.connection,r.property,r.newValue,g)])},D.prototype.onNetworkQualityLevelChangedChanged=function(r){var g=this;r.connectionId===this.connection.connectionId?this.ee.emitEvent("networkQualityLevelChanged",[new u.NetworkQualityLevelChangedEvent(this,r.newValue,r.oldValue,this.connection)]):this.getConnection(r.connectionId,"Connection not found for connectionId "+r.connectionId).then(function(N){g.ee.emitEvent("networkQualityLevelChanged",[new u.NetworkQualityLevelChangedEvent(g,r.newValue,r.oldValue,N)])}).catch(function(N){n.error(N)})},D.prototype.recvIceCandidate=function(r){var g={candidate:r.candidate,sdpMLineIndex:r.sdpMLineIndex,sdpMid:r.sdpMid},N=new RTCIceCandidate(g);this.getConnection(r.senderConnectionId,"Connection not found for connectionId "+r.senderConnectionId+" owning endpoint "+r.endpointName+". Ice candidate will be ignored: "+N).then(function(R){var m=R.stream;m.getWebRtcPeer().addIceCandidate(N).catch(function(O){n.error("Error adding candidate for "+m.streamId+" stream of endpoint "+r.endpointName+": "+O)})}).catch(function(R){n.error(R)})},D.prototype.onSessionClosed=function(r){n.info("Session closed: "+JSON.stringify(r));var g=r.sessionId;g!==void 0?this.ee.emitEvent("session-closed",[{session:g}]):n.warn("Session undefined on session closed",r)},D.prototype.onLostConnection=function(r){n.warn("Lost connection in Session "+this.sessionId),this.sessionId&&this.connection&&!this.connection.disposed&&this.leave(!0,r)},D.prototype.onRecoveredConnection=function(){n.info("Recovered connection in Session "+this.sessionId),this.reconnectBrokenStreams(),this.ee.emitEvent("reconnected",[])},D.prototype.onMediaError=function(r){n.error("Media error: "+JSON.stringify(r));var g=r.error;g?this.ee.emitEvent("error-media",[{error:g}]):n.warn("Received undefined media error:",r)},D.prototype.onRecordingStarted=function(r){this.ee.emitEvent("recordingStarted",[new t.RecordingEvent(this,"recordingStarted",r.id,r.name)])},D.prototype.onRecordingStopped=function(r){this.ee.emitEvent("recordingStopped",[new t.RecordingEvent(this,"recordingStopped",r.id,r.name,r.reason)])},D.prototype.onBroadcastStarted=function(){this.ee.emitEvent("broadcastStarted",[])},D.prototype.onBroadcastStopped=function(){this.ee.emitEvent("broadcastStopped",[])},D.prototype.onFilterEventDispatched=function(r){var g=this,N=r.connectionId;this.getConnection(N,"No connection found for connectionId "+N).then(function(R){n.info('Filter event of type "'.concat(r.eventType,'" dispatched'));var m=R.stream;if(!m||!m.filter)return n.error('Filter event of type "'.concat(r.eventType,'" dispatched for stream ').concat(m.streamId," but there is no ").concat(m?"filter":"stream"," defined"));var O=m.filter.handlers.get(r.eventType);if(!O||typeof O!="function"){var M=Array.from(m.filter.handlers.keys());return n.error('Filter event of type "'.concat(r.eventType,'" not handled or not a function! Active filter events: ').concat(M.join(",")))}else O.call(g,new i.FilterEvent(m.filter,r.eventType,r.data))})},D.prototype.onForciblyReconnectSubscriber=function(r){var g=this;return new Promise(function(N,R){g.getRemoteConnection(r.connectionId,"onForciblyReconnectSubscriber").then(function(m){if(m.stream&&m.stream.streamId===r.streamId){var O=m.stream;if(O.setupReconnectionEventEmitter(N,R)){if(O.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent!=null)return O.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent=r,R("Ongoing forced subscriber reconnection");O.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent=r;var M=function(){var j=O.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent;delete O.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent,g.onForciblyReconnectSubscriber(j)};O.reconnectionEventEmitter.once("success",function(){M()}),O.reconnectionEventEmitter.once("error",function(){M()});return}O.completeWebRtcPeerReceive(!0,!0,r.sdpOffer).then(function(){return O.finalResolveForSubscription(!0,N)}).catch(function(j){return O.finalRejectForSubscription(!0,"Error while forcibly reconnecting remote stream ".concat(r.streamId,": ").concat(j.toString()),R)})}else{var V="No stream with streamId '"+r.streamId+"' found for connection '"+r.connectionId+"' on 'streamPropertyChanged' event";return n.error(V),R(V)}}).catch(function(m){return n.error(m),R(m)})})},D.prototype.reconnectBrokenStreams=function(){n.info("Re-establishing media connections...");var r=!1;this.connection.stream&&this.connection.stream.streamIceConnectionStateBroken()&&(n.warn("Re-establishing Publisher "+this.connection.stream.streamId),this.connection.stream.initWebRtcPeerSend(!0),r=!0),this.remoteConnections.forEach(function(g){g.stream&&g.stream.streamIceConnectionStateBroken()&&(n.warn("Re-establishing Subscriber "+g.stream.streamId),g.stream.initWebRtcPeerReceive(!0),r=!0)}),r||n.info("There were no media streams in need of a reconnection")},D.prototype.onSpeechToTextMessage=function(r){return x(this,void 0,void 0,function(){var g,N;return S(this,function(R){switch(R.label){case 0:return[4,this.getConnection(r.connectionId,"No connection found for connectionId "+r.connectionId)];case 1:return g=R.sent(),N=new C.SpeechToTextEvent(this,g,r.text,r.reason.toLowerCase(),r.raw,r.lang),this.ee.emitEvent("speechToTextMessage",[N]),[2]}})})},D.prototype.onSpeechToTextDisconnected=function(r){return x(this,void 0,void 0,function(){return S(this,function(g){return this.emitEvent("exception",[new I.ExceptionEvent(this,I.ExceptionEventName.SPEECH_TO_TEXT_DISCONNECTED,this,r.message)]),[2]})})},D.prototype.emitEvent=function(r,g){this.ee.emitEvent(r,g)},D.prototype.leave=function(r,g){var N=this;if(r=!!r,n.info("Leaving Session (forced="+r+")"),this.stopVideoDataIntervals(),this.connection){if(!this.connection.disposed&&!r?this.openvidu.sendRequest("leaveRoom",function(m,O){m&&n.error("leaveRoom error: ".concat(JSON.stringify(m))),N.openvidu.closeWs()}):this.openvidu.closeWs(),this.stopPublisherStream(g),!this.connection.disposed){var R=new E.SessionDisconnectedEvent(this,g);this.ee.emitEvent("sessionDisconnected",[R]),R.callDefaultBehavior()}}else n.warn("You were not connected to the session "+this.sessionId);n.flush()},D.prototype.initializeParams=function(r){var g={token:r||"",session:this.sessionId,platform:y.getDescription()?y.getDescription():"unknown",sdkVersion:this.openvidu.libraryVersion,metadata:this.options.metadata?this.options.metadata:"",secret:this.openvidu.getSecret(),recorder:this.openvidu.getRecorder(),stt:this.openvidu.getStt()};return g},D.prototype.sendVideoData=function(r,g,N,R){var m=this,O,M;if(g===void 0&&(g=1),N===void 0&&(N=!1),R===void 0&&(R=1),y.isChromeBrowser()||y.isChromeMobileBrowser()||y.isOperaBrowser()||y.isOperaMobileBrowser()||y.isEdgeBrowser()||y.isEdgeMobileBrowser()||y.isElectron()||y.isSafariBrowser()&&!y.isIonicIos()||y.isAndroidBrowser()||y.isSamsungBrowser()||y.isIonicAndroid()||y.isIOSWithSafari()){var V=function(){return x(m,void 0,void 0,function(){var B,W,F;return S(this,function(G){switch(G.label){case 0:return B=r.stream.getRTCPeerConnection(),B.connectionState!=="connected"?[3,2]:[4,B.getStats()];case 1:W=G.sent(),F=[],W.forEach(function(A){"frameWidth"in A&&"frameHeight"in A&&F.length===0&&F.push(A)}),F.length>0&&this.openvidu.sendRequest("videoData",{height:F[0].frameHeight,width:F[0].frameWidth,videoActive:r.stream.videoActive!=null?r.stream.videoActive:!1,audioActive:r.stream.audioActive!=null?r.stream.audioActive:!1},function(A,z){A&&n.error("Error sending 'videoData' event",A)}),G.label=2;case 2:return[2]}})})};if(N){var j=1;this.videoDataInterval=setInterval(function(){j<R?(j++,V()):clearInterval(m.videoDataInterval)},g*1e3)}else this.videoDataTimeout=setTimeout(V,g*1e3)}else y.isFirefoxBrowser()||y.isFirefoxMobileBrowser()||y.isIonicIos()||y.isReactNative()?this.openvidu.sendRequest("videoData",{height:((O=r.stream.videoDimensions)===null||O===void 0?void 0:O.height)||0,width:((M=r.stream.videoDimensions)===null||M===void 0?void 0:M.width)||0,videoActive:r.stream.videoActive!=null?r.stream.videoActive:!1,audioActive:r.stream.audioActive!=null?r.stream.audioActive:!1},function(B,W){B&&n.error("Error sending 'videoData' event",B)}):n.error("Browser "+y.getName()+" (version "+y.getVersion()+") for "+y.getFamily()+" is not supported in OpenVidu for Network Quality")},D.prototype.sessionConnected=function(){return this.connection!=null},D.prototype.notConnectedError=function(){return new s.OpenViduError(s.OpenViduErrorName.OPENVIDU_NOT_CONNECTED,"There is no connection to the session. Method 'Session.connect' must be successfully completed first")},D.prototype.anySpeechEventListenerEnabled=function(r,g,N){var R=this.ee.getListeners(r);g&&(R=R.filter(function(V){return V.once}));var m=R.length;if(m>0)return!0;var O=0;if(N){var M=N.ee.getListeners(r);g&&(M=M.filter(function(V){return V.once})),O=M.length}return O>0},D.prototype.getTokenParams=function(r){var g=r.match(/^(wss?)\:\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);if(g){var N={protocol:g[1],host:g[2],hostname:g[3],port:g[4],pathname:g[5],search:g[6],hash:g[7]},R=r.split("?"),m=decodeURI(R[1]).split("&").map(function(O){return O.split("=")}).reduce(function(O,M){var V=M[0],j=M[1];return O[V]=j,O},{});return{sessionId:m.sessionId,secret:m.secret,recorder:m.recorder,stt:m.stt,webrtcStatsInterval:m.webrtcStatsInterval,sendBrowserLogs:m.sendBrowserLogs,edition:m.edition,wsUri:N.protocol+"://"+N.host+"/openvidu",httpUri:"https://"+N.host}}else throw new Error('Token not valid: "'.concat(r,'"'))},D.prototype.connectAux=function(r){var g=this;return new Promise(function(N,R){g.openvidu.startWs(function(m){if(m)return R(m);var O=g.initializeParams(r);g.openvidu.sendRequest("joinRoom",O,function(M,V){if(M)return R(M);g.processJoinRoomResponse(V,r),g.connection=new f.Connection(g,V);var j={connections:new Array,streams:new Array},B=V.value;return B.forEach(function(W){var F=new f.Connection(g,W);g.remoteConnections.set(F.connectionId,F),j.connections.push(F),F.stream&&(g.remoteStreamsCreated.set(F.stream.streamId,!0),j.streams.push(F.stream))}),g.ee.emitEvent("connectionCreated",[new a.ConnectionEvent(!1,g,"connectionCreated",g.connection,"")]),j.connections.forEach(function(W){g.ee.emitEvent("connectionCreated",[new a.ConnectionEvent(!1,g,"connectionCreated",W,"")])}),j.streams.forEach(function(W){g.ee.emitEvent("streamCreated",[new h.StreamEvent(!1,g,"streamCreated",W,"")])}),V.recordingId&&V.recordingName&&g.ee.emitEvent("recordingStarted",[new t.RecordingEvent(g,"recordingStarted",V.recordingId,V.recordingName)]),N()})})})},D.prototype.stopPublisherStream=function(r){this.connection.stream&&(this.connection.stream.disposeWebRtcPeer(),this.connection.stream.isLocalStreamPublished&&this.connection.stream.ee.emitEvent("local-stream-destroyed",[r]))},D.prototype.stopVideoDataIntervals=function(){clearInterval(this.videoDataInterval),clearTimeout(this.videoDataTimeout)},D.prototype.stringClientMetadata=function(r){return typeof r!="string"?JSON.stringify(r):r},D.prototype.getConnection=function(r,g){var N=this;return new Promise(function(R,m){var O=N.remoteConnections.get(r);return O?R(O):N.connection.connectionId===r?R(N.connection):m(new s.OpenViduError(s.OpenViduErrorName.GENERIC_ERROR,g))})},D.prototype.getRemoteConnection=function(r,g){var N=this;return new Promise(function(R,m){var O=N.remoteConnections.get(r);if(O)return R(O);var M="Remote connection "+r+" unknown when '"+g+"'. Existing remote connections: "+JSON.stringify(N.remoteConnections.keys());return m(new s.OpenViduError(s.OpenViduErrorName.GENERIC_ERROR,M))})},D.prototype.processToken=function(r){var g=this.getTokenParams(r);this.sessionId=g.sessionId,g.secret&&(this.openvidu.secret=g.secret),g.recorder&&(this.openvidu.recorder=!0),g.stt&&(this.openvidu.stt=!0),g.webrtcStatsInterval&&(this.openvidu.webrtcStatsInterval=g.webrtcStatsInterval),g.sendBrowserLogs&&(this.openvidu.sendBrowserLogs=g.sendBrowserLogs),this.openvidu.isAtLeastPro=g.edition==="pro"||g.edition==="enterprise",this.openvidu.isEnterprise=g.edition==="enterprise",this.openvidu.wsUri=g.wsUri,this.openvidu.httpUri=g.httpUri},D.prototype.processJoinRoomResponse=function(r,g){if(this.sessionId=r.session,r.customIceServers!=null&&r.customIceServers.length>0){this.openvidu.iceServers=[];for(var N=0,R=r.customIceServers;N<R.length;N++){var m=R[N],O={urls:[m.url]};n.log("STUN/TURN server IP: "+m.url),m.username!=null&&m.credential!=null&&(O.username=m.username,O.credential=m.credential,n.log("TURN credentials ["+m.username+":"+m.credential+"]")),this.openvidu.iceServers.push(O)}}this.openvidu.role=r.role,this.openvidu.finalUserId=r.finalUserId,this.openvidu.mediaServer=r.mediaServer,this.openvidu.videoSimulcast=r.videoSimulcast,this.capabilities={subscribe:!0,publish:this.openvidu.role!=="SUBSCRIBER",forceUnpublish:this.openvidu.role==="MODERATOR",forceDisconnect:this.openvidu.role==="MODERATOR"},n.info("openvidu-server version: "+r.version),r.life!=null&&(this.openvidu.life=r.life);var M=l(r.version)-l(this.openvidu.libraryVersion);e(r.version)!==e(this.openvidu.libraryVersion)||!(M==0||M==1)?n.error("openvidu-browser (".concat(this.openvidu.libraryVersion,") and openvidu-server (").concat(r.version,") versions are incompatible. ")+"Errors are likely to occur. openvidu-browser SDK is only compatible with the same version or the immediately following minor version of an OpenVidu deployment"):M==1&&n.warn("openvidu-browser version ".concat(this.openvidu.libraryVersion," does not match openvidu-server version ").concat(r.version,". ")+"These versions are still compatible with each other, but openvidu-browser version must be updated as soon as possible to ".concat(e(r.version),".").concat(l(r.version),".x. ")+"This client using openvidu-browser ".concat(this.openvidu.libraryVersion," will become incompatible with the next release of openvidu-server")),k.OpenViduLogger.configureJSNLog(this.openvidu,g),this.token=g},D}(o.EventDispatcher);return le.Session=T,le}var yr;function rn(){if(yr)return de;yr=1;var p=de&&de.__extends||function(){var v=function(u,s){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,k){_.__proto__=k}||function(_,k){for(var b in k)Object.prototype.hasOwnProperty.call(k,b)&&(_[b]=k[b])},v(u,s)};return function(u,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");v(u,s);function _(){this.constructor=u}u.prototype=s===null?Object.create(s):(_.prototype=s.prototype,new _)}}(),x=de&&de.__awaiter||function(v,u,s,_){function k(b){return b instanceof s?b:new s(function(e){e(b)})}return new(s||(s=Promise))(function(b,e){function l(y){try{n(_.next(y))}catch(T){e(T)}}function I(y){try{n(_.throw(y))}catch(T){e(T)}}function n(y){y.done?b(y.value):k(y.value).then(l,I)}n((_=_.apply(v,u||[])).next())})},S=de&&de.__generator||function(v,u){var s={label:0,sent:function(){if(b[0]&1)throw b[1];return b[1]},trys:[],ops:[]},_,k,b,e;return e={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e;function l(n){return function(y){return I([n,y])}}function I(n){if(_)throw new TypeError("Generator is already executing.");for(;e&&(e=0,n[0]&&(s=0)),s;)try{if(_=1,k&&(b=n[0]&2?k.return:n[0]?k.throw||((b=k.return)&&b.call(k),0):k.next)&&!(b=b.call(k,n[1])).done)return b;switch(k=0,b&&(n=[n[0]&2,b.value]),n[0]){case 0:case 1:b=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,k=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(b=s.trys,!(b=b.length>0&&b[b.length-1])&&(n[0]===6||n[0]===2)){s=0;continue}if(n[0]===3&&(!b||n[1]>b[0]&&n[1]<b[3])){s.label=n[1];break}if(n[0]===6&&s.label<b[1]){s.label=b[1],b=n;break}if(b&&s.label<b[2]){s.label=b[2],s.ops.push(n);break}b[2]&&s.ops.pop(),s.trys.pop();continue}n=u.call(v,s)}catch(y){n=[6,y],k=0}finally{_=b=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(de,"__esModule",{value:!0}),de.Publisher=void 0;var f=gt(),d=en(),c=Yt(),o=nn(),a=Ae(),i=Ve(),t=se(),E=me(),w=Zt(),C=t.OpenViduLogger.getInstance(),h,P=function(v){p(u,v);function u(s,_,k){var b=v.call(this,new d.Stream(k.session?k.session:new f.Session(k),{publisherProperties:_,mediaConstraints:{}}),s)||this;return b.accessAllowed=!1,b.isSubscribedToRemote=!1,b.accessDenied=!1,h=E.PlatformUtils.getInstance(),b.properties=_,b.openvidu=k,b.stream.ee.on("local-stream-destroyed",function(e){b.stream.isLocalStreamPublished=!1;var l=new o.StreamEvent(!0,b,"streamDestroyed",b.stream,e);b.emitEvent("streamDestroyed",[l]),l.callDefaultBehavior()}),b}return u.prototype.publishAudio=function(s){var _=this;if(this.stream.audioActive!==s){var k=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream();k.getAudioTracks().forEach(function(b){b.enabled=s}),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"audioActive",newValue:s,reason:"publishAudio"},function(b,e){b?C.error("Error sending 'streamPropertyChanged' event",b):(_.session.emitEvent("streamPropertyChanged",[new a.StreamPropertyChangedEvent(_.session,_.stream,"audioActive",s,!s,"publishAudio")]),_.emitEvent("streamPropertyChanged",[new a.StreamPropertyChangedEvent(_,_.stream,"audioActive",s,!s,"publishAudio")]),_.session.sendVideoData(_.stream.streamManager))}),this.stream.audioActive=s,C.info("'Publisher' has "+(s?"published":"unpublished")+" its audio stream")}},u.prototype.publishVideo=function(s,_){var k=this;return new Promise(function(b,e){return x(k,void 0,void 0,function(){var l,I,n,y,T,L,D=this;return S(this,function(r){switch(r.label){case 0:return this.stream.videoActive===s?[3,9]:(l=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream(),I=!1,l.getVideoTracks().forEach(function(g){g.enabled=s,!s&&_===!0?g.stop():s&&g.readyState==="ended"&&(I=!0)}),!s&&_===!0&&this.stream.filter&&this.stream.filter.type.startsWith("VB:")?(this.stream.lastVBFilter=this.stream.filter,[4,this.stream.removeFilterAux(!0)]):[3,2]);case 1:r.sent(),r.label=2;case 2:return I?(n=l.getVideoTracks()[0],l.removeTrack(n),y=function(g){return x(D,void 0,void 0,function(){var N=this;return S(this,function(R){switch(R.label){case 0:return l.addTrack(g),this.stream.isLocalStreamPublished?[4,this.replaceTrackInRtcRtpSender(g)]:[3,2];case 1:R.sent(),R.label=2;case 2:return this.stream.lastVBFilter&&setTimeout(function(){return x(N,void 0,void 0,function(){var m,O;return S(this,function(M){switch(M.label){case 0:return m=this.stream.lastVBFilter.options,O=this.stream.lastVBFilter.lastExecMethod,O&&O.method==="update"&&(m=Object.assign({},m,O.params)),[4,this.stream.applyFilter(this.stream.lastVBFilter.type,m)];case 1:return M.sent(),delete this.stream.lastVBFilter,[2]}})})},1),[2]}})})},_&&_ instanceof MediaStreamTrack?[4,y(_)]:[3,4]):[3,8];case 3:return r.sent(),[3,8];case 4:return r.trys.push([4,7,,8]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:this.stream.lastVideoTrackConstraints})];case 5:return T=r.sent(),[4,y(T.getVideoTracks()[0])];case 6:return r.sent(),[3,8];case 7:return L=r.sent(),[2,e(L)];case 8:return this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"videoActive",newValue:s,reason:"publishVideo"},function(g,N){g?C.error("Error sending 'streamPropertyChanged' event",g):(D.session.emitEvent("streamPropertyChanged",[new a.StreamPropertyChangedEvent(D.session,D.stream,"videoActive",s,!s,"publishVideo")]),D.emitEvent("streamPropertyChanged",[new a.StreamPropertyChangedEvent(D,D.stream,"videoActive",s,!s,"publishVideo")]),D.session.sendVideoData(D.stream.streamManager))}),this.stream.videoActive=s,C.info("'Publisher' has "+(s?"published":"unpublished")+" its video stream"),[2,b()];case 9:return[2]}})})})},u.prototype.subscribeToRemote=function(s){s=s!==void 0?s:!0,this.isSubscribedToRemote=s,this.stream.subscribeToMyRemote(s)},u.prototype.on=function(s,_){var k=this;return v.prototype.on.call(this,s,_),s==="streamCreated"&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new o.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.on("stream-created-by-publisher",function(){k.emitEvent("streamCreated",[new o.StreamEvent(!1,k,"streamCreated",k.stream,"")])})),s==="accessAllowed"&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),s==="accessDenied"&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},u.prototype.once=function(s,_){var k=this;return v.prototype.once.call(this,s,_),s==="streamCreated"&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new o.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.once("stream-created-by-publisher",function(){k.emitEvent("streamCreated",[new o.StreamEvent(!1,k,"streamCreated",k.stream,"")])})),s==="accessAllowed"&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),s==="accessDenied"&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},u.prototype.off=function(s,_){return v.prototype.off.call(this,s,_),this},u.prototype.replaceTrack=function(s){return x(this,void 0,void 0,function(){return S(this,function(_){return[2,this.replaceTrackAux(s,!0)]})})},u.prototype.initialize=function(){var s=this;return new Promise(function(_,k){return x(s,void 0,void 0,function(){var b,e,l,I,n,y,T,L,D,r,g,N,N,R,m,O=this,M,V;return S(this,function(j){switch(j.label){case 0:b={},e={},l=2e3,n=function(B){return O.accessDenied=!0,O.accessAllowed=!1,C.error("Publisher initialization failed. ".concat(B.name,": ").concat(B.message)),k(B)},y=function(B){var W,F;if(O.accessAllowed=!0,O.accessDenied=!1,typeof MediaStreamTrack<"u"&&O.properties.audioSource instanceof MediaStreamTrack&&(B.removeTrack(B.getAudioTracks()[0]),B.addTrack(O.properties.audioSource)),typeof MediaStreamTrack<"u"&&O.properties.videoSource instanceof MediaStreamTrack&&(B.removeTrack(B.getVideoTracks()[0]),B.addTrack(O.properties.videoSource)),B.getAudioTracks()[0]){var G=O.stream.audioActive!==void 0&&O.stream.audioActive!==null?O.stream.audioActive:!!O.stream.outboundStreamOpts.publisherProperties.publishAudio;B.getAudioTracks()[0].enabled=G}if(B.getVideoTracks()[0]){var G=O.stream.videoActive!==void 0&&O.stream.videoActive!==null?O.stream.videoActive:!!O.stream.outboundStreamOpts.publisherProperties.publishVideo;B.getVideoTracks()[0].enabled=G}for(var A=0,z=B.getAudioTracks();A<z.length;A++){var $=z[A];!((W=$.contentHint)===null||W===void 0)&&W.length||($.contentHint="",C.info("Audio track Content Hint set: '".concat($.contentHint,"'")))}for(var Z=0,K=B.getVideoTracks();Z<K.length;Z++){var $=K[Z];if(!(!((F=$.contentHint)===null||F===void 0)&&F.length)){switch(O.stream.typeOfVideo){case w.TypeOfVideo.SCREEN:$.contentHint="detail";break;case w.TypeOfVideo.CUSTOM:C.warn("CUSTOM type video track was provided without Content Hint!"),$.contentHint="motion";break;case w.TypeOfVideo.CAMERA:case w.TypeOfVideo.IPCAM:default:$.contentHint="motion";break}C.info("Video track Content Hint set: '".concat($.contentHint,"'"))}}return O.initializeVideoReference(B),O.stream.displayMyRemote()||O.stream.updateMediaStreamInVideos(),delete O.firstVideoElement,O.stream.isSendVideo()?O.getVideoDimensions().then(function(U){O.stream.videoDimensions={width:U.width,height:U.height},O.stream.isSendScreen()&&(O.stream.isSendAudio()&&B.getAudioTracks().length===0&&(O.stream.audioActive=!1,O.stream.hasAudio=!1,O.stream.outboundStreamOpts.publisherProperties.publishAudio=!1,O.stream.outboundStreamOpts.publisherProperties.audioSource=!1),O.screenShareResizeInterval=setInterval(function(){var re=B.getVideoTracks()[0].getSettings(),X=re.width,q=re.height,J=X!=null&&X!==O.stream.videoDimensions.width,ee=q!=null&&q!==O.stream.videoDimensions.height;O.stream.isLocalStreamPublished&&(J||ee)&&O.openvidu.sendVideoDimensionsChangedEvent(O,"screenResized",O.stream.videoDimensions.width,O.stream.videoDimensions.height,X||0,q||0)},650)),O.stream.isLocalStreamReadyToPublish=!0,O.stream.ee.emitEvent("stream-ready-to-publish",[])}):(O.stream.isLocalStreamReadyToPublish=!0,O.stream.ee.emitEvent("stream-ready-to-publish",[])),_()},T=function(B,W){return x(O,void 0,void 0,function(){var F,G;return S(this,function(A){switch(A.label){case 0:if(this.clearPermissionDialogTimer(I,l),!(this.stream.isSendScreen()&&this.properties.audioSource!=="screen"&&this.stream.isSendAudio()))return[3,5];e.audio=W,e.video=!1,I=Date.now(),this.setPermissionDialogTimer(l),A.label=1;case 1:return A.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia(e)];case 2:return F=A.sent(),this.clearPermissionDialogTimer(I,l),B.addTrack(F.getAudioTracks()[0]),y(B),[3,4];case 3:return G=A.sent(),this.clearPermissionDialogTimer(I,l),B.getAudioTracks().forEach(function(z){z.stop()}),B.getVideoTracks().forEach(function(z){z.stop()}),n(this.openvidu.generateAudioDeviceError(G,b)),[2];case 4:return[3,6];case 5:y(B),A.label=6;case 6:return[2]}})})},L=function(B){return x(O,void 0,void 0,function(){var W,F,G,z,A,z,$;return S(this,function(Z){switch(Z.label){case 0:switch(C.error("getMediaError: ".concat(B.toString())),this.clearPermissionDialogTimer(I,l),B.name==="Error"&&(B.name=B.constructor.name),G=B.name.toLowerCase(),G){case"notfounderror":return[3,1];case"notallowederror":return[3,5];case"overconstrainederror":return[3,6];case"aborterror":return[3,10];case"notreadableerror":return[3,10]}return[3,11];case 1:return Z.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:b.video})];case 2:return z=Z.sent(),z.getVideoTracks().forEach(function(K){K.stop()}),W=i.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,F=B.toString(),n(new i.OpenViduError(W,F)),[3,4];case 3:return A=Z.sent(),W=i.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,F=A.toString(),n(new i.OpenViduError(W,F)),[3,4];case 4:return[3,12];case 5:return W=this.stream.isSendScreen()?i.OpenViduErrorName.SCREEN_CAPTURE_DENIED:i.OpenViduErrorName.DEVICE_ACCESS_DENIED,F=B.toString(),n(new i.OpenViduError(W,F)),[3,12];case 6:return Z.trys.push([6,8,,9]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:b.video})];case 7:return z=Z.sent(),z.getVideoTracks().forEach(function(K){K.stop()}),B.constraint.toLowerCase()==="deviceid"?(W=i.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,F="Audio input device with deviceId '"+b.audio.deviceId.exact+"' not found"):(W=i.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,F="Audio input device doesn't support the value passed for constraint '"+B.constraint+"'"),n(new i.OpenViduError(W,F)),[3,9];case 8:return $=Z.sent(),$.constraint.toLowerCase()==="deviceid"?(W=i.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,F="Video input device with deviceId '"+b.video.deviceId.exact+"' not found"):(W=i.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,F="Video input device doesn't support the value passed for constraint '"+$.constraint+"'"),n(new i.OpenViduError(W,F)),[3,9];case 9:return[3,12];case 10:return W=i.OpenViduErrorName.DEVICE_ALREADY_IN_USE,F=B.toString(),n(new i.OpenViduError(W,F)),[3,12];case 11:return W=i.OpenViduErrorName.GENERIC_ERROR,F=B.toString(),n(new i.OpenViduError(W,F)),[3,12];case 12:return[2]}})})},j.label=1;case 1:return j.trys.push([1,14,,15]),[4,this.openvidu.generateMediaConstraints(this.properties)];case 2:return D=j.sent(),D.videoTrack&&D.audioTrack||D.audioTrack&&((M=D.constraints)===null||M===void 0?void 0:M.video)===!1||D.videoTrack&&((V=D.constraints)===null||V===void 0?void 0:V.audio)===!1?(y(this.openvidu.addAlreadyProvidedTracks(D,new MediaStream,this.stream)),[3,13]):[3,3];case 3:b=D.constraints,r={mediaConstraints:b,publisherProperties:this.properties},this.stream.setOutboundStreamOptions(r),g=b.audio===void 0?!0:b.audio,e.audio=this.stream.isSendScreen()?!1:g,e.video=b.video,I=Date.now(),this.setPermissionDialogTimer(l),j.label=4;case 4:return j.trys.push([4,11,,13]),this.stream.isSendScreen()&&navigator.mediaDevices.getDisplayMedia&&!h.isElectron()?[4,navigator.mediaDevices.getDisplayMedia({video:!0,audio:this.properties.audioSource==="screen"})]:[3,7];case 5:return N=j.sent(),this.openvidu.addAlreadyProvidedTracks(D,N),[4,T(N,g)];case 6:return j.sent(),[3,10];case 7:return this.stream.lastVideoTrackConstraints=e.video,[4,navigator.mediaDevices.getUserMedia(e)];case 8:return N=j.sent(),this.openvidu.addAlreadyProvidedTracks(D,N,this.stream),[4,T(N,g)];case 9:j.sent(),j.label=10;case 10:return[3,13];case 11:return R=j.sent(),[4,L(R)];case 12:return j.sent(),[3,13];case 13:return[3,15];case 14:return m=j.sent(),n(m),[3,15];case 15:return[2]}})})})},u.prototype.replaceTrackAux=function(s,_){return x(this,void 0,void 0,function(){var k,b;return S(this,function(e){switch(e.label){case 0:k=s.enabled,s.kind==="video"?s.enabled=this.stream.videoActive:s.kind==="audio"&&(s.enabled=this.stream.audioActive),e.label=1;case 1:return e.trys.push([1,5,,6]),this.stream.isLocalStreamPublished?(this.replaceTrackInMediaStream(s,_),[4,this.replaceTrackInRtcRtpSender(s)]):[3,3];case 2:return[2,e.sent()];case 3:return[2,this.replaceTrackInMediaStream(s,_)];case 4:return[3,6];case 5:throw b=e.sent(),s.enabled=k,b;case 6:return[2]}})})},u.prototype.getVideoDimensions=function(){var s=this;return new Promise(function(_,k){var b=(h.isIonicIos()||h.isIOSWithSafari())&&s.videoReference.readyState<1,e,l=function(){var I,n;if(typeof s.stream.getMediaStream().getVideoTracks()[0].getSettings=="function"){var y=s.stream.getMediaStream().getVideoTracks()[0].getSettings();I=y.width||s.videoReference.videoWidth,n=y.height||s.videoReference.videoHeight}else C.warn("MediaStreamTrack does not have getSettings method on "+h.getDescription()),I=s.videoReference.videoWidth,n=s.videoReference.videoHeight;return e!=null&&s.videoReference.removeEventListener("loadedmetadata",e),b&&document.body.removeChild(s.videoReference),_({width:I,height:n})};s.videoReference.readyState>=1?l():(e=function(){if(s.videoReference.videoWidth)l();else var I=setInterval(function(){s.videoReference.videoWidth&&(clearInterval(I),l())},40)},s.videoReference.addEventListener("loadedmetadata",e),b&&document.body.appendChild(s.videoReference))})},u.prototype.reestablishStreamPlayingEvent=function(){this.ee.getListeners("streamPlaying").length>0&&this.addPlayEventToFirstVideo()},u.prototype.initializeVideoReference=function(s){this.videoReference=document.createElement("video"),this.videoReference.style.display="none",this.videoReference.muted=!0,this.videoReference.autoplay=!0,this.videoReference.controls=!1,(h.isSafariBrowser()||h.isIPhoneOrIPad()&&(h.isChromeMobileBrowser()||h.isEdgeMobileBrowser()||h.isOperaMobileBrowser()||h.isFirefoxMobileBrowser()))&&(this.videoReference.playsInline=!0),this.stream.setMediaStream(s),this.firstVideoElement&&this.createVideoElement(this.firstVideoElement.targetElement,this.properties.insertMode),this.videoReference.srcObject=this.stream.getMediaStream()},u.prototype.replaceTrackInMediaStream=function(s,_){var k=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream(),b;s.kind==="video"?(b=k.getVideoTracks()[0],_&&(this.stream.lastVideoTrackConstraints=s.getConstraints())):b=k.getAudioTracks()[0],b.enabled=!1,b.stop(),k.removeTrack(b),k.addTrack(s);var e={oldLabel:(b==null?void 0:b.label)||"",newLabel:(s==null?void 0:s.label)||""};s.kind==="video"&&_?(this.openvidu.sendNewVideoDimensionsIfRequired(this,"trackReplaced",50,30),this.openvidu.sendTrackChangedEvent(this,e.oldLabel,e.newLabel,"videoTrack"),this.stream.isLocalStreamPublished&&this.session.sendVideoData(this.stream.streamManager,5,!0,5)):s.kind==="audio"&&_&&this.openvidu.sendTrackChangedEvent(this,e.oldLabel,e.newLabel,"audioTrack"),s.kind==="audio"&&(this.stream.disableHarkSpeakingEvent(!1),this.stream.disableHarkStoppedSpeakingEvent(!1),this.stream.disableHarkVolumeChangeEvent(!1),this.stream.initHarkEvents())},u.prototype.setPermissionDialogTimer=function(s){var _=this;this.permissionDialogTimeout=setTimeout(function(){_.emitEvent("accessDialogOpened",[])},s)},u.prototype.clearPermissionDialogTimer=function(s,_){clearTimeout(this.permissionDialogTimeout),Date.now()-s>_&&this.emitEvent("accessDialogClosed",[])},u.prototype.replaceTrackInRtcRtpSender=function(s){return x(this,void 0,void 0,function(){var _,k;return S(this,function(b){switch(b.label){case 0:if(_=this.stream.getRTCPeerConnection().getSenders(),s.kind==="video"){if(k=_.find(function(e){return!!e.track&&e.track.kind==="video"}),!k)throw new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")}else if(s.kind==="audio"){if(k=_.find(function(e){return!!e.track&&e.track.kind==="audio"}),!k)throw new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")}else throw new Error("Unknown track kind "+s.kind);return[4,k.replaceTrack(s)];case 1:return b.sent(),[2]}})})},u}(c.StreamManager);return de.Publisher=P,de}var jt={},wr;function $i(){if(wr)return jt;wr=1,globalThis.getScreenId=function(c,o,a){if(navigator.userAgent.indexOf("Edge")!==-1&&(navigator.msSaveOrOpenBlob||navigator.msSaveBlob)){o({video:!0});return}if(navigator.mozGetUserMedia){o(null,"firefox",{video:{mozMediaSource:c,mediaSource:c}});return}globalThis.addEventListener("message",i);function i(t){t.data&&(t.data.chromeMediaSourceId&&(t.data.chromeMediaSourceId==="PermissionDeniedError"?o("permission-denied"):o(null,t.data.chromeMediaSourceId,p(null,t.data.chromeMediaSourceId,t.data.canRequestAudioTrack)),globalThis.removeEventListener("message",i)),t.data.chromeExtensionStatus&&(o(t.data.chromeExtensionStatus,null,p(t.data.chromeExtensionStatus)),globalThis.removeEventListener("message",i)))}setTimeout(a?function(){x(a)}:x,100)};function p(c,o,a){var i={audio:!1,video:{mandatory:{chromeMediaSource:c?"screen":"desktop",maxWidth:globalThis.screen.width>1920?globalThis.screen.width:1920,maxHeight:globalThis.screen.height>1080?globalThis.screen.height:1080},optional:[]}};return a&&(i.audio={mandatory:{chromeMediaSource:c?"screen":"desktop"},optional:[]}),o&&(i.video.mandatory.chromeMediaSourceId=o,i.audio&&i.audio.mandatory&&(i.audio.mandatory.chromeMediaSourceId=o)),i}function x(c){if(!S){f(function(){x(c)});return}if(!S.isLoaded){setTimeout(function(){x(c)},100);return}c?c.forEach?S.contentWindow.postMessage({captureCustomSourceId:c},"*"):S.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):S.contentWindow.postMessage({captureSourceId:!0},"*")}var S;globalThis.getScreenConstraints=function(c){f(function(){getScreenId(function(o,a,i){i||(i={video:!0}),c(o,i.video)})})};function f(c){if(S){c();return}S=document.createElement("iframe"),S.onload=function(){S.isLoaded=!0,c()},S.src="https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/",S.style.display="none",(document.body||document.documentElement).appendChild(S)}globalThis.getChromeExtensionStatus=function(c){if(navigator.mozGetUserMedia){c("installed-enabled");return}globalThis.addEventListener("message",o);function o(a){a.data&&a.data.chromeExtensionStatus&&(c(a.data.chromeExtensionStatus),globalThis.removeEventListener("message",o))}setTimeout(d,100)};function d(){if(!S){f(d);return}if(!S.isLoaded){setTimeout(d,100);return}S.contentWindow.postMessage({getChromeExtensionStatus:!0},"*")}return jt.getScreenId=globalThis.getScreenId,jt}var Le={},Or;function Gi(){if(Or)return Le;Or=1;var p="screen",x,S;if(typeof window<"u"&&typeof navigator<"u"&&typeof navigator.userAgent<"u"){var f=typeof window.InstallTrigger<"u";window.opera||navigator.userAgent.indexOf(" OPR/")>=0,window.addEventListener("message",function(w){w.origin==window.location.origin&&d(w.data)})}function d(w){if(w=="PermissionDeniedError"){if(S)return S("PermissionDeniedError");throw new Error("PermissionDeniedError")}w=="rtcmulticonnection-extension-loaded"&&(p="desktop"),w.sourceId&&S&&S(x=w.sourceId,w.canRequestAudioTrack===!0)}function c(w){if(w){if(p=="desktop")return w(!0);window.postMessage("are-you-there","*"),setTimeout(function(){p=="screen"?w(!1):w(!0)},2e3)}}function o(w){if(!w)throw'"callback" parameter is mandatory.';if(x)return w(x);S=w,window.postMessage("get-sourceId","*")}function a(w){if(!w)throw'"callback" parameter is mandatory.';if(x)return w(x);S=w,window.postMessage("audio-plus-tab","*")}function i(w,C){if(f)return C("not-chrome");arguments.length!=2&&(C=w,w="lfcgfepafnobdloecchnfaclibenjold");var h=document.createElement("img");h.src="chrome-extension://"+w+"/icon.png",h.onload=function(){p="screen",window.postMessage("are-you-there","*"),setTimeout(function(){p=="screen"?C("installed-disabled"):C("installed-enabled")},2e3)},h.onerror=function(){C("not-installed")}}function t(w){E(w,!0)}function E(w,C){x="";var h={mozMediaSource:"window",mediaSource:"window"};if(f)return w(null,h);var P={mandatory:{chromeMediaSource:p,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};if(p=="desktop"&&!x){C?a(function(v,u){P.mandatory.chromeMediaSourceId=v,u&&(P.canRequestAudioTrack=!0),w(v=="PermissionDeniedError"?v:null,P)}):o(function(v){P.mandatory.chromeMediaSourceId=v,w(v=="PermissionDeniedError"?v:null,P)});return}p=="desktop"&&(P.mandatory.chromeMediaSourceId=x),w(null,P)}return Le.getScreenConstraints=E,Le.getScreenConstraintsWithAudio=t,Le.isChromeExtensionAvailable=c,Le.getChromeExtensionStatus=i,Le.getSourceId=o,Le}var ut={exports:{}},Rr;function zi(){if(Rr)return ut.exports;Rr=1;var p=typeof Reflect=="object"?Reflect:null,x=p&&typeof p.apply=="function"?p.apply:function(e,l,I){return Function.prototype.apply.call(e,l,I)},S;p&&typeof p.ownKeys=="function"?S=p.ownKeys:Object.getOwnPropertySymbols?S=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:S=function(e){return Object.getOwnPropertyNames(e)};function f(b){console&&console.warn&&console.warn(b)}var d=Number.isNaN||function(e){return e!==e};function c(){c.init.call(this)}ut.exports=c,ut.exports.once=s,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||d(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),c.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||d(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function i(b){return b._maxListeners===void 0?c.defaultMaxListeners:b._maxListeners}c.prototype.getMaxListeners=function(){return i(this)},c.prototype.emit=function(e){for(var l=[],I=1;I<arguments.length;I++)l.push(arguments[I]);var n=e==="error",y=this._events;if(y!==void 0)n=n&&y.error===void 0;else if(!n)return!1;if(n){var T;if(l.length>0&&(T=l[0]),T instanceof Error)throw T;var L=new Error("Unhandled error."+(T?" ("+T.message+")":""));throw L.context=T,L}var D=y[e];if(D===void 0)return!1;if(typeof D=="function")x(D,this,l);else for(var r=D.length,g=P(D,r),I=0;I<r;++I)x(g[I],this,l);return!0};function t(b,e,l,I){var n,y,T;if(a(l),y=b._events,y===void 0?(y=b._events=Object.create(null),b._eventsCount=0):(y.newListener!==void 0&&(b.emit("newListener",e,l.listener?l.listener:l),y=b._events),T=y[e]),T===void 0)T=y[e]=l,++b._eventsCount;else if(typeof T=="function"?T=y[e]=I?[l,T]:[T,l]:I?T.unshift(l):T.push(l),n=i(b),n>0&&T.length>n&&!T.warned){T.warned=!0;var L=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");L.name="MaxListenersExceededWarning",L.emitter=b,L.type=e,L.count=T.length,f(L)}return b}c.prototype.addListener=function(e,l){return t(this,e,l,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,l){return t(this,e,l,!0)};function E(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function w(b,e,l){var I={fired:!1,wrapFn:void 0,target:b,type:e,listener:l},n=E.bind(I);return n.listener=l,I.wrapFn=n,n}c.prototype.once=function(e,l){return a(l),this.on(e,w(this,e,l)),this},c.prototype.prependOnceListener=function(e,l){return a(l),this.prependListener(e,w(this,e,l)),this},c.prototype.removeListener=function(e,l){var I,n,y,T,L;if(a(l),n=this._events,n===void 0)return this;if(I=n[e],I===void 0)return this;if(I===l||I.listener===l)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,I.listener||l));else if(typeof I!="function"){for(y=-1,T=I.length-1;T>=0;T--)if(I[T]===l||I[T].listener===l){L=I[T].listener,y=T;break}if(y<0)return this;y===0?I.shift():v(I,y),I.length===1&&(n[e]=I[0]),n.removeListener!==void 0&&this.emit("removeListener",e,L||l)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var l,I,n;if(I=this._events,I===void 0)return this;if(I.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):I[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete I[e]),this;if(arguments.length===0){var y=Object.keys(I),T;for(n=0;n<y.length;++n)T=y[n],T!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(l=I[e],typeof l=="function")this.removeListener(e,l);else if(l!==void 0)for(n=l.length-1;n>=0;n--)this.removeListener(e,l[n]);return this};function C(b,e,l){var I=b._events;if(I===void 0)return[];var n=I[e];return n===void 0?[]:typeof n=="function"?l?[n.listener||n]:[n]:l?u(n):P(n,n.length)}c.prototype.listeners=function(e){return C(this,e,!0)},c.prototype.rawListeners=function(e){return C(this,e,!1)},c.listenerCount=function(b,e){return typeof b.listenerCount=="function"?b.listenerCount(e):h.call(b,e)},c.prototype.listenerCount=h;function h(b){var e=this._events;if(e!==void 0){var l=e[b];if(typeof l=="function")return 1;if(l!==void 0)return l.length}return 0}c.prototype.eventNames=function(){return this._eventsCount>0?S(this._events):[]};function P(b,e){for(var l=new Array(e),I=0;I<e;++I)l[I]=b[I];return l}function v(b,e){for(;e+1<b.length;e++)b[e]=b[e+1];b.pop()}function u(b){for(var e=new Array(b.length),l=0;l<e.length;++l)e[l]=b[l].listener||b[l];return e}function s(b,e){return new Promise(function(l,I){function n(T){b.removeListener(e,y),I(T)}function y(){typeof b.removeListener=="function"&&b.removeListener("error",n),l([].slice.call(arguments))}k(b,e,y,{once:!0}),e!=="error"&&_(b,n,{once:!0})})}function _(b,e,l){typeof b.on=="function"&&k(b,"error",e,l)}function k(b,e,l,I){if(typeof b.on=="function")I.once?b.once(e,l):b.on(e,l);else if(typeof b.addEventListener=="function")b.addEventListener(e,function n(y){I.once&&b.removeEventListener(e,n),l(y)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return ut.exports}var dt={},lt={},Cr;function Xi(){if(Cr)return lt;Cr=1;function p(S,f){var d={jsonrpc:"2.0"};if(S.method)d.method=S.method,S.params&&(d.params=S.params),f!=null&&(d.id=f);else if(f!=null){if(S.error){if(S.result!==void 0)throw new TypeError("Both result and error are defined");d.error=S.error}else if(S.result!==void 0)d.result=S.result;else throw new TypeError("No result or error is defined");d.id=f}return JSON.stringify(d)}function x(S){var f=S;(typeof S=="string"||S instanceof String)&&(f=JSON.parse(S));var d=f.jsonrpc;if(d!=="2.0")throw new TypeError("Invalid JsonRPC version '"+d+"': "+S);if(f.method==null){if(f.id==null)throw new TypeError("Invalid message: "+S);var c=f.result!==void 0,o=f.error!==void 0;if(c&&o)throw new TypeError("Both result and error are defined: "+S);if(!c&&!o)throw new TypeError("No result or error is defined: "+S);f.ack=f.id,delete f.id}return f}return lt.pack=p,lt.unpack=x,lt}var ft={},_r;function Ji(){if(_r)return ft;_r=1;function p(S){throw new TypeError("Not yet implemented")}function x(S){throw new TypeError("Not yet implemented")}return ft.pack=p,ft.unpack=x,ft}var Ir;function Ki(){if(Ir)return dt;Ir=1;var p=Xi(),x=Ji();return dt.JsonRPC=p,dt.XmlRPC=x,dt}var Bt,Pr;function Yi(){if(Pr)return Bt;Pr=1;function p(){var x={};this.forEach=function(S){for(var f in x){var d=x[f];for(var c in d)S(d[c])}},this.get=function(S,f){var d=x[f];if(d!=null)return d[S]},this.remove=function(S,f){var d=x[f];if(d!=null){delete d[S];for(var c in d)return!1;delete x[f]}},this.set=function(S,f,d){if(S==null)return this.remove(f,d);var c=x[d];c==null&&(x[d]=c={}),c[f]=S}}return p.prototype.pop=function(x,S){var f=this.get(x,S);if(f!=null)return this.remove(x,S),f},Bt=p,Bt}var qt={},Ft,Tr;function si(){if(Tr)return Ft;Tr=1;var p=se().OpenViduLogger,x=p.getInstance(),S=2e3,f=3e3,d=3;function c(o){var a=!1,i,t=o.uri,E=!1,w=new WebSocket(t);w.onopen=function(){x.debug("WebSocket connected to "+t),o.onconnected&&o.onconnected()},w.onerror=function(u){x.error("Could not connect to "+t+" (invoking onerror if defined)",u),o.onerror&&o.onerror(u)};var C=function(){w.readyState===d?a?x.debug("Connection closed by user"):o.ismasternodecrashed()?x.error("Master Node has crashed. Stopping reconnection process"):(x.debug("Connection closed unexpectedly. Reconnecting..."),h(S,1)):x.debug("Close callback from previous websocket. Ignoring it")};w.onclose=C;function h(u,s){if(x.debug("reconnect (attempt #"+s+", max="+u+")"),s===1){if(E){x.warn("Trying to reconnect when already reconnecting... Ignoring this reconnection.");return}else E=!0;o.onreconnecting&&o.onreconnecting()}v(u,s)}function P(u){var s=new URLSearchParams(new URL(u).search);return s.has("reconnect")||(u=Array.from(s).length>0?u+"&reconnect=true":u+"?reconnect=true"),u}function v(u,s){x.debug("Reconnection attempt #"+s),w.close(4104,"Connection closed for reconnection"),t=P(t),w=new WebSocket(t),w.onopen=function(){x.debug("Reconnected to "+t+" after "+s+" attempts..."),E=!1,i(),o.onreconnected&&o.onreconnected(),w.onclose=C},w.onerror=function(_){x.warn("Reconnection error: ",_),s===u?o.ondisconnect&&o.ondisconnect():setTimeout(function(){h(u,s+1)},f)}}this.close=function(u,s){a=!0,w.close(u,s)},this.reconnectWs=function(){x.debug("reconnectWs"),h(S,1)},this.send=function(u){w.send(u)},this.addEventListener=function(u,s){i=function(){w.addEventListener(u,s)},i()},this.getReadyState=function(){return w.readyState}}return Ft=c,Ft}var Ut,xr;function Qi(){if(xr)return Ut;xr=1;var p=ai(),x=si(),S=se().OpenViduLogger;Date.now=Date.now||function(){return+new Date};var f=5e3,d="RECONNECTING",c="CONNECTED",o="DISCONNECTED",a=S.getInstance();function i(t){var E=this,w=t.ws,C=-1,h=0,P=!0,v=!1,u,s=o,_=w.onreconnecting,k=w.onreconnected,b=w.onconnected,e=w.onerror;t.rpc.pull=function(r,g){g.reply(null,"push")},w.onreconnecting=function(){if(a.debug("--------- ONRECONNECTING -----------"),s===d){a.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it");return}D(),s=d,_&&_()},w.onreconnected=function(){if(a.debug("--------- ONRECONNECTED -----------"),s===c){a.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it");return}s=c,y(),k&&k()},w.onconnected=function(){if(a.debug("--------- ONCONNECTED -----------"),s===c){a.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it");return}s=c,P=!0,L(),b&&b()},w.onerror=function(r){a.debug("--------- ONERROR -----------"),s=o,D(),e&&e(r)};var l=new x(w);a.debug("Connecting websocket to URI: "+w.uri);var I={request_timeout:t.rpc.requestTimeout,ping_request_timeout:t.rpc.heartbeatRequestTimeout},n=new p(p.packers.JsonRPC,I,l,function(r){a.debug("Received request: "+JSON.stringify(r));try{var g=t.rpc[r.method];g===void 0?a.error("Method "+r.method+" not registered in client"):g(r.params,r)}catch(N){a.error("Exception processing request: "+JSON.stringify(r)),a.error(N)}});this.send=function(r,g,N){var R=Date.now();n.encode(r,g,function(m,O){if(m){try{a.error("ERROR:"+m.message+" in Request: method:"+r+" params:"+JSON.stringify(g)+" request:"+m.request),m.data&&a.error("ERROR DATA:"+JSON.stringify(m.data))}catch{}m.requestTime=R}N&&(O!=null&&O.value!=="pong"&&a.debug("Response: "+JSON.stringify(O)),N(m,O))})};function y(){a.debug("notReconnectIfNumLessThan = "+h+" (old="+C+")"),C=h}function T(){if(P){var r=null;(h==0||h==C)&&(r={interval:t.heartbeat||f}),h++,E.send("ping",r,function(g){return function(N,R){N&&(a.debug("Error in ping request #"+g+" ("+N.message+")"),g>C&&(P=!1,y(),a.debug("Server did not respond to ping message #"+g+". Reconnecting... "),l.reconnectWs()))}}(h))}else a.debug("Trying to send ping, but ping is not enabled")}function L(){v||(a.debug("Starting ping (if configured)"),v=!0,t.heartbeat!=null&&(u=setInterval(T,t.heartbeat),T()))}function D(){clearInterval(u),v=!1,P=!1,h=-1,n.cancel()}this.close=function(r,g){a.debug("Closing  with code: "+r+" because: "+g),u!=null&&(a.debug("Clearing ping interval"),clearInterval(u)),v=!1,P=!1,l.close(r,g)},this.reconnect=function(){l.reconnectWs()},this.resetPing=function(){P=!0,h=0,L()},this.getReadyState=function(){return l.getReadyState()}}return Ut=i,Ut}var kr;function Zi(){if(kr)return qt;kr=1;var p=Qi();return qt.JsonRpcClient=p,qt}var Wt={},Nr;function eo(){if(Nr)return Wt;Nr=1;var p=si();return Wt.WebSocketWithReconnection=p,Wt}var Ht,Lr;function ai(){if(Lr)return Ht;Lr=1;var p=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch{p=!0}Function.prototype.bind||(Function.prototype.bind=function(C){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var h=Array.prototype.slice.call(arguments,1),P=this,v=function(){},u=function(){return P.apply(this instanceof v&&C?this:C,h.concat(Array.prototype.slice.call(arguments)))};return v.prototype=this.prototype,u.prototype=new v,u});var x=zi().EventEmitter,S=pi(),f=Ki(),d=Yi(),c=5e3;function o(C){if(!C)return{};for(var h in C){var P=C[h];typeof P=="string"&&(C[h]={response:P})}return C}function a(C){if(C){if(C instanceof Function)return{send:C};if(C.send instanceof Function)return C;if(C.postMessage instanceof Function)return C.send=C.postMessage,C;if(C.write instanceof Function)return C.send=C.write,C;if(C.onmessage===void 0&&!(C.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function i(C,h){p?(this.method=C,this.params=h):(Object.defineProperty(this,"method",{value:C,enumerable:!0}),Object.defineProperty(this,"params",{value:h,enumerable:!0}))}function t(C,h,P,v){var u=this;if(!C)throw new SyntaxError("Packer is not defined");if(!C.pack||!C.unpack)throw new SyntaxError("Packer is invalid");var s=o(C.responseMethods);if(h instanceof Function){if(P!=null)throw new SyntaxError("There can't be parameters after onRequest");v=h,P=void 0,h=void 0}if(h&&h.send instanceof Function){if(P&&!(P instanceof Function))throw new SyntaxError("Only a function can be after transport");v=P,P=h,h=void 0}if(P instanceof Function){if(v!=null)throw new SyntaxError("There can't be parameters after onRequest");v=P,P=void 0}if(P&&P.send instanceof Function&&v&&!(v instanceof Function))throw new SyntaxError("Only a function can be after transport");h=h||{},x.call(this),v&&this.on("request",v),p?this.peerID=h.peerID:Object.defineProperty(this,"peerID",{value:h.peerID});var _=h.max_retries||0;function k(m){u.decode(m.data||m)}this.getTransport=function(){return P},this.setTransport=function(m){P&&(P.removeEventListener?P.removeEventListener("message",k):P.removeListener&&P.removeListener("data",k)),m&&(m.addEventListener?m.addEventListener("message",k):m.addListener&&m.addListener("data",k)),P=a(m)},p||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(P);var b=h.request_timeout||c,e=h.ping_request_timeout||b,l=h.response_timeout||c,I=h.duplicates_timeout||c,n=0,y=new d,T=new d,L=new d,D={};function r(m,O,M){var V={message:m,timeout:setTimeout(function(){T.remove(O,M)},l)};T.set(V,O,M)}function g(m,O){var M=setTimeout(function(){L.remove(m,O)},I);L.set(M,m,O)}function N(m,O,M,V,j){i.call(this,m,O),this.getTransport=function(){return j},this.setTransport=function(F){j=a(F)},p||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var B=T.get(M,V);j||u.getTransport()||(p?this.duplicated=!!B:Object.defineProperty(this,"duplicated",{value:!!B}));var W=s[m];this.pack=C.pack.bind(C,this,M),this.reply=function(F,G,A){if(F instanceof Function||F&&F.send instanceof Function){if(G!=null)throw new SyntaxError("There can't be parameters after callback");A=F,G=null,F=void 0}else if(G instanceof Function||G&&G.send instanceof Function){if(A!=null)throw new SyntaxError("There can't be parameters after callback");A=G,G=null}A=a(A),B&&clearTimeout(B.timeout),V!=null&&(F&&(F.dest=V),G&&(G.dest=V));var z;if(F||G!=null){if(u.peerID!=null&&(F?F.from=u.peerID:G.from=u.peerID),W)if(W.error==null&&F)z={error:F};else{var $=F?W.error:W.response;z={method:$,params:F||G}}else z={error:F,result:G};z=C.pack(z,M)}else B?z=B.message:z=C.pack({result:null},M);return r(z,M,V),A=A||this.getTransport()||u.getTransport(),A?A.send(z):z}}S(N,i);function R(m){var O=D[m];if(O){delete D[m];var M=y.pop(O.id,O.dest);M&&(clearTimeout(M.timeout),g(O.id,O.dest))}}this.cancel=function(m){if(m)return R(m);for(var m in D)R(m)},this.close=function(){var m=this.getTransport();m&&m.close&&m.close(4003,"Cancel request"),this.cancel(),L.forEach(clearTimeout),T.forEach(function(O){clearTimeout(O.timeout)})},this.encode=function(m,O,M,V,j){if(O instanceof Function){if(M!=null)throw new SyntaxError("There can't be parameters after callback");j=O,V=void 0,M=void 0,O=void 0}else if(M instanceof Function){if(V!=null)throw new SyntaxError("There can't be parameters after callback");j=M,V=void 0,M=void 0}else if(V instanceof Function){if(j!=null)throw new SyntaxError("There can't be parameters after callback");j=V,V=void 0}u.peerID!=null&&(O=O||{},O.from=u.peerID),M!=null&&(O=O||{},O.dest=M);var B={method:m,params:O};if(j){let z=function(U,re){u.cancel(B),j(U,re)},$=function(U){var re=m==="ping"?e:b;return G.timeout=setTimeout(K,re*Math.pow(2,F++)),D[B]={id:W,dest:M},y.set(G,W,M),U=U||A||u.getTransport(),U?U.send(B):B},Z=function(U){U=a(U),console.warn(F+" retry for request message:",B);var re=L.pop(W,M);return clearTimeout(re),$(U)},K=function(){if(F<_)return Z(V);var U=new Error("Request has timed out");U.request=B,U.retry=Z,z(U)};var W=n++,F=0;B=C.pack(B,W);var G={message:B,callback:z,responseMethods:s[m]||{}},A=a(V);return $(V)}return B=C.pack(B),V=V||this.getTransport(),V?V.send(B):B},this.decode=function(m,O){if(!m)throw new TypeError("Message is not defined");try{m=C.unpack(m)}catch(q){return console.debug(q,m)}var M=m.id,V=m.ack,j=m.method,B=m.params||{},W=B.from,F=B.dest;if(u.peerID!=null&&W==u.peerID)return;if(M==null&&V==null){var G=new i(j,B);return u.emit("request",G)?void 0:G}function A(){if(O=a(O)||u.getTransport(),O){var q=T.get(M,W);if(q)return O.send(q.message)}var J=M??V,ee=new N(j,B,J,W,O);if(!u.emit("request",ee))return ee}function z(q,J,ee){q.callback(J,ee)}function $(q){console.warn("Response already processed",m),clearTimeout(q),g(V,W)}if(j){if(F==null||F==u.peerID){var X=y.get(V,W);if(X){var Z=X.responseMethods;return j==Z.error?z(X,B):j==Z.response?z(X,null,B):A()}var K=L.get(V,W);if(K)return $(K)}return A()}var U=m.error,re=m.result;if(!(U&&U.dest&&U.dest!=u.peerID)&&!(re&&re.dest&&re.dest!=u.peerID)){var X=y.get(V,W);if(!X){var K=L.get(V,W);return K?$(K):console.warn("No callback was defined for this message",m)}z(X,U,re)}}}S(t,x),t.RpcNotification=i,Ht=t;var E=Zi(),w=eo();return t.clients=E,t.clients.transports=w,t.packers=f,Ht}const to="2.31.0",no={version:to};var Mr;function ro(){if(Mr)return fe;Mr=1;var p=fe&&fe.__awaiter||function(b,e,l,I){function n(y){return y instanceof l?y:new l(function(T){T(y)})}return new(l||(l=Promise))(function(y,T){function L(g){try{r(I.next(g))}catch(N){T(N)}}function D(g){try{r(I.throw(g))}catch(N){T(N)}}function r(g){g.done?y(g.value):n(g.value).then(L,D)}r((I=I.apply(b,e||[])).next())})},x=fe&&fe.__generator||function(b,e){var l={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},I,n,y,T;return T={next:L(0),throw:L(1),return:L(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function L(r){return function(g){return D([r,g])}}function D(r){if(I)throw new TypeError("Generator is already executing.");for(;T&&(T=0,r[0]&&(l=0)),l;)try{if(I=1,n&&(y=r[0]&2?n.return:r[0]?n.throw||((y=n.return)&&y.call(n),0):n.next)&&!(y=y.call(n,r[1])).done)return y;switch(n=0,y&&(r=[r[0]&2,y.value]),r[0]){case 0:case 1:y=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,n=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(y=l.trys,!(y=y.length>0&&y[y.length-1])&&(r[0]===6||r[0]===2)){l=0;continue}if(r[0]===3&&(!y||r[1]>y[0]&&r[1]<y[3])){l.label=r[1];break}if(r[0]===6&&l.label<y[1]){l.label=y[1],y=r;break}if(y&&l.label<y[2]){l.label=y[2],l.ops.push(r);break}y[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(b,l)}catch(g){r=[6,g],n=0}finally{I=y=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(fe,"__esModule",{value:!0}),fe.OpenVidu=void 0;var S=Ur(),f=rn(),d=gt(),c=tn(),o=Ae(),a=Ve(),i=pt(),t=se(),E=me(),w=$i(),C=Gi(),h=Fr(),P=Xt(),v=ai(),u=no,s=t.OpenViduLogger.getInstance(),_,k=function(){function b(){var e=this;this.masterNodeHasCrashed=!1,this.publishers=[],this.secret="",this.recorder=!1,this.stt=!1,this.life=-1,this.advancedConfiguration={},this.webrtcStatsInterval=-1,this.sendBrowserLogs=h.OpenViduLoggerConfiguration.disabled,this.isAtLeastPro=!1,this.isEnterprise=!1,this.ee=new P,_=E.PlatformUtils.getInstance(),this.libraryVersion=u.version,s.info("OpenVidu initialized"),s.info("Platform detected: "+_.getDescription()),s.info("openvidu-browser version: "+this.libraryVersion),(_.isMobileDevice()||_.isReactNative())&&this.onOrientationChanged(function(){e.publishers.forEach(function(l){l.stream.isLocalStreamPublished&&l.stream&&l.stream.hasVideo&&e.sendNewVideoDimensionsIfRequired(l,"deviceRotated",75,10)})})}return b.prototype.initSession=function(){return this.session=new d.Session(this),this.session},b.prototype.initPublisher=function(e,l,I){var n;l&&typeof l!="function"?(n=l,n={audioSource:typeof n.audioSource<"u"?n.audioSource:void 0,frameRate:typeof MediaStreamTrack<"u"&&n.videoSource instanceof MediaStreamTrack?void 0:typeof n.frameRate<"u"?n.frameRate:void 0,insertMode:typeof n.insertMode<"u"?typeof n.insertMode=="string"?i.VideoInsertMode[n.insertMode]:n.insertMode:i.VideoInsertMode.APPEND,mirror:typeof n.mirror<"u"?n.mirror:!0,publishAudio:typeof n.publishAudio<"u"?n.publishAudio:!0,publishVideo:typeof n.publishVideo<"u"?n.publishVideo:!0,resolution:typeof MediaStreamTrack<"u"&&n.videoSource instanceof MediaStreamTrack?void 0:typeof n.resolution<"u"?n.resolution:"640x480",videoSource:typeof n.videoSource<"u"?n.videoSource:void 0,videoSimulcast:n.videoSimulcast,filter:n.filter}):n={insertMode:i.VideoInsertMode.APPEND,mirror:!0,publishAudio:!0,publishVideo:!0,resolution:"640x480"};var y=new f.Publisher(e,n,this),T;return l&&typeof l=="function"?T=l:I&&(T=I),y.initialize().then(function(){T!==void 0&&T(void 0),y.emitEvent("accessAllowed",[])}).catch(function(L){T!==void 0&&T(L),y.emitEvent("accessDenied",[L])}),this.publishers.push(y),y},b.prototype.initPublisherAsync=function(e,l){var I=this;return new Promise(function(n,y){var T,L=function(D){return D?y(D):n(T)};l?T=I.initPublisher(e,l,L):T=I.initPublisher(e,L)})},b.prototype.initLocalRecorder=function(e){return new S.LocalRecorder(e)},b.prototype.checkSystemRequirements=function(){return _.isIPhoneOrIPad()?_.isIOSWithSafari()||_.isChromeMobileBrowser()||_.isFirefoxMobileBrowser()||_.isOperaMobileBrowser()||_.isEdgeMobileBrowser()||_.isIonicIos():_.isChromeBrowser()||_.isChromeMobileBrowser()||_.isFirefoxBrowser()||_.isFirefoxMobileBrowser()||_.isOperaBrowser()||_.isOperaMobileBrowser()||_.isEdgeBrowser()||_.isEdgeMobileBrowser()||_.isSamsungBrowser()||_.isSafariBrowser()||_.isAndroidBrowser()||_.isElectron()||_.isNodeJs()||_.isMotorolaEdgeDevice()},b.prototype.checkScreenSharingCapabilities=function(){return _.canScreenShare()},b.prototype.getDevices=function(){return new Promise(function(e,l){navigator.mediaDevices.enumerateDevices().then(function(I){var n,y=[];if(_.isIonicAndroid()&&typeof cordova<"u"&&(!((n=cordova==null?void 0:cordova.plugins)===null||n===void 0)&&n.EnumerateDevicesPlugin))cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then(function(T){var L=[],D=[],r=[];return L=T.filter(function(g){return g.kind==="audioinput"}),D=I.filter(function(g){return g.kind==="videoinput"}),r=I.filter(function(g){return g.kind==="audioinput"}),D.forEach(function(g,N){if(g.label)y.push({kind:g.kind,deviceId:g.deviceId,label:g.label});else{var R="";N===0?R="Front Camera":N===1?R="Back Camera":R="Unknown Camera",y.push({kind:g.kind,deviceId:g.deviceId,label:R})}}),r.forEach(function(g,N){if(g.label)y.push({kind:g.kind,deviceId:g.deviceId,label:g.label});else{var R="";switch(N){case 0:R="Default";break;case 1:var m=L.filter(function(V){return V.label.includes("Built")})[0];R=m?m.label:"Built-in Microphone";break;case 2:var O=L.filter(function(V){return V.label.includes("Wired")})[0];O?R=O.label:R="Headset earpiece";break;case 3:var M=L.filter(function(V){return V.label.includes("Bluetooth")})[0];R=M?M.label:"Wireless";break;default:R="Unknown Microphone";break}y.push({kind:g.kind,deviceId:g.deviceId,label:R})}}),e(y)});else return I.forEach(function(T){(T.kind==="audioinput"||T.kind==="videoinput")&&y.push({kind:T.kind,deviceId:T.deviceId,label:T.label})}),e(y)}).catch(function(I){return s.error("Error getting devices",I),l(I)})})},b.prototype.getUserMedia=function(e){var l,I;return p(this,void 0,void 0,function(){var n,y,T,r,L,N,R,D,r,g,N,R,m,O=this;return x(this,function(M){switch(M.label){case 0:n=function(V,j){return p(O,void 0,void 0,function(){var B,W,F,G;return x(this,function(A){switch(A.label){case 0:B=j.audio===void 0?!0:j.audio,W={audio:B,video:!1},A.label=1;case 1:return A.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia(W)];case 2:return F=A.sent(),V.addTrack(F.getAudioTracks()[0]),[2,V];case 3:throw G=A.sent(),V.getAudioTracks().forEach(function(z){z.stop()}),V.getVideoTracks().forEach(function(z){z.stop()}),this.generateAudioDeviceError(G,W);case 4:return[2]}})})},M.label=1;case 1:return M.trys.push([1,20,,21]),[4,this.generateMediaConstraints(e)];case 2:return y=M.sent(),y.videoTrack&&y.audioTrack||y.audioTrack&&((l=y.constraints)===null||l===void 0?void 0:l.video)===!1||y.videoTrack&&((I=y.constraints)===null||I===void 0?void 0:I.audio)===!1?[2,this.addAlreadyProvidedTracks(y,new MediaStream)]:[3,3];case 3:if(y.videoTrack&&delete y.constraints.video,y.audioTrack&&delete y.constraints.audio,T=!1,typeof e.videoSource!="string")return[3,12];if(!(e.videoSource==="screen"||e.videoSource==="window"||_.isElectron()&&e.videoSource.startsWith("screen:")))return[3,12];if(T=!y.audioTrack&&e.audioSource!==null&&e.audioSource!==!1,!(navigator.mediaDevices.getDisplayMedia&&!_.isElectron()))return[3,11];M.label=4;case 4:return M.trys.push([4,9,,10]),[4,navigator.mediaDevices.getDisplayMedia({video:!0,audio:e.audioSource==="screen"})];case 5:return r=M.sent(),this.addAlreadyProvidedTracks(y,r),T?[4,n(r,y.constraints)]:[3,7];case 6:return[2,M.sent()];case 7:return[2,r];case 8:return[3,10];case 9:throw L=M.sent(),N=a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,R=L.toString(),new a.OpenViduError(N,R);case 10:return[3,11];case 11:return[3,12];case 12:D=T?{video:y.constraints.video}:y.constraints,M.label=13;case 13:return M.trys.push([13,18,,19]),[4,navigator.mediaDevices.getUserMedia(D)];case 14:return r=M.sent(),this.addAlreadyProvidedTracks(y,r),T?[4,n(r,y.constraints)]:[3,16];case 15:return[2,M.sent()];case 16:return[2,r];case 17:return[3,19];case 18:throw g=M.sent(),N=void 0,R=g.toString(),e.videoSource!=="screen"?N=a.OpenViduErrorName.DEVICE_ACCESS_DENIED:N=a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,new a.OpenViduError(N,R);case 19:return[3,21];case 20:throw m=M.sent(),m;case 21:return[2]}})})},b.prototype.enableProdMode=function(){s.enableProdMode()},b.prototype.setAdvancedConfiguration=function(e){this.advancedConfiguration=e},b.prototype.onOrientationChanged=function(e){globalThis.addEventListener("orientationchange",e)},b.prototype.sendNewVideoDimensionsIfRequired=function(e,l,I,n){var y=this,T,L,D,r,g=0,N=((L=(T=e==null?void 0:e.stream)===null||T===void 0?void 0:T.videoDimensions)===null||L===void 0?void 0:L.width)||0,R=((r=(D=e==null?void 0:e.stream)===null||D===void 0?void 0:D.videoDimensions)===null||r===void 0?void 0:r.height)||0,m=setInterval(function(){g++,g>n&&clearTimeout(m),e.getVideoDimensions().then(function(O){(O.width!==N||O.height!==R)&&(clearTimeout(m),y.sendVideoDimensionsChangedEvent(e,l,N,R,O.width,O.height))})},I)},b.prototype.sendVideoDimensionsChangedEvent=function(e,l,I,n,y,T){var L=this;e.stream.videoDimensions={width:y||0,height:T||0},this.sendRequest("streamPropertyChanged",{streamId:e.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(e.stream.videoDimensions),reason:l},function(D,r){D?s.error("Error sending 'streamPropertyChanged' event",D):(L.session.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(L.session,e.stream,"videoDimensions",e.stream.videoDimensions,{width:I,height:n},l)]),e.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(e,e.stream,"videoDimensions",e.stream.videoDimensions,{width:I,height:n},l)]),L.session.sendVideoData(e))})},b.prototype.sendTrackChangedEvent=function(e,l,I,n){var y=this,T={label:l},L={label:I},D="trackReplaced";e.stream.isLocalStreamPublished?this.sendRequest("streamPropertyChanged",{streamId:e.stream.streamId,property:n,newValue:L,reason:D},function(r,g){r?s.error("Error sending 'streamPropertyChanged' event",r):(y.session.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(y.session,e.stream,n,L,T,D)]),e.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(e,e.stream,n,L,T,D)]))}):(this.session.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(this.session,e.stream,n,L,T,D)]),e.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(e,e.stream,n,L,T,D)]))},b.prototype.generateMediaConstraints=function(e){var l=this;return new Promise(function(I,n){var y={audioTrack:void 0,videoTrack:void 0,constraints:{audio:void 0,video:void 0}},T=e.audioSource,L=e.videoSource;if((T===null||T===!1)&&(y.constraints.audio=!1),(L===null||L===!1)&&(y.constraints.video=!1),y.constraints.audio===!1&&y.constraints.video===!1)return n(new a.OpenViduError(a.OpenViduErrorName.NO_INPUT_SOURCE_SET,"Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time"));if(typeof MediaStreamTrack<"u"&&T instanceof MediaStreamTrack&&(y.audioTrack=T),typeof MediaStreamTrack<"u"&&L instanceof MediaStreamTrack&&(y.videoTrack=L),T===void 0&&(y.constraints.audio=!0),L===void 0&&(y.constraints.video={width:{ideal:640},height:{ideal:480}}),L!==null&&L!==!1){if(e.resolution){var D=e.resolution.toLowerCase().split("x"),r=Number(D[0]),g=Number(D[1]);y.constraints.video={width:{ideal:r},height:{ideal:g}}}e.frameRate&&(y.constraints.video.frameRate={ideal:e.frameRate})}return l.configureDeviceIdOrScreensharing(y,e,I,n),I(y)})},b.prototype.startWs=function(e){var l={heartbeat:5e3,ws:{uri:this.wsUri+"?sessionId="+this.session.sessionId,onconnected:e,ondisconnect:this.disconnectCallback.bind(this),onreconnecting:this.reconnectingCallback.bind(this),onreconnected:this.reconnectedCallback.bind(this),ismasternodecrashed:this.isMasterNodeCrashed.bind(this)},rpc:{requestTimeout:1e4,heartbeatRequestTimeout:5e3,participantJoined:this.session.onParticipantJoined.bind(this.session),participantPublished:this.session.onParticipantPublished.bind(this.session),participantUnpublished:this.session.onParticipantUnpublished.bind(this.session),participantLeft:this.session.onParticipantLeft.bind(this.session),participantEvicted:this.session.onParticipantEvicted.bind(this.session),recordingStarted:this.session.onRecordingStarted.bind(this.session),recordingStopped:this.session.onRecordingStopped.bind(this.session),broadcastStarted:this.session.onBroadcastStarted.bind(this.session),broadcastStopped:this.session.onBroadcastStopped.bind(this.session),sendMessage:this.session.onNewMessage.bind(this.session),streamPropertyChanged:this.session.onStreamPropertyChanged.bind(this.session),connectionPropertyChanged:this.session.onConnectionPropertyChanged.bind(this.session),networkQualityLevelChanged:this.session.onNetworkQualityLevelChangedChanged.bind(this.session),filterEventDispatched:this.session.onFilterEventDispatched.bind(this.session),iceCandidate:this.session.recvIceCandidate.bind(this.session),mediaError:this.session.onMediaError.bind(this.session),masterNodeCrashedNotification:this.onMasterNodeCrashedNotification.bind(this),forciblyReconnectSubscriber:this.session.onForciblyReconnectSubscriber.bind(this.session),speechToTextMessage:this.session.onSpeechToTextMessage.bind(this.session),speechToTextDisconnected:this.session.onSpeechToTextDisconnected.bind(this.session)}};this.jsonRpcClient=new v.clients.JsonRpcClient(l)},b.prototype.onMasterNodeCrashedNotification=function(e){console.error("Master Node has crashed"),this.masterNodeHasCrashed=!0,this.session.onLostConnection("nodeCrashed"),this.jsonRpcClient.close(4103,"Master Node has crashed")},b.prototype.getWsReadyState=function(){return this.jsonRpcClient.getReadyState()},b.prototype.closeWs=function(){this.jsonRpcClient.close(4102,"Connection closed by client")},b.prototype.sendRequest=function(e,l,I){var n;l&&l instanceof Function&&(I=l,l={}),s.debug('Sending request: {method:"'+e+'", params: '+JSON.stringify(l)+"}"),(n=this.jsonRpcClient)===null||n===void 0||n.send(e,l,I)},b.prototype.getWsUri=function(){return this.wsUri},b.prototype.getSecret=function(){return this.secret},b.prototype.getRecorder=function(){return this.recorder},b.prototype.getStt=function(){return this.stt},b.prototype.generateAudioDeviceError=function(e,l){e.name==="Error"&&(e.name=e.constructor.name);var I,n;switch(e.name.toLowerCase()){case"notfounderror":return I=a.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,n=e.toString(),new a.OpenViduError(I,n);case"notallowederror":return I=a.OpenViduErrorName.DEVICE_ACCESS_DENIED,n=e.toString(),new a.OpenViduError(I,n);case"overconstrainederror":return e.constraint.toLowerCase()==="deviceid"?(I=a.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,n="Audio input device with deviceId '"+l.audio.deviceId.exact+"' not found"):(I=a.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,n="Audio input device doesn't support the value passed for constraint '"+e.constraint+"'"),new a.OpenViduError(I,n);case"notreadableerror":return I=a.OpenViduErrorName.DEVICE_ALREADY_IN_USE,n=e.toString(),new a.OpenViduError(I,n);default:return new a.OpenViduError(a.OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR,e.toString())}},b.prototype.addAlreadyProvidedTracks=function(e,l,I){return e.videoTrack&&(l.addTrack(e.videoTrack),I&&(e.constraints.video?I.lastVideoTrackConstraints=e.constraints.video:I.lastVideoTrackConstraints=e.videoTrack.getConstraints())),e.audioTrack&&l.addTrack(e.audioTrack),l},b.prototype.configureDeviceIdOrScreensharing=function(e,l,I,n){var y=this,T=l.audioSource,L=l.videoSource;if(typeof T=="string"&&T!=="screen"&&(e.constraints.audio={deviceId:{exact:T}}),typeof L=="string")if(!this.isScreenShare(L))this.setVideoSource(e,L),T==="screen"&&(s.warn('Parameter "audioSource" is set to "screen", which means rquesting audio from screen sharing source. But "videoSource" is not set to "screen". No audio source will be requested'),e.constraints.audio=!1);else if(this.checkScreenSharingCapabilities())if(_.isElectron()){var r="screen:",g=L,N=g.substr(g.indexOf(r)+r.length);return e.constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:N}},I(e)}else if(this.advancedConfiguration.screenShareChromeExtension&&!(_.isFirefoxBrowser()||_.isFirefoxMobileBrowser())&&!navigator.mediaDevices.getDisplayMedia){C.getScreenConstraints(function(m,O){if(m||O.mandatory&&O.mandatory.chromeMediaSource==="screen")if(m==="permission-denied"||m==="PermissionDeniedError"){var M=new a.OpenViduError(a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");return s.error(M),n(M)}else{var V=y.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim();C.getChromeExtensionStatus(V,function(j){if(j==="installed-disabled"){var B=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");return s.error(B),n(B)}if(j==="not-installed"){var W=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,y.advancedConfiguration.screenShareChromeExtension);return s.error(W),n(W)}});return}else return e.constraints.video=O,I(e)});return}else{if(navigator.mediaDevices.getDisplayMedia)return I(e);var R=_.isFirefoxBrowser()||_.isFirefoxMobileBrowser()?l.videoSource:void 0;w.getScreenId(R,function(m,O,M){if(m)if(m==="not-installed"){var V=y.advancedConfiguration.screenShareChromeExtension?y.advancedConfiguration.screenShareChromeExtension:"https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",j=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,V);return s.error(j),n(j)}else if(m==="installed-disabled"){var j=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");return s.error(j),n(j)}else if(m==="permission-denied"){var j=new a.OpenViduError(a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");return s.error(j),n(j)}else{var j=new a.OpenViduError(a.OpenViduErrorName.GENERIC_ERROR,"Unknown error when accessing screen share");return s.error(j),s.error(m),n(j)}else return e.constraints.video=M.video,I(e)});return}else{var D=new a.OpenViduError(a.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED,"You can only screen share in desktop Chrome, Firefox, Opera, Safari (>=13.0), Edge (>= 80) or Electron. Detected client: "+_.getName()+" "+_.getVersion());return s.error(D),n(D)}},b.prototype.setVideoSource=function(e,l){e.constraints.video||(e.constraints.video={}),e.constraints.video.deviceId={exact:l}},b.prototype.disconnectCallback=function(){s.warn("Websocket connection lost"),this.isRoomAvailable()?this.session.onLostConnection("networkDisconnect"):alert("Connection error. Please reload page.")},b.prototype.reconnectingCallback=function(){s.warn("Websocket connection lost (reconnecting)"),this.isRoomAvailable()?this.session.emitEvent("reconnecting",[]):alert("Connection error. Please reload page.")},b.prototype.reconnectWebsocketThroughRpcConnectMethod=function(e){var l=this;this.sendRequest("connect",{sessionId:e,reconnect:!0},function(I,n){if(I)if(l.isMasterNodeCrashed())s.warn("Master Node has crashed!");else{s.error(I);var y=function(L,D){s.warn(D),l.session.onLostConnection(L),l.jsonRpcClient.close(4101,"Reconnection fault: "+D)},T=function(){l.life===-1?y("networkDisconnect","WS successfully reconnected but the user was already evicted due to timeout"):l.sendRequest("sessionStatus",{sessionId:l.session.sessionId},function(L,D){L!=null?console.error("Error checking session status",L):l.life===D.life?y("networkDisconnect","WS successfully reconnected but the user was already evicted due to timeout"):y("nodeCrashed","WS successfully reconnected to OpenVidu Server but your Master Node crashed")})};I.code===40007&&I.message==="reconnection error"&&console.error("Invalid RPC sessionId. Client network disconnection or Master Node crash"),T()}else l.jsonRpcClient.resetPing(),l.session.onRecoveredConnection()})},b.prototype.reconnectedCallback=function(){if(s.warn("Websocket reconnected"),this.isRoomAvailable())if(this.session.connection)this.reconnectWebsocketThroughRpcConnectMethod(this.session.connection.rpcSessionId);else{s.warn("There was no previous connection when running reconnection callback");var e=new c.SessionDisconnectedEvent(this.session,"networkDisconnect");this.session.ee.emitEvent("sessionDisconnected",[e]),e.callDefaultBehavior()}else alert("Connection error. Please reload page.")},b.prototype.isMasterNodeCrashed=function(){return this.masterNodeHasCrashed},b.prototype.isRoomAvailable=function(){return this.session!==void 0&&this.session instanceof d.Session?!0:(s.warn("Session instance not found"),!1)},b.prototype.isScreenShare=function(e){return e==="screen"||e==="window"||_.isElectron()&&e.startsWith("screen:")},b}();return fe.OpenVidu=k,fe}var $t={},Ar;function io(){return Ar||(Ar=1,Object.defineProperty($t,"__esModule",{value:!0})),$t}var Vr;function oo(){return Vr||(Vr=1,function(p){var x=ge&&ge.__createBinding||(Object.create?function(m,O,M,V){V===void 0&&(V=M);var j=Object.getOwnPropertyDescriptor(O,M);(!j||("get"in j?!O.__esModule:j.writable||j.configurable))&&(j={enumerable:!0,get:function(){return O[M]}}),Object.defineProperty(m,V,j)}:function(m,O,M,V){V===void 0&&(V=M),m[V]=O[M]}),S=ge&&ge.__exportStar||function(m,O){for(var M in m)M!=="default"&&!Object.prototype.hasOwnProperty.call(O,M)&&x(O,m,M)};Object.defineProperty(p,"__esModule",{value:!0}),p.EventDispatcher=p.ExceptionEventName=p.ExceptionEvent=p.SpeechToTextEvent=p.NetworkQualityLevelChangedEvent=p.FilterEvent=p.ConnectionPropertyChangedEvent=p.StreamPropertyChangedEvent=p.VideoElementEvent=p.StreamManagerEvent=p.StreamEvent=p.SignalEvent=p.SessionDisconnectedEvent=p.RecordingEvent=p.PublisherSpeakingEvent=p.ConnectionEvent=p.Event=p.VideoInsertMode=p.TypeOfVideo=p.OpenViduErrorName=p.OpenViduError=p.LocalRecorderState=p.Filter=p.LocalRecorder=p.Connection=p.Stream=p.StreamManager=p.Subscriber=p.Publisher=p.Session=p.OpenVidu=void 0;var f=Br(),d=ro();Object.defineProperty(p,"OpenVidu",{enumerable:!0,get:function(){return d.OpenVidu}});var c=gt();Object.defineProperty(p,"Session",{enumerable:!0,get:function(){return c.Session}});var o=rn();Object.defineProperty(p,"Publisher",{enumerable:!0,get:function(){return o.Publisher}});var a=Qt();Object.defineProperty(p,"Subscriber",{enumerable:!0,get:function(){return a.Subscriber}});var i=Yt();Object.defineProperty(p,"StreamManager",{enumerable:!0,get:function(){return i.StreamManager}});var t=en();Object.defineProperty(p,"Stream",{enumerable:!0,get:function(){return t.Stream}});var E=Jr();Object.defineProperty(p,"Connection",{enumerable:!0,get:function(){return E.Connection}});var w=Ur();Object.defineProperty(p,"LocalRecorder",{enumerable:!0,get:function(){return w.LocalRecorder}});var C=zt();Object.defineProperty(p,"Filter",{enumerable:!0,get:function(){return C.Filter}});var h=qr();Object.defineProperty(p,"LocalRecorderState",{enumerable:!0,get:function(){return h.LocalRecorderState}});var P=Ve();Object.defineProperty(p,"OpenViduError",{enumerable:!0,get:function(){return P.OpenViduError}}),Object.defineProperty(p,"OpenViduErrorName",{enumerable:!0,get:function(){return P.OpenViduErrorName}});var v=Zt();Object.defineProperty(p,"TypeOfVideo",{enumerable:!0,get:function(){return v.TypeOfVideo}});var u=pt();Object.defineProperty(p,"VideoInsertMode",{enumerable:!0,get:function(){return u.VideoInsertMode}});var s=ce();Object.defineProperty(p,"Event",{enumerable:!0,get:function(){return s.Event}});var _=Kr();Object.defineProperty(p,"ConnectionEvent",{enumerable:!0,get:function(){return _.ConnectionEvent}});var k=Xr();Object.defineProperty(p,"PublisherSpeakingEvent",{enumerable:!0,get:function(){return k.PublisherSpeakingEvent}});var b=Qr();Object.defineProperty(p,"RecordingEvent",{enumerable:!0,get:function(){return b.RecordingEvent}});var e=tn();Object.defineProperty(p,"SessionDisconnectedEvent",{enumerable:!0,get:function(){return e.SessionDisconnectedEvent}});var l=Zr();Object.defineProperty(p,"SignalEvent",{enumerable:!0,get:function(){return l.SignalEvent}});var I=nn();Object.defineProperty(p,"StreamEvent",{enumerable:!0,get:function(){return I.StreamEvent}});var n=Kt();Object.defineProperty(p,"StreamManagerEvent",{enumerable:!0,get:function(){return n.StreamManagerEvent}});var y=Wr();Object.defineProperty(p,"VideoElementEvent",{enumerable:!0,get:function(){return y.VideoElementEvent}});var T=Ae();Object.defineProperty(p,"StreamPropertyChangedEvent",{enumerable:!0,get:function(){return T.StreamPropertyChangedEvent}});var L=ti();Object.defineProperty(p,"ConnectionPropertyChangedEvent",{enumerable:!0,get:function(){return L.ConnectionPropertyChangedEvent}});var D=Yr();Object.defineProperty(p,"FilterEvent",{enumerable:!0,get:function(){return D.FilterEvent}});var r=ni();Object.defineProperty(p,"NetworkQualityLevelChangedEvent",{enumerable:!0,get:function(){return r.NetworkQualityLevelChangedEvent}});var g=ei();Object.defineProperty(p,"SpeechToTextEvent",{enumerable:!0,get:function(){return g.SpeechToTextEvent}});var N=De();Object.defineProperty(p,"ExceptionEvent",{enumerable:!0,get:function(){return N.ExceptionEvent}}),Object.defineProperty(p,"ExceptionEventName",{enumerable:!0,get:function(){return N.ExceptionEventName}});var R=Jt();Object.defineProperty(p,"EventDispatcher",{enumerable:!0,get:function(){return R.EventDispatcher}}),S(io(),p),f.JL.setOptions({enabled:!1})}(ge)),ge}var so=oo();const Dr=window.location.hostname==="localhost"?"http://localhost:8089":"https://moim.o-r.kr",Gt=jr.memo(({streamManager:p,onClick:x,isMuted:S})=>{const f=oe.useRef();oe.useEffect(()=>{p&&f.current&&p.addVideoElement(f.current)},[p]);const d=()=>{try{return JSON.parse(p.stream.connection.data).clientData}catch{return"Participant"}};return Y.jsxs("div",{className:"video-item-container",onClick:x,children:[Y.jsx("video",{autoPlay:!0,ref:f,muted:S}),Y.jsx("div",{className:"participant-name",children:d()})]})});function ao(){const[p,x]=oe.useState(null),[S,f]=oe.useState(null),[d,c]=oe.useState([]),[o,a]=oe.useState(!1),[i,t]=oe.useState(""),[E,w]=oe.useState(`User_${Math.floor(Math.random()*100)}`),[C,h]=oe.useState(!0),[P,v]=oe.useState(!0),[u,s]=oe.useState(null),_=oe.useRef(new so.OpenVidu),k=oe.useRef(null);oe.useEffect(()=>{k.current=p},[p]),oe.useEffect(()=>{const g=()=>{k.current&&k.current.disconnect()};return window.addEventListener("beforeunload",g),()=>{window.removeEventListener("beforeunload",g),k.current&&(console.log("컴포넌트가 사라지면서 세션 연결을 종료합니다."),k.current.disconnect())}},[]);const b=async g=>{g.preventDefault();try{const N=i||"default-room-moim",R=_.current.initSession();R.on("streamCreated",B=>{const W=R.subscribe(B.stream,void 0);c(F=>[...F,W])}),R.on("streamDestroyed",B=>{u&&u.stream.streamId===B.stream.streamId&&s(null),c(W=>W.filter(F=>F.stream.streamId!==B.stream.streamId))}),R.on("exception",B=>console.warn("OpenVidu 예외: ",B));const m=await fetch(`${Dr}/api/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customSessionId:N})});if(!m.ok)throw new Error(`세션 생성 실패: ${m.status}`);const O=await m.text(),M=await fetch(`${Dr}/api/sessions/${O}/connections`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!M.ok)throw new Error(`토큰 발급 실패: ${M.status}`);const V=await M.text();await R.connect(V,{clientData:E});const j=await _.current.initPublisherAsync(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:C,publishVideo:P,resolution:"1280x720",frameRate:30,insertMode:"APPEND",mirror:!0});await R.publish(j),x(R),f(j),a(!0)}catch(N){console.error("세션 참여 실패:",N),alert(`연결 실패: ${N.message}`)}},e=()=>{p&&(p.disconnect(),window.close())},l=()=>S==null?void 0:S.publishAudio(!C),I=()=>S==null?void 0:S.publishVideo(!P);oe.useEffect(()=>{S&&S.on("streamPropertyChanged",g=>{g.changedProperty==="audioActive"&&h(g.newValue),g.changedProperty==="videoActive"&&v(g.newValue)})},[S]);const n=g=>{(u==null?void 0:u.stream.streamId)===g.stream.streamId?s(null):s(g)};if(!o)return Y.jsxs(Y.Fragment,{children:[Y.jsx("style",{children:co}),Y.jsx("div",{className:"join-container",children:Y.jsxs("div",{className:"join-form-wrapper",children:[Y.jsx("h1",{children:"MOIM 화상통화"}),Y.jsxs("form",{onSubmit:b,children:[Y.jsx("input",{type:"text",placeholder:"사용자 이름을 입력하세요",value:E,onChange:g=>w(g.target.value),required:!0}),Y.jsx("input",{type:"text",placeholder:"방 이름을 입력하거나 비워두세요",value:i,onChange:g=>t(g.target.value)}),Y.jsx("button",{type:"submit",children:"참여하기"})]}),Y.jsx("p",{children:"같은 방 이름을 입력한 사람들끼리 화상통화가 됩니다."})]})})]});const y=[S,...d].filter(Boolean),T=u||(y.length>0?y[0]:null),L=y.filter(g=>T&&g.stream.streamId!==T.stream.streamId),D=g=>g===1?"grid-cols-1 grid-rows-1":g===2?"grid-cols-2 grid-rows-1":"grid-cols-2 grid-rows-2",r=y.length>4||!!u;return Y.jsxs(Y.Fragment,{children:[Y.jsx("style",{children:uo}),Y.jsxs("div",{className:"video-call-wrapper",children:[Y.jsx("div",{className:"main-content",children:r?Y.jsxs("div",{className:"focused-layout",children:[Y.jsx("div",{className:"main-video-container",children:T&&Y.jsx(Gt,{streamManager:T,onClick:()=>n(T),isMuted:S===T})}),Y.jsx("div",{className:"thumbnail-strip",children:L.map(g=>Y.jsx(Gt,{streamManager:g,onClick:()=>n(g),isMuted:S===g},g.stream.streamId))})]}):Y.jsx("div",{className:`grid-layout ${D(y.length)}`,children:y.map(g=>Y.jsx(Gt,{streamManager:g,onClick:()=>n(g),isMuted:S===g},g.stream.streamId))})}),Y.jsxs("div",{className:"controls-bar",children:[Y.jsx("button",{onClick:l,className:`control-btn ${C?"on":"off"}`,children:C?"🎤":"🔇"}),Y.jsx("button",{onClick:I,className:`control-btn ${P?"on":"off"}`,children:P?"📹":"📵"}),Y.jsx("button",{onClick:e,className:"control-btn leave",children:"🚪"})]})]})]})}const co=`
    .join-container { display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f2f5; font-family: sans-serif; }
    .join-form-wrapper { background: #fff; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; max-width: 400px; width: 90%; color: #333; }
    .join-form-wrapper h1 { margin-bottom: 24px; font-size: 28px; font-weight: 600; }
    .join-form-wrapper input { display: block; width: 100%; padding: 12px; margin-bottom: 16px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
    .join-form-wrapper button { width: 100%; padding: 14px; background-color: #007bff; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; transition: background-color 0.3s; font-weight: 500; }
    .join-form-wrapper button:hover { background-color: #0056b3; }
    .join-form-wrapper p { margin-top: 20px; color: #666; font-size: 14px; line-height: 1.5; }
`,uo=`
    .video-call-wrapper { font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; background-color: #202124; color: #fff; }
    .main-content { flex-grow: 1; display: flex; padding: 16px; gap: 16px; overflow: hidden; }
    .focused-layout { display: flex; flex-direction: column; flex-grow: 1; gap: 16px; width: 100%; height: 100%; }
    .main-video-container { flex-grow: 1; display: flex; justify-content: center; align-items: center; background-color: #000; border-radius: 12px; overflow: hidden; position: relative; min-height: 0; }
    .thumbnail-strip { display: flex; justify-content: center; align-items: center; gap: 16px; flex-wrap: wrap; flex-shrink: 0; max-height: 180px; overflow-y: auto; padding: 8px; }
    .thumbnail-strip .video-item-container { width: 240px; height: 160px; flex-shrink: 0; }
    .grid-layout { display: grid; flex-grow: 1; gap: 16px; width: 100%; height: 100%; align-content: center; justify-content: center; }
    .grid-layout.grid-cols-1 { grid-template-columns: minmax(0, 1fr); }
    .grid-layout.grid-rows-1 { grid-template-rows: minmax(0, 1fr); }
    .grid-layout.grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .grid-layout.grid-rows-2 { grid-template-rows: repeat(2, minmax(0, 1fr)); }
    .video-item-container { position: relative; background-color: #3c4043; border-radius: 12px; overflow: hidden; transition: box-shadow 0.3s; border: 2px solid transparent; width: 100%; height: 100%; cursor: pointer; }
    .video-item-container:hover { box-shadow: 0 0 15px rgba(128, 189, 255, 0.7); }
    .video-item-container video { width: 100%; height: 100%; object-fit: cover; display: block; }
    .participant-name { position: absolute; bottom: 8px; left: 8px; background: rgba(0, 0, 0, 0.6); padding: 4px 8px; border-radius: 6px; font-size: 14px; }
    .controls-bar { flex-shrink: 0; display: flex; justify-content: center; align-items: center; padding: 16px; background-color: #2c2d30; }
    .control-btn { background: #4a4a4a; color: white; border: none; width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; margin: 0 10px; cursor: pointer; transition: background-color 0.3s; }
    .control-btn.on { background-color: #8ab4f8; color: #202124; }
    .control-btn.off { background-color: #3c4043; }
    .control-btn.leave { background-color: #ea4335; }
`;function lo(){return Y.jsx("div",{className:"App",children:Y.jsx(ao,{})})}hi.createRoot(document.getElementById("root")).render(Y.jsx(jr.StrictMode,{children:Y.jsx(lo,{})}));
