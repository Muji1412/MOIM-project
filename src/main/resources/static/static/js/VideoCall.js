import{c as an,r as ce,R as te}from"./index.js";var ge={},Be={},cn;function jr(){return cn||(cn=1,function(p){var k=Be&&Be.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();function y(f){if(!f)return y.__;Array.prototype.reduce||(Array.prototype.reduce=function(o,a){for(var i=a,n=0;n<this.length;n++)i=o(i,this[n],n,this);return i});var d="",c=("."+f).split(".").reduce(function(o,a,i,n){d?d+="."+a:d=a;var E=o["__"+d];return E===void 0&&(y.Logger.prototype=o,E=new y.Logger(d),o["__"+d]=E),E},y.__);return c}(function(f){f.requestId="",f.entryId=0,f._createXMLHttpRequest=function(){return new XMLHttpRequest},f._getTime=function(){return new Date().getTime()},f._console=console,f._appenderNames=[];function d(R,m,O){if(m[R]!==void 0){if(m[R]===null){delete O[R];return}O[R]=m[R]}}function c(R){if(f.enabled!=null&&!f.enabled)return!1;try{if(R.userAgentRegex&&!new RegExp(R.userAgentRegex).test(navigator.userAgent))return!1}catch{}try{if(R.ipRegex&&f.clientIP&&!new RegExp(R.ipRegex).test(f.clientIP))return!1}catch{}return!0}function o(R,m){try{if(R.disallow&&new RegExp(R.disallow).test(m))return!1}catch{}return!0}function a(R){return typeof R=="function"?R instanceof RegExp?R.toString():R():R}var i=function(){function R(m,O,A){this.msg=m,this.meta=O,this.finalString=A}return R}();function n(R){var m=a(R),O;switch(typeof m){case"string":return new i(m,null,m);case"number":return O=m.toString(),new i(O,null,O);case"boolean":return O=m.toString(),new i(O,null,O);case"undefined":return new i("undefined",null,"undefined");case"object":return m instanceof RegExp||m instanceof String||m instanceof Number||m instanceof Boolean?(O=m.toString(),new i(O,null,O)):(typeof f.serialize=="function"?O=f.serialize.call(this,m):O=JSON.stringify(m),new i("",m,O));default:return new i("unknown",null,"unknown")}}function E(R){return d("enabled",R,this),d("maxMessages",R,this),d("defaultAjaxUrl",R,this),d("clientIP",R,this),d("requestId",R,this),d("defaultBeforeSend",R,this),d("serialize",R,this),this}f.setOptions=E;function w(){return-2147483648}f.getAllLevel=w;function _(){return 1e3}f.getTraceLevel=_;function h(){return 2e3}f.getDebugLevel=h;function P(){return 3e3}f.getInfoLevel=P;function v(){return 4e3}f.getWarnLevel=v;function u(){return 5e3}f.getErrorLevel=u;function s(){return 6e3}f.getFatalLevel=s;function C(){return 2147483647}f.getOffLevel=C;function x(R){return R<=1e3?"trace":R<=2e3?"debug":R<=3e3?"info":R<=4e3?"warn":R<=5e3?"error":"fatal"}var b=function(){function R(m,O){this.inner=O,this.name="JL.Exception",this.message=n(m).finalString}return R}();f.Exception=b,b.prototype=new Error;var e=function(){function R(m,O,A,V,B){this.l=m,this.m=O,this.n=A,this.t=V,this.u=B}return R}();f.LogItem=e;function l(R,m,O){return f.entryId++,new e(R,m,O,f._getTime(),f.entryId)}function I(R){R.id&&(clearTimeout(R.id),R.id=null)}function t(R,m,O){var A=this;R.id||(R.id=setTimeout(function(){O.call(A)},m))}var g=function(){function R(m,O){this.appenderName=m,this.sendLogItems=O,this.level=f.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;var A="Trying to create an appender without a name or with an empty name";if(m==null)throw A;if(f._appenderNames.indexOf(m)!=-1)throw m?"Multiple appenders use the same name "+m:A;f._appenderNames.push(m)}return R.prototype.addLogItemsToBuffer=function(m){if(this.batchBuffer.length>=this.maxBatchSize){this.nbrLogItemsSkipped+=m.length;return}if(f.maxMessages!=null){if(f.maxMessages<1)return;f.maxMessages-=m.length}this.batchBuffer=this.batchBuffer.concat(m);var O=this;t(this.batchTimeoutTimer,this.batchTimeout,function(){O.sendBatch.call(O)})},R.prototype.batchBufferHasOverdueMessages=function(){for(var m=0;m<this.batchBuffer.length;m++){var O=f._getTime()-this.batchBuffer[m].t;if(O>this.batchTimeout)return!0}return!1},R.prototype.batchBufferHasStrandedMessage=function(){return f.maxMessages!=null&&f.maxMessages<1&&this.batchBuffer.length>0},R.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},R.prototype.onSendingEnded=function(){I(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},R.prototype.setOptions=function(m){if(d("level",m,this),d("ipRegex",m,this),d("userAgentRegex",m,this),d("disallow",m,this),d("sendWithBufferLevel",m,this),d("storeInBufferLevel",m,this),d("bufferSize",m,this),d("batchSize",m,this),d("maxBatchSize",m,this),d("batchTimeout",m,this),d("sendTimeout",m,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new f.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},R.prototype.log=function(m,O,A,V,B,j,$){var F;if(c(this)&&o(this,j)&&!(B<this.storeInBufferLevel)){if(F=l(B,j,$),B<this.level){this.bufferSize>0&&(this.buffer.push(F),this.buffer.length>this.bufferSize&&this.buffer.shift());return}this.addLogItemsToBuffer([F]),B>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete()}},R.prototype.sendBatch=function(){if(!(this.nbrLogItemsBeingSent>0)&&(I(this.batchTimeoutTimer),this.batchBuffer.length!=0)){this.nbrLogItemsBeingSent=this.batchBuffer.length;var m=this;t(this.sendTimeoutTimer,this.sendTimeout,function(){m.onSendingEnded.call(m)}),this.sendLogItems(this.batchBuffer,function(){m.batchBuffer.splice(0,m.nbrLogItemsBeingSent),m.nbrLogItemsSkipped>0&&(m.batchBuffer.push(l(v(),"Lost "+m.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",m.appenderName)),m.nbrLogItemsSkipped=0),m.onSendingEnded.call(m)})}},R}();f.Appender=g;var T=function(R){k(m,R);function m(O){return R.call(this,O,m.prototype.sendLogItemsAjax)||this}return m.prototype.setOptions=function(O){return d("url",O,this),d("beforeSend",O,this),R.prototype.setOptions.call(this,O),this},m.prototype.sendLogItemsAjax=function(O,A){try{if(!c(this))return;this.xhr&&this.xhr.readyState!=0&&this.xhr.readyState!=4&&this.xhr.abort(),this.xhr=f._createXMLHttpRequest();var V="/jsnlog.logger";f.defaultAjaxUrl!=null&&(V=f.defaultAjaxUrl),this.url&&(V=this.url),this.xhr.open("POST",V),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",f.requestId);var B=this;this.xhr.onreadystatechange=function(){B.xhr.readyState==4&&B.xhr.status>=200&&B.xhr.status<300&&A()};var j={r:f.requestId,lg:O};typeof this.beforeSend=="function"?this.beforeSend.call(this,this.xhr,j):typeof f.defaultBeforeSend=="function"&&f.defaultBeforeSend.call(this,this.xhr,j);var $=JSON.stringify(j);this.xhr.send($)}catch{}},m}(g);f.AjaxAppender=T;var L=function(R){k(m,R);function m(O){return R.call(this,O,m.prototype.sendLogItemsConsole)||this}return m.prototype.clog=function(O){f._console.log(O)},m.prototype.cerror=function(O){f._console.error?f._console.error(O):this.clog(O)},m.prototype.cwarn=function(O){f._console.warn?f._console.warn(O):this.clog(O)},m.prototype.cinfo=function(O){f._console.info?f._console.info(O):this.clog(O)},m.prototype.cdebug=function(O){f._console.debug?f._console.debug(O):this.cinfo(O)},m.prototype.sendLogItemsConsole=function(O,A){try{if(!c(this)||!f._console)return;var V;for(V=0;V<O.length;++V){var B=O[V],j=B.n+": "+B.m;typeof window>"u"&&(j=new Date(B.t)+" | "+j),B.l<=f.getDebugLevel()?this.cdebug(j):B.l<=f.getInfoLevel()?this.cinfo(j):B.l<=f.getWarnLevel()?this.cwarn(j):this.cerror(j)}}catch{}A()},m}(g);f.ConsoleAppender=L;var D=function(){function R(m){this.loggerName=m,this.seenRegexes=[]}return R.prototype.setOptions=function(m){return d("level",m,this),d("userAgentRegex",m,this),d("disallow",m,this),d("ipRegex",m,this),d("appenders",m,this),d("onceOnly",m,this),this.seenRegexes=[],this},R.prototype.buildExceptionObject=function(m){var O={};return m.stack?O.stack=m.stack:O.e=m,m.message&&(O.message=m.message),m.name&&(O.name=m.name),m.data&&(O.data=m.data),m.inner&&(O.inner=this.buildExceptionObject(m.inner)),O},R.prototype.log=function(m,O,A){var V=0,B,j;if(!this.appenders)return this;if(m>=this.level&&c(this)&&(A?(j=this.buildExceptionObject(A),j.logData=a(O)):j=O,B=n(j),o(this,B.finalString))){if(this.onceOnly)for(V=this.onceOnly.length-1;V>=0;){if(new RegExp(this.onceOnly[V]).test(B.finalString)){if(this.seenRegexes[V])return this;this.seenRegexes[V]=!0}V--}for(B.meta=B.meta||{},V=this.appenders.length-1;V>=0;)this.appenders[V].log(x(m),B.msg,B.meta,function(){},m,B.finalString,this.loggerName),V--}return this},R.prototype.trace=function(m){return this.log(_(),m)},R.prototype.debug=function(m){return this.log(h(),m)},R.prototype.info=function(m){return this.log(P(),m)},R.prototype.warn=function(m){return this.log(v(),m)},R.prototype.error=function(m){return this.log(u(),m)},R.prototype.fatal=function(m){return this.log(s(),m)},R.prototype.fatalException=function(m,O){return this.log(s(),m,O)},R}();f.Logger=D;function r(R){return new T(R)}f.createAjaxAppender=r;function S(R){return new L(R)}f.createConsoleAppender=S;var N;typeof window<"u"?N=new T(""):N=new L(""),f.__=new f.Logger(""),f.__.setOptions({level:f.getDebugLevel(),appenders:[N]})})(y||(y={})),p.__esModule=!0,p.JL=y,typeof __jsnlog_configure=="function"&&__jsnlog_configure(y),typeof window<"u"&&!window.onerror&&(window.onerror=function(f,d,c,o,a){return y("onerrorLogger").fatalException({msg:"Uncaught Exception",errorMsg:f?f.message||f:"",url:d,"line number":c,column:o},a),!1}),typeof window<"u"&&!window.onunhandledrejection&&(window.onunhandledrejection=function(f){y("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:f.reason?f.reason.message:f.message||null},f.reason)})}(Be)),Be}var fe={},je={},bt={},un;function qr(){return un||(un=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),p.LocalRecorderState=void 0,function(k){k.READY="READY",k.RECORDING="RECORDING",k.PAUSED="PAUSED",k.FINISHED="FINISHED"}(p.LocalRecorderState||(p.LocalRecorderState={}))}(bt)),bt}var qe={},Fe={},dn;function hi(){if(dn)return Fe;dn=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.ConsoleLogger=void 0;var p=function(){function k(y){this.logger=y,this.log=y.log,this.info=y.info,this.debug=y.debug,this.warn=y.warn,this.error=y.error}return k}();return Fe.ConsoleLogger=p,Fe}var St={},ln;function Fr(){return ln||(ln=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),p.OpenViduLoggerConfiguration=void 0,function(k){k.disabled="disabled",k.debug="debug",k.debug_app="debug_app"}(p.OpenViduLoggerConfiguration||(p.OpenViduLoggerConfiguration={}))}(St)),St}var fn;function oe(){if(fn)return qe;fn=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.OpenViduLogger=void 0;var p=jr(),k=hi(),y=Fr(),f=function(){function d(){this.JSNLOG_URL="/openvidu/elk/openvidu-browser-logs",this.MAX_JSNLOG_BATCH_LOG_MESSAGES=100,this.MAX_MSECONDS_BATCH_MESSAGES=5e3,this.MAX_LENGTH_STRING_JSON=1e3,this.defaultConsoleLogger=new k.ConsoleLogger(globalThis.console),this.isProdMode=!1,this.isJSNLogSetup=!1}return d.configureJSNLog=function(c,o){var a=this;try{if(globalThis.LOG_JSNLOG_RESULTS||this.instance&&c.isAtLeastPro&&this.instance.isOpenViduBrowserLogsDebugActive(c)&&this.instance.canConfigureJSNLog(c,this.instance)){c.sendBrowserLogs===y.OpenViduLoggerConfiguration.debug_app&&this.instance.replaceWindowConsole(),this.instance.isJSNLogSetup=!1,this.instance.info("Configuring JSNLogs.");var i=c.finalUserId,n=c.session.sessionId,E=function(_){var h=_.onreadystatechange;_.onreadystatechange=function(){a.isInvalidResponse(_)&&(Object.defineProperty(_,"readyState",{value:4}),Object.defineProperty(_,"status",{value:200}),a.instance.disableLogger()),h()},_.setRequestHeader("Authorization","Basic "+btoa("".concat(i,"%/%").concat(n)+":"+o)),_.setRequestHeader("X-Requested-With","XMLHttpRequest"),_.setRequestHeader("OV-Final-User-Id",i),_.setRequestHeader("OV-Session-Id",n),_.setRequestHeader("OV-Token",o)};this.instance.currentAppender=p.JL.createAjaxAppender("appender-".concat(i,"-").concat(n)),this.instance.currentAppender.setOptions({beforeSend:E,maxBatchSize:1e3,batchSize:this.instance.MAX_JSNLOG_BATCH_LOG_MESSAGES,batchTimeout:this.instance.MAX_MSECONDS_BATCH_MESSAGES});var w=function(_){var h=function(){var v=new WeakSet;return function(u,s){if(typeof s=="object"&&s!=null){if(v.has(s)||globalThis.HTMLElement&&s instanceof HTMLElement)return;v.add(s)}return s}},P=JSON.stringify(_,h());return P.length>a.instance.MAX_LENGTH_STRING_JSON&&(P="".concat(P.substring(0,a.instance.MAX_LENGTH_STRING_JSON),"...")),globalThis.LOG_JSNLOG_RESULTS&&console.log(P),P};p.JL.setOptions({defaultAjaxUrl:c.httpUri+this.instance.JSNLOG_URL,serialize:w,enabled:!0}),(0,p.JL)().setOptions({appenders:[this.instance.currentAppender]}),this.instance.isJSNLogSetup=!0,this.instance.loggingSessionId=n,this.instance.info("JSNLog configured.")}}catch(_){console.error("Error configuring JSNLog: "),console.error(_),this.instance.disableLogger()}},d.getInstance=function(){return d.instance||(d.instance=new d),d.instance},d.isInvalidResponse=function(c){return c.status==401||c.status==403||c.status==404||c.status==0},d.prototype.canConfigureJSNLog=function(c,o){return c.session.sessionId!=o.loggingSessionId},d.prototype.isOpenViduBrowserLogsDebugActive=function(c){return c.sendBrowserLogs===y.OpenViduLoggerConfiguration.debug||c.sendBrowserLogs===y.OpenViduLoggerConfiguration.debug_app},d.prototype.getConsoleWithJSNLog=function(){return function(c){return{log:function(){c.defaultConsoleLogger.log.apply(c.defaultConsoleLogger.logger,arguments),c.isJSNLogSetup&&(0,p.JL)().info(arguments)},info:function(){c.defaultConsoleLogger.info.apply(c.defaultConsoleLogger.logger,arguments),c.isJSNLogSetup&&(0,p.JL)().info(arguments)},debug:function(){c.defaultConsoleLogger.debug.apply(c.defaultConsoleLogger.logger,arguments)},warn:function(){c.defaultConsoleLogger.warn.apply(c.defaultConsoleLogger.logger,arguments),c.isJSNLogSetup&&(0,p.JL)().warn(arguments)},error:function(){c.defaultConsoleLogger.error.apply(c.defaultConsoleLogger.logger,arguments),c.isJSNLogSetup&&(0,p.JL)().error(arguments)}}}(this)},d.prototype.replaceWindowConsole=function(){globalThis.console=this.defaultConsoleLogger.logger,globalThis.console.log=this.getConsoleWithJSNLog().log,globalThis.console.info=this.getConsoleWithJSNLog().info,globalThis.console.debug=this.getConsoleWithJSNLog().debug,globalThis.console.warn=this.getConsoleWithJSNLog().warn,globalThis.console.error=this.getConsoleWithJSNLog().error},d.prototype.disableLogger=function(){p.JL.setOptions({enabled:!1}),this.isJSNLogSetup=!1,this.loggingSessionId=void 0,this.currentAppender=void 0,globalThis.console=this.defaultConsoleLogger.logger,globalThis.console.log=this.defaultConsoleLogger.log,globalThis.console.info=this.defaultConsoleLogger.info,globalThis.console.debug=this.defaultConsoleLogger.debug,globalThis.console.warn=this.defaultConsoleLogger.warn,globalThis.console.error=this.defaultConsoleLogger.error},d.prototype.log=function(){this.isProdMode||this.defaultConsoleLogger.log.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,p.JL)().info(arguments)},d.prototype.debug=function(){this.isProdMode||this.defaultConsoleLogger.debug.apply(this.defaultConsoleLogger.logger,arguments)},d.prototype.info=function(){this.isProdMode||this.defaultConsoleLogger.info.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,p.JL)().info(arguments)},d.prototype.warn=function(){this.defaultConsoleLogger.warn.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,p.JL)().warn(arguments)},d.prototype.error=function(){this.defaultConsoleLogger.error.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,p.JL)().error(arguments)},d.prototype.flush=function(){this.isJSNLogSetup&&this.currentAppender!=null&&this.currentAppender.sendBatch()},d.prototype.enableProdMode=function(){this.isProdMode=!0},d}();return qe.OpenViduLogger=f,qe}var Ue={},st={exports:{}};/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */var pi=st.exports,hn;function vi(){return hn||(hn=1,function(p,k){(function(){var y={function:!0,object:!0},f=y[typeof window]&&window||this,d=k,c=p&&!p.nodeType&&p,o=d&&c&&typeof an=="object"&&an;o&&(o.global===o||o.window===o||o.self===o)&&(f=o);var a=Math.pow(2,53)-1,i=/\bOpera/,n=Object.prototype,E=n.hasOwnProperty,w=n.toString;function _(t){return t=String(t),t.charAt(0).toUpperCase()+t.slice(1)}function h(t,g,T){var L={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return g&&T&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(L=L[/[\d.]+$/.exec(t)])&&(t="Windows "+L),t=String(t),g&&T&&(t=t.replace(RegExp(g,"i"),T)),t=v(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),t}function P(t,g){var T=-1,L=t?t.length:0;if(typeof L=="number"&&L>-1&&L<=a)for(;++T<L;)g(t[T],T,t);else u(t,g)}function v(t){return t=e(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:_(t)}function u(t,g){for(var T in t)E.call(t,T)&&g(t[T],T,t)}function s(t){return t==null?_(t):w.call(t).slice(8,-1)}function C(t,g){var T=t!=null?typeof t[g]:"number";return!/^(?:boolean|number|string|undefined)$/.test(T)&&(T=="object"?!!t[g]:!0)}function x(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function b(t,g){var T=null;return P(t,function(L,D){T=g(T,L,D,t)}),T}function e(t){return String(t).replace(/^ +| +$/g,"")}function l(t){var g=f,T=t&&typeof t=="object"&&s(t)!="String";T&&(g=t,t=null);var L=g.navigator||{},D=L.userAgent||"";t||(t=D);var r=T?!!L.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(w.toString()),S="Object",N=T?S:"ScriptBridgingProxyObject",R=T?S:"Environment",m=T&&g.java?"JavaPackage":s(g.java),O=T?S:"RuntimeObject",A=/\bJava/.test(m)&&g.java,V=A&&s(g.environment)==R,B=A?"a":"α",j=A?"b":"β",$=g.document||{},F=g.operamini||g.opera,G=i.test(G=T&&F?F["[[Class]]"]:s(F))?G:F=null,M,z=t,H=[],Q=null,K=t==D,U=K&&F&&typeof F.version=="function"&&F.version(),re,X=ci([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),q=di(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),J=on([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),Z=ui({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),W=li(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function ci(ie){return b(ie,function(ee,Y){return ee||RegExp("\\b"+(Y.pattern||x(Y))+"\\b","i").exec(t)&&(Y.label||Y)})}function ui(ie){return b(ie,function(ee,Y,ue){return ee||(Y[J]||Y[/^[a-z]+(?: +[a-z]+\b)*/i.exec(J)]||RegExp("\\b"+x(ue)+"(?:\\b|\\w*\\d)","i").exec(t))&&ue})}function di(ie){return b(ie,function(ee,Y){return ee||RegExp("\\b"+(Y.pattern||x(Y))+"\\b","i").exec(t)&&(Y.label||Y)})}function li(ie){return b(ie,function(ee,Y){var ue=Y.pattern||x(Y);return!ee&&(ee=RegExp("\\b"+ue+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(ee=h(ee,ue,Y.label||Y)),ee})}function on(ie){return b(ie,function(ee,Y){var ue=Y.pattern||x(Y);return!ee&&(ee=RegExp("\\b"+ue+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+ue+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+ue+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((ee=String(Y.label&&!RegExp(ue,"i").test(Y.label)?Y.label:ee).split("/"))[1]&&!/[\d.]+/.test(ee[0])&&(ee[0]+=" "+ee[1]),Y=Y.label||Y,ee=v(ee[0].replace(RegExp(ue,"i"),Y).replace(RegExp("; *(?:"+Y+"[_-])?","i")," ").replace(RegExp("("+Y+")[-_.]?(\\w)","i"),"$1 $2"))),ee})}function sn(ie){return b(ie,function(ee,Y){return ee||(RegExp(Y+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null})}function fi(){return this.description||""}if(X&&(X=[X]),/\bAndroid\b/.test(W)&&!J&&(M=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(J=e(M[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),Z&&!J?J=on([Z]):Z&&J&&(J=J.replace(RegExp("^("+x(Z)+")[-_.\\s]","i"),Z+" ").replace(RegExp("^("+x(Z)+")[-_.]?(\\w)","i"),Z+" $2")),(M=/\bGoogle TV\b/.exec(J))&&(J=M[0]),/\bSimulator\b/i.test(t)&&(J=(J?J+" ":"")+"Simulator"),q=="Opera Mini"&&/\bOPiOS\b/.test(t)&&H.push("running in Turbo/Uncompressed mode"),q=="IE"&&/\blike iPhone OS\b/.test(t)?(M=l(t.replace(/like iPhone OS/,"")),Z=M.manufacturer,J=M.product):/^iP/.test(J)?(q||(q="Safari"),W="iOS"+((M=/ OS ([\d_]+)/i.exec(t))?" "+M[1].replace(/_/g,"."):"")):q=="Konqueror"&&/^Linux\b/i.test(W)?W="Kubuntu":Z&&Z!="Google"&&(/Chrome/.test(q)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(J))||/\bAndroid\b/.test(W)&&/^Chrome/.test(q)&&/\bVersion\//i.test(t)?(q="Android Browser",W=/\bAndroid\b/.test(W)?W:"Android"):q=="Silk"?(/\bMobi/i.test(t)||(W="Android",H.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&H.unshift("accelerated")):q=="UC Browser"&&/\bUCWEB\b/.test(t)?H.push("speed mode"):q=="PaleMoon"&&(M=/\bFirefox\/([\d.]+)\b/.exec(t))?H.push("identifying as Firefox "+M[1]):q=="Firefox"&&(M=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(W||(W="Firefox OS"),J||(J=M[1])):!q||(M=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(q))?(q&&!J&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(M+"/")+8))&&(q=null),(M=J||Z||W)&&(J||Z||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(W))&&(q=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(W)?W:M)+" Browser")):q=="Electron"&&(M=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&H.push("Chromium "+M),U||(U=sn(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",x(q),"(?:Firefox|Minefield|NetFront)"])),(M=X=="iCab"&&parseFloat(U)>3&&"WebKit"||/\bOpera\b/.test(q)&&(/\bOPR\b/.test(t)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(X)&&"WebKit"||!X&&/\bMSIE\b/i.test(t)&&(W=="Mac OS"?"Tasman":"Trident")||X=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(q)&&"NetFront")&&(X=[M]),q=="IE"&&(M=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(q+=" Mobile",W="Windows Phone "+(/\+$/.test(M)?M:M+".x"),H.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(q="IE Mobile",W="Windows Phone 8.x",H.unshift("desktop mode"),U||(U=(/\brv:([\d.]+)/.exec(t)||0)[1])):q!="IE"&&X=="Trident"&&(M=/\brv:([\d.]+)/.exec(t))&&(q&&H.push("identifying as "+q+(U?" "+U:"")),q="IE",U=M[1]),K){if(C(g,"global"))if(A&&(M=A.lang.System,z=M.getProperty("os.arch"),W=W||M.getProperty("os.name")+" "+M.getProperty("os.version")),V){try{U=g.require("ringo/engine").version.join("."),q="RingoJS"}catch{(M=g.system)&&M.global.system==g.system&&(q="Narwhal",W||(W=M[0].os||null))}q||(q="Rhino")}else typeof g.process=="object"&&!g.process.browser&&(M=g.process)&&(typeof M.versions=="object"&&(typeof M.versions.electron=="string"?(H.push("Node "+M.versions.node),q="Electron",U=M.versions.electron):typeof M.versions.nw=="string"&&(H.push("Chromium "+U,"Node "+M.versions.node),q="NW.js",U=M.versions.nw)),q||(q="Node.js",z=M.arch,W=M.platform,U=/[\d.]+/.exec(M.version),U=U?U[0]:null));else s(M=g.runtime)==N?(q="Adobe AIR",W=M.flash.system.Capabilities.os):s(M=g.phantom)==O?(q="PhantomJS",U=(M=M.version||null)&&M.major+"."+M.minor+"."+M.patch):typeof $.documentMode=="number"&&(M=/\bTrident\/(\d+)/i.exec(t))?(U=[U,$.documentMode],(M=+M[1]+4)!=U[1]&&(H.push("IE "+U[1]+" mode"),X&&(X[1]=""),U[1]=M),U=q=="IE"?String(U[1].toFixed(1)):U[0]):typeof $.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(q)&&(H.push("masking as "+q+" "+U),q="IE",U="11.0",X=["Trident"],W="Windows");W=W&&v(W)}if(U&&(M=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(U)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(K&&L.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(Q=/b/i.test(M)?"beta":"alpha",U=U.replace(RegExp(M+"\\+?$"),"")+(Q=="beta"?j:B)+(/\d+\+?/.exec(M)||"")),q=="Fennec"||q=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(W))q="Firefox Mobile";else if(q=="Maxthon"&&U)U=U.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(J))J=="Xbox 360"&&(W=null),J=="Xbox 360"&&/\bIEMobile\b/.test(t)&&H.unshift("mobile mode");else if((/^(?:Chrome|IE|Opera)$/.test(q)||q&&!J&&!/Browser|Mobi/.test(q))&&(W=="Windows CE"||/Mobi/i.test(t)))q+=" Mobile";else if(q=="IE"&&K)try{g.external===null&&H.unshift("platform preview")}catch{H.unshift("embedded")}else(/\bBlackBerry\b/.test(J)||/\bBB10\b/.test(t))&&(M=(RegExp(J.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||U)?(M=[M,/BB10/.test(t)],W=(M[1]?(J=null,Z="BlackBerry"):"Device Software")+" "+M[0],U=null):this!=u&&J!="Wii"&&(K&&F||/Opera/.test(q)&&/\b(?:MSIE|Firefox)\b/i.test(t)||q=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(W)||q=="IE"&&(W&&!/^Win/.test(W)&&U>5.5||/\bWindows XP\b/.test(W)&&U>8||U==8&&!/\bTrident\b/.test(t)))&&!i.test(M=l.call(u,t.replace(i,"")+";"))&&M.name&&(M="ing as "+M.name+((M=M.version)?" "+M:""),i.test(q)?(/\bIE\b/.test(M)&&W=="Mac OS"&&(W=null),M="identify"+M):(M="mask"+M,G?q=v(G.replace(/([a-z])([A-Z])/g,"$1 $2")):q="Opera",/\bIE\b/.test(M)&&(W=null),K||(U=null)),X=["Presto"],H.push(M));(M=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(M=[parseFloat(M.replace(/\.(\d)$/,".0$1")),M],q=="Safari"&&M[1].slice(-1)=="+"?(q="WebKit Nightly",Q="alpha",U=M[1].slice(0,-1)):(U==M[1]||U==(M[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1]))&&(U=null),M[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],M[0]==537.36&&M[2]==537.36&&parseFloat(M[1])>=28&&X=="WebKit"&&(X=["Blink"]),!K||!r&&!M[1]?(X&&(X[1]="like Safari"),M=(M=M[0],M<400?1:M<500?2:M<526?3:M<533?4:M<534?"4+":M<535?5:M<537?6:M<538?7:M<601?8:M<602?9:M<604?10:M<606?11:M<608?12:"12")):(X&&(X[1]="like Chrome"),M=M[1]||(M=M[0],M<530?1:M<532?2:M<532.05?3:M<533?4:M<534.03?5:M<534.07?6:M<534.1?7:M<534.13?8:M<534.16?9:M<534.24?10:M<534.3?11:M<535.01?12:M<535.02?"13+":M<535.07?15:M<535.11?16:M<535.19?17:M<536.05?18:M<536.1?19:M<537.01?20:M<537.11?"21+":M<537.13?23:M<537.18?24:M<537.24?25:M<537.36?26:X!="Blink"?"27":"28")),X&&(X[1]+=" "+(M+=typeof M=="number"?".x":/[.+]/.test(M)?"":"+")),q=="Safari"&&(!U||parseInt(U)>45)?U=M:q=="Chrome"&&/\bHeadlessChrome/i.test(t)&&H.unshift("headless")),q=="Opera"&&(M=/\bzbov|zvav$/.exec(W))?(q+=" ",H.unshift("desktop mode"),M=="zvav"?(q+="Mini",U=null):q+="Mobile",W=W.replace(RegExp(" *"+M+"$"),"")):q=="Safari"&&/\bChrome\b/.exec(X&&X[1])?(H.unshift("desktop mode"),q="Chrome Mobile",U=null,/\bOS X\b/.test(W)?(Z="Apple",W="iOS 4.3+"):W=null):/\bSRWare Iron\b/.test(q)&&!U&&(U=sn("Chrome")),U&&U.indexOf(M=/[\d.]+$/.exec(W))==0&&t.indexOf("/"+M+"-")>-1&&(W=e(W.replace(M,""))),W&&W.indexOf(q)!=-1&&!RegExp(q+" OS").test(W)&&(W=W.replace(RegExp(" *"+x(q)+" *"),"")),X&&!/\b(?:Avant|Nook)\b/.test(q)&&(/Browser|Lunascape|Maxthon/.test(q)||q!="Safari"&&/^iOS/.test(W)&&/\bSafari\b/.test(X[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(q)&&X[1])&&(M=X[X.length-1])&&H.push(M),H.length&&(H=["("+H.join("; ")+")"]),Z&&J&&J.indexOf(Z)<0&&H.push("on "+Z),J&&H.push((/^on /.test(H[H.length-1])?"":"on ")+J),W&&(M=/ ([\d.+]+)$/.exec(W),re=M&&W.charAt(W.length-M[0].length-1)=="/",W={architecture:32,family:M&&!re?W.replace(M[0],""):W,version:M?M[1]:null,toString:function(){var ie=this.version;return this.family+(ie&&!re?" "+ie:"")+(this.architecture==64?" 64-bit":"")}}),(M=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(z))&&!/\bi686\b/i.test(z)?(W&&(W.architecture=64,W.family=W.family.replace(RegExp(" *"+M),"")),q&&(/\bWOW64\b/i.test(t)||K&&/\w(?:86|32)$/.test(L.cpuClass||L.platform)&&!/\bWin64; x64\b/i.test(t))&&H.unshift("32-bit")):W&&/^OS X/.test(W.family)&&q=="Chrome"&&parseFloat(U)>=39&&(W.architecture=64),t||(t=null);var se={};return se.description=t,se.layout=X&&X[0],se.manufacturer=Z,se.name=q,se.prerelease=Q,se.product=J,se.ua=t,se.version=q&&U,se.os=W||{architecture:null,family:null,version:null,toString:function(){return"null"}},se.parse=l,se.toString=fi,se.version&&H.unshift(U),se.name&&H.unshift(q),W&&q&&!(W==String(W).split(" ")[0]&&(W==q.split(" ")[0]||J))&&H.push(J?"("+W+")":"on "+W),H.length&&(se.description=H.join(" ")),se}var I=l();d&&c?u(I,function(t,g){d[g]=t}):f.platform=I}).call(pi)}(st,st.exports)),st.exports}var pn;function me(){if(pn)return Ue;pn=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.PlatformUtils=void 0;var p=vi(),k=function(){function y(){}return y.getInstance=function(){return this.instance||(this.instance=new y),y.instance},y.prototype.isChromeBrowser=function(){return p.name==="Chrome"},y.prototype.isSafariBrowser=function(){return p.name==="Safari"},y.prototype.isChromeMobileBrowser=function(){return p.name==="Chrome Mobile"},y.prototype.isFirefoxBrowser=function(){return p.name==="Firefox"},y.prototype.isFirefoxMobileBrowser=function(){return p.name==="Firefox Mobile"||p.name==="Firefox for iOS"},y.prototype.isOperaBrowser=function(){return p.name==="Opera"},y.prototype.isOperaMobileBrowser=function(){return p.name==="Opera Mobile"},y.prototype.isEdgeBrowser=function(){var f=p!=null&&p.version?parseFloat(p.version):-1;return p.name==="Microsoft Edge"&&f>=80},y.prototype.isEdgeMobileBrowser=function(){var f,d,c=p!=null&&p.version?parseFloat(p.version):-1;return p.name==="Microsoft Edge"&&(((f=p.os)===null||f===void 0?void 0:f.family)==="Android"||((d=p.os)===null||d===void 0?void 0:d.family)==="iOS")&&c>45},y.prototype.isAndroidBrowser=function(){return p.name==="Android Browser"},y.prototype.isElectron=function(){return p.name==="Electron"},y.prototype.isNodeJs=function(){return p.name==="Node.js"},y.prototype.isSamsungBrowser=function(){return p.name==="Samsung Internet Mobile"||p.name==="Samsung Internet"},y.prototype.isMotorolaEdgeDevice=function(){var f;return((f=p.product)===null||f===void 0?void 0:f.toLowerCase().includes("motorola edge"))||!1},y.prototype.isIPhoneOrIPad=function(){var f=p.ua?p.ua:navigator.userAgent,d="ontouchend"in document,c=/\b(\w*Macintosh\w*)\b/.test(f)&&d,o=/\b(\w*iPhone\w*)\b/.test(f)&&/\b(\w*Mobile\w*)\b/.test(f)&&d;return c||o},y.prototype.isIOSWithSafari=function(){var f=p.ua?p.ua:navigator.userAgent;return this.isIPhoneOrIPad()&&/\b(\w*Apple\w*)\b/.test(navigator.vendor)&&/\b(\w*Safari\w*)\b/.test(f)&&!/\b(\w*CriOS\w*)\b/.test(f)&&!/\b(\w*FxiOS\w*)\b/.test(f)},y.prototype.isIonicIos=function(){return this.isIPhoneOrIPad()&&p.ua.indexOf("Safari")===-1},y.prototype.isIonicAndroid=function(){return p.os.family==="Android"&&p.name=="Android Browser"},y.prototype.isMobileDevice=function(){return p.os.family==="iOS"||p.os.family==="Android"},y.prototype.isReactNative=function(){return!1},y.prototype.isChromium=function(){return this.isChromeBrowser()||this.isChromeMobileBrowser()||this.isOperaBrowser()||this.isOperaMobileBrowser()||this.isEdgeBrowser()||this.isEdgeMobileBrowser()||this.isSamsungBrowser()||this.isIonicAndroid()||this.isIonicIos()||this.isElectron()||this.isMotorolaEdgeDevice()},y.prototype.canScreenShare=function(){var f=p!=null&&p.version?parseFloat(p.version):-1;return this.isMobileDevice()?!1:this.isChromeBrowser()||this.isFirefoxBrowser()||this.isOperaBrowser()||this.isElectron()||this.isEdgeBrowser()||this.isSafariBrowser()&&f>=13},y.prototype.getName=function(){return p.name||""},y.prototype.getVersion=function(){return p.version||""},y.prototype.getFamily=function(){return p.os.family||""},y.prototype.getDescription=function(){return p.description||""},y}();return Ue.PlatformUtils=k,Ue}var yt,vn;function mi(){if(vn)return yt;vn=1;function p(){this._types=Object.create(null),this._extensions=Object.create(null);for(let k=0;k<arguments.length;k++)this.define(arguments[k]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}return p.prototype.define=function(k,y){for(let f in k){let d=k[f].map(function(c){return c.toLowerCase()});f=f.toLowerCase();for(let c=0;c<d.length;c++){const o=d[c];if(o[0]!=="*"){if(!y&&o in this._types)throw new Error('Attempt to change mapping for "'+o+'" extension from "'+this._types[o]+'" to "'+f+'". Pass `force=true` to allow this, otherwise remove "'+o+'" from the list of extensions for "'+f+'".');this._types[o]=f}}if(y||!this._extensions[f]){const c=d[0];this._extensions[f]=c[0]!=="*"?c:c.substr(1)}}},p.prototype.getType=function(k){k=String(k);let y=k.replace(/^.*[/\\]/,"").toLowerCase(),f=y.replace(/^.*\./,"").toLowerCase(),d=y.length<k.length;return(f.length<y.length-1||!d)&&this._types[f]||null},p.prototype.getExtension=function(k){return k=/^\s*([^;\s]*)/.test(k)&&RegExp.$1,k&&this._extensions[k.toLowerCase()]||null},yt=p,yt}var wt,mn;function gi(){return mn||(mn=1,wt={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]}),wt}var Ot,gn;function Ei(){if(gn)return Ot;gn=1;let p=mi();return Ot=new p(gi()),Ot}var En;function Ur(){if(En)return je;En=1,Object.defineProperty(je,"__esModule",{value:!0}),je.LocalRecorder=void 0;var p=qr(),k=oe(),y=me(),f=Ei(),d=k.OpenViduLogger.getInstance(),c,o=function(){function a(i){this.stream=i,this.chunks=[],c=y.PlatformUtils.getInstance(),this.connectionId=this.stream.connection?this.stream.connection.connectionId:"default-connection",this.id=this.stream.streamId+"_"+this.connectionId+"_localrecord",this.state=p.LocalRecorderState.READY}return a.prototype.record=function(i){var n=this;return new Promise(function(E,w){try{if(typeof i=="string"||i instanceof String)return w(`When calling LocalRecorder.record(options) parameter 'options' cannot be a string. Must be an object like { mimeType: "`.concat(i,'" }'));if(typeof MediaRecorder>"u")throw d.error("MediaRecorder not supported on your device. See compatibility in https://caniuse.com/#search=MediaRecorder"),Error("MediaRecorder not supported on your device. See compatibility in https://caniuse.com/#search=MediaRecorder");if(n.state!==p.LocalRecorderState.READY)throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '"+n.state+"'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before");d.log("Starting local recording of stream '"+n.stream.streamId+"' of connection '"+n.connectionId+"'"),i?i.mimeType||(i.mimeType="video/webm"):i={mimeType:"video/webm"},n.mediaRecorder=new MediaRecorder(n.stream.getMediaStream(),i),n.mediaRecorder.start()}catch(_){return w(_)}return n.mediaRecorder.ondataavailable=function(_){_.data.size>0&&n.chunks.push(_.data)},n.mediaRecorder.onerror=function(_){d.error("MediaRecorder error: ",_)},n.mediaRecorder.onstart=function(){d.log("MediaRecorder started (state="+n.mediaRecorder.state+")")},n.mediaRecorder.onstop=function(){n.onStopDefault()},n.mediaRecorder.onpause=function(){d.log("MediaRecorder paused (state="+n.mediaRecorder.state+")")},n.mediaRecorder.onresume=function(){d.log("MediaRecorder resumed (state="+n.mediaRecorder.state+")")},n.state=p.LocalRecorderState.RECORDING,E()})},a.prototype.stop=function(){var i=this;return new Promise(function(n,E){try{if(i.state===p.LocalRecorderState.READY||i.state===p.LocalRecorderState.FINISHED)throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '"+i.state+"'). Call 'LocalRecorder.start()' before");i.mediaRecorder.onstop=function(){return i.onStopDefault(),n()},i.mediaRecorder.stop()}catch(w){return E(w)}})},a.prototype.pause=function(){var i=this;return new Promise(function(n,E){try{return i.state!==p.LocalRecorderState.RECORDING?E(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '"+i.state+"'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")):(i.mediaRecorder.pause(),i.state=p.LocalRecorderState.PAUSED,n())}catch(w){return E(w)}})},a.prototype.resume=function(){var i=this;return new Promise(function(n,E){try{if(i.state!==p.LocalRecorderState.PAUSED)throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '"+i.state+"'). Call 'LocalRecorder.pause()' before");return i.mediaRecorder.resume(),i.state=p.LocalRecorderState.RECORDING,n()}catch(w){return E(w)}})},a.prototype.preview=function(i){if(this.state!==p.LocalRecorderState.FINISHED)throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");if(this.videoPreview=document.createElement("video"),this.videoPreview.id=this.id,this.videoPreview.autoplay=!0,c.isSafariBrowser()&&(this.videoPreview.playsInline=!0),typeof i=="string"){var n=document.getElementById(i);n&&(this.videoPreview=n.appendChild(this.videoPreview))}else this.videoPreview=i.appendChild(this.videoPreview);return this.videoPreview.src=this.videoPreviewSrc,this.videoPreview},a.prototype.clean=function(){var i=this,n=function(){delete i.blob,i.chunks=[],i.state=p.LocalRecorderState.READY};this.state===p.LocalRecorderState.RECORDING||this.state===p.LocalRecorderState.PAUSED?this.stop().then(function(){return n()}).catch(function(){return n()}):n()},a.prototype.download=function(){if(this.state!==p.LocalRecorderState.FINISHED)throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");var i=document.createElement("a");i.style.display="none",document.body.appendChild(i);var n=globalThis.URL.createObjectURL(this.blob);i.href=n,i.download=this.id+"."+f.getExtension(this.blob.type),i.click(),globalThis.URL.revokeObjectURL(n),document.body.removeChild(i)},a.prototype.getBlob=function(){if(this.state!==p.LocalRecorderState.FINISHED)throw Error("Call 'LocalRecord.stop()' before getting Blob file");return this.blob},a.prototype.uploadAsBinary=function(i,n){var E=this;return new Promise(function(w,_){if(E.state!==p.LocalRecorderState.FINISHED)return _(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+E.state+"'). Call 'LocalRecorder.stop()' before"));var h=new XMLHttpRequest;if(h.open("POST",i,!0),typeof n=="object")for(var P=0,v=Object.keys(n);P<v.length;P++){var u=v[P];h.setRequestHeader(u,n[u])}h.onreadystatechange=function(){if(h.readyState===4)return h.status.toString().charAt(0)==="2"?w(h.responseText):_(h.status)},h.send(E.blob)})},a.prototype.uploadAsMultipartfile=function(i,n){var E=this;return new Promise(function(w,_){if(E.state!==p.LocalRecorderState.FINISHED)return _(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+E.state+"'). Call 'LocalRecorder.stop()' before"));var h=new XMLHttpRequest;if(h.open("POST",i,!0),typeof n=="object")for(var P=0,v=Object.keys(n);P<v.length;P++){var u=v[P];h.setRequestHeader(u,n[u])}var s=new FormData;s.append("file",E.blob,E.id+"."+f.getExtension(E.blob.type)),h.onreadystatechange=function(){if(h.readyState===4)return h.status.toString().charAt(0)==="2"?w(h.responseText):_(h.status)},h.send(s)})},a.prototype.onStopDefault=function(){d.log("MediaRecorder stopped  (state="+this.mediaRecorder.state+")"),this.blob=new Blob(this.chunks,{type:this.mediaRecorder.mimeType}),this.chunks=[],this.videoPreviewSrc=globalThis.URL.createObjectURL(this.blob),this.state=p.LocalRecorderState.FINISHED},a}();return je.LocalRecorder=o,je}var de={},le={},We={},he={},$e={},Ee={},He={},bn;function ae(){if(bn)return He;bn=1,Object.defineProperty(He,"__esModule",{value:!0}),He.Event=void 0;var p=function(){function k(y,f,d){this.hasBeenPrevented=!1,this.cancelable=y,this.target=f,this.type=d}return k.prototype.isDefaultPrevented=function(){return this.hasBeenPrevented},k.prototype.preventDefault=function(){this.callDefaultBehavior=function(){},this.hasBeenPrevented=!0},k}();return He.Event=p,He}var Sn;function Ae(){if(Sn)return Ee;Sn=1;var p=Ee&&Ee.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.StreamPropertyChangedEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a,i,n,E){var w=f.call(this,!1,c,"streamPropertyChanged")||this;return w.stream=o,w.changedProperty=a,w.newValue=i,w.oldValue=n,w.reason=E,w}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return Ee.StreamPropertyChangedEvent=y,Ee}var Rt={},yn;function Ve(){return yn||(yn=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),p.OpenViduError=p.OpenViduErrorName=void 0,function(y){y.BROWSER_NOT_SUPPORTED="BROWSER_NOT_SUPPORTED",y.DEVICE_ACCESS_DENIED="DEVICE_ACCESS_DENIED",y.DEVICE_ALREADY_IN_USE="DEVICE_ALREADY_IN_USE",y.SCREEN_CAPTURE_DENIED="SCREEN_CAPTURE_DENIED",y.SCREEN_SHARING_NOT_SUPPORTED="SCREEN_SHARING_NOT_SUPPORTED",y.SCREEN_EXTENSION_NOT_INSTALLED="SCREEN_EXTENSION_NOT_INSTALLED",y.SCREEN_EXTENSION_DISABLED="SCREEN_EXTENSION_DISABLED",y.INPUT_VIDEO_DEVICE_NOT_FOUND="INPUT_VIDEO_DEVICE_NOT_FOUND",y.INPUT_AUDIO_DEVICE_NOT_FOUND="INPUT_AUDIO_DEVICE_NOT_FOUND",y.INPUT_AUDIO_DEVICE_GENERIC_ERROR="INPUT_AUDIO_DEVICE_GENERIC_ERROR",y.NO_INPUT_SOURCE_SET="NO_INPUT_SOURCE_SET",y.PUBLISHER_PROPERTIES_ERROR="PUBLISHER_PROPERTIES_ERROR",y.OPENVIDU_PERMISSION_DENIED="OPENVIDU_PERMISSION_DENIED",y.OPENVIDU_NOT_CONNECTED="OPENVIDU_NOT_CONNECTED",y.VIRTUAL_BACKGROUND_ERROR="VIRTUAL_BACKGROUND_ERROR",y.GENERIC_ERROR="GENERIC_ERROR"}(p.OpenViduErrorName||(p.OpenViduErrorName={}));var k=function(){function y(f,d){this.name=f,this.message=d}return y}();p.OpenViduError=k}(Rt)),Rt}var wn;function zt(){if(wn)return $e;wn=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.Filter=void 0;var p=Ae(),k=Ve(),y=oe(),f=y.OpenViduLogger.getInstance(),d=function(){function c(o,a){this.handlers=new Map,this.type=o,this.options=a}return c.prototype.execMethod=function(o,a){var i=this;return new Promise(function(n,E){var w;f.info("Executing filter method to stream "+i.stream.streamId);var _,h=function(u){f.info("Filter method successfully executed on Stream "+i.stream.streamId);var s=Object.assign({},i.stream.filter);return i.stream.filter.lastExecMethod={method:o,params:_},u&&(i.stream.session.emitEvent("streamPropertyChanged",[new p.StreamPropertyChangedEvent(i.stream.session,i.stream,"filter",i.stream.filter,s,"execFilterMethod")]),i.stream.streamManager.emitEvent("streamPropertyChanged",[new p.StreamPropertyChangedEvent(i.stream.streamManager,i.stream,"filter",i.stream.filter,s,"execFilterMethod")])),n()};if(i.type.startsWith("VB:")){if(typeof a=="string")try{a=JSON.parse(a)}catch(u){return E(new k.OpenViduError(k.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"Wrong params syntax: "+u))}if(_=a,o==="update")if(!((w=i.stream.virtualBackgroundSinkElements)===null||w===void 0)&&w.VB)i.stream.virtualBackgroundSinkElements.VB.updateValues(a).then(function(){return h(!1)}).catch(function(u){return u.name===k.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR?E(new k.OpenViduError(u.name,u.message)):E(new k.OpenViduError(k.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"Error updating values on Virtual Background filter: "+u))});else return E(new k.OpenViduError(k.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"There is no Virtual Background filter applied"));else return E(new k.OpenViduError(k.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,'Unknown Virtual Background method "'.concat(o,'"')))}else{var P=void 0;if(typeof a!="string")try{P=JSON.stringify(a)}catch{var v="'params' property must be a JSON formatted object";return f.error(v),E(v)}else P=a;_=P,i.stream.session.openvidu.sendRequest("execFilterMethod",{streamId:i.stream.streamId,method:o,params:P},function(u,s){return u?(f.error("Error executing filter method for Stream "+i.stream.streamId,u),u.code===401?E(new k.OpenViduError(k.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to execute a filter method")):E(u)):h(!0)})}})},c.prototype.addEventListener=function(o,a){var i=this;return new Promise(function(n,E){f.info("Adding filter event listener to event "+o+" to stream "+i.stream.streamId),i.stream.session.openvidu.sendRequest("addFilterEventListener",{streamId:i.stream.streamId,eventType:o},function(w,_){return w?(f.error("Error adding filter event listener to event "+o+"for Stream "+i.stream.streamId,w),w.code===401?E(new k.OpenViduError(k.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):E(w)):(i.handlers.set(o,a),f.info("Filter event listener to event "+o+" successfully applied on Stream "+i.stream.streamId),n())})})},c.prototype.removeEventListener=function(o){var a=this;return new Promise(function(i,n){f.info("Removing filter event listener to event "+o+" to stream "+a.stream.streamId),a.stream.session.openvidu.sendRequest("removeFilterEventListener",{streamId:a.stream.streamId,eventType:o},function(E,w){return E?(f.error("Error removing filter event listener to event "+o+"for Stream "+a.stream.streamId,E),E.code===401?n(new k.OpenViduError(k.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):n(E)):(a.handlers.delete(o),f.info("Filter event listener to event "+o+" successfully removed on Stream "+a.stream.streamId),i())})})},c}();return $e.Filter=d,$e}var be={},Se={},Ge={},pt={exports:{}};/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */var bi=pt.exports,On;function Xt(){return On||(On=1,function(p){(function(k){function y(){}var f=y.prototype,d=k.EventEmitter;function c(i,n){for(var E=i.length;E--;)if(i[E].listener===n)return E;return-1}function o(i){return function(){return this[i].apply(this,arguments)}}f.getListeners=function(n){var E=this._getEvents(),w,_;if(n instanceof RegExp){w={};for(_ in E)E.hasOwnProperty(_)&&n.test(_)&&(w[_]=E[_])}else w=E[n]||(E[n]=[]);return w},f.flattenListeners=function(n){var E=[],w;for(w=0;w<n.length;w+=1)E.push(n[w].listener);return E},f.getListenersAsObject=function(n){var E=this.getListeners(n),w;return E instanceof Array&&(w={},w[n]=E),w||E};function a(i){return typeof i=="function"||i instanceof RegExp?!0:i&&typeof i=="object"?a(i.listener):!1}f.addListener=function(n,E){if(!a(E))throw new TypeError("listener must be a function");var w=this.getListenersAsObject(n),_=typeof E=="object",h;for(h in w)w.hasOwnProperty(h)&&c(w[h],E)===-1&&w[h].push(_?E:{listener:E,once:!1});return this},f.on=o("addListener"),f.addOnceListener=function(n,E){return this.addListener(n,{listener:E,once:!0})},f.once=o("addOnceListener"),f.defineEvent=function(n){return this.getListeners(n),this},f.defineEvents=function(n){for(var E=0;E<n.length;E+=1)this.defineEvent(n[E]);return this},f.removeListener=function(n,E){var w=this.getListenersAsObject(n),_,h;for(h in w)w.hasOwnProperty(h)&&(_=c(w[h],E),_!==-1&&w[h].splice(_,1));return this},f.off=o("removeListener"),f.addListeners=function(n,E){return this.manipulateListeners(!1,n,E)},f.removeListeners=function(n,E){return this.manipulateListeners(!0,n,E)},f.manipulateListeners=function(n,E,w){var _,h,P=n?this.removeListener:this.addListener,v=n?this.removeListeners:this.addListeners;if(typeof E=="object"&&!(E instanceof RegExp))for(_ in E)E.hasOwnProperty(_)&&(h=E[_])&&(typeof h=="function"?P.call(this,_,h):v.call(this,_,h));else for(_=w.length;_--;)P.call(this,E,w[_]);return this},f.removeEvent=function(n){var E=typeof n,w=this._getEvents(),_;if(E==="string")delete w[n];else if(n instanceof RegExp)for(_ in w)w.hasOwnProperty(_)&&n.test(_)&&delete w[_];else delete this._events;return this},f.removeAllListeners=o("removeEvent"),f.emitEvent=function(n,E){var w=this.getListenersAsObject(n),_,h,P,v,u;for(v in w)if(w.hasOwnProperty(v))for(_=w[v].slice(0),P=0;P<_.length;P++)h=_[P],h.once===!0&&this.removeListener(n,h.listener),u=h.listener.apply(this,E||[]),u===this._getOnceReturnValue()&&this.removeListener(n,h.listener);return this},f.trigger=o("emitEvent"),f.emit=function(n){var E=Array.prototype.slice.call(arguments,1);return this.emitEvent(n,E)},f.setOnceReturnValue=function(n){return this._onceReturnValue=n,this},f._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},f._getEvents=function(){return this._events||(this._events={})},y.noConflict=function(){return k.EventEmitter=d,y},p.exports?p.exports=y:k.EventEmitter=y})(typeof window<"u"?window:bi||{})}(pt)),pt.exports}var Rn;function Jt(){if(Rn)return Ge;Rn=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.EventDispatcher=void 0;var p=oe(),k=Xt(),y=p.OpenViduLogger.getInstance(),f=function(){function d(){this.userHandlerArrowHandler=new WeakMap,this.ee=new k}return d.prototype.onAux=function(c,o,a){var i=function(n){n?y.debug(o,n):y.debug(o),a(n)};return this.userHandlerArrowHandler.set(a,i),this.ee.on(c,i),this},d.prototype.onceAux=function(c,o,a){var i=this,n=function(E){E?y.debug(o,E):y.debug(o),a(E),i.userHandlerArrowHandler.delete(a)};return this.userHandlerArrowHandler.set(a,n),this.ee.once(c,n),this},d.prototype.offAux=function(c,o){if(!o)this.ee.removeAllListeners(c);else{var a=this.userHandlerArrowHandler.get(o);a&&this.ee.off(c,a),this.userHandlerArrowHandler.delete(o)}return this},d}();return Ge.EventDispatcher=f,Ge}var ye={},Cn;function Kt(){if(Cn)return ye;Cn=1;var p=ye&&ye.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(ye,"__esModule",{value:!0}),ye.StreamManagerEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a){var i=f.call(this,!1,c,o)||this;return i.value=a,i}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return ye.StreamManagerEvent=y,ye}var we={},_n;function Wr(){if(_n)return we;_n=1;var p=we&&we.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(we,"__esModule",{value:!0}),we.VideoElementEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a){var i=f.call(this,!1,o,a)||this;return i.element=c,i}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return we.VideoElementEvent=y,we}var ze={},In;function De(){return In||(In=1,function(p){var k=ze&&ze.__extends||function(){var d=function(c,o){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,i){a.__proto__=i}||function(a,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(a[n]=i[n])},d(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");d(c,o);function a(){this.constructor=c}c.prototype=o===null?Object.create(o):(a.prototype=o.prototype,new a)}}();Object.defineProperty(p,"__esModule",{value:!0}),p.ExceptionEvent=p.ExceptionEventName=void 0;var y=ae();(function(d){d.ICE_CANDIDATE_ERROR="ICE_CANDIDATE_ERROR",d.ICE_CONNECTION_FAILED="ICE_CONNECTION_FAILED",d.ICE_CONNECTION_DISCONNECTED="ICE_CONNECTION_DISCONNECTED",d.NO_STREAM_PLAYING_EVENT="NO_STREAM_PLAYING_EVENT",d.SPEECH_TO_TEXT_DISCONNECTED="SPEECH_TO_TEXT_DISCONNECTED"})(p.ExceptionEventName||(p.ExceptionEventName={}));var f=function(d){k(c,d);function c(o,a,i,n,E){var w=d.call(this,!1,o,"exception")||this;return w.name=a,w.origin=i,w.message=n,w.data=E,w}return c.prototype.callDefaultBehavior=function(){},c}(y.Event);p.ExceptionEvent=f}(ze)),ze}var Ct={},Pn;function vt(){return Pn||(Pn=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),p.VideoInsertMode=void 0,function(k){k.AFTER="AFTER",k.APPEND="APPEND",k.BEFORE="BEFORE",k.PREPEND="PREPEND",k.REPLACE="REPLACE"}(p.VideoInsertMode||(p.VideoInsertMode={}))}(Ct)),Ct}var Tn;function Yt(){if(Tn)return Se;Tn=1;var p=Se&&Se.__extends||function(){var w=function(_,h){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,v){P.__proto__=v}||function(P,v){for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(P[u]=v[u])},w(_,h)};return function(_,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");w(_,h);function P(){this.constructor=_}_.prototype=h===null?Object.create(h):(P.prototype=h.prototype,new P)}}();Object.defineProperty(Se,"__esModule",{value:!0}),Se.StreamManager=void 0;var k=Jt(),y=Kt(),f=Wr(),d=De(),c=vt(),o=oe(),a=me(),i=o.OpenViduLogger.getInstance(),n,E=function(w){p(_,w);function _(h,P){var v=w.call(this)||this;if(v.videos=[],v.lazyLaunchVideoElementCreatedEvent=!1,n=a.PlatformUtils.getInstance(),v.stream=h,v.stream.streamManager=v,v.remote=!v.stream.isLocal(),P){var u=void 0;typeof P=="string"?u=document.getElementById(P):P instanceof HTMLElement&&(u=P),u&&(v.firstVideoElement={targetElement:u,video:document.createElement("video"),id:"",canplayListenerAdded:!1},(n.isSafariBrowser()||n.isIPhoneOrIPad()&&(n.isChromeMobileBrowser()||n.isEdgeMobileBrowser()||n.isOperaMobileBrowser()||n.isFirefoxMobileBrowser()))&&(v.firstVideoElement.video.playsInline=!0),v.targetElement=u,v.element=u)}return v.canPlayListener=function(){v.deactivateStreamPlayingEventExceptionTimeout(),v.ee.emitEvent("streamPlaying",[new y.StreamManagerEvent(v,"streamPlaying",void 0)])},v}return _.prototype.on=function(h,P){return w.prototype.onAux.call(this,h,"Event '"+h+"' triggered by '"+(this.remote?"Subscriber":"Publisher")+"'",P),h==="videoElementCreated"&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&(this.ee.emitEvent("videoElementCreated",[new f.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!1),h==="streamPlaying"&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&this.videos[0].video.paused===!1&&this.videos[0].video.ended===!1&&this.videos[0].video.readyState===4&&this.ee.emitEvent("streamPlaying",[new y.StreamManagerEvent(this,"streamPlaying",void 0)]),this.stream.hasAudio&&(h==="publisherStartSpeaking"&&this.stream.enableHarkSpeakingEvent(),h==="publisherStopSpeaking"&&this.stream.enableHarkStoppedSpeakingEvent(),h==="streamAudioVolumeChange"&&this.stream.enableHarkVolumeChangeEvent(!1)),this},_.prototype.once=function(h,P){return w.prototype.onceAux.call(this,h,"Event '"+h+"' triggered once by '"+(this.remote?"Subscriber":"Publisher")+"'",P),h==="videoElementCreated"&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&this.ee.emitEvent("videoElementCreated",[new f.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),h==="streamPlaying"&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&this.videos[0].video.paused===!1&&this.videos[0].video.ended===!1&&this.videos[0].video.readyState===4&&this.ee.emitEvent("streamPlaying",[new y.StreamManagerEvent(this,"streamPlaying",void 0)]),this.stream.hasAudio&&(h==="publisherStartSpeaking"&&this.stream.enableOnceHarkSpeakingEvent(),h==="publisherStopSpeaking"&&this.stream.enableOnceHarkStoppedSpeakingEvent(),h==="streamAudioVolumeChange"&&this.stream.enableOnceHarkVolumeChangeEvent(!1)),this},_.prototype.off=function(h,P){if(w.prototype.offAux.call(this,h,P),h==="publisherStartSpeaking"){var v=this.ee.getListeners(h).length+this.stream.session.ee.getListeners(h).length;v===0&&this.stream.disableHarkSpeakingEvent(!1)}if(h==="publisherStopSpeaking"){var u=this.ee.getListeners(h).length+this.stream.session.ee.getListeners(h).length;u===0&&this.stream.disableHarkStoppedSpeakingEvent(!1)}if(h==="streamAudioVolumeChange"){var s=this.ee.getListeners(h).length;s===0&&this.stream.disableHarkVolumeChangeEvent(!1)}return this},_.prototype.addVideoElement=function(h){this.initializeVideoProperties(h),!this.remote&&this.stream.displayMyRemote()&&h.srcObject!==this.stream.getMediaStream()&&(h.srcObject=this.stream.getMediaStream());for(var P=0,v=this.videos;P<v.length;P++){var u=v[P];if(u.video===h)return 0}for(var s=1,C=0,x=this.stream.session.streamManagers;C<x.length;C++){var b=x[C];if(b.disassociateVideo(h)){s=-1;break}}return this.stream.session.streamManagers.forEach(function(e){e.disassociateVideo(h)}),this.pushNewStreamManagerVideo({video:h,id:h.id,canplayListenerAdded:!1}),i.info("New video element associated to ",this),s},_.prototype.createVideoElement=function(h,P){var v;if(typeof h=="string"){if(v=document.getElementById(h),!v)throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+h)}else if(h instanceof HTMLElement)v=h;else throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+h);var u=this.createVideo();this.initializeVideoProperties(u);var s=P||c.VideoInsertMode.APPEND;switch(s){case c.VideoInsertMode.AFTER:v.parentNode.insertBefore(u,v.nextSibling);break;case c.VideoInsertMode.APPEND:v.appendChild(u);break;case c.VideoInsertMode.BEFORE:v.parentNode.insertBefore(u,v);break;case c.VideoInsertMode.PREPEND:v.insertBefore(u,v.childNodes[0]);break;case c.VideoInsertMode.REPLACE:v.parentNode.replaceChild(u,v);break;default:s=c.VideoInsertMode.APPEND,v.appendChild(u);break}var C={targetElement:v,video:u,insertMode:s,id:u.id,canplayListenerAdded:!1};return this.pushNewStreamManagerVideo(C),this.ee.emitEvent("videoElementCreated",[new f.VideoElementEvent(C.video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!!this.firstVideoElement,u},_.prototype.updatePublisherSpeakingEventsOptions=function(h){var P=this.stream.harkOptions?this.stream.harkOptions:this.stream.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{},v=typeof h.interval=="number"?h.interval:typeof P.interval=="number"?P.interval:100,u=typeof h.threshold=="number"?h.threshold:typeof P.threshold=="number"?P.threshold:-50;this.stream.harkOptions={interval:v,threshold:u},this.stream.speechEvent&&(this.stream.speechEvent.setInterval(v),this.stream.speechEvent.setThreshold(u))},_.prototype.initializeVideoProperties=function(h){!this.remote&&this.stream.displayMyRemote()||h.srcObject!==this.stream.getMediaStream()&&(h.srcObject=this.stream.getMediaStream()),h.autoplay=!0,h.controls=!1,(n.isSafariBrowser()||n.isIPhoneOrIPad()&&(n.isChromeMobileBrowser()||n.isEdgeMobileBrowser()||n.isOperaMobileBrowser()||n.isFirefoxMobileBrowser()))&&(h.playsInline=!0),h.id||(h.id=(this.remote?"remote-":"local-")+"video-"+this.stream.streamId,!this.id&&this.targetElement&&(this.id=h.id)),this.remote&&this.isMirroredVideo(h)?this.removeMirrorVideo(h):!this.remote&&!this.stream.displayMyRemote()&&(h.muted=!0,this.isMirroredVideo(h)&&!this.stream.outboundStreamOpts.publisherProperties.mirror?this.removeMirrorVideo(h):this.stream.outboundStreamOpts.publisherProperties.mirror&&!this.stream.isSendScreen()&&this.mirrorVideo(h))},_.prototype.removeAllVideos=function(){for(var h=this,P=this.stream.session.streamManagers.length-1;P>=0;--P)this.stream.session.streamManagers[P]===this&&this.stream.session.streamManagers.splice(P,1);this.videos.forEach(function(v){v.video&&v.video.removeEventListener&&v.video.removeEventListener("canplay",h.canPlayListener),v.canplayListenerAdded=!1,v.targetElement&&(v.video.parentNode.removeChild(v.video),h.ee.emitEvent("videoElementDestroyed",[new f.VideoElementEvent(v.video,h,"videoElementDestroyed")])),h.removeSrcObject(v),h.videos=h.videos.filter(function(u){return!u.targetElement})})},_.prototype.disassociateVideo=function(h){for(var P=!1,v=0;v<this.videos.length;v++)if(this.videos[v].video===h){this.videos[v].video.removeEventListener("canplay",this.canPlayListener),this.videos.splice(v,1),P=!0,i.info("Video element disassociated from ",this);break}return P},_.prototype.addPlayEventToFirstVideo=function(){this.videos[0]&&this.videos[0].video&&!this.videos[0].canplayListenerAdded&&(this.activateStreamPlayingEventExceptionTimeout(),this.videos[0].video.addEventListener("canplay",this.canPlayListener),this.videos[0].canplayListenerAdded=!0)},_.prototype.updateMediaStream=function(h){this.videos.forEach(function(P){if(P.video.srcObject=h,n.isIonicIos()){var v=P.video.parentElement,u=P.video;v.replaceChild(u,P.video),P.video=u}})},_.prototype.emitEvent=function(h,P){this.ee.emitEvent(h,P)},_.prototype.createVideo=function(){return document.createElement("video")},_.prototype.removeSrcObject=function(h){h.video.srcObject=null,this.deactivateStreamPlayingEventExceptionTimeout()},_.prototype.pushNewStreamManagerVideo=function(h){this.videos.push(h),this.addPlayEventToFirstVideo(),this.stream.session.streamManagers.indexOf(this)===-1&&this.stream.session.streamManagers.push(this)},_.prototype.mirrorVideo=function(h){n.isIonicIos()||(h.style.transform="rotateY(180deg)",h.style.webkitTransform="rotateY(180deg)")},_.prototype.removeMirrorVideo=function(h){h.style.transform="unset",h.style.webkitTransform="unset"},_.prototype.isMirroredVideo=function(h){return h.style.transform==="rotateY(180deg)"||h.style.webkitTransform==="rotateY(180deg)"},_.prototype.activateStreamPlayingEventExceptionTimeout=function(){var h=this;if(this.remote&&this.streamPlayingEventExceptionTimeout==null){var P=this.stream.session.openvidu.advancedConfiguration.noStreamPlayingEventExceptionTimeout||4e3;this.streamPlayingEventExceptionTimeout=setTimeout(function(){var v="StreamManager of Stream "+h.stream.streamId+" ("+(h.remote?"Subscriber":"Publisher")+') did not trigger "streamPlaying" event in '+P+" ms";i.warn(v),h.stream.session.emitEvent("exception",[new d.ExceptionEvent(h.stream.session,d.ExceptionEventName.NO_STREAM_PLAYING_EVENT,h,v)]),delete h.streamPlayingEventExceptionTimeout},P)}},_.prototype.deactivateStreamPlayingEventExceptionTimeout=function(){clearTimeout(this.streamPlayingEventExceptionTimeout),delete this.streamPlayingEventExceptionTimeout},_}(k.EventDispatcher);return Se.StreamManager=E,Se}var kn;function Qt(){if(kn)return be;kn=1;var p=be&&be.__extends||function(){var c=function(o,a){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var E in n)Object.prototype.hasOwnProperty.call(n,E)&&(i[E]=n[E])},c(o,a)};return function(o,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");c(o,a);function i(){this.constructor=o}o.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(be,"__esModule",{value:!0}),be.Subscriber=void 0;var k=Yt(),y=oe(),f=y.OpenViduLogger.getInstance(),d=function(c){p(o,c);function o(a,i,n){var E=c.call(this,a,i)||this;return E.element=E.targetElement,E.stream=a,E.properties=n,E}return o.prototype.subscribeToAudio=function(a){return this.stream.getMediaStream().getAudioTracks().forEach(function(i){i.enabled=a}),this.stream.audioActive=a,f.info("'Subscriber' has "+(a?"subscribed to":"unsubscribed from")+" its audio stream"),this},o.prototype.subscribeToVideo=function(a){return this.stream.getMediaStream().getVideoTracks().forEach(function(i){i.enabled=a}),this.stream.videoActive=a,f.info("'Subscriber' has "+(a?"subscribed to":"unsubscribed from")+" its video stream"),this},o.prototype.replaceTrackInMediaStream=function(a,i){var n=this.stream.getMediaStream(),E;a.kind==="video"?(E=n.getVideoTracks()[0],i&&(this.stream.lastVideoTrackConstraints=a.getConstraints())):E=n.getAudioTracks()[0],n.removeTrack(E),E.stop(),n.addTrack(a)},o}(k.StreamManager);return be.Subscriber=d,be}var ne={},_t,xn;function Si(){if(xn)return _t;xn=1;var p=["stun:","turn:"];return _t=function(k){var y=(k||{}).url||k,f,d,c={};return typeof y!="string"&&!(y instanceof String)||(y=y.trim(),f=p[p.indexOf(y.slice(0,5))],!f)?k:(y=y.slice(5),d=y.split("@"),c.username=k.username,c.credential=k.credential,d.length>1&&(y=d[1],d=d[0].split(":"),c.username=d[0],c.credential=(k||{}).credential||d[1]||""),c.url=f+y,c.urls=[c.url],c)},_t}const yi=["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"],wi=[];var It,Nn;function Oi(){if(Nn)return It;Nn=1;var p=Si(),k=function(y){var f={stun:(y||{}).stun||yi,turn:(y||{}).turn||wi},d=(y||{}).stunCount||2,c=(y||{}).turnCount||0,o;function a(i,n){for(var E=[],w=[].concat(f[i]),_;w.length&&E.length<n;)_=Math.random()*w.length|0,E=E.concat(w.splice(_,1));return E.map(function(h){return typeof h!="string"&&!(h instanceof String)?h:p(i+":"+h)})}return o=[].concat(a("stun",d)),c&&(o=o.concat(a("turn",c))),o};return It=k,It}var Pt={},Xe={},at={},Ln;function $r(){if(Ln)return at;Ln=1,Object.defineProperty(at,"__esModule",{value:!0}),at.default=y;let p;const k=new Uint8Array(16);function y(){if(!p&&(p=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!p))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(k)}return at}var Me={},Je={},Ke={},Mn;function Ri(){if(Mn)return Ke;Mn=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.default=void 0;var p=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;return Ke.default=p,Ke}var An;function mt(){if(An)return Je;An=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.default=void 0;var p=k(Ri());function k(d){return d&&d.__esModule?d:{default:d}}function y(d){return typeof d=="string"&&p.default.test(d)}var f=y;return Je.default=f,Je}var Vn;function gt(){if(Vn)return Me;Vn=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0,Me.unsafeStringify=f;var p=k(mt());function k(o){return o&&o.__esModule?o:{default:o}}const y=[];for(let o=0;o<256;++o)y.push((o+256).toString(16).slice(1));function f(o,a=0){return y[o[a+0]]+y[o[a+1]]+y[o[a+2]]+y[o[a+3]]+"-"+y[o[a+4]]+y[o[a+5]]+"-"+y[o[a+6]]+y[o[a+7]]+"-"+y[o[a+8]]+y[o[a+9]]+"-"+y[o[a+10]]+y[o[a+11]]+y[o[a+12]]+y[o[a+13]]+y[o[a+14]]+y[o[a+15]]}function d(o,a=0){const i=f(o,a);if(!(0,p.default)(i))throw TypeError("Stringified UUID is invalid");return i}var c=d;return Me.default=c,Me}var Dn;function Ci(){if(Dn)return Xe;Dn=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.default=void 0;var p=y($r()),k=gt();function y(n){return n&&n.__esModule?n:{default:n}}let f,d,c=0,o=0;function a(n,E,w){let _=E&&w||0;const h=E||new Array(16);n=n||{};let P=n.node||f,v=n.clockseq!==void 0?n.clockseq:d;if(P==null||v==null){const e=n.random||(n.rng||p.default)();P==null&&(P=f=[e[0]|1,e[1],e[2],e[3],e[4],e[5]]),v==null&&(v=d=(e[6]<<8|e[7])&16383)}let u=n.msecs!==void 0?n.msecs:Date.now(),s=n.nsecs!==void 0?n.nsecs:o+1;const C=u-c+(s-o)/1e4;if(C<0&&n.clockseq===void 0&&(v=v+1&16383),(C<0||u>c)&&n.nsecs===void 0&&(s=0),s>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=u,o=s,d=v,u+=122192928e5;const x=((u&268435455)*1e4+s)%4294967296;h[_++]=x>>>24&255,h[_++]=x>>>16&255,h[_++]=x>>>8&255,h[_++]=x&255;const b=u/4294967296*1e4&268435455;h[_++]=b>>>8&255,h[_++]=b&255,h[_++]=b>>>24&15|16,h[_++]=b>>>16&255,h[_++]=v>>>8|128,h[_++]=v&255;for(let e=0;e<6;++e)h[_+e]=P[e];return E||(0,k.unsafeStringify)(h)}var i=a;return Xe.default=i,Xe}var Ye={},ve={},Qe={},Bn;function Hr(){if(Bn)return Qe;Bn=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.default=void 0;var p=k(mt());function k(d){return d&&d.__esModule?d:{default:d}}function y(d){if(!(0,p.default)(d))throw TypeError("Invalid UUID");let c;const o=new Uint8Array(16);return o[0]=(c=parseInt(d.slice(0,8),16))>>>24,o[1]=c>>>16&255,o[2]=c>>>8&255,o[3]=c&255,o[4]=(c=parseInt(d.slice(9,13),16))>>>8,o[5]=c&255,o[6]=(c=parseInt(d.slice(14,18),16))>>>8,o[7]=c&255,o[8]=(c=parseInt(d.slice(19,23),16))>>>8,o[9]=c&255,o[10]=(c=parseInt(d.slice(24,36),16))/1099511627776&255,o[11]=c/4294967296&255,o[12]=c>>>24&255,o[13]=c>>>16&255,o[14]=c>>>8&255,o[15]=c&255,o}var f=y;return Qe.default=f,Qe}var jn;function Gr(){if(jn)return ve;jn=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.URL=ve.DNS=void 0,ve.default=o;var p=gt(),k=y(Hr());function y(a){return a&&a.__esModule?a:{default:a}}function f(a){a=unescape(encodeURIComponent(a));const i=[];for(let n=0;n<a.length;++n)i.push(a.charCodeAt(n));return i}const d="6ba7b810-9dad-11d1-80b4-00c04fd430c8";ve.DNS=d;const c="6ba7b811-9dad-11d1-80b4-00c04fd430c8";ve.URL=c;function o(a,i,n){function E(w,_,h,P){var v;if(typeof w=="string"&&(w=f(w)),typeof _=="string"&&(_=(0,k.default)(_)),((v=_)===null||v===void 0?void 0:v.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+w.length);if(u.set(_),u.set(w,_.length),u=n(u),u[6]=u[6]&15|i,u[8]=u[8]&63|128,h){P=P||0;for(let s=0;s<16;++s)h[P+s]=u[s];return h}return(0,p.unsafeStringify)(u)}try{E.name=a}catch{}return E.DNS=d,E.URL=c,E}return ve}var Ze={},qn;function _i(){if(qn)return Ze;qn=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.default=void 0;function p(h){if(typeof h=="string"){const P=unescape(encodeURIComponent(h));h=new Uint8Array(P.length);for(let v=0;v<P.length;++v)h[v]=P.charCodeAt(v)}return k(f(d(h),h.length*8))}function k(h){const P=[],v=h.length*32,u="0123456789abcdef";for(let s=0;s<v;s+=8){const C=h[s>>5]>>>s%32&255,x=parseInt(u.charAt(C>>>4&15)+u.charAt(C&15),16);P.push(x)}return P}function y(h){return(h+64>>>9<<4)+14+1}function f(h,P){h[P>>5]|=128<<P%32,h[y(P)-1]=P;let v=1732584193,u=-271733879,s=-1732584194,C=271733878;for(let x=0;x<h.length;x+=16){const b=v,e=u,l=s,I=C;v=i(v,u,s,C,h[x],7,-680876936),C=i(C,v,u,s,h[x+1],12,-389564586),s=i(s,C,v,u,h[x+2],17,606105819),u=i(u,s,C,v,h[x+3],22,-1044525330),v=i(v,u,s,C,h[x+4],7,-176418897),C=i(C,v,u,s,h[x+5],12,1200080426),s=i(s,C,v,u,h[x+6],17,-1473231341),u=i(u,s,C,v,h[x+7],22,-45705983),v=i(v,u,s,C,h[x+8],7,1770035416),C=i(C,v,u,s,h[x+9],12,-1958414417),s=i(s,C,v,u,h[x+10],17,-42063),u=i(u,s,C,v,h[x+11],22,-1990404162),v=i(v,u,s,C,h[x+12],7,1804603682),C=i(C,v,u,s,h[x+13],12,-40341101),s=i(s,C,v,u,h[x+14],17,-1502002290),u=i(u,s,C,v,h[x+15],22,1236535329),v=n(v,u,s,C,h[x+1],5,-165796510),C=n(C,v,u,s,h[x+6],9,-1069501632),s=n(s,C,v,u,h[x+11],14,643717713),u=n(u,s,C,v,h[x],20,-373897302),v=n(v,u,s,C,h[x+5],5,-701558691),C=n(C,v,u,s,h[x+10],9,38016083),s=n(s,C,v,u,h[x+15],14,-660478335),u=n(u,s,C,v,h[x+4],20,-405537848),v=n(v,u,s,C,h[x+9],5,568446438),C=n(C,v,u,s,h[x+14],9,-1019803690),s=n(s,C,v,u,h[x+3],14,-187363961),u=n(u,s,C,v,h[x+8],20,1163531501),v=n(v,u,s,C,h[x+13],5,-1444681467),C=n(C,v,u,s,h[x+2],9,-51403784),s=n(s,C,v,u,h[x+7],14,1735328473),u=n(u,s,C,v,h[x+12],20,-1926607734),v=E(v,u,s,C,h[x+5],4,-378558),C=E(C,v,u,s,h[x+8],11,-2022574463),s=E(s,C,v,u,h[x+11],16,1839030562),u=E(u,s,C,v,h[x+14],23,-35309556),v=E(v,u,s,C,h[x+1],4,-1530992060),C=E(C,v,u,s,h[x+4],11,1272893353),s=E(s,C,v,u,h[x+7],16,-155497632),u=E(u,s,C,v,h[x+10],23,-1094730640),v=E(v,u,s,C,h[x+13],4,681279174),C=E(C,v,u,s,h[x],11,-358537222),s=E(s,C,v,u,h[x+3],16,-722521979),u=E(u,s,C,v,h[x+6],23,76029189),v=E(v,u,s,C,h[x+9],4,-640364487),C=E(C,v,u,s,h[x+12],11,-421815835),s=E(s,C,v,u,h[x+15],16,530742520),u=E(u,s,C,v,h[x+2],23,-995338651),v=w(v,u,s,C,h[x],6,-198630844),C=w(C,v,u,s,h[x+7],10,1126891415),s=w(s,C,v,u,h[x+14],15,-1416354905),u=w(u,s,C,v,h[x+5],21,-57434055),v=w(v,u,s,C,h[x+12],6,1700485571),C=w(C,v,u,s,h[x+3],10,-1894986606),s=w(s,C,v,u,h[x+10],15,-1051523),u=w(u,s,C,v,h[x+1],21,-2054922799),v=w(v,u,s,C,h[x+8],6,1873313359),C=w(C,v,u,s,h[x+15],10,-30611744),s=w(s,C,v,u,h[x+6],15,-1560198380),u=w(u,s,C,v,h[x+13],21,1309151649),v=w(v,u,s,C,h[x+4],6,-145523070),C=w(C,v,u,s,h[x+11],10,-1120210379),s=w(s,C,v,u,h[x+2],15,718787259),u=w(u,s,C,v,h[x+9],21,-343485551),v=c(v,b),u=c(u,e),s=c(s,l),C=c(C,I)}return[v,u,s,C]}function d(h){if(h.length===0)return[];const P=h.length*8,v=new Uint32Array(y(P));for(let u=0;u<P;u+=8)v[u>>5]|=(h[u/8]&255)<<u%32;return v}function c(h,P){const v=(h&65535)+(P&65535);return(h>>16)+(P>>16)+(v>>16)<<16|v&65535}function o(h,P){return h<<P|h>>>32-P}function a(h,P,v,u,s,C){return c(o(c(c(P,h),c(u,C)),s),v)}function i(h,P,v,u,s,C,x){return a(P&v|~P&u,h,P,s,C,x)}function n(h,P,v,u,s,C,x){return a(P&u|v&~u,h,P,s,C,x)}function E(h,P,v,u,s,C,x){return a(P^v^u,h,P,s,C,x)}function w(h,P,v,u,s,C,x){return a(v^(P|~u),h,P,s,C,x)}var _=p;return Ze.default=_,Ze}var Fn;function Ii(){if(Fn)return Ye;Fn=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.default=void 0;var p=y(Gr()),k=y(_i());function y(c){return c&&c.__esModule?c:{default:c}}var d=(0,p.default)("v3",48,k.default);return Ye.default=d,Ye}var et={},tt={},Un;function Pi(){if(Un)return tt;Un=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.default=void 0;var k={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};return tt.default=k,tt}var Wn;function Ti(){if(Wn)return et;Wn=1,Object.defineProperty(et,"__esModule",{value:!0}),et.default=void 0;var p=f(Pi()),k=f($r()),y=gt();function f(o){return o&&o.__esModule?o:{default:o}}function d(o,a,i){if(p.default.randomUUID&&!a&&!o)return p.default.randomUUID();o=o||{};const n=o.random||(o.rng||k.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,a){i=i||0;for(let E=0;E<16;++E)a[i+E]=n[E];return a}return(0,y.unsafeStringify)(n)}var c=d;return et.default=c,et}var nt={},rt={},$n;function ki(){if($n)return rt;$n=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.default=void 0;function p(d,c,o,a){switch(d){case 0:return c&o^~c&a;case 1:return c^o^a;case 2:return c&o^c&a^o&a;case 3:return c^o^a}}function k(d,c){return d<<c|d>>>32-c}function y(d){const c=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof d=="string"){const E=unescape(encodeURIComponent(d));d=[];for(let w=0;w<E.length;++w)d.push(E.charCodeAt(w))}else Array.isArray(d)||(d=Array.prototype.slice.call(d));d.push(128);const a=d.length/4+2,i=Math.ceil(a/16),n=new Array(i);for(let E=0;E<i;++E){const w=new Uint32Array(16);for(let _=0;_<16;++_)w[_]=d[E*64+_*4]<<24|d[E*64+_*4+1]<<16|d[E*64+_*4+2]<<8|d[E*64+_*4+3];n[E]=w}n[i-1][14]=(d.length-1)*8/Math.pow(2,32),n[i-1][14]=Math.floor(n[i-1][14]),n[i-1][15]=(d.length-1)*8&4294967295;for(let E=0;E<i;++E){const w=new Uint32Array(80);for(let s=0;s<16;++s)w[s]=n[E][s];for(let s=16;s<80;++s)w[s]=k(w[s-3]^w[s-8]^w[s-14]^w[s-16],1);let _=o[0],h=o[1],P=o[2],v=o[3],u=o[4];for(let s=0;s<80;++s){const C=Math.floor(s/20),x=k(_,5)+p(C,h,P,v)+u+c[C]+w[s]>>>0;u=v,v=P,P=k(h,30)>>>0,h=_,_=x}o[0]=o[0]+_>>>0,o[1]=o[1]+h>>>0,o[2]=o[2]+P>>>0,o[3]=o[3]+v>>>0,o[4]=o[4]+u>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,o[0]&255,o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,o[1]&255,o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,o[2]&255,o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,o[3]&255,o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,o[4]&255]}var f=y;return rt.default=f,rt}var Hn;function xi(){if(Hn)return nt;Hn=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.default=void 0;var p=y(Gr()),k=y(ki());function y(c){return c&&c.__esModule?c:{default:c}}var d=(0,p.default)("v5",80,k.default);return nt.default=d,nt}var it={},Gn;function Ni(){if(Gn)return it;Gn=1,Object.defineProperty(it,"__esModule",{value:!0}),it.default=void 0;var p="00000000-0000-0000-0000-000000000000";return it.default=p,it}var ot={},zn;function Li(){if(zn)return ot;zn=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.default=void 0;var p=k(mt());function k(d){return d&&d.__esModule?d:{default:d}}function y(d){if(!(0,p.default)(d))throw TypeError("Invalid UUID");return parseInt(d.slice(14,15),16)}var f=y;return ot.default=f,ot}var Xn;function zr(){return Xn||(Xn=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),Object.defineProperty(p,"NIL",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(p,"parse",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(p,"stringify",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(p,"v1",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(p,"v3",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(p,"v4",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(p,"v5",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(p,"validate",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(p,"version",{enumerable:!0,get:function(){return o.default}});var k=E(Ci()),y=E(Ii()),f=E(Ti()),d=E(xi()),c=E(Ni()),o=E(Li()),a=E(mt()),i=E(gt()),n=E(Hr());function E(w){return w&&w.__esModule?w:{default:w}}}(Pt)),Pt}var Jn;function Mi(){if(Jn)return ne;Jn=1;var p=ne&&ne.__extends||function(){var P=function(v,u){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,C){s.__proto__=C}||function(s,C){for(var x in C)Object.prototype.hasOwnProperty.call(C,x)&&(s[x]=C[x])},P(v,u)};return function(v,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");P(v,u);function s(){this.constructor=v}v.prototype=u===null?Object.create(u):(s.prototype=u.prototype,new s)}}(),k=ne&&ne.__assign||function(){return k=Object.assign||function(P){for(var v,u=1,s=arguments.length;u<s;u++){v=arguments[u];for(var C in v)Object.prototype.hasOwnProperty.call(v,C)&&(P[C]=v[C])}return P},k.apply(this,arguments)},y=ne&&ne.__awaiter||function(P,v,u,s){function C(x){return x instanceof u?x:new u(function(b){b(x)})}return new(u||(u=Promise))(function(x,b){function e(t){try{I(s.next(t))}catch(g){b(g)}}function l(t){try{I(s.throw(t))}catch(g){b(g)}}function I(t){t.done?x(t.value):C(t.value).then(e,l)}I((s=s.apply(P,v||[])).next())})},f=ne&&ne.__generator||function(P,v){var u={label:0,sent:function(){if(x[0]&1)throw x[1];return x[1]},trys:[],ops:[]},s,C,x,b;return b={next:e(0),throw:e(1),return:e(2)},typeof Symbol=="function"&&(b[Symbol.iterator]=function(){return this}),b;function e(I){return function(t){return l([I,t])}}function l(I){if(s)throw new TypeError("Generator is already executing.");for(;b&&(b=0,I[0]&&(u=0)),u;)try{if(s=1,C&&(x=I[0]&2?C.return:I[0]?C.throw||((x=C.return)&&x.call(C),0):C.next)&&!(x=x.call(C,I[1])).done)return x;switch(C=0,x&&(I=[I[0]&2,x.value]),I[0]){case 0:case 1:x=I;break;case 4:return u.label++,{value:I[1],done:!1};case 5:u.label++,C=I[1],I=[0];continue;case 7:I=u.ops.pop(),u.trys.pop();continue;default:if(x=u.trys,!(x=x.length>0&&x[x.length-1])&&(I[0]===6||I[0]===2)){u=0;continue}if(I[0]===3&&(!x||I[1]>x[0]&&I[1]<x[3])){u.label=I[1];break}if(I[0]===6&&u.label<x[1]){u.label=x[1],x=I;break}if(x&&u.label<x[2]){u.label=x[2],u.ops.push(I);break}x[2]&&u.ops.pop(),u.trys.pop();continue}I=v.call(P,u)}catch(t){I=[6,t],C=0}finally{s=x=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}};Object.defineProperty(ne,"__esModule",{value:!0}),ne.WebRtcPeerSendrecv=ne.WebRtcPeerSendonly=ne.WebRtcPeerRecvonly=ne.WebRtcPeer=void 0;var d=Oi(),c=zr(),o=De(),a=oe(),i=me(),n=a.OpenViduLogger.getInstance(),E=function(){function P(v){var u=this;this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],this.iceCandidateList=[],i.PlatformUtils.getInstance(),this.configuration=k(k({},v),{iceServers:v.iceServers&&v.iceServers.length>0?v.iceServers:d(),rtcConfiguration:v.rtcConfiguration!==void 0?v.rtcConfiguration:{},mediaStream:v.mediaStream!==void 0?v.mediaStream:null,mode:v.mode?v.mode:"sendrecv",id:v.id?v.id:this.generateUniqueId()}),n.debug(`[WebRtcPeer] configuration:

`.concat(JSON.stringify(this.configuration,null,2)));var s=this.configuration.rtcConfiguration?this.configuration.rtcConfiguration:{iceServers:this.configuration.iceServers};!s.iceServers&&this.configuration.iceServers&&(s.iceServers=this.configuration.iceServers),this.pc=new RTCPeerConnection(s),this.pc.addEventListener("icecandidate",function(C){if(C.candidate!==null){var x=C.candidate,b=new RTCIceCandidate(x);u.configuration.onIceCandidate(b),b.candidate!==""&&u.localCandidatesQueue.push(b)}}),this.pc.addEventListener("signalingstatechange",function(){return y(u,void 0,void 0,function(){var C,x;return f(this,function(b){switch(b.label){case 0:if(this.pc.signalingState!=="stable")return[3,6];b.label=1;case 1:if(!(this.iceCandidateList.length>0))return[3,6];C=this.iceCandidateList.shift(),b.label=2;case 2:return b.trys.push([2,4,,5]),[4,this.pc.addIceCandidate(C)];case 3:return b.sent(),[3,5];case 4:return x=b.sent(),n.error("Error when calling RTCPeerConnection#addIceCandidate for RTCPeerConnection "+this.getId(),x),[3,5];case 5:return[3,1];case 6:return[2]}})})})}return P.prototype.getId=function(){return this.configuration.id},P.prototype.dispose=function(){if(n.debug("Disposing WebRtcPeer"),this.pc){if(this.pc.signalingState==="closed")return;this.pc.close(),this.remoteCandidatesQueue=[],this.localCandidatesQueue=[]}},P.prototype.createOfferLegacy=function(){this.configuration.mediaStream&&this.deprecatedPeerConnectionTrackApi();var v=this.configuration.mediaConstraints.audio,u=this.configuration.mediaConstraints.video,s={offerToReceiveAudio:this.configuration.mode!=="sendonly"&&v,offerToReceiveVideo:this.configuration.mode!=="sendonly"&&u};return n.debug("[createOfferLegacy] RTCPeerConnection.createOffer() options:",JSON.stringify(s)),this.pc.createOffer(s)},P.prototype.createOffer=function(){var v,u,s,C,x,b,e,l;return y(this,void 0,void 0,function(){var I,t,g,T,L,D,r,S,N,R,m,O,A,V,B,j,$,Q,F,G,M,z,H,Q;return f(this,function(K){switch(K.label){case 0:if("addTransceiver"in this.pc)n.debug("[createOffer] Method RTCPeerConnection.addTransceiver() is available; using it");else return n.warn("[createOffer] Method RTCPeerConnection.addTransceiver() is NOT available; using LEGACY offerToReceive{Audio,Video}"),[2,this.createOfferLegacy()];if(this.configuration.mode==="recvonly")return[3,7];if(!this.configuration.mediaStream)throw new Error("[WebRtcPeer.createOffer] Direction is '".concat(this.configuration.mode,"', but no stream was configured to be sent"));I=0,t=this.configuration.mediaStream.getTracks(),K.label=1;case 1:if(!(I<t.length))return[3,6];if(g=t[I],T={direction:this.configuration.mode,streams:[this.configuration.mediaStream]},g.kind==="video"&&this.configuration.simulcast)for(L=g.getSettings(),D=g.getConstraints(),r=(s=(u=(v=L.width)!==null&&v!==void 0?v:D.width.ideal)!==null&&u!==void 0?u:D.width)!==null&&s!==void 0?s:0,S=(b=(x=(C=L.height)!==null&&C!==void 0?C:D.height.ideal)!==null&&x!==void 0?x:D.height)!==null&&b!==void 0?b:0,n.info("[createOffer] Video track dimensions: ".concat(r,"x").concat(S)),N=r*S,R=0,N>=960*540?R=3:N>=480*270?R=2:R=1,T.sendEncodings=[],m=0;m<R;m++)O=Math.pow(2,R-m-1),A={rid:"rdiv"+O.toString(),scalabilityMode:"L1T1"},["detail","text"].includes(g.contentHint)?(A.scaleResolutionDownBy=1,A.maxFramerate=Math.floor(30/O)):A.scaleResolutionDownBy=O,T.sendEncodings.push(A);if(V=this.pc.addTransceiver(g,T),g.kind!=="video")return[3,5];if(B=V.sender.getParameters(),j=!1,!((e=B.degradationPreference)===null||e===void 0)&&e.length||(["detail","text"].includes(g.contentHint)?B.degradationPreference="maintain-resolution":B.degradationPreference="balanced",n.info("[createOffer] Video sender Degradation Preference set: ".concat(B.degradationPreference)),j=!0),this.configuration.simulcast&&((l=B.encodings)===null||l===void 0?void 0:l.length)!==T.sendEncodings.length&&(B.encodings=T.sendEncodings,j=!0),!j)return[3,5];n.debug("[createOffer] Setting new RTCRtpSendParameters to video sender"),K.label=2;case 2:return K.trys.push([2,4,,5]),[4,V.sender.setParameters(B)];case 3:return K.sent(),[3,5];case 4:throw $=K.sent(),Q="[WebRtcPeer.createOffer] Cannot set RTCRtpSendParameters to video sender",$ instanceof Error&&(Q+=": ".concat($.message)),new Error(Q);case 5:return I++,[3,1];case 6:return[3,8];case 7:for(F=0,G=["audio","video"];F<G.length;F++)M=G[F],this.configuration.mediaConstraints[M]&&(this.configuration.mediaStream=new MediaStream,this.pc.addTransceiver(M,{direction:this.configuration.mode,streams:[this.configuration.mediaStream]}));K.label=8;case 8:return K.trys.push([8,10,,11]),[4,this.pc.createOffer()];case 9:return z=K.sent(),[3,11];case 10:throw H=K.sent(),Q="[WebRtcPeer.createOffer] Browser failed creating an SDP Offer",H instanceof Error&&(Q+=": ".concat(H.message)),new Error(Q);case 11:return[2,z]}})})},P.prototype.deprecatedPeerConnectionTrackApi=function(){for(var v=0,u=this.configuration.mediaStream.getTracks();v<u.length;v++){var s=u[v];this.pc.addTrack(s,this.configuration.mediaStream)}},P.prototype.createAnswer=function(){var v=this;return new Promise(function(u,s){if("getTransceivers"in v.pc){n.debug("[createAnswer] Method RTCPeerConnection.getTransceivers() is available; using it");for(var C=function(T){if(!v.configuration.mediaConstraints[T])return"continue";var L=v.pc.getTransceivers().find(function(D){return D.receiver.track.kind===T});if(L)L.direction=v.configuration.mode;else return{value:s(new Error("".concat(T," requested, but no transceiver was created from remote description")))}},x=0,b=["audio","video"];x<b.length;x++){var e=b[x],l=C(e);if(typeof l=="object")return l.value}v.pc.createAnswer().then(function(T){return u(T)}).catch(function(T){return s(T)})}else{var I=void 0,t=!0;if(v.configuration.mediaConstraints){I=typeof v.configuration.mediaConstraints.audio=="boolean"?v.configuration.mediaConstraints.audio:!0,t=typeof v.configuration.mediaConstraints.video=="boolean"?v.configuration.mediaConstraints.video:!0;var g={offerToReceiveAudio:I,offerToReceiveVideo:t};v.pc.createAnswer(g).then(function(T){return u(T)}).catch(function(T){return s(T)})}}})},P.prototype.processLocalOffer=function(v){var u=this;return new Promise(function(s,C){u.pc.setLocalDescription(v).then(function(){var x=u.pc.localDescription;return x?(n.debug("Local description set",x.sdp),s()):C("Local description is not defined")}).catch(function(x){return C(x)})})},P.prototype.processRemoteOffer=function(v){var u=this;return new Promise(function(s,C){var x={type:"offer",sdp:v};if(n.debug("SDP offer received, setting remote description",x),u.pc.signalingState==="closed")return C("RTCPeerConnection is closed when trying to set remote description");u.setRemoteDescription(x).then(function(){return s()}).catch(function(b){return C(b)})})},P.prototype.processLocalAnswer=function(v){var u=this;return new Promise(function(s,C){if(n.debug("SDP answer created, setting local description"),u.pc.signalingState==="closed")return C("RTCPeerConnection is closed when trying to set local description");u.pc.setLocalDescription(v).then(function(){return s()}).catch(function(x){return C(x)})})},P.prototype.processRemoteAnswer=function(v){var u=this;return new Promise(function(s,C){var x={type:"answer",sdp:v};if(n.debug("SDP answer received, setting remote description"),u.pc.signalingState==="closed")return C("RTCPeerConnection is closed when trying to set remote description");u.setRemoteDescription(x).then(function(){s()}).catch(function(b){return C(b)})})},P.prototype.setRemoteDescription=function(v){return y(this,void 0,void 0,function(){return f(this,function(u){return[2,this.pc.setRemoteDescription(v)]})})},P.prototype.addIceCandidate=function(v){var u=this;return new Promise(function(s,C){switch(n.debug("Remote ICE candidate received",v),u.remoteCandidatesQueue.push(v),u.pc.signalingState){case"closed":C(new Error("PeerConnection object is closed"));break;case"stable":u.pc.remoteDescription?u.pc.addIceCandidate(v).then(function(){return s()}).catch(function(x){return C(x)}):(u.iceCandidateList.push(v),s());break;default:u.iceCandidateList.push(v),s()}})},P.prototype.addIceConnectionStateChangeListener=function(v){var u=this;this.pc.addEventListener("iceconnectionstatechange",function(){var s=u.pc.iceConnectionState;switch(s){case"disconnected":var C="IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "disconnected". Possible network disconnection';n.warn(C),u.configuration.onIceConnectionStateException(o.ExceptionEventName.ICE_CONNECTION_DISCONNECTED,C);break;case"failed":var x="IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') to "failed"';n.error(x),u.configuration.onIceConnectionStateException(o.ExceptionEventName.ICE_CONNECTION_FAILED,x);break;case"closed":n.log("IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "closed"');break;case"new":n.log("IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "new"');break;case"checking":n.log("IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "checking"');break;case"connected":n.log("IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "connected"');break;case"completed":n.log("IceConnectionState of RTCPeerConnection "+u.configuration.id+" ("+v+') change to "completed"');break}})},P.prototype.generateUniqueId=function(){return(0,c.v4)()},P}();ne.WebRtcPeer=E;var w=function(P){p(v,P);function v(u){return u.mode="recvonly",P.call(this,u)||this}return v}(E);ne.WebRtcPeerRecvonly=w;var _=function(P){p(v,P);function v(u){return u.mode="sendonly",P.call(this,u)||this}return v}(E);ne.WebRtcPeerSendonly=_;var h=function(P){p(v,P);function v(u){return u.mode="sendrecv",P.call(this,u)||this}return v}(E);return ne.WebRtcPeerSendrecv=h,ne}var pe={},Kn;function Ai(){if(Kn)return pe;Kn=1;var p=pe&&pe.__awaiter||function(a,i,n,E){function w(_){return _ instanceof n?_:new n(function(h){h(_)})}return new(n||(n=Promise))(function(_,h){function P(s){try{u(E.next(s))}catch(C){h(C)}}function v(s){try{u(E.throw(s))}catch(C){h(C)}}function u(s){s.done?_(s.value):w(s.value).then(P,v)}u((E=E.apply(a,i||[])).next())})},k=pe&&pe.__generator||function(a,i){var n={label:0,sent:function(){if(_[0]&1)throw _[1];return _[1]},trys:[],ops:[]},E,w,_,h;return h={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function P(u){return function(s){return v([u,s])}}function v(u){if(E)throw new TypeError("Generator is already executing.");for(;h&&(h=0,u[0]&&(n=0)),n;)try{if(E=1,w&&(_=u[0]&2?w.return:u[0]?w.throw||((_=w.return)&&_.call(w),0):w.next)&&!(_=_.call(w,u[1])).done)return _;switch(w=0,_&&(u=[u[0]&2,_.value]),u[0]){case 0:case 1:_=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,w=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(_=n.trys,!(_=_.length>0&&_[_.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!_||u[1]>_[0]&&u[1]<_[3])){n.label=u[1];break}if(u[0]===6&&n.label<_[1]){n.label=_[1],_=u;break}if(_&&n.label<_[2]){n.label=_[2],n.ops.push(u);break}_[2]&&n.ops.pop(),n.trys.pop();continue}u=i.call(a,n)}catch(s){u=[6,s],w=0}finally{E=_=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(pe,"__esModule",{value:!0}),pe.WebRtcStats=void 0;var y=oe(),f=me(),d=y.OpenViduLogger.getInstance(),c,o=function(){function a(i){this.stream=i,this.STATS_ITEM_NAME="webrtc-stats-config",this.webRtcStatsEnabled=!1,this.statsInterval=1,c=f.PlatformUtils.getInstance()}return a.prototype.isEnabled=function(){return this.webRtcStatsEnabled},a.prototype.initWebRtcStats=function(){var i=this,n;try{n=localStorage.getItem(this.STATS_ITEM_NAME)}catch{}if(n){this.webRtcStatsEnabled=!0;var E=JSON.parse(n);d.warn("WebRtc stats enabled for stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId),d.warn("localStorage item: "+JSON.stringify(E)),this.POST_URL=E.httpEndpoint,this.statsInterval=E.interval,this.webRtcStatsIntervalId=setInterval(function(){return p(i,void 0,void 0,function(){return k(this,function(w){switch(w.label){case 0:return[4,this.sendStatsToHttpEndpoint()];case 1:return w.sent(),[2]}})})},this.statsInterval*1e3)}else d.debug("WebRtc stats not enabled")},a.prototype.getSelectedIceCandidateInfo=function(){var i=this;return new Promise(function(n,E){return p(i,void 0,void 0,function(){var w,_,h,P,v,u,s,C,x,b,e,l,I,t,D,r,g,T,R,L,D,r,S,N,R;return k(this,function(m){switch(m.label){case 0:return[4,this.stream.getRTCPeerConnection().getStats()];case 1:if(w=m.sent(),h=new Map,P=new Map,v=new Map,w.forEach(function(O){switch(O.type==="transport"&&(c.isChromium()||c.isSafariBrowser()||c.isReactNative())&&(_=O),O.type){case"candidate-pair":h.set(O.id,O);break;case"local-candidate":P.set(O.id,O);break;case"remote-candidate":v.set(O.id,O);break}}),_!=null)s=_.selectedCandidatePairId,u=h.get(s);else for(C=h.size,x=h.values(),b=0;b<C;b++)if(e=x.next().value,e.selected){u=e;break}if(l=u.localCandidateId,I=u.remoteCandidateId,t=P.get(l),t)for(D=this.stream.getLocalIceCandidateList(),r=D.filter(function(O){return!!O.candidate&&(O.candidate.indexOf(t.ip)>=0||O.candidate.indexOf(t.address)>=0)&&O.candidate.indexOf(t.port)>=0}),t.raw=[],g=0,T=r;g<T.length;g++)R=T[g],t.raw.push(R.candidate);else t="ERROR: No active local ICE candidate. Probably ICE-TCP is being used";if(L=v.get(I),L)for(D=this.stream.getRemoteIceCandidateList(),r=D.filter(function(O){return!!O.candidate&&(O.candidate.indexOf(L.ip)>=0||O.candidate.indexOf(L.address)>=0)&&O.candidate.indexOf(L.port)>=0}),L.raw=[],S=0,N=r;S<N.length;S++)R=N[S],L.raw.push(R.candidate);else L="ERROR: No active remote ICE candidate. Probably ICE-TCP is being used";return[2,n({localCandidate:t,remoteCandidate:L})]}})})})},a.prototype.stopWebRtcStats=function(){this.webRtcStatsEnabled&&(clearInterval(this.webRtcStatsIntervalId),d.warn("WebRtc stats stopped for disposed stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId))},a.prototype.sendStats=function(i,n){return p(this,void 0,void 0,function(){var E,w;return k(this,function(_){switch(_.label){case 0:return _.trys.push([0,2,,3]),E={headers:{"Content-type":"application/json"},body:JSON.stringify(n),method:"POST"},[4,fetch(i,E)];case 1:return _.sent(),[3,3];case 2:return w=_.sent(),d.error("sendStats error: ".concat(JSON.stringify(w))),[3,3];case 3:return[2]}})})},a.prototype.sendStatsToHttpEndpoint=function(){return p(this,void 0,void 0,function(){var i,n,E;return k(this,function(w){switch(w.label){case 0:return w.trys.push([0,3,,4]),[4,this.getCommonStats()];case 1:return i=w.sent(),n=this.generateJSONStatsResponse(i),[4,this.sendStats(this.POST_URL,n)];case 2:return w.sent(),[3,4];case 3:return E=w.sent(),d.log(E),[3,4];case 4:return[2]}})})},a.prototype.getCommonStats=function(){return p(this,void 0,void 0,function(){var i=this;return k(this,function(n){return[2,new Promise(function(E,w){return p(i,void 0,void 0,function(){var _,h,P,v,u,s=this;return k(this,function(C){switch(C.label){case 0:return C.trys.push([0,2,,3]),[4,this.stream.getRTCPeerConnection().getStats()];case 1:return _=C.sent(),h=this.getWebRtcStatsResponseOutline(),P=["framesReceived","framesDropped","framesSent","frameHeight","frameWidth"],v=["availableOutgoingBitrate","currentRoundTripTime"],_.forEach(function(x){var b=x.mediaType!=null?x.mediaType:x.kind,e=function(l,I){x[I]!=null&&h[l]!=null&&(!b&&P.indexOf(I)>-1&&(b="video"),l!=null&&b!=null&&I!=null&&h[l][b]!=null?h[l][b][I]=Number(x[I]):l!=null&&I!=null&&v.includes(I)&&(h[l][I]=Number(x[I])))};switch(x.type){case"outbound-rtp":e("outbound","bytesSent"),e("outbound","packetsSent"),e("outbound","framesEncoded"),e("outbound","nackCount"),e("outbound","firCount"),e("outbound","pliCount"),e("outbound","qpSum");break;case"inbound-rtp":e("inbound","bytesReceived"),e("inbound","packetsReceived"),e("inbound","packetsLost"),e("inbound","jitter"),e("inbound","framesDecoded"),e("inbound","nackCount"),e("inbound","firCount"),e("inbound","pliCount");break;case"track":e("inbound","jitterBufferDelay"),e("inbound","framesReceived"),e("outbound","framesDropped"),e("outbound","framesSent"),e(s.stream.isLocal()?"outbound":"inbound","frameHeight"),e(s.stream.isLocal()?"outbound":"inbound","frameWidth");break;case"candidate-pair":e("candidatepair","currentRoundTripTime"),e("candidatepair","availableOutgoingBitrate");break}}),(!(h!=null&&h.candidatepair)||Object.keys(h.candidatepair).length===0)&&delete h.candidatepair,[2,E(h)];case 2:return u=C.sent(),d.error("Error getting common stats: ",u),[2,w(u)];case 3:return[2]}})})})]})})},a.prototype.generateJSONStatsResponse=function(i){return{"@timestamp":new Date().toISOString(),participant_id:this.stream.connection.data,session_id:this.stream.session.sessionId,platform:c.getName(),platform_description:c.getDescription(),stream:"webRTC",webrtc_stats:i}},a.prototype.getWebRtcStatsResponseOutline=function(){return this.stream.isLocal()?{outbound:{audio:{},video:{}},candidatepair:{}}:{inbound:{audio:{},video:{}}}},a}();return pe.WebRtcStats=o,pe}var Oe={},Yn;function Xr(){if(Yn)return Oe;Yn=1;var p=Oe&&Oe.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.PublisherSpeakingEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a,i){var n=f.call(this,!1,c,o)||this;return n.type=o,n.connection=a,n.streamId=i,n}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return Oe.PublisherSpeakingEvent=y,Oe}var Tt={},Qn;function Zt(){return Qn||(Qn=1,function(p){Object.defineProperty(p,"__esModule",{value:!0}),p.TypeOfVideo=void 0,function(k){k.CAMERA="CAMERA",k.SCREEN="SCREEN",k.CUSTOM="CUSTOM",k.IPCAM="IPCAM"}(p.TypeOfVideo||(p.TypeOfVideo={}))}(Tt)),Tt}var kt,Zn;function Vi(){if(Zn)return kt;Zn=1,kt=p;function p(){}return p.mixin=function(k){var y=k.prototype||k;y.isWildEmitter=!0,y.on=function(f,d,c){this.callbacks=this.callbacks||{};var o=arguments.length===3,a=o?arguments[1]:void 0,i=o?arguments[2]:arguments[1];return i._groupName=a,(this.callbacks[f]=this.callbacks[f]||[]).push(i),this},y.once=function(f,d,c){var o=this,a=arguments.length===3,i=a?arguments[1]:void 0,n=a?arguments[2]:arguments[1];function E(){o.off(f,E),n.apply(this,arguments)}return this.on(f,i,E),this},y.releaseGroup=function(f){this.callbacks=this.callbacks||{};var d,c,o,a;for(d in this.callbacks)for(a=this.callbacks[d],c=0,o=a.length;c<o;c++)a[c]._groupName===f&&(a.splice(c,1),c--,o--);return this},y.off=function(f,d){this.callbacks=this.callbacks||{};var c=this.callbacks[f],o;return c?arguments.length===1?(delete this.callbacks[f],this):(o=c.indexOf(d),o!==-1&&(c.splice(o,1),c.length===0&&delete this.callbacks[f]),this):this},y.emit=function(f){this.callbacks=this.callbacks||{};var d=[].slice.call(arguments,1),c=this.callbacks[f],o=this.getWildcardCallbacks(f),a,i,n;if(c)for(n=c.slice(),a=0,i=n.length;a<i&&n[a];++a)n[a].apply(this,d);if(o)for(i=o.length,n=o.slice(),a=0,i=n.length;a<i&&n[a];++a)n[a].apply(this,[f].concat(d));return this},y.getWildcardCallbacks=function(f){this.callbacks=this.callbacks||{};var d,c,o=[];for(d in this.callbacks)c=d.split("*"),(d==="*"||c.length===2&&f.slice(0,c[0].length)===c[0])&&(o=o.concat(this.callbacks[d]));return o}},p.mixin(p),kt}var xt,er;function Di(){if(er)return xt;er=1;var p=Vi();function k(d,c){var o=-1/0;d.getFloatFrequencyData(c);for(var a=4,i=c.length;a<i;a++)c[a]>o&&c[a]<0&&(o=c[a]);return o}var y;typeof window<"u"&&(y=window.AudioContext||window.webkitAudioContext);var f=null;return xt=function(d,a){var o=new p;if(!y)return o;var a=a||{},i=a.smoothing||.1,n=a.interval||50,E=a.threshold,w=a.play,_=a.history||10,h=!0;f=a.audioContext||f||new y;var P,v,u;u=f.createAnalyser(),u.fftSize=512,u.smoothingTimeConstant=i,v=new Float32Array(u.frequencyBinCount),d.jquery&&(d=d[0]),d instanceof HTMLAudioElement||d instanceof HTMLVideoElement?(P=f.createMediaElementSource(d),typeof w>"u"&&(w=!0),E=E||-50):(P=f.createMediaStreamSource(d),E=E||-50),P.connect(u),w&&u.connect(f.destination),o.speaking=!1,o.suspend=function(){return f.suspend()},o.resume=function(){return f.resume()},Object.defineProperty(o,"state",{get:function(){return f.state}}),f.onstatechange=function(){o.emit("state_change",f.state)},o.setThreshold=function(x){E=x},o.setInterval=function(x){n=x},o.stop=function(){h=!1,o.emit("volume_change",-100,E),o.speaking&&(o.speaking=!1,o.emit("stopped_speaking")),u.disconnect(),P.disconnect()},o.speakingHistory=[];for(var s=0;s<_;s++)o.speakingHistory.push(0);var C=function(){setTimeout(function(){if(h){var x=k(u,v);o.emit("volume_change",x,E);var b=0;if(x>E&&!o.speaking){for(var e=o.speakingHistory.length-3;e<o.speakingHistory.length;e++)b+=o.speakingHistory[e];b>=2&&(o.speaking=!0,o.emit("speaking"))}else if(x<E&&o.speaking){for(var e=0;e<o.speakingHistory.length;e++)b+=o.speakingHistory[e];b==0&&(o.speaking=!1,o.emit("stopped_speaking"))}o.speakingHistory.shift(),o.speakingHistory.push(0+(x>E)),C()}},n)};return C(),o},xt}var tr;function en(){if(tr)return he;tr=1;var p=he&&he.__awaiter||function(b,e,l,I){function t(g){return g instanceof l?g:new l(function(T){T(g)})}return new(l||(l=Promise))(function(g,T){function L(S){try{r(I.next(S))}catch(N){T(N)}}function D(S){try{r(I.throw(S))}catch(N){T(N)}}function r(S){S.done?g(S.value):t(S.value).then(L,D)}r((I=I.apply(b,e||[])).next())})},k=he&&he.__generator||function(b,e){var l={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},I,t,g,T;return T={next:L(0),throw:L(1),return:L(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function L(r){return function(S){return D([r,S])}}function D(r){if(I)throw new TypeError("Generator is already executing.");for(;T&&(T=0,r[0]&&(l=0)),l;)try{if(I=1,t&&(g=r[0]&2?t.return:r[0]?t.throw||((g=t.return)&&g.call(t),0):t.next)&&!(g=g.call(t,r[1])).done)return g;switch(t=0,g&&(r=[r[0]&2,g.value]),r[0]){case 0:case 1:g=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,t=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(g=l.trys,!(g=g.length>0&&g[g.length-1])&&(r[0]===6||r[0]===2)){l=0;continue}if(r[0]===3&&(!g||r[1]>g[0]&&r[1]<g[3])){l.label=r[1];break}if(r[0]===6&&l.label<g[1]){l.label=g[1],g=r;break}if(g&&l.label<g[2]){l.label=g[2],l.ops.push(r);break}g[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(b,l)}catch(S){r=[6,S],t=0}finally{I=g=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(he,"__esModule",{value:!0}),he.Stream=void 0;var y=zt(),f=Qt(),d=Mi(),c=Ai(),o=De(),a=Xr(),i=Kt(),n=Ae(),E=Ve(),w=Zt(),_=oe(),h=me(),P=zr(),v=Di(),u=Xt(),s=_.OpenViduLogger.getInstance(),C,x=function(){function b(e,l){var I=this;this.isSubscribeToRemote=!1,this.isLocalStreamReadyToPublish=!1,this.isLocalStreamPublished=!1,this.publishedOnce=!1,this.harkSpeakingEnabled=!1,this.harkSpeakingEnabledOnce=!1,this.harkStoppedSpeakingEnabled=!1,this.harkStoppedSpeakingEnabledOnce=!1,this.harkVolumeChangeEnabled=!1,this.harkVolumeChangeEnabledOnce=!1,this.ee=new u,C=h.PlatformUtils.getInstance(),this.session=e,l.hasOwnProperty("id")?(this.inboundStreamOpts=l,this.streamId=this.inboundStreamOpts.id,this.creationTime=this.inboundStreamOpts.createdAt,this.hasAudio=this.inboundStreamOpts.hasAudio,this.hasVideo=this.inboundStreamOpts.hasVideo,this.hasAudio&&(this.audioActive=this.inboundStreamOpts.audioActive),this.hasVideo&&(this.videoActive=this.inboundStreamOpts.videoActive,this.typeOfVideo=this.inboundStreamOpts.typeOfVideo?this.inboundStreamOpts.typeOfVideo:void 0,this.frameRate=this.inboundStreamOpts.frameRate===-1?void 0:this.inboundStreamOpts.frameRate,this.videoDimensions=this.inboundStreamOpts.videoDimensions),this.inboundStreamOpts.filter&&Object.keys(this.inboundStreamOpts.filter).length>0&&(this.inboundStreamOpts.filter.lastExecMethod&&Object.keys(this.inboundStreamOpts.filter.lastExecMethod).length===0&&delete this.inboundStreamOpts.filter.lastExecMethod,this.filter=this.inboundStreamOpts.filter)):(this.outboundStreamOpts=l,this.hasAudio=this.isSendAudio(),this.hasVideo=this.isSendVideo(),this.hasAudio&&(this.audioActive=!!this.outboundStreamOpts.publisherProperties.publishAudio),this.hasVideo&&(this.videoActive=!!this.outboundStreamOpts.publisherProperties.publishVideo,this.frameRate=this.outboundStreamOpts.publisherProperties.frameRate,typeof MediaStreamTrack<"u"&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?this.typeOfVideo=w.TypeOfVideo.CUSTOM:this.typeOfVideo=this.isSendScreen()?w.TypeOfVideo.SCREEN:w.TypeOfVideo.CAMERA),this.outboundStreamOpts.publisherProperties.filter&&(this.filter=this.outboundStreamOpts.publisherProperties.filter)),this.ee.on("mediastream-updated",function(){var t;I.streamManager.updateMediaStream(I.mediaStream),s.debug("Video srcObject ["+((t=I.mediaStream)===null||t===void 0?void 0:t.id)+"] updated in stream ["+I.streamId+"]")})}return b.prototype.reconnect=function(){return this.reconnectStream("API")},b.prototype.applyFilter=function(e,l){var I=this;return new Promise(function(t,g){return p(I,void 0,void 0,function(){var T,L,D,r,S,N,R=this;return k(this,function(m){if(this.filter)return[2,g(new E.OpenViduError(E.OpenViduErrorName.GENERIC_ERROR,"There is already a filter applied to Stream "+this.streamId))];if(T=function(O,A){if(O)return s.error("Error applying filter for Stream "+R.streamId,O),O.code===401?g(new E.OpenViduError(E.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to apply a filter")):g(O);s.info("Filter successfully applied on Stream "+R.streamId);var V=R.filter;return R.filter=new y.Filter(e,l),R.filter.stream=R,A&&(R.session.emitEvent("streamPropertyChanged",[new n.StreamPropertyChangedEvent(R.session,R,"filter",R.filter,V,"applyFilter")]),R.streamManager.emitEvent("streamPropertyChanged",[new n.StreamPropertyChangedEvent(R.streamManager,R,"filter",R.filter,V,"applyFilter")])),t(R.filter)},e.startsWith("VB:")){if(!this.hasVideo)return[2,g(new E.OpenViduError(E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"The Virtual Background filter requires a video track to be applied"))];if(!this.mediaStream||this.streamManager.videos.length===0)return[2,g(new E.OpenViduError(E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"The StreamManager requires some video element to be attached to it in order to apply a Virtual Background filter"))];if(this.session.token?L=this.session.token:L=l.token,!L)return[2,g(new E.OpenViduError(E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,'Virtual Background requires the client to be connected to a Session or to have a "token" property available in "options" parameter with a valid OpenVidu token'))];if(D=this.session.getTokenParams(L),D.edition!=="pro"&&D.edition!=="enterprise")return[2,g(new E.OpenViduError(E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"OpenVidu Virtual Background API is available from OpenVidu Pro edition onwards"))];L=encodeURIComponent(btoa(L)),s.info("Applying Virtual Background to stream "+this.streamId),r=function(){return p(R,void 0,void 0,function(){var O,A,V,B,j,$,F;return k(this,function(G){switch(G.label){case 0:return G.trys.push([0,8,,9]),O=this.streamId+"_"+(0,P.v4)(),A=this.mediaStream.clone(),V=this.streamManager.videos[0].video.cloneNode(!1),V.id=VirtualBackground.VirtualBackground.SOURCE_VIDEO_PREFIX+O,V.srcObject=A,V.muted=!0,this.virtualBackgroundSourceElements={videoClone:V,mediaStreamClone:A},VirtualBackground.VirtualBackground.hideHtmlElement(V,!1),VirtualBackground.VirtualBackground.appendHtmlElementToHiddenContainer(V,O),[4,V.play()];case 1:switch(G.sent(),B=new VirtualBackground.VirtualBackground({id:O,openviduServerUrl:new URL(D.httpUri),openviduToken:L,inputVideo:V,inputResolution:"160x96",outputFramerate:24}),j=void 0,$=e,$){case"VB:blur":return[3,2];case"VB:image":return[3,4]}return[3,6];case 2:return[4,B.backgroundBlur(l)];case 3:return j=G.sent(),[3,7];case 4:return[4,B.backgroundImage(l)];case 5:return j=G.sent(),[3,7];case 6:throw new Error("Unknown Virtual Background filter: "+e);case 7:return this.virtualBackgroundSinkElements={VB:B,video:j},V.style.display="none",this.streamManager.remote?this.streamManager.replaceTrackInMediaStream(this.virtualBackgroundSinkElements.video.srcObject.getVideoTracks()[0],!1):this.streamManager.replaceTrackAux(this.virtualBackgroundSinkElements.video.srcObject.getVideoTracks()[0],!1),T(void 0,!1),[3,9];case 8:return F=G.sent(),F.name===E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR?T(new E.OpenViduError(E.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,F.message),!1):T(F,!1),[3,9];case 9:return[2]}})})},typeof VirtualBackground>"u"?(S=document.createElement("script"),S.type="text/javascript",S.src=D.httpUri+"/openvidu/virtual-background/openvidu-virtual-background.js?token="+L,S.onload=function(){return p(R,void 0,void 0,function(){var O;return k(this,function(A){switch(A.label){case 0:return A.trys.push([0,2,,3]),[4,r()];case 1:return A.sent(),t(new y.Filter(e,l)),[3,3];case 2:return O=A.sent(),g(O),[3,3];case 3:return[2]}})})},document.body.appendChild(S)):r().then(function(){return t(new y.Filter(e,l))}).catch(function(O){return g(O)})}else{if(!this.session.sessionConnected())return[2,g(this.session.notConnectedError())];s.info("Applying server filter to stream "+this.streamId),l=l??{},N=l,typeof N!="string"&&(N=JSON.stringify(N)),this.session.openvidu.sendRequest("applyFilter",{streamId:this.streamId,type:e,options:N},function(O,A){T(O,!0)})}return[2]})})})},b.prototype.removeFilter=function(){return p(this,void 0,void 0,function(){return k(this,function(e){switch(e.label){case 0:return[4,this.removeFilterAux(!1)];case 1:return[2,e.sent()]}})})},b.prototype.getRTCPeerConnection=function(){return this.webRtcPeer.pc},b.prototype.getMediaStream=function(){return this.mediaStream},b.prototype.removeFilterAux=function(e){var l=this;return new Promise(function(I,t){return p(l,void 0,void 0,function(){var g,T,L,D=this,r;return k(this,function(S){switch(S.label){case 0:if(g=function(N,R){if(N)return delete D.filter,s.error("Error removing filter for Stream "+D.streamId,N),N.code===401?t(new E.OpenViduError(E.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to remove a filter")):t(N);s.info("Filter successfully removed from Stream "+D.streamId);var m=D.filter;return delete D.filter,R&&(D.session.emitEvent("streamPropertyChanged",[new n.StreamPropertyChangedEvent(D.session,D,"filter",D.filter,m,"applyFilter")]),D.streamManager.emitEvent("streamPropertyChanged",[new n.StreamPropertyChangedEvent(D.streamManager,D,"filter",D.filter,m,"applyFilter")])),I()},!this.filter)return[3,11];if(!(!((r=this.filter)===null||r===void 0)&&r.type.startsWith("VB:")))return[3,9];S.label=1;case 1:return S.trys.push([1,7,,8]),T=this.virtualBackgroundSourceElements.mediaStreamClone,e?[3,5]:this.streamManager.remote?(this.streamManager.replaceTrackInMediaStream(T.getVideoTracks()[0],!1),[3,4]):[3,2];case 2:return[4,this.streamManager.replaceTrackAux(T.getVideoTracks()[0],!1)];case 3:S.sent(),S.label=4;case 4:return[3,6];case 5:T.getTracks().forEach(function(N){return N.stop()}),S.label=6;case 6:return this.virtualBackgroundSinkElements.VB.cleanUp(),delete this.virtualBackgroundSinkElements,delete this.virtualBackgroundSourceElements,[2,g(void 0,!1)];case 7:return L=S.sent(),[2,g(L,!1)];case 8:return[3,10];case 9:if(!this.session.sessionConnected())return[2,t(this.session.notConnectedError())];s.info("Removing filter of stream "+this.streamId),this.session.openvidu.sendRequest("removeFilter",{streamId:this.streamId},function(N,R){return g(N,!0)}),S.label=10;case 10:return[3,12];case 11:return[2,t(new E.OpenViduError(E.OpenViduErrorName.GENERIC_ERROR,"Stream "+this.streamId+" has no filter applied"))];case 12:return[2]}})})})},b.prototype.setMediaStream=function(e){this.mediaStream=e},b.prototype.updateMediaStreamInVideos=function(){this.ee.emitEvent("mediastream-updated",[])},b.prototype.getWebRtcPeer=function(){return this.webRtcPeer},b.prototype.subscribeToMyRemote=function(e){this.isSubscribeToRemote=e},b.prototype.setOutboundStreamOptions=function(e){this.outboundStreamOpts=e},b.prototype.subscribe=function(){var e=this;return new Promise(function(l,I){e.initWebRtcPeerReceive(!1).then(function(){return l()}).catch(function(t){return I(t)})})},b.prototype.publish=function(){var e=this;return new Promise(function(l,I){e.isLocalStreamReadyToPublish?e.initWebRtcPeerSend(!1).then(function(){return l()}).catch(function(t){return I(t)}):e.ee.once("stream-ready-to-publish",function(){e.publish().then(function(){return l()}).catch(function(t){return I(t)})})})},b.prototype.disposeWebRtcPeer=function(){var e;this.webRtcPeer&&(this.webRtcPeer.dispose(),e=this.webRtcPeer.getId()),this.stopWebRtcStats(),s.info((this.outboundStreamOpts?"Outbound ":"Inbound ")+"RTCPeerConnection with id ["+e+"] from 'Stream' with id ["+this.streamId+"] is now closed")},b.prototype.disposeMediaStream=function(){return p(this,void 0,void 0,function(){var e;return k(this,function(l){switch(l.label){case 0:if(!(this.filter&&this.filter.type.startsWith("VB:")))return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.removeFilterAux(!0)];case 2:return l.sent(),console.debug("Success removing Virtual Background filter for stream ".concat(this.streamId)),[3,4];case 3:return e=l.sent(),console.error("Error removing Virtual Background filter for stream ".concat(this.streamId),e),[3,4];case 4:return this.mediaStream&&(this.mediaStream.getAudioTracks().forEach(function(I){I.stop()}),this.mediaStream.getVideoTracks().forEach(function(I){I.stop()}),delete this.mediaStream),this.localMediaStreamWhenSubscribedToRemote&&(this.localMediaStreamWhenSubscribedToRemote.getAudioTracks().forEach(function(I){I.stop()}),this.localMediaStreamWhenSubscribedToRemote.getVideoTracks().forEach(function(I){I.stop()}),delete this.localMediaStreamWhenSubscribedToRemote),this.speechEvent&&(this.speechEvent.stop&&this.speechEvent.stop(),delete this.speechEvent),s.info((this.outboundStreamOpts?"Local ":"Remote ")+"MediaStream from 'Stream' with id ["+this.streamId+"] is now disposed"),[2]}})})},b.prototype.displayMyRemote=function(){return this.isSubscribeToRemote},b.prototype.isSendAudio=function(){return!!this.outboundStreamOpts&&this.outboundStreamOpts.publisherProperties.audioSource!==null&&this.outboundStreamOpts.publisherProperties.audioSource!==!1},b.prototype.isSendVideo=function(){return!!this.outboundStreamOpts&&this.outboundStreamOpts.publisherProperties.videoSource!==null&&this.outboundStreamOpts.publisherProperties.videoSource!==!1},b.prototype.isSendScreen=function(){var e=!1;if(typeof MediaStreamTrack<"u"&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack){var l=this.outboundStreamOpts.publisherProperties.videoSource.getSettings();l.displaySurface&&(e=["monitor","window","browser"].includes(l.displaySurface))}return!e&&C.isElectron()&&(e=typeof this.outboundStreamOpts.publisherProperties.videoSource=="string"&&this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")),e||(e=this.outboundStreamOpts.publisherProperties.videoSource==="screen"),!!this.outboundStreamOpts&&e},b.prototype.enableHarkSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkSpeakingEnabled&&this.speechEvent&&(this.harkSpeakingEnabled=!0,this.speechEvent.on("speaking",function(){e.session.emitEvent("publisherStartSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStartSpeaking",[new a.PublisherSpeakingEvent(e.streamManager,"publisherStartSpeaking",e.connection,e.streamId)]),e.harkSpeakingEnabledOnce=!1}))},b.prototype.enableOnceHarkSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkSpeakingEnabledOnce&&this.speechEvent&&(this.harkSpeakingEnabledOnce=!0,this.speechEvent.once("speaking",function(){e.harkSpeakingEnabledOnce&&(e.session.emitEvent("publisherStartSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStartSpeaking",[new a.PublisherSpeakingEvent(e.streamManager,"publisherStartSpeaking",e.connection,e.streamId)])),e.disableHarkSpeakingEvent(!0)}))},b.prototype.disableHarkSpeakingEvent=function(e){if(this.speechEvent){if(this.harkSpeakingEnabledOnce=!1,e){if(this.harkSpeakingEnabled)return}else this.harkSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},b.prototype.enableHarkStoppedSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkStoppedSpeakingEnabled&&this.speechEvent&&(this.harkStoppedSpeakingEnabled=!0,this.speechEvent.on("stopped_speaking",function(){e.session.emitEvent("publisherStopSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStopSpeaking",[new a.PublisherSpeakingEvent(e.streamManager,"publisherStopSpeaking",e.connection,e.streamId)]),e.harkStoppedSpeakingEnabledOnce=!1}))},b.prototype.enableOnceHarkStoppedSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkStoppedSpeakingEnabledOnce&&this.speechEvent&&(this.harkStoppedSpeakingEnabledOnce=!0,this.speechEvent.once("stopped_speaking",function(){e.harkStoppedSpeakingEnabledOnce&&(e.session.emitEvent("publisherStopSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStopSpeaking",[new a.PublisherSpeakingEvent(e.streamManager,"publisherStopSpeaking",e.connection,e.streamId)])),e.disableHarkStoppedSpeakingEvent(!0)}))},b.prototype.disableHarkStoppedSpeakingEvent=function(e){if(this.speechEvent){if(this.harkStoppedSpeakingEnabledOnce=!1,e){if(this.harkStoppedSpeakingEnabled)return}else this.harkStoppedSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce?this.speechEvent.off("stopped_speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},b.prototype.enableHarkVolumeChangeEvent=function(e){var l=this;this.setHarkListenerIfNotExists()?(!this.harkVolumeChangeEnabled||e)&&(this.harkVolumeChangeEnabled=!0,this.speechEvent.on("volume_change",function(I){var t=l.speechEvent.oldVolumeValue,g={newValue:I,oldValue:t};l.speechEvent.oldVolumeValue=I,l.streamManager.emitEvent("streamAudioVolumeChange",[new i.StreamManagerEvent(l.streamManager,"streamAudioVolumeChange",g)])})):this.harkVolumeChangeEnabled=!0},b.prototype.enableOnceHarkVolumeChangeEvent=function(e){var l=this;this.setHarkListenerIfNotExists()?(!this.harkVolumeChangeEnabledOnce||e)&&(this.harkVolumeChangeEnabledOnce=!0,this.speechEvent.once("volume_change",function(I){var t=l.speechEvent.oldVolumeValue,g={newValue:I,oldValue:t};l.speechEvent.oldVolumeValue=I,l.disableHarkVolumeChangeEvent(!0),l.streamManager.emitEvent("streamAudioVolumeChange",[new i.StreamManagerEvent(l.streamManager,"streamAudioVolumeChange",g)])})):this.harkVolumeChangeEnabledOnce=!0},b.prototype.disableHarkVolumeChangeEvent=function(e){if(this.speechEvent){if(this.harkVolumeChangeEnabledOnce=!1,e){if(this.harkVolumeChangeEnabled)return}else this.harkVolumeChangeEnabled=!1;this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("volume_change"):(this.speechEvent.stop(),delete this.speechEvent)}},b.prototype.isLocal=function(){return!this.inboundStreamOpts&&!!this.outboundStreamOpts},b.prototype.getSelectedIceCandidate=function(){var e=this;return new Promise(function(l,I){e.webRtcStats.getSelectedIceCandidateInfo().then(function(t){return l(t)}).catch(function(t){return I(t)})})},b.prototype.getRemoteIceCandidateList=function(){return this.webRtcPeer.remoteCandidatesQueue},b.prototype.getLocalIceCandidateList=function(){return this.webRtcPeer.localCandidatesQueue},b.prototype.streamIceConnectionStateBroken=function(){if(!this.getWebRtcPeer()||!this.getRTCPeerConnection())return!1;if(this.session.openvidu.advancedConfiguration.forceMediaReconnectionAfterNetworkDrop)return s.warn('OpenVidu Browser advanced configuration option "forceMediaReconnectionAfterNetworkDrop" is enabled. Stream '.concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") will force a reconnection")),!0;var e=this.getRTCPeerConnection().iceConnectionState;return e!=="connected"&&e!=="completed"},b.prototype.setHarkListenerIfNotExists=function(){if(this.mediaStream){if(!this.speechEvent){var e=this.harkOptions?this.harkOptions:this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{};e.interval=typeof e.interval=="number"?e.interval:100,e.threshold=typeof e.threshold=="number"?e.threshold:-50,this.speechEvent=v(this.mediaStream,e)}return!0}return!1},b.prototype.setupReconnectionEventEmitter=function(e,l){return this.reconnectionEventEmitter==null?(this.reconnectionEventEmitter=new u,!1):(console.warn("Trying to reconnect stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") but an ongoing reconnection process is active. Waiting for response...")),this.reconnectionEventEmitter.once("success",function(){return e()}),this.reconnectionEventEmitter.once("error",function(I){return l(I)}),!0)},b.prototype.initWebRtcPeerSend=function(e){var l=this;return new Promise(function(I,t){var g;if(e){if(l.setupReconnectionEventEmitter(I,t))return}else l.initHarkEvents();var T=function(){var S;return e&&((S=l.reconnectionEventEmitter)===null||S===void 0||S.emitEvent("success"),delete l.reconnectionEventEmitter),I()},L=function(S){var N;return e&&((N=l.reconnectionEventEmitter)===null||N===void 0||N.emitEvent("error",[S]),delete l.reconnectionEventEmitter),t(S)},D=function(S){s.debug("Sending SDP offer to publish as "+l.streamId,S);var N=e?"reconnectStream":"publishVideo",R;if(e)R={stream:l.streamId,sdpString:S};else{var m=void 0;l.isSendVideo()&&(m=typeof MediaStreamTrack<"u"&&l.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?w.TypeOfVideo.CUSTOM:l.isSendScreen()?w.TypeOfVideo.SCREEN:w.TypeOfVideo.CAMERA),R={doLoopback:l.displayMyRemote()||!1,hasAudio:l.isSendAudio(),hasVideo:l.isSendVideo(),audioActive:l.audioActive,videoActive:l.videoActive,typeOfVideo:m,frameRate:l.frameRate?l.frameRate:-1,videoDimensions:JSON.stringify(l.videoDimensions),filter:l.outboundStreamOpts.publisherProperties.filter,sdpOffer:S}}l.session.openvidu.sendRequest(N,R,function(O,A){O?O.code===401?L(new E.OpenViduError(E.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to publish")):L("Error on publishVideo: "+JSON.stringify(O)):l.webRtcPeer.processRemoteAnswer(A.sdpAnswer).then(function(){l.streamId=A.id,l.creationTime=A.createdAt,l.isLocalStreamPublished=!0,l.publishedOnce=!0,l.displayMyRemote()&&(l.localMediaStreamWhenSubscribedToRemote=l.mediaStream,l.remotePeerSuccessfullyEstablished(e)),e?l.ee.emitEvent("stream-reconnected-by-publisher",[]):l.ee.emitEvent("stream-created-by-publisher",[]),l.initWebRtcStats(),s.info("'Publisher' ("+l.streamId+") successfully "+(e?"reconnected":"published")+" to session"),T()}).catch(function(V){L(V)})})},r={mediaConstraints:{audio:l.hasAudio,video:l.hasVideo},simulcast:(g=l.outboundStreamOpts.publisherProperties.videoSimulcast)!==null&&g!==void 0?g:l.session.openvidu.videoSimulcast,onIceCandidate:l.connection.sendIceCandidate.bind(l.connection),onIceConnectionStateException:l.onIceConnectionStateExceptionHandler.bind(l),iceServers:l.getIceServersConf(),rtcConfiguration:l.session.openvidu.advancedConfiguration.rtcConfiguration,mediaStream:l.mediaStream,mediaServer:l.session.openvidu.mediaServer,typeOfVideo:l.typeOfVideo?w.TypeOfVideo[l.typeOfVideo]:void 0};l.session.openvidu.mediaServer!=="mediasoup"&&(r.simulcast=!1),e&&l.disposeWebRtcPeer(),l.displayMyRemote()?l.webRtcPeer=new d.WebRtcPeerSendrecv(r):l.webRtcPeer=new d.WebRtcPeerSendonly(r),l.webRtcPeer.addIceConnectionStateChangeListener("publisher of "+l.connection.connectionId),l.webRtcPeer.createOffer().then(function(S){l.webRtcPeer.processLocalOffer(S).then(function(){D(S.sdp)}).catch(function(N){L(new Error("(publish) SDP process local offer error: "+JSON.stringify(N)))})}).catch(function(S){L(new Error("(publish) SDP create offer error: "+JSON.stringify(S)))})})},b.prototype.finalResolveForSubscription=function(e,l){var I;return s.info("'Subscriber' ("+this.streamId+") successfully "+(e?"reconnected":"subscribed")),this.remotePeerSuccessfullyEstablished(e),this.initWebRtcStats(),e&&((I=this.reconnectionEventEmitter)===null||I===void 0||I.emitEvent("success"),delete this.reconnectionEventEmitter),l()},b.prototype.finalRejectForSubscription=function(e,l,I){var t;return s.error("Error for 'Subscriber' ("+this.streamId+") while trying to "+(e?"reconnect":"subscribe")+": "+l.toString()),e&&((t=this.reconnectionEventEmitter)===null||t===void 0||t.emitEvent("error",[l]),delete this.reconnectionEventEmitter),I(l)},b.prototype.initWebRtcPeerReceive=function(e){var l=this;return new Promise(function(I,t){e&&l.setupReconnectionEventEmitter(I,t)||(l.session.openvidu.mediaServer==="mediasoup"?l.initWebRtcPeerReceiveFromServer(e).then(function(){return l.finalResolveForSubscription(e,I)}).catch(function(g){return l.finalRejectForSubscription(e,g,t)}):l.initWebRtcPeerReceiveFromClient(e).then(function(){return l.finalResolveForSubscription(e,I)}).catch(function(g){return l.finalRejectForSubscription(e,g,t)}))})},b.prototype.initWebRtcPeerReceiveFromClient=function(e){var l=this;return new Promise(function(I,t){l.completeWebRtcPeerReceive(e,!1).then(function(g){l.webRtcPeer.processRemoteAnswer(g.sdpAnswer).then(function(){return I()}).catch(function(T){return t(T)})}).catch(function(g){return t(g)})})},b.prototype.initWebRtcPeerReceiveFromServer=function(e){var l=this;return new Promise(function(I,t){l.session.openvidu.sendRequest("prepareReceiveVideoFrom",{sender:l.streamId,reconnect:e},function(g,T){if(g)return t(new Error("Error on prepareReceiveVideoFrom: "+JSON.stringify(g)));l.completeWebRtcPeerReceive(e,!1,T.sdpOffer).then(function(){return I()}).catch(function(L){return t(L)})})})},b.prototype.completeWebRtcPeerReceive=function(e,l,I){var t=this;return new Promise(function(g,T){s.debug("'Session.subscribe(Stream)' called");var L=function(r){s.debug("Sending local SDP ".concat(I?"answer":"offer"," to subscribe to ").concat(t.streamId),r);var S=e?"reconnectStream":"receiveVideoFrom",N={};N[e?"stream":"sender"]=t.streamId,I?N[e?"sdpString":"sdpAnswer"]=r:N.sdpOffer=r,e&&(N.forciblyReconnect=l),t.session.openvidu.sendRequest(S,N,function(R,m){return R?T(new Error("Error on "+S+" : "+JSON.stringify(R))):g(m)})},D={mediaConstraints:{audio:t.hasAudio,video:t.hasVideo},simulcast:!1,onIceCandidate:t.connection.sendIceCandidate.bind(t.connection),onIceConnectionStateException:t.onIceConnectionStateExceptionHandler.bind(t),iceServers:t.getIceServersConf(),rtcConfiguration:t.session.openvidu.advancedConfiguration.rtcConfiguration,mediaServer:t.session.openvidu.mediaServer,typeOfVideo:t.typeOfVideo?w.TypeOfVideo[t.typeOfVideo]:void 0};e&&t.disposeWebRtcPeer(),t.webRtcPeer=new d.WebRtcPeerRecvonly(D),t.webRtcPeer.addIceConnectionStateChangeListener(t.streamId),I?t.webRtcPeer.processRemoteOffer(I).then(function(){t.webRtcPeer.createAnswer().then(function(r){t.webRtcPeer.processLocalAnswer(r).then(function(){L(r.sdp)}).catch(function(S){return T(new Error("(subscribe) SDP process local answer error: "+JSON.stringify(S)))})}).catch(function(r){return T(new Error("(subscribe) SDP create answer error: "+JSON.stringify(r)))})}).catch(function(r){return T(new Error("(subscribe) SDP process remote offer error: "+JSON.stringify(r)))}):t.webRtcPeer.createOffer().then(function(r){t.webRtcPeer.processLocalOffer(r).then(function(){L(r.sdp)}).catch(function(S){return T(new Error("(subscribe) SDP process local offer error: "+JSON.stringify(S)))})}).catch(function(r){return T(new Error("(subscribe) SDP create offer error: "+JSON.stringify(r)))})})},b.prototype.remotePeerSuccessfullyEstablished=function(e){e&&this.mediaStream!=null&&this.disposeMediaStream(),this.mediaStream=new MediaStream;for(var l,I=0,t=this.webRtcPeer.pc.getReceivers();I<t.length;I++)l=t[I],l.track&&this.mediaStream.addTrack(l.track);if(s.debug("Peer remote stream",this.mediaStream),this.mediaStream){if(this.streamManager instanceof f.Subscriber){if(this.mediaStream.getAudioTracks()[0]){var g=e?this.audioActive:!!this.streamManager.properties.subscribeToAudio;this.mediaStream.getAudioTracks()[0].enabled=g}if(this.mediaStream.getVideoTracks()[0]){var g=e?this.videoActive:!!this.videoActive&&!!this.streamManager.properties.subscribeToVideo;this.mediaStream.getVideoTracks()[0].enabled=g}}this.updateMediaStreamInVideos(),this.initHarkEvents()}},b.prototype.initHarkEvents=function(){this.mediaStream.getAudioTracks()[0]&&(this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!0,this.streamManager)&&this.enableOnceHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.streamManager)&&this.enableHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!0,this.streamManager)&&this.enableOnceHarkStoppedSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.streamManager)&&this.enableHarkStoppedSpeakingEvent(),this.harkVolumeChangeEnabledOnce&&this.enableOnceHarkVolumeChangeEvent(!0),this.harkVolumeChangeEnabled&&this.enableHarkVolumeChangeEvent(!0))},b.prototype.onIceConnectionStateExceptionHandler=function(e,l,I){switch(e){case o.ExceptionEventName.ICE_CONNECTION_FAILED:this.onIceConnectionFailed();break;case o.ExceptionEventName.ICE_CONNECTION_DISCONNECTED:this.onIceConnectionDisconnected();break}this.session.emitEvent("exception",[new o.ExceptionEvent(this.session,e,this,l,I)])},b.prototype.onIceConnectionFailed=function(){s.log("[ICE_CONNECTION_FAILED] Handling ICE_CONNECTION_FAILED event. Reconnecting stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",")")),this.reconnectStreamAndLogResultingIceConnectionState(o.ExceptionEventName.ICE_CONNECTION_FAILED)},b.prototype.onIceConnectionDisconnected=function(){var e=this;s.log("[ICE_CONNECTION_DISCONNECTED] Handling ICE_CONNECTION_DISCONNECTED event. Waiting for ICE to be restored and reconnect stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") if not possible"));var l=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3;this.awaitWebRtcPeerConnectionState(l).then(function(I){switch(I){case"failed":s.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(e.streamId," (").concat(e.isLocal()?"Publisher":"Subscriber",") is now failed after ICE_CONNECTION_DISCONNECTED"));break;case"connected":case"completed":s.log("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(e.streamId," (").concat(e.isLocal()?"Publisher":"Subscriber",") automatically restored after ICE_CONNECTION_DISCONNECTED. Current ICE connection state: ").concat(I));break;case"closed":case"checking":case"new":case"disconnected":s.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(e.streamId," (").concat(e.isLocal()?"Publisher":"Subscriber",") couldn't be restored after ICE_CONNECTION_DISCONNECTED event. Current ICE connection state after ").concat(l," ms: ").concat(I)),e.reconnectStreamAndLogResultingIceConnectionState(o.ExceptionEventName.ICE_CONNECTION_DISCONNECTED);break}})},b.prototype.reconnectStreamAndLogResultingIceConnectionState=function(e){return p(this,void 0,void 0,function(){var l,I;return k(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.reconnectStreamAndReturnIceConnectionState(e)];case 1:switch(l=t.sent(),l){case"connected":case"completed":s.log("[".concat(e,"] Stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") successfully reconnected after ").concat(e,". Current ICE connection state: ").concat(l));break;default:s.error("[".concat(e,"] Stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") failed to reconnect after ").concat(e,". Current ICE connection state: ").concat(l));break}return[3,3];case 2:return I=t.sent(),s.error("[".concat(e,"] Error reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") after ").concat(e,": ").concat(I)),[3,3];case 3:return[2]}})})},b.prototype.reconnectStreamAndReturnIceConnectionState=function(e){return p(this,void 0,void 0,function(){var l,I;return k(this,function(t){switch(t.label){case 0:s.log("[".concat(e,"] Reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") after event ").concat(e)),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.reconnectStream(e)];case 2:return t.sent(),l=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3,[2,this.awaitWebRtcPeerConnectionState(l)];case 3:return I=t.sent(),s.warn("[".concat(e,"] Error reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber","). Reason: ").concat(I)),[2,this.awaitWebRtcPeerConnectionState(1)];case 4:return[2]}})})},b.prototype.awaitWebRtcPeerConnectionState=function(e){return p(this,void 0,void 0,function(){var l,I,t,g;return k(this,function(T){switch(T.label){case 0:l=this.getRTCPeerConnection().iceConnectionState,I=150,t=Math.ceil(e/I),g=0,T.label=1;case 1:return g<t?(l=this.getRTCPeerConnection().iceConnectionState,l==="connected"||l==="completed"?[3,4]:[4,new Promise(function(L){return setTimeout(L,I)})]):[3,4];case 2:T.sent(),T.label=3;case 3:return g++,[3,1];case 4:return[2,l]}})})},b.prototype.reconnectStream=function(e){return p(this,void 0,void 0,function(){var l,I;return k(this,function(t){switch(t.label){case 0:return[4,this.isWebsocketConnected(e,3e3)];case 1:if(l=t.sent(),l)return s.log("[".concat(e,"] Trying to reconnect stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") and the websocket is opened")),this.isLocal()?[2,this.initWebRtcPeerSend(!0)]:[2,this.initWebRtcPeerReceive(!0)];throw I="[".concat(e,"] Trying to reconnect stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") but the websocket wasn't opened"),s.error(I),Error(I)}})})},b.prototype.isWebsocketConnected=function(e,l){var I=this;return new Promise(function(t,g){var T=I.session.openvidu.getWsReadyState();if(T===1){var L=setTimeout(function(){return console.warn("[".concat(e,"] Websocket timeout of ").concat(l,"ms")),t(!1)},l);I.session.openvidu.sendRequest("echo",{},function(D,r){return clearTimeout(L),D?(console.warn("[".concat(e,"] Websocket 'echo' returned error: ").concat(D)),t(!1)):t(!0)})}else return console.warn("[".concat(e,"] Websocket readyState is ").concat(T)),t(!1)})},b.prototype.initWebRtcStats=function(){this.webRtcStats=new c.WebRtcStats(this),this.webRtcStats.initWebRtcStats()},b.prototype.stopWebRtcStats=function(){this.webRtcStats&&this.webRtcStats.isEnabled()&&this.webRtcStats.stopWebRtcStats()},b.prototype.getIceServersConf=function(){var e,l;return this.session.openvidu.advancedConfiguration.iceServers?l=this.session.openvidu.advancedConfiguration.iceServers==="freeice"?void 0:this.session.openvidu.advancedConfiguration.iceServers:!((e=this.session.openvidu.advancedConfiguration.rtcConfiguration)===null||e===void 0)&&e.iceServers?l=this.session.openvidu.advancedConfiguration.rtcConfiguration.iceServers:this.session.openvidu.iceServers?l=this.session.openvidu.iceServers:l=void 0,l},b.prototype.gatherStatsForPeer=function(){var e=this;return new Promise(function(l,I){e.isLocal()?e.getRTCPeerConnection().getSenders().forEach(function(t){return t.getStats().then(function(g){g.forEach(function(T){if(e.isReportWanted(T)){var L={};L.type=T.type,L.timestamp=T.timestamp,L.id=T.id,T.type==="outbound-rtp"&&(L.ssrc=T.ssrc,L.firCount=T.firCount,L.pliCount=T.pliCount,L.nackCount=T.nackCount,L.qpSum=T.qpSum,T.kind?L.mediaType=T.kind:T.mediaType?L.mediaType=T.mediaType:L.mediaType=T.id.indexOf("VideoStream")!==-1?"video":"audio",L.mediaType==="video"&&(L.framesEncoded=T.framesEncoded),L.packetsSent=T.packetsSent,L.bytesSent=T.bytesSent),T.type==="candidate-pair"&&T.totalRoundTripTime!==void 0&&(L.availableOutgoingBitrate=T.availableOutgoingBitrate,L.rtt=T.currentRoundTripTime,L.averageRtt=T.totalRoundTripTime/T.responsesReceived),T.type==="remote-inbound-rtp"||T.type,s.log(L)}})})}):e.getRTCPeerConnection().getReceivers().forEach(function(t){return t.getStats().then(function(g){g.forEach(function(T){if(e.isReportWanted(T)){var L={};L.type=T.type,L.timestamp=T.timestamp,L.id=T.id,T.type==="inbound-rtp"&&(L.ssrc=T.ssrc,L.firCount=T.firCount,L.pliCount=T.pliCount,L.nackCount=T.nackCount,L.qpSum=T.qpSum,T.kind?L.mediaType=T.kind:T.mediaType?L.mediaType=T.mediaType:L.mediaType=T.id.indexOf("VideoStream")!==-1?"video":"audio",L.mediaType==="video"&&(L.framesDecoded=T.framesDecoded),L.packetsReceived=T.packetsReceived,L.packetsLost=T.packetsLost,L.jitter=T.jitter,L.bytesReceived=T.bytesReceived),T.type==="candidate-pair"&&T.totalRoundTripTime!==void 0&&(L.availableIncomingBitrate=T.availableIncomingBitrate,L.rtt=T.currentRoundTripTime,L.averageRtt=T.totalRoundTripTime/T.responsesReceived),T.type==="remote-inbound-rtp"||T.type,s.log(L)}})})})})},b.prototype.isReportWanted=function(e){return e.type==="inbound-rtp"&&!this.isLocal()||e.type==="outbound-rtp"&&this.isLocal()||e.type==="candidate-pair"&&e.nominated&&e.bytesSent>0},b}();return he.Stream=x,he}var nr;function Jr(){if(nr)return We;nr=1,Object.defineProperty(We,"__esModule",{value:!0}),We.Connection=void 0;var p=en(),k=oe(),y=De(),f=k.OpenViduLogger.getInstance(),d=function(){function c(o,a){this.session=o,this.disposed=!1;var i="'Connection' created ";a.role?(this.localOptions=a,this.connectionId=this.localOptions.id,this.creationTime=this.localOptions.createdAt,this.data=this.localOptions.metadata,this.rpcSessionId=this.localOptions.sessionId,this.role=this.localOptions.role,this.record=this.localOptions.record,i+="(local)"):(this.remoteOptions=a,this.connectionId=this.remoteOptions.id,this.creationTime=this.remoteOptions.createdAt,this.remoteOptions.metadata&&(this.data=this.remoteOptions.metadata),this.remoteOptions.streams&&this.initRemoteStreams(this.remoteOptions.streams),i+="(remote) with 'connectionId' ["+this.remoteOptions.id+"]"),f.info(i)}return c.prototype.sendIceCandidate=function(o){var a=this;this.disposed?f.warn("Connection ".concat(this.connectionId," disposed when trying to send an ICE candidate. ICE candidate not sent")):(f.debug((this.stream.outboundStreamOpts?"Local":"Remote")+"candidate for"+this.connectionId,o),this.session.openvidu.sendRequest("onIceCandidate",{endpointName:this.connectionId,candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex},function(i,n){i&&(f.error("Error sending ICE candidate: "+JSON.stringify(i)),a.session.emitEvent("exception",[new y.ExceptionEvent(a.session,y.ExceptionEventName.ICE_CANDIDATE_ERROR,a.session,"There was an unexpected error on the server-side processing an ICE candidate generated and sent by the client-side",i)]))}))},c.prototype.initRemoteStreams=function(o){var a=this;o.forEach(function(i){var n={id:i.id,createdAt:i.createdAt,connection:a,hasAudio:i.hasAudio,hasVideo:i.hasVideo,audioActive:i.audioActive,videoActive:i.videoActive,typeOfVideo:i.typeOfVideo,frameRate:i.frameRate,videoDimensions:i.videoDimensions?JSON.parse(i.videoDimensions):void 0,filter:i.filter?i.filter:void 0},E=new p.Stream(a.session,n);a.addStream(E)}),f.info("Remote 'Connection' with 'connectionId' ["+this.connectionId+"] is now configured for receiving Streams with options: ",this.stream.inboundStreamOpts)},c.prototype.addStream=function(o){o.connection=this,this.stream=o},c.prototype.removeStream=function(){delete this.stream},c.prototype.dispose=function(){this.disposed=!0,this.removeStream()},c}();return We.Connection=d,We}var Re={},rr;function Kr(){if(rr)return Re;rr=1;var p=Re&&Re.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Re,"__esModule",{value:!0}),Re.ConnectionEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a,i,n){var E=f.call(this,c,o,a)||this;return E.connection=i,E.reason=n,E}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return Re.ConnectionEvent=y,Re}var Ce={},ir;function Yr(){if(ir)return Ce;ir=1;var p=Ce&&Ce.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.FilterEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a){var i=f.call(this,!1,c,o)||this;return i.data=a,i}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return Ce.FilterEvent=y,Ce}var _e={},or;function Qr(){if(or)return _e;or=1;var p=_e&&_e.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(_e,"__esModule",{value:!0}),_e.RecordingEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a,i,n){var E=f.call(this,!1,c,o)||this;return E.id=a,i!==a&&(E.name=i),E.reason=n,E}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return _e.RecordingEvent=y,_e}var Ie={},sr;function tn(){if(sr)return Ie;sr=1;var p=Ie&&Ie.__extends||function(){var c=function(o,a){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var E in n)Object.prototype.hasOwnProperty.call(n,E)&&(i[E]=n[E])},c(o,a)};return function(o,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");c(o,a);function i(){this.constructor=o}o.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.SessionDisconnectedEvent=void 0;var k=ae(),y=oe(),f=y.OpenViduLogger.getInstance(),d=function(c){p(o,c);function o(a,i){var n=c.call(this,!0,a,"sessionDisconnected")||this;return n.reason=i,n}return o.prototype.callDefaultBehavior=function(){f.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'");var a=this.target;a.remoteConnections.forEach(function(i){var n,E,w,_,h,P,v,u,s=i.connectionId;if(!((n=a.remoteConnections.get(s))===null||n===void 0)&&n.stream){(E=a.remoteConnections.get(s))===null||E===void 0||E.stream.disposeWebRtcPeer(),(w=a.remoteConnections.get(s))===null||w===void 0||w.stream.disposeMediaStream(),!((_=a.remoteConnections.get(s))===null||_===void 0)&&_.stream.streamManager&&((h=a.remoteConnections.get(s))===null||h===void 0||h.stream.streamManager.removeAllVideos());var C=(v=(P=a.remoteConnections.get(s))===null||P===void 0?void 0:P.stream)===null||v===void 0?void 0:v.streamId;C&&a.remoteStreamsCreated.delete(C),(u=a.remoteConnections.get(s))===null||u===void 0||u.dispose()}a.remoteConnections.delete(s)})},o}(k.Event);return Ie.SessionDisconnectedEvent=d,Ie}var Pe={},ar;function Zr(){if(ar)return Pe;ar=1;var p=Pe&&Pe.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.SignalEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a,i){var n=f.call(this,!1,c,"signal")||this;return o&&(n.type="signal:"+o),n.data=a,n.from=i,n}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return Pe.SignalEvent=y,Pe}var Te={},cr;function ei(){if(cr)return Te;cr=1;var p=Te&&Te.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Te,"__esModule",{value:!0}),Te.SpeechToTextEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a,i,n,E){var w=f.call(this,!1,c,"speechToTextMessage")||this;return w.connection=o,w.text=a,w.reason=i,w.raw=n,w.lang=E,w}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return Te.SpeechToTextEvent=y,Te}var ke={},ur;function nn(){if(ur)return ke;ur=1;var p=ke&&ke.__extends||function(){var a=function(i,n){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,w){E.__proto__=w}||function(E,w){for(var _ in w)Object.prototype.hasOwnProperty.call(w,_)&&(E[_]=w[_])},a(i,n)};return function(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");a(i,n);function E(){this.constructor=i}i.prototype=n===null?Object.create(n):(E.prototype=n.prototype,new E)}}();Object.defineProperty(ke,"__esModule",{value:!0}),ke.StreamEvent=void 0;var k=ae(),y=rn(),f=Et(),d=oe(),c=d.OpenViduLogger.getInstance(),o=function(a){p(i,a);function i(n,E,w,_,h){var P=a.call(this,n,E,w)||this;return P.stream=_,P.reason=h,P}return i.prototype.callDefaultBehavior=function(){if(this.type==="streamDestroyed"){if(this.target instanceof f.Session)c.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'"),this.stream.disposeWebRtcPeer();else if(this.target instanceof y.Publisher){c.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Publisher'"),clearInterval(this.target.screenShareResizeInterval),this.stream.isLocalStreamReadyToPublish=!1;for(var n=this.target.openvidu.publishers,E=0;E<n.length;E++)if(n[E]===this.target){n.splice(E,1);break}}this.stream.disposeMediaStream(),this.stream.streamManager&&this.stream.streamManager.removeAllVideos(),this.stream.session.remoteStreamsCreated.delete(this.stream.streamId);var w=this.stream.session.remoteConnections.get(this.stream.connection.connectionId);if(w&&w.remoteOptions)for(var _=w.remoteOptions.streams,E=_.length-1;E>=0;--E)_[E].id===this.stream.streamId&&_.splice(E,1)}},i}(k.Event);return ke.StreamEvent=o,ke}var xe={},dr;function ti(){if(dr)return xe;dr=1;var p=xe&&xe.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(xe,"__esModule",{value:!0}),xe.ConnectionPropertyChangedEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a,i,n){var E=f.call(this,!1,c,"connectionPropertyChanged")||this;return E.connection=o,E.changedProperty=a,E.newValue=i,E.oldValue=n,E}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return xe.ConnectionPropertyChangedEvent=y,xe}var Ne={},lr;function ni(){if(lr)return Ne;lr=1;var p=Ne&&Ne.__extends||function(){var f=function(d,c){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])},f(d,c)};return function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");f(d,c);function o(){this.constructor=d}d.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}}();Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.NetworkQualityLevelChangedEvent=void 0;var k=ae(),y=function(f){p(d,f);function d(c,o,a,i){var n=f.call(this,!1,c,"networkQualityLevelChanged")||this;return n.newValue=o,n.oldValue=a,n.connection=i,n}return d.prototype.callDefaultBehavior=function(){},d}(k.Event);return Ne.NetworkQualityLevelChangedEvent=y,Ne}var Nt,fr;function ri(){if(fr)return Nt;fr=1;var p={};return Nt=typeof process=="object"&&p&&p.NODE_DEBUG&&/\bsemver\b/i.test(p.NODE_DEBUG)?(...y)=>console.error("SEMVER",...y):()=>{},Nt}var Lt,hr;function ii(){if(hr)return Lt;hr=1;const p="2.0.0",k=256,y=Number.MAX_SAFE_INTEGER||9007199254740991,f=16,d=k-6;return Lt={MAX_LENGTH:k,MAX_SAFE_COMPONENT_LENGTH:f,MAX_SAFE_BUILD_LENGTH:d,MAX_SAFE_INTEGER:y,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:p,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Lt}var ct={exports:{}},pr;function Bi(){return pr||(pr=1,function(p,k){const{MAX_SAFE_COMPONENT_LENGTH:y,MAX_SAFE_BUILD_LENGTH:f,MAX_LENGTH:d}=ii(),c=ri();k=p.exports={};const o=k.re=[],a=k.safeRe=[],i=k.src=[],n=k.t={};let E=0;const w="[a-zA-Z0-9-]",_=[["\\s",1],["\\d",d],[w,f]],h=v=>{for(const[u,s]of _)v=v.split(`${u}*`).join(`${u}{0,${s}}`).split(`${u}+`).join(`${u}{1,${s}}`);return v},P=(v,u,s)=>{const C=h(u),x=E++;c(v,x,u),n[v]=x,i[x]=u,o[x]=new RegExp(u,s?"g":void 0),a[x]=new RegExp(C,s?"g":void 0)};P("NUMERICIDENTIFIER","0|[1-9]\\d*"),P("NUMERICIDENTIFIERLOOSE","\\d+"),P("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${w}*`),P("MAINVERSION",`(${i[n.NUMERICIDENTIFIER]})\\.(${i[n.NUMERICIDENTIFIER]})\\.(${i[n.NUMERICIDENTIFIER]})`),P("MAINVERSIONLOOSE",`(${i[n.NUMERICIDENTIFIERLOOSE]})\\.(${i[n.NUMERICIDENTIFIERLOOSE]})\\.(${i[n.NUMERICIDENTIFIERLOOSE]})`),P("PRERELEASEIDENTIFIER",`(?:${i[n.NUMERICIDENTIFIER]}|${i[n.NONNUMERICIDENTIFIER]})`),P("PRERELEASEIDENTIFIERLOOSE",`(?:${i[n.NUMERICIDENTIFIERLOOSE]}|${i[n.NONNUMERICIDENTIFIER]})`),P("PRERELEASE",`(?:-(${i[n.PRERELEASEIDENTIFIER]}(?:\\.${i[n.PRERELEASEIDENTIFIER]})*))`),P("PRERELEASELOOSE",`(?:-?(${i[n.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[n.PRERELEASEIDENTIFIERLOOSE]})*))`),P("BUILDIDENTIFIER",`${w}+`),P("BUILD",`(?:\\+(${i[n.BUILDIDENTIFIER]}(?:\\.${i[n.BUILDIDENTIFIER]})*))`),P("FULLPLAIN",`v?${i[n.MAINVERSION]}${i[n.PRERELEASE]}?${i[n.BUILD]}?`),P("FULL",`^${i[n.FULLPLAIN]}$`),P("LOOSEPLAIN",`[v=\\s]*${i[n.MAINVERSIONLOOSE]}${i[n.PRERELEASELOOSE]}?${i[n.BUILD]}?`),P("LOOSE",`^${i[n.LOOSEPLAIN]}$`),P("GTLT","((?:<|>)?=?)"),P("XRANGEIDENTIFIERLOOSE",`${i[n.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),P("XRANGEIDENTIFIER",`${i[n.NUMERICIDENTIFIER]}|x|X|\\*`),P("XRANGEPLAIN",`[v=\\s]*(${i[n.XRANGEIDENTIFIER]})(?:\\.(${i[n.XRANGEIDENTIFIER]})(?:\\.(${i[n.XRANGEIDENTIFIER]})(?:${i[n.PRERELEASE]})?${i[n.BUILD]}?)?)?`),P("XRANGEPLAINLOOSE",`[v=\\s]*(${i[n.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[n.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[n.XRANGEIDENTIFIERLOOSE]})(?:${i[n.PRERELEASELOOSE]})?${i[n.BUILD]}?)?)?`),P("XRANGE",`^${i[n.GTLT]}\\s*${i[n.XRANGEPLAIN]}$`),P("XRANGELOOSE",`^${i[n.GTLT]}\\s*${i[n.XRANGEPLAINLOOSE]}$`),P("COERCEPLAIN",`(^|[^\\d])(\\d{1,${y}})(?:\\.(\\d{1,${y}}))?(?:\\.(\\d{1,${y}}))?`),P("COERCE",`${i[n.COERCEPLAIN]}(?:$|[^\\d])`),P("COERCEFULL",i[n.COERCEPLAIN]+`(?:${i[n.PRERELEASE]})?(?:${i[n.BUILD]})?(?:$|[^\\d])`),P("COERCERTL",i[n.COERCE],!0),P("COERCERTLFULL",i[n.COERCEFULL],!0),P("LONETILDE","(?:~>?)"),P("TILDETRIM",`(\\s*)${i[n.LONETILDE]}\\s+`,!0),k.tildeTrimReplace="$1~",P("TILDE",`^${i[n.LONETILDE]}${i[n.XRANGEPLAIN]}$`),P("TILDELOOSE",`^${i[n.LONETILDE]}${i[n.XRANGEPLAINLOOSE]}$`),P("LONECARET","(?:\\^)"),P("CARETTRIM",`(\\s*)${i[n.LONECARET]}\\s+`,!0),k.caretTrimReplace="$1^",P("CARET",`^${i[n.LONECARET]}${i[n.XRANGEPLAIN]}$`),P("CARETLOOSE",`^${i[n.LONECARET]}${i[n.XRANGEPLAINLOOSE]}$`),P("COMPARATORLOOSE",`^${i[n.GTLT]}\\s*(${i[n.LOOSEPLAIN]})$|^$`),P("COMPARATOR",`^${i[n.GTLT]}\\s*(${i[n.FULLPLAIN]})$|^$`),P("COMPARATORTRIM",`(\\s*)${i[n.GTLT]}\\s*(${i[n.LOOSEPLAIN]}|${i[n.XRANGEPLAIN]})`,!0),k.comparatorTrimReplace="$1$2$3",P("HYPHENRANGE",`^\\s*(${i[n.XRANGEPLAIN]})\\s+-\\s+(${i[n.XRANGEPLAIN]})\\s*$`),P("HYPHENRANGELOOSE",`^\\s*(${i[n.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[n.XRANGEPLAINLOOSE]})\\s*$`),P("STAR","(<|>)?=?\\s*\\*"),P("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),P("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(ct,ct.exports)),ct.exports}var Mt,vr;function ji(){if(vr)return Mt;vr=1;const p=Object.freeze({loose:!0}),k=Object.freeze({});return Mt=f=>f?typeof f!="object"?p:f:k,Mt}var At,mr;function qi(){if(mr)return At;mr=1;const p=/^[0-9]+$/,k=(f,d)=>{const c=p.test(f),o=p.test(d);return c&&o&&(f=+f,d=+d),f===d?0:c&&!o?-1:o&&!c?1:f<d?-1:1};return At={compareIdentifiers:k,rcompareIdentifiers:(f,d)=>k(d,f)},At}var Vt,gr;function oi(){if(gr)return Vt;gr=1;const p=ri(),{MAX_LENGTH:k,MAX_SAFE_INTEGER:y}=ii(),{safeRe:f,t:d}=Bi(),c=ji(),{compareIdentifiers:o}=qi();class a{constructor(n,E){if(E=c(E),n instanceof a){if(n.loose===!!E.loose&&n.includePrerelease===!!E.includePrerelease)return n;n=n.version}else if(typeof n!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof n}".`);if(n.length>k)throw new TypeError(`version is longer than ${k} characters`);p("SemVer",n,E),this.options=E,this.loose=!!E.loose,this.includePrerelease=!!E.includePrerelease;const w=n.trim().match(E.loose?f[d.LOOSE]:f[d.FULL]);if(!w)throw new TypeError(`Invalid Version: ${n}`);if(this.raw=n,this.major=+w[1],this.minor=+w[2],this.patch=+w[3],this.major>y||this.major<0)throw new TypeError("Invalid major version");if(this.minor>y||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>y||this.patch<0)throw new TypeError("Invalid patch version");w[4]?this.prerelease=w[4].split(".").map(_=>{if(/^[0-9]+$/.test(_)){const h=+_;if(h>=0&&h<y)return h}return _}):this.prerelease=[],this.build=w[5]?w[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(n){if(p("SemVer.compare",this.version,this.options,n),!(n instanceof a)){if(typeof n=="string"&&n===this.version)return 0;n=new a(n,this.options)}return n.version===this.version?0:this.compareMain(n)||this.comparePre(n)}compareMain(n){return n instanceof a||(n=new a(n,this.options)),o(this.major,n.major)||o(this.minor,n.minor)||o(this.patch,n.patch)}comparePre(n){if(n instanceof a||(n=new a(n,this.options)),this.prerelease.length&&!n.prerelease.length)return-1;if(!this.prerelease.length&&n.prerelease.length)return 1;if(!this.prerelease.length&&!n.prerelease.length)return 0;let E=0;do{const w=this.prerelease[E],_=n.prerelease[E];if(p("prerelease compare",E,w,_),w===void 0&&_===void 0)return 0;if(_===void 0)return 1;if(w===void 0)return-1;if(w===_)continue;return o(w,_)}while(++E)}compareBuild(n){n instanceof a||(n=new a(n,this.options));let E=0;do{const w=this.build[E],_=n.build[E];if(p("build compare",E,w,_),w===void 0&&_===void 0)return 0;if(_===void 0)return 1;if(w===void 0)return-1;if(w===_)continue;return o(w,_)}while(++E)}inc(n,E,w){switch(n){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",E,w);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",E,w);break;case"prepatch":this.prerelease.length=0,this.inc("patch",E,w),this.inc("pre",E,w);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",E,w),this.inc("pre",E,w);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const _=Number(w)?1:0;if(!E&&w===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[_];else{let h=this.prerelease.length;for(;--h>=0;)typeof this.prerelease[h]=="number"&&(this.prerelease[h]++,h=-2);if(h===-1){if(E===this.prerelease.join(".")&&w===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(_)}}if(E){let h=[E,_];w===!1&&(h=[E]),o(this.prerelease[0],E)===0?isNaN(this.prerelease[1])&&(this.prerelease=h):this.prerelease=h}break}default:throw new Error(`invalid increment argument: ${n}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return Vt=a,Vt}var Dt,Er;function Fi(){if(Er)return Dt;Er=1;const p=oi();return Dt=(y,f)=>new p(y,f).major,Dt}var Bt,br;function Ui(){if(br)return Bt;br=1;const p=oi();return Bt=(y,f)=>new p(y,f).minor,Bt}var Sr;function Et(){if(Sr)return le;Sr=1;var p=le&&le.__extends||function(){var L=function(D,r){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,N){S.__proto__=N}||function(S,N){for(var R in N)Object.prototype.hasOwnProperty.call(N,R)&&(S[R]=N[R])},L(D,r)};return function(D,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");L(D,r);function S(){this.constructor=D}D.prototype=r===null?Object.create(r):(S.prototype=r.prototype,new S)}}(),k=le&&le.__awaiter||function(L,D,r,S){function N(R){return R instanceof r?R:new r(function(m){m(R)})}return new(r||(r=Promise))(function(R,m){function O(B){try{V(S.next(B))}catch(j){m(j)}}function A(B){try{V(S.throw(B))}catch(j){m(j)}}function V(B){B.done?R(B.value):N(B.value).then(O,A)}V((S=S.apply(L,D||[])).next())})},y=le&&le.__generator||function(L,D){var r={label:0,sent:function(){if(R[0]&1)throw R[1];return R[1]},trys:[],ops:[]},S,N,R,m;return m={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function O(V){return function(B){return A([V,B])}}function A(V){if(S)throw new TypeError("Generator is already executing.");for(;m&&(m=0,V[0]&&(r=0)),r;)try{if(S=1,N&&(R=V[0]&2?N.return:V[0]?N.throw||((R=N.return)&&R.call(N),0):N.next)&&!(R=R.call(N,V[1])).done)return R;switch(N=0,R&&(V=[V[0]&2,R.value]),V[0]){case 0:case 1:R=V;break;case 4:return r.label++,{value:V[1],done:!1};case 5:r.label++,N=V[1],V=[0];continue;case 7:V=r.ops.pop(),r.trys.pop();continue;default:if(R=r.trys,!(R=R.length>0&&R[R.length-1])&&(V[0]===6||V[0]===2)){r=0;continue}if(V[0]===3&&(!R||V[1]>R[0]&&V[1]<R[3])){r.label=V[1];break}if(V[0]===6&&r.label<R[1]){r.label=R[1],R=V;break}if(R&&r.label<R[2]){r.label=R[2],r.ops.push(V);break}R[2]&&r.ops.pop(),r.trys.pop();continue}V=D.call(L,r)}catch(B){V=[6,B],N=0}finally{S=R=0}if(V[0]&5)throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}};Object.defineProperty(le,"__esModule",{value:!0}),le.Session=void 0;var f=Jr(),d=zt(),c=Qt(),o=Jt(),a=Kr(),i=Yr(),n=Qr(),E=tn(),w=Zr(),_=ei(),h=nn(),P=Ae(),v=ti(),u=ni(),s=Ve(),C=vt(),x=oe(),b=me(),e=Fi(),l=Ui(),I=De(),t=x.OpenViduLogger.getInstance(),g,T=function(L){p(D,L);function D(r){var S=L.call(this)||this;return S.streamManagers=[],S.remoteStreamsCreated=new Map,S.remoteConnections=new Map,g=b.PlatformUtils.getInstance(),S.openvidu=r,S}return D.prototype.connect=function(r,S){var N=this;return new Promise(function(R,m){if(N.processToken(r),N.openvidu.checkSystemRequirements())N.options={sessionId:N.sessionId,participantId:r,metadata:S?N.stringClientMetadata(S):""},N.connectAux(r).then(function(){return R()}).catch(function(O){return m(O)});else return m(new s.OpenViduError(s.OpenViduErrorName.BROWSER_NOT_SUPPORTED,"Browser "+g.getName()+" (version "+g.getVersion()+") for "+g.getFamily()+" is not supported in OpenVidu"))})},D.prototype.disconnect=function(){this.leave(!1,"disconnect")},D.prototype.subscribe=function(r,S,N,R){var m={};N&&typeof N!="function"?m={insertMode:typeof N.insertMode<"u"?typeof N.insertMode=="string"?C.VideoInsertMode[N.insertMode]:m.insertMode:C.VideoInsertMode.APPEND,subscribeToAudio:typeof N.subscribeToAudio<"u"?N.subscribeToAudio:!0,subscribeToVideo:typeof N.subscribeToVideo<"u"?N.subscribeToVideo:!0}:m={insertMode:C.VideoInsertMode.APPEND,subscribeToAudio:!0,subscribeToVideo:!0};var O=void 0;if(N&&typeof N=="function"?O=N:R&&(O=R),!this.sessionConnected())throw O!==void 0&&O(this.notConnectedError()),this.notConnectedError();t.info("Subscribing to "+r.connection.connectionId),r.subscribe().then(function(){t.info("Subscribed correctly to "+r.connection.connectionId),O!==void 0&&O(void 0)}).catch(function(V){O!==void 0&&O(V)});var A=new c.Subscriber(r,S,m);return A.targetElement&&r.streamManager.createVideoElement(A.targetElement,m.insertMode),A},D.prototype.subscribeAsync=function(r,S,N){var R=this;return new Promise(function(m,O){if(!R.sessionConnected())return O(R.notConnectedError());var A,V=function(B){return B?O(B):m(A)};N?A=R.subscribe(r,S,N,V):A=R.subscribe(r,S,V)})},D.prototype.unsubscribe=function(r){var S=this;return new Promise(function(N,R){if(S.sessionConnected()){var m=r.stream.connection.connectionId;t.info("Unsubscribing from "+m),S.openvidu.sendRequest("unsubscribeFromVideo",{sender:r.stream.connection.connectionId},function(O,A){return O?(t.error("Error unsubscribing from "+m),R(O)):(t.info("Unsubscribed correctly from "+m),r.stream.streamManager.removeAllVideos(),r.stream.disposeWebRtcPeer(),r.stream.disposeMediaStream(),N())})}else return R(S.notConnectedError())})},D.prototype.publish=function(r){var S=this;return new Promise(function(N,R){if(!S.sessionConnected())return R(S.notConnectedError());r.session=S,r.stream.session=S,r.stream.publishedOnce?r.initialize().then(function(){S.connection.addStream(r.stream),r.reestablishStreamPlayingEvent(),r.stream.publish().then(function(){return S.sendVideoData(r,8,!0,5),N()}).catch(function(m){return R(m)})}).catch(function(m){return R(m)}):(S.connection.addStream(r.stream),r.stream.publish().then(function(){return S.sendVideoData(r,8,!0,5),N()}).catch(function(m){return R(m)}))})},D.prototype.unpublish=function(r){var S=this;return new Promise(function(N,R){if(!S.sessionConnected())throw S.notConnectedError();var m=r.stream;if(m.connection){if(m.connection!==S.connection)return R(new Error("The associated Connection object of this Publisher is not your local Connection.  Only moderators can force unpublish on remote Streams via 'forceUnpublish' method"));t.info("Unpublishing local media ("+m.connection.connectionId+")"),S.openvidu.sendRequest("unpublishVideo",function(O,A){if(O)return R(O);t.info("Media unpublished correctly"),m.disposeWebRtcPeer(),m.connection.stream==m&&delete m.connection.stream;var V=new h.StreamEvent(!0,r,"streamDestroyed",r.stream,"unpublish");return r.emitEvent("streamDestroyed",[V]),V.callDefaultBehavior(),N()})}else return R(new Error("The associated Connection object of this Publisher is null"))})},D.prototype.forceDisconnect=function(r){var S=this;return new Promise(function(N,R){if(!S.sessionConnected())return R(S.notConnectedError());t.info("Forcing disconnect for connection "+r.connectionId),S.openvidu.sendRequest("forceDisconnect",{connectionId:r.connectionId},function(m,O){return m?(t.error("Error forcing disconnect for Connection "+r.connectionId,m),m.code===401?R(new s.OpenViduError(s.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force a disconnection")):R(m)):(t.info("Forcing disconnect correctly for Connection "+r.connectionId),N())})})},D.prototype.forceUnpublish=function(r){var S=this;return new Promise(function(N,R){if(!S.sessionConnected())return R(S.notConnectedError());t.info("Forcing unpublish for stream "+r.streamId),S.openvidu.sendRequest("forceUnpublish",{streamId:r.streamId},function(m,O){return m?(t.error("Error forcing unpublish for Stream "+r.streamId,m),m.code===401?R(new s.OpenViduError(s.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force an unpublishing")):R(m)):(t.info("Forcing unpublish correctly for Stream "+r.streamId),N())})})},D.prototype.signal=function(r){var S=this;return new Promise(function(N,R){if(!S.sessionConnected())return R(S.notConnectedError());var m={};if(r.to&&r.to.length>0){var O=[];r.to.forEach(function(V){V.connectionId&&O.push(V.connectionId)}),m.to=O}else m.to=[];m.data=r.data?r.data:"";var A=r.type?r.type:"signal";A&&A.substring(0,7)!=="signal:"&&(A="signal:"+A),m.type=A,S.openvidu.sendRequest("sendMessage",{message:JSON.stringify(m)},function(V,B){return V?R(V):N()})})},D.prototype.subscribeToSpeechToText=function(r,S){var N=this;return new Promise(function(R,m){N.openvidu.sendRequest("subscribeToSpeechToText",{connectionId:r.connection.connectionId,lang:S},function(O,A){return O?m(O):R()})})},D.prototype.unsubscribeFromSpeechToText=function(r){var S=this;return new Promise(function(N,R){S.openvidu.sendRequest("unsubscribeFromSpeechToText",{connectionId:r.connection.connectionId},function(m,O){return m?R(m):N()})})},D.prototype.on=function(r,S){var N,R,m,O;return L.prototype.onAux.call(this,r,"Event '"+r+"' triggered by 'Session'",S),r==="publisherStartSpeaking"&&(this.remoteConnections.forEach(function(A){var V;!((V=A.stream)===null||V===void 0)&&V.hasAudio&&A.stream.enableHarkSpeakingEvent()}),!((R=(N=this.connection)===null||N===void 0?void 0:N.stream)===null||R===void 0)&&R.hasAudio&&this.connection.stream.enableHarkSpeakingEvent()),r==="publisherStopSpeaking"&&(this.remoteConnections.forEach(function(A){var V;!((V=A.stream)===null||V===void 0)&&V.hasAudio&&A.stream.enableHarkStoppedSpeakingEvent()}),!((O=(m=this.connection)===null||m===void 0?void 0:m.stream)===null||O===void 0)&&O.hasAudio&&this.connection.stream.enableHarkStoppedSpeakingEvent()),this},D.prototype.once=function(r,S){var N,R,m,O;return L.prototype.onceAux.call(this,r,"Event '"+r+"' triggered once by 'Session'",S),r==="publisherStartSpeaking"&&(this.remoteConnections.forEach(function(A){var V;!((V=A.stream)===null||V===void 0)&&V.hasAudio&&A.stream.enableOnceHarkSpeakingEvent()}),!((R=(N=this.connection)===null||N===void 0?void 0:N.stream)===null||R===void 0)&&R.hasAudio&&this.connection.stream.enableOnceHarkSpeakingEvent()),r==="publisherStopSpeaking"&&(this.remoteConnections.forEach(function(A){var V;!((V=A.stream)===null||V===void 0)&&V.hasAudio&&A.stream.enableOnceHarkStoppedSpeakingEvent()}),!((O=(m=this.connection)===null||m===void 0?void 0:m.stream)===null||O===void 0)&&O.hasAudio&&this.connection.stream.enableOnceHarkStoppedSpeakingEvent()),this},D.prototype.off=function(r,S){var N=this,R,m,O,A;return L.prototype.offAux.call(this,r,S),r==="publisherStartSpeaking"&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1)||(this.remoteConnections.forEach(function(V){var B;!((B=V.stream)===null||B===void 0)&&B.streamManager&&(N.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,V.stream.streamManager)||V.stream.disableHarkSpeakingEvent(!1))}),!((m=(R=this.connection)===null||R===void 0?void 0:R.stream)===null||m===void 0)&&m.streamManager&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkSpeakingEvent(!1)))),r==="publisherStopSpeaking"&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1)||(this.remoteConnections.forEach(function(V){var B;!((B=V.stream)===null||B===void 0)&&B.streamManager&&(N.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,V.stream.streamManager)||V.stream.disableHarkStoppedSpeakingEvent(!1))}),!((A=(O=this.connection)===null||O===void 0?void 0:O.stream)===null||A===void 0)&&A.streamManager&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkStoppedSpeakingEvent(!1)))),this},D.prototype.onParticipantJoined=function(r){var S=this;this.getConnection(r.id,"").then(function(N){t.warn("Connection "+N.connectionId+" already exists in connections list")}).catch(function(N){var R=new f.Connection(S,r);S.remoteConnections.set(r.id,R),S.ee.emitEvent("connectionCreated",[new a.ConnectionEvent(!1,S,"connectionCreated",R,"")])})},D.prototype.onParticipantLeft=function(r){var S=this;this.getRemoteConnection(r.connectionId,"onParticipantLeft").then(function(N){if(N.stream){var R=N.stream,m=new h.StreamEvent(!0,S,"streamDestroyed",R,r.reason);S.ee.emitEvent("streamDestroyed",[m]),m.callDefaultBehavior(),S.remoteStreamsCreated.delete(R.streamId)}N.dispose(),S.remoteConnections.delete(N.connectionId),S.ee.emitEvent("connectionDestroyed",[new a.ConnectionEvent(!1,S,"connectionDestroyed",N,r.reason)])}).catch(function(N){t.error(N)})},D.prototype.onParticipantPublished=function(r){var S=this,N=function(m){S.remoteConnections.set(m.connectionId,m),S.remoteStreamsCreated.get(m.stream.streamId)||S.ee.emitEvent("streamCreated",[new h.StreamEvent(!1,S,"streamCreated",m.stream,"")]),S.remoteStreamsCreated.set(m.stream.streamId,!0)},R;this.getRemoteConnection(r.id,"onParticipantPublished").then(function(m){R=m,r.metadata=m.data,R.remoteOptions=r,R.initRemoteStreams(r.streams),N(R)}).catch(function(m){R=new f.Connection(S,r),N(R)})},D.prototype.onParticipantUnpublished=function(r){var S=this;r.connectionId===this.connection.connectionId?this.stopPublisherStream(r.reason):this.getRemoteConnection(r.connectionId,"onParticipantUnpublished").then(function(N){var R=new h.StreamEvent(!0,S,"streamDestroyed",N.stream,r.reason);if(S.ee.emitEvent("streamDestroyed",[R]),R.callDefaultBehavior(),N.stream!=null){var m=N.stream.streamId;S.remoteStreamsCreated.delete(m),N.removeStream()}}).catch(function(N){t.error(N)})},D.prototype.onParticipantEvicted=function(r){r.connectionId===this.connection.connectionId&&this.sessionId&&!this.connection.disposed&&this.leave(!0,r.reason)},D.prototype.onNewMessage=function(r){var S=this;t.info("New signal: "+JSON.stringify(r));var N=r.type?r.type.replace(/^(signal:)/,""):void 0;r.from?this.getConnection(r.from,"Connection '"+r.from+"' unknown when 'onNewMessage'. Existing remote connections: "+JSON.stringify(this.remoteConnections.keys())+". Existing local connection: "+this.connection.connectionId).then(function(R){S.ee.emitEvent("signal",[new w.SignalEvent(S,N,r.data,R)]),r.type&&r.type!=="signal"&&S.ee.emitEvent(r.type,[new w.SignalEvent(S,N,r.data,R)])}).catch(function(R){t.error(R)}):(this.ee.emitEvent("signal",[new w.SignalEvent(this,N,r.data,void 0)]),r.type&&r.type!=="signal"&&this.ee.emitEvent(r.type,[new w.SignalEvent(this,N,r.data,void 0)]))},D.prototype.onStreamPropertyChanged=function(r){var S=this,N=function(R){var m,O;if(R.stream&&R.stream.streamId===r.streamId){var A=R.stream,V=void 0;switch(r.property){case"audioActive":V=A.audioActive,r.newValue=r.newValue==="true",A.audioActive=r.newValue;break;case"videoActive":V=A.videoActive,r.newValue=r.newValue==="true",A.videoActive=r.newValue;var B=(O=(m=A==null?void 0:A.getMediaStream())===null||m===void 0?void 0:m.getVideoTracks())===null||O===void 0?void 0:O[0];B&&!B.enabled&&A.videoActive&&(B.enabled=!0);break;case"videoTrack":r.newValue=JSON.parse(r.newValue);break;case"audioTrack":r.newValue=JSON.parse(r.newValue);break;case"videoDimensions":V=A.videoDimensions,r.newValue=JSON.parse(JSON.parse(r.newValue)),A.videoDimensions=r.newValue;break;case"filter":V=A.filter,r.newValue=Object.keys(r.newValue).length>0?r.newValue:void 0,r.newValue!==void 0?(A.filter=new d.Filter(r.newValue.type,r.newValue.options),A.filter.stream=A,r.newValue.lastExecMethod&&(A.filter.lastExecMethod=r.newValue.lastExecMethod)):delete A.filter,r.newValue=A.filter;break}S.ee.emitEvent("streamPropertyChanged",[new P.StreamPropertyChangedEvent(S,A,r.property,r.newValue,V,r.reason)]),A.streamManager&&A.streamManager.emitEvent("streamPropertyChanged",[new P.StreamPropertyChangedEvent(A.streamManager,A,r.property,r.newValue,V,r.reason)])}else t.error("No stream with streamId '"+r.streamId+"' found for connection '"+r.connectionId+"' on 'streamPropertyChanged' event")};r.connectionId===this.connection.connectionId?N(this.connection):this.getRemoteConnection(r.connectionId,"onStreamPropertyChanged").then(function(R){N(R)}).catch(function(R){t.error(R)})},D.prototype.onConnectionPropertyChanged=function(r){var S;switch(r.property){case"role":S=this.connection.role.slice(),this.connection.role=r.newValue,this.connection.localOptions.role=r.newValue;break;case"record":S=this.connection.record,r.newValue=r.newValue==="true",this.connection.record=r.newValue,this.connection.localOptions.record=r.newValue;break}this.ee.emitEvent("connectionPropertyChanged",[new v.ConnectionPropertyChangedEvent(this,this.connection,r.property,r.newValue,S)])},D.prototype.onNetworkQualityLevelChangedChanged=function(r){var S=this;r.connectionId===this.connection.connectionId?this.ee.emitEvent("networkQualityLevelChanged",[new u.NetworkQualityLevelChangedEvent(this,r.newValue,r.oldValue,this.connection)]):this.getConnection(r.connectionId,"Connection not found for connectionId "+r.connectionId).then(function(N){S.ee.emitEvent("networkQualityLevelChanged",[new u.NetworkQualityLevelChangedEvent(S,r.newValue,r.oldValue,N)])}).catch(function(N){t.error(N)})},D.prototype.recvIceCandidate=function(r){var S={candidate:r.candidate,sdpMLineIndex:r.sdpMLineIndex,sdpMid:r.sdpMid},N=new RTCIceCandidate(S);this.getConnection(r.senderConnectionId,"Connection not found for connectionId "+r.senderConnectionId+" owning endpoint "+r.endpointName+". Ice candidate will be ignored: "+N).then(function(R){var m=R.stream;m.getWebRtcPeer().addIceCandidate(N).catch(function(O){t.error("Error adding candidate for "+m.streamId+" stream of endpoint "+r.endpointName+": "+O)})}).catch(function(R){t.error(R)})},D.prototype.onSessionClosed=function(r){t.info("Session closed: "+JSON.stringify(r));var S=r.sessionId;S!==void 0?this.ee.emitEvent("session-closed",[{session:S}]):t.warn("Session undefined on session closed",r)},D.prototype.onLostConnection=function(r){t.warn("Lost connection in Session "+this.sessionId),this.sessionId&&this.connection&&!this.connection.disposed&&this.leave(!0,r)},D.prototype.onRecoveredConnection=function(){t.info("Recovered connection in Session "+this.sessionId),this.reconnectBrokenStreams(),this.ee.emitEvent("reconnected",[])},D.prototype.onMediaError=function(r){t.error("Media error: "+JSON.stringify(r));var S=r.error;S?this.ee.emitEvent("error-media",[{error:S}]):t.warn("Received undefined media error:",r)},D.prototype.onRecordingStarted=function(r){this.ee.emitEvent("recordingStarted",[new n.RecordingEvent(this,"recordingStarted",r.id,r.name)])},D.prototype.onRecordingStopped=function(r){this.ee.emitEvent("recordingStopped",[new n.RecordingEvent(this,"recordingStopped",r.id,r.name,r.reason)])},D.prototype.onBroadcastStarted=function(){this.ee.emitEvent("broadcastStarted",[])},D.prototype.onBroadcastStopped=function(){this.ee.emitEvent("broadcastStopped",[])},D.prototype.onFilterEventDispatched=function(r){var S=this,N=r.connectionId;this.getConnection(N,"No connection found for connectionId "+N).then(function(R){t.info('Filter event of type "'.concat(r.eventType,'" dispatched'));var m=R.stream;if(!m||!m.filter)return t.error('Filter event of type "'.concat(r.eventType,'" dispatched for stream ').concat(m.streamId," but there is no ").concat(m?"filter":"stream"," defined"));var O=m.filter.handlers.get(r.eventType);if(!O||typeof O!="function"){var A=Array.from(m.filter.handlers.keys());return t.error('Filter event of type "'.concat(r.eventType,'" not handled or not a function! Active filter events: ').concat(A.join(",")))}else O.call(S,new i.FilterEvent(m.filter,r.eventType,r.data))})},D.prototype.onForciblyReconnectSubscriber=function(r){var S=this;return new Promise(function(N,R){S.getRemoteConnection(r.connectionId,"onForciblyReconnectSubscriber").then(function(m){if(m.stream&&m.stream.streamId===r.streamId){var O=m.stream;if(O.setupReconnectionEventEmitter(N,R)){if(O.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent!=null)return O.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent=r,R("Ongoing forced subscriber reconnection");O.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent=r;var A=function(){var B=O.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent;delete O.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent,S.onForciblyReconnectSubscriber(B)};O.reconnectionEventEmitter.once("success",function(){A()}),O.reconnectionEventEmitter.once("error",function(){A()});return}O.completeWebRtcPeerReceive(!0,!0,r.sdpOffer).then(function(){return O.finalResolveForSubscription(!0,N)}).catch(function(B){return O.finalRejectForSubscription(!0,"Error while forcibly reconnecting remote stream ".concat(r.streamId,": ").concat(B.toString()),R)})}else{var V="No stream with streamId '"+r.streamId+"' found for connection '"+r.connectionId+"' on 'streamPropertyChanged' event";return t.error(V),R(V)}}).catch(function(m){return t.error(m),R(m)})})},D.prototype.reconnectBrokenStreams=function(){t.info("Re-establishing media connections...");var r=!1;this.connection.stream&&this.connection.stream.streamIceConnectionStateBroken()&&(t.warn("Re-establishing Publisher "+this.connection.stream.streamId),this.connection.stream.initWebRtcPeerSend(!0),r=!0),this.remoteConnections.forEach(function(S){S.stream&&S.stream.streamIceConnectionStateBroken()&&(t.warn("Re-establishing Subscriber "+S.stream.streamId),S.stream.initWebRtcPeerReceive(!0),r=!0)}),r||t.info("There were no media streams in need of a reconnection")},D.prototype.onSpeechToTextMessage=function(r){return k(this,void 0,void 0,function(){var S,N;return y(this,function(R){switch(R.label){case 0:return[4,this.getConnection(r.connectionId,"No connection found for connectionId "+r.connectionId)];case 1:return S=R.sent(),N=new _.SpeechToTextEvent(this,S,r.text,r.reason.toLowerCase(),r.raw,r.lang),this.ee.emitEvent("speechToTextMessage",[N]),[2]}})})},D.prototype.onSpeechToTextDisconnected=function(r){return k(this,void 0,void 0,function(){return y(this,function(S){return this.emitEvent("exception",[new I.ExceptionEvent(this,I.ExceptionEventName.SPEECH_TO_TEXT_DISCONNECTED,this,r.message)]),[2]})})},D.prototype.emitEvent=function(r,S){this.ee.emitEvent(r,S)},D.prototype.leave=function(r,S){var N=this;if(r=!!r,t.info("Leaving Session (forced="+r+")"),this.stopVideoDataIntervals(),this.connection){if(!this.connection.disposed&&!r?this.openvidu.sendRequest("leaveRoom",function(m,O){m&&t.error("leaveRoom error: ".concat(JSON.stringify(m))),N.openvidu.closeWs()}):this.openvidu.closeWs(),this.stopPublisherStream(S),!this.connection.disposed){var R=new E.SessionDisconnectedEvent(this,S);this.ee.emitEvent("sessionDisconnected",[R]),R.callDefaultBehavior()}}else t.warn("You were not connected to the session "+this.sessionId);t.flush()},D.prototype.initializeParams=function(r){var S={token:r||"",session:this.sessionId,platform:g.getDescription()?g.getDescription():"unknown",sdkVersion:this.openvidu.libraryVersion,metadata:this.options.metadata?this.options.metadata:"",secret:this.openvidu.getSecret(),recorder:this.openvidu.getRecorder(),stt:this.openvidu.getStt()};return S},D.prototype.sendVideoData=function(r,S,N,R){var m=this,O,A;if(S===void 0&&(S=1),N===void 0&&(N=!1),R===void 0&&(R=1),g.isChromeBrowser()||g.isChromeMobileBrowser()||g.isOperaBrowser()||g.isOperaMobileBrowser()||g.isEdgeBrowser()||g.isEdgeMobileBrowser()||g.isElectron()||g.isSafariBrowser()&&!g.isIonicIos()||g.isAndroidBrowser()||g.isSamsungBrowser()||g.isIonicAndroid()||g.isIOSWithSafari()){var V=function(){return k(m,void 0,void 0,function(){var j,$,F;return y(this,function(G){switch(G.label){case 0:return j=r.stream.getRTCPeerConnection(),j.connectionState!=="connected"?[3,2]:[4,j.getStats()];case 1:$=G.sent(),F=[],$.forEach(function(M){"frameWidth"in M&&"frameHeight"in M&&F.length===0&&F.push(M)}),F.length>0&&this.openvidu.sendRequest("videoData",{height:F[0].frameHeight,width:F[0].frameWidth,videoActive:r.stream.videoActive!=null?r.stream.videoActive:!1,audioActive:r.stream.audioActive!=null?r.stream.audioActive:!1},function(M,z){M&&t.error("Error sending 'videoData' event",M)}),G.label=2;case 2:return[2]}})})};if(N){var B=1;this.videoDataInterval=setInterval(function(){B<R?(B++,V()):clearInterval(m.videoDataInterval)},S*1e3)}else this.videoDataTimeout=setTimeout(V,S*1e3)}else g.isFirefoxBrowser()||g.isFirefoxMobileBrowser()||g.isIonicIos()||g.isReactNative()?this.openvidu.sendRequest("videoData",{height:((O=r.stream.videoDimensions)===null||O===void 0?void 0:O.height)||0,width:((A=r.stream.videoDimensions)===null||A===void 0?void 0:A.width)||0,videoActive:r.stream.videoActive!=null?r.stream.videoActive:!1,audioActive:r.stream.audioActive!=null?r.stream.audioActive:!1},function(j,$){j&&t.error("Error sending 'videoData' event",j)}):t.error("Browser "+g.getName()+" (version "+g.getVersion()+") for "+g.getFamily()+" is not supported in OpenVidu for Network Quality")},D.prototype.sessionConnected=function(){return this.connection!=null},D.prototype.notConnectedError=function(){return new s.OpenViduError(s.OpenViduErrorName.OPENVIDU_NOT_CONNECTED,"There is no connection to the session. Method 'Session.connect' must be successfully completed first")},D.prototype.anySpeechEventListenerEnabled=function(r,S,N){var R=this.ee.getListeners(r);S&&(R=R.filter(function(V){return V.once}));var m=R.length;if(m>0)return!0;var O=0;if(N){var A=N.ee.getListeners(r);S&&(A=A.filter(function(V){return V.once})),O=A.length}return O>0},D.prototype.getTokenParams=function(r){var S=r.match(/^(wss?)\:\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);if(S){var N={protocol:S[1],host:S[2],hostname:S[3],port:S[4],pathname:S[5],search:S[6],hash:S[7]},R=r.split("?"),m=decodeURI(R[1]).split("&").map(function(O){return O.split("=")}).reduce(function(O,A){var V=A[0],B=A[1];return O[V]=B,O},{});return{sessionId:m.sessionId,secret:m.secret,recorder:m.recorder,stt:m.stt,webrtcStatsInterval:m.webrtcStatsInterval,sendBrowserLogs:m.sendBrowserLogs,edition:m.edition,wsUri:N.protocol+"://"+N.host+"/openvidu",httpUri:"https://"+N.host}}else throw new Error('Token not valid: "'.concat(r,'"'))},D.prototype.connectAux=function(r){var S=this;return new Promise(function(N,R){S.openvidu.startWs(function(m){if(m)return R(m);var O=S.initializeParams(r);S.openvidu.sendRequest("joinRoom",O,function(A,V){if(A)return R(A);S.processJoinRoomResponse(V,r),S.connection=new f.Connection(S,V);var B={connections:new Array,streams:new Array},j=V.value;return j.forEach(function($){var F=new f.Connection(S,$);S.remoteConnections.set(F.connectionId,F),B.connections.push(F),F.stream&&(S.remoteStreamsCreated.set(F.stream.streamId,!0),B.streams.push(F.stream))}),S.ee.emitEvent("connectionCreated",[new a.ConnectionEvent(!1,S,"connectionCreated",S.connection,"")]),B.connections.forEach(function($){S.ee.emitEvent("connectionCreated",[new a.ConnectionEvent(!1,S,"connectionCreated",$,"")])}),B.streams.forEach(function($){S.ee.emitEvent("streamCreated",[new h.StreamEvent(!1,S,"streamCreated",$,"")])}),V.recordingId&&V.recordingName&&S.ee.emitEvent("recordingStarted",[new n.RecordingEvent(S,"recordingStarted",V.recordingId,V.recordingName)]),N()})})})},D.prototype.stopPublisherStream=function(r){this.connection.stream&&(this.connection.stream.disposeWebRtcPeer(),this.connection.stream.isLocalStreamPublished&&this.connection.stream.ee.emitEvent("local-stream-destroyed",[r]))},D.prototype.stopVideoDataIntervals=function(){clearInterval(this.videoDataInterval),clearTimeout(this.videoDataTimeout)},D.prototype.stringClientMetadata=function(r){return typeof r!="string"?JSON.stringify(r):r},D.prototype.getConnection=function(r,S){var N=this;return new Promise(function(R,m){var O=N.remoteConnections.get(r);return O?R(O):N.connection.connectionId===r?R(N.connection):m(new s.OpenViduError(s.OpenViduErrorName.GENERIC_ERROR,S))})},D.prototype.getRemoteConnection=function(r,S){var N=this;return new Promise(function(R,m){var O=N.remoteConnections.get(r);if(O)return R(O);var A="Remote connection "+r+" unknown when '"+S+"'. Existing remote connections: "+JSON.stringify(N.remoteConnections.keys());return m(new s.OpenViduError(s.OpenViduErrorName.GENERIC_ERROR,A))})},D.prototype.processToken=function(r){var S=this.getTokenParams(r);this.sessionId=S.sessionId,S.secret&&(this.openvidu.secret=S.secret),S.recorder&&(this.openvidu.recorder=!0),S.stt&&(this.openvidu.stt=!0),S.webrtcStatsInterval&&(this.openvidu.webrtcStatsInterval=S.webrtcStatsInterval),S.sendBrowserLogs&&(this.openvidu.sendBrowserLogs=S.sendBrowserLogs),this.openvidu.isAtLeastPro=S.edition==="pro"||S.edition==="enterprise",this.openvidu.isEnterprise=S.edition==="enterprise",this.openvidu.wsUri=S.wsUri,this.openvidu.httpUri=S.httpUri},D.prototype.processJoinRoomResponse=function(r,S){if(this.sessionId=r.session,r.customIceServers!=null&&r.customIceServers.length>0){this.openvidu.iceServers=[];for(var N=0,R=r.customIceServers;N<R.length;N++){var m=R[N],O={urls:[m.url]};t.log("STUN/TURN server IP: "+m.url),m.username!=null&&m.credential!=null&&(O.username=m.username,O.credential=m.credential,t.log("TURN credentials ["+m.username+":"+m.credential+"]")),this.openvidu.iceServers.push(O)}}this.openvidu.role=r.role,this.openvidu.finalUserId=r.finalUserId,this.openvidu.mediaServer=r.mediaServer,this.openvidu.videoSimulcast=r.videoSimulcast,this.capabilities={subscribe:!0,publish:this.openvidu.role!=="SUBSCRIBER",forceUnpublish:this.openvidu.role==="MODERATOR",forceDisconnect:this.openvidu.role==="MODERATOR"},t.info("openvidu-server version: "+r.version),r.life!=null&&(this.openvidu.life=r.life);var A=l(r.version)-l(this.openvidu.libraryVersion);e(r.version)!==e(this.openvidu.libraryVersion)||!(A==0||A==1)?t.error("openvidu-browser (".concat(this.openvidu.libraryVersion,") and openvidu-server (").concat(r.version,") versions are incompatible. ")+"Errors are likely to occur. openvidu-browser SDK is only compatible with the same version or the immediately following minor version of an OpenVidu deployment"):A==1&&t.warn("openvidu-browser version ".concat(this.openvidu.libraryVersion," does not match openvidu-server version ").concat(r.version,". ")+"These versions are still compatible with each other, but openvidu-browser version must be updated as soon as possible to ".concat(e(r.version),".").concat(l(r.version),".x. ")+"This client using openvidu-browser ".concat(this.openvidu.libraryVersion," will become incompatible with the next release of openvidu-server")),x.OpenViduLogger.configureJSNLog(this.openvidu,S),this.token=S},D}(o.EventDispatcher);return le.Session=T,le}var yr;function rn(){if(yr)return de;yr=1;var p=de&&de.__extends||function(){var v=function(u,s){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,x){C.__proto__=x}||function(C,x){for(var b in x)Object.prototype.hasOwnProperty.call(x,b)&&(C[b]=x[b])},v(u,s)};return function(u,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");v(u,s);function C(){this.constructor=u}u.prototype=s===null?Object.create(s):(C.prototype=s.prototype,new C)}}(),k=de&&de.__awaiter||function(v,u,s,C){function x(b){return b instanceof s?b:new s(function(e){e(b)})}return new(s||(s=Promise))(function(b,e){function l(g){try{t(C.next(g))}catch(T){e(T)}}function I(g){try{t(C.throw(g))}catch(T){e(T)}}function t(g){g.done?b(g.value):x(g.value).then(l,I)}t((C=C.apply(v,u||[])).next())})},y=de&&de.__generator||function(v,u){var s={label:0,sent:function(){if(b[0]&1)throw b[1];return b[1]},trys:[],ops:[]},C,x,b,e;return e={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e;function l(t){return function(g){return I([t,g])}}function I(t){if(C)throw new TypeError("Generator is already executing.");for(;e&&(e=0,t[0]&&(s=0)),s;)try{if(C=1,x&&(b=t[0]&2?x.return:t[0]?x.throw||((b=x.return)&&b.call(x),0):x.next)&&!(b=b.call(x,t[1])).done)return b;switch(x=0,b&&(t=[t[0]&2,b.value]),t[0]){case 0:case 1:b=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,x=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(b=s.trys,!(b=b.length>0&&b[b.length-1])&&(t[0]===6||t[0]===2)){s=0;continue}if(t[0]===3&&(!b||t[1]>b[0]&&t[1]<b[3])){s.label=t[1];break}if(t[0]===6&&s.label<b[1]){s.label=b[1],b=t;break}if(b&&s.label<b[2]){s.label=b[2],s.ops.push(t);break}b[2]&&s.ops.pop(),s.trys.pop();continue}t=u.call(v,s)}catch(g){t=[6,g],x=0}finally{C=b=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}};Object.defineProperty(de,"__esModule",{value:!0}),de.Publisher=void 0;var f=Et(),d=en(),c=Yt(),o=nn(),a=Ae(),i=Ve(),n=oe(),E=me(),w=Zt(),_=n.OpenViduLogger.getInstance(),h,P=function(v){p(u,v);function u(s,C,x){var b=v.call(this,new d.Stream(x.session?x.session:new f.Session(x),{publisherProperties:C,mediaConstraints:{}}),s)||this;return b.accessAllowed=!1,b.isSubscribedToRemote=!1,b.accessDenied=!1,h=E.PlatformUtils.getInstance(),b.properties=C,b.openvidu=x,b.stream.ee.on("local-stream-destroyed",function(e){b.stream.isLocalStreamPublished=!1;var l=new o.StreamEvent(!0,b,"streamDestroyed",b.stream,e);b.emitEvent("streamDestroyed",[l]),l.callDefaultBehavior()}),b}return u.prototype.publishAudio=function(s){var C=this;if(this.stream.audioActive!==s){var x=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream();x.getAudioTracks().forEach(function(b){b.enabled=s}),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"audioActive",newValue:s,reason:"publishAudio"},function(b,e){b?_.error("Error sending 'streamPropertyChanged' event",b):(C.session.emitEvent("streamPropertyChanged",[new a.StreamPropertyChangedEvent(C.session,C.stream,"audioActive",s,!s,"publishAudio")]),C.emitEvent("streamPropertyChanged",[new a.StreamPropertyChangedEvent(C,C.stream,"audioActive",s,!s,"publishAudio")]),C.session.sendVideoData(C.stream.streamManager))}),this.stream.audioActive=s,_.info("'Publisher' has "+(s?"published":"unpublished")+" its audio stream")}},u.prototype.publishVideo=function(s,C){var x=this;return new Promise(function(b,e){return k(x,void 0,void 0,function(){var l,I,t,g,T,L,D=this;return y(this,function(r){switch(r.label){case 0:return this.stream.videoActive===s?[3,9]:(l=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream(),I=!1,l.getVideoTracks().forEach(function(S){S.enabled=s,!s&&C===!0?S.stop():s&&S.readyState==="ended"&&(I=!0)}),!s&&C===!0&&this.stream.filter&&this.stream.filter.type.startsWith("VB:")?(this.stream.lastVBFilter=this.stream.filter,[4,this.stream.removeFilterAux(!0)]):[3,2]);case 1:r.sent(),r.label=2;case 2:return I?(t=l.getVideoTracks()[0],l.removeTrack(t),g=function(S){return k(D,void 0,void 0,function(){var N=this;return y(this,function(R){switch(R.label){case 0:return l.addTrack(S),this.stream.isLocalStreamPublished?[4,this.replaceTrackInRtcRtpSender(S)]:[3,2];case 1:R.sent(),R.label=2;case 2:return this.stream.lastVBFilter&&setTimeout(function(){return k(N,void 0,void 0,function(){var m,O;return y(this,function(A){switch(A.label){case 0:return m=this.stream.lastVBFilter.options,O=this.stream.lastVBFilter.lastExecMethod,O&&O.method==="update"&&(m=Object.assign({},m,O.params)),[4,this.stream.applyFilter(this.stream.lastVBFilter.type,m)];case 1:return A.sent(),delete this.stream.lastVBFilter,[2]}})})},1),[2]}})})},C&&C instanceof MediaStreamTrack?[4,g(C)]:[3,4]):[3,8];case 3:return r.sent(),[3,8];case 4:return r.trys.push([4,7,,8]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:this.stream.lastVideoTrackConstraints})];case 5:return T=r.sent(),[4,g(T.getVideoTracks()[0])];case 6:return r.sent(),[3,8];case 7:return L=r.sent(),[2,e(L)];case 8:return this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"videoActive",newValue:s,reason:"publishVideo"},function(S,N){S?_.error("Error sending 'streamPropertyChanged' event",S):(D.session.emitEvent("streamPropertyChanged",[new a.StreamPropertyChangedEvent(D.session,D.stream,"videoActive",s,!s,"publishVideo")]),D.emitEvent("streamPropertyChanged",[new a.StreamPropertyChangedEvent(D,D.stream,"videoActive",s,!s,"publishVideo")]),D.session.sendVideoData(D.stream.streamManager))}),this.stream.videoActive=s,_.info("'Publisher' has "+(s?"published":"unpublished")+" its video stream"),[2,b()];case 9:return[2]}})})})},u.prototype.subscribeToRemote=function(s){s=s!==void 0?s:!0,this.isSubscribedToRemote=s,this.stream.subscribeToMyRemote(s)},u.prototype.on=function(s,C){var x=this;return v.prototype.on.call(this,s,C),s==="streamCreated"&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new o.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.on("stream-created-by-publisher",function(){x.emitEvent("streamCreated",[new o.StreamEvent(!1,x,"streamCreated",x.stream,"")])})),s==="accessAllowed"&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),s==="accessDenied"&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},u.prototype.once=function(s,C){var x=this;return v.prototype.once.call(this,s,C),s==="streamCreated"&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new o.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.once("stream-created-by-publisher",function(){x.emitEvent("streamCreated",[new o.StreamEvent(!1,x,"streamCreated",x.stream,"")])})),s==="accessAllowed"&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),s==="accessDenied"&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},u.prototype.off=function(s,C){return v.prototype.off.call(this,s,C),this},u.prototype.replaceTrack=function(s){return k(this,void 0,void 0,function(){return y(this,function(C){return[2,this.replaceTrackAux(s,!0)]})})},u.prototype.initialize=function(){var s=this;return new Promise(function(C,x){return k(s,void 0,void 0,function(){var b,e,l,I,t,g,T,L,D,r,S,N,N,R,m,O=this,A,V;return y(this,function(B){switch(B.label){case 0:b={},e={},l=2e3,t=function(j){return O.accessDenied=!0,O.accessAllowed=!1,_.error("Publisher initialization failed. ".concat(j.name,": ").concat(j.message)),x(j)},g=function(j){var $,F;if(O.accessAllowed=!0,O.accessDenied=!1,typeof MediaStreamTrack<"u"&&O.properties.audioSource instanceof MediaStreamTrack&&(j.removeTrack(j.getAudioTracks()[0]),j.addTrack(O.properties.audioSource)),typeof MediaStreamTrack<"u"&&O.properties.videoSource instanceof MediaStreamTrack&&(j.removeTrack(j.getVideoTracks()[0]),j.addTrack(O.properties.videoSource)),j.getAudioTracks()[0]){var G=O.stream.audioActive!==void 0&&O.stream.audioActive!==null?O.stream.audioActive:!!O.stream.outboundStreamOpts.publisherProperties.publishAudio;j.getAudioTracks()[0].enabled=G}if(j.getVideoTracks()[0]){var G=O.stream.videoActive!==void 0&&O.stream.videoActive!==null?O.stream.videoActive:!!O.stream.outboundStreamOpts.publisherProperties.publishVideo;j.getVideoTracks()[0].enabled=G}for(var M=0,z=j.getAudioTracks();M<z.length;M++){var H=z[M];!(($=H.contentHint)===null||$===void 0)&&$.length||(H.contentHint="",_.info("Audio track Content Hint set: '".concat(H.contentHint,"'")))}for(var Q=0,K=j.getVideoTracks();Q<K.length;Q++){var H=K[Q];if(!(!((F=H.contentHint)===null||F===void 0)&&F.length)){switch(O.stream.typeOfVideo){case w.TypeOfVideo.SCREEN:H.contentHint="detail";break;case w.TypeOfVideo.CUSTOM:_.warn("CUSTOM type video track was provided without Content Hint!"),H.contentHint="motion";break;case w.TypeOfVideo.CAMERA:case w.TypeOfVideo.IPCAM:default:H.contentHint="motion";break}_.info("Video track Content Hint set: '".concat(H.contentHint,"'"))}}return O.initializeVideoReference(j),O.stream.displayMyRemote()||O.stream.updateMediaStreamInVideos(),delete O.firstVideoElement,O.stream.isSendVideo()?O.getVideoDimensions().then(function(U){O.stream.videoDimensions={width:U.width,height:U.height},O.stream.isSendScreen()&&(O.stream.isSendAudio()&&j.getAudioTracks().length===0&&(O.stream.audioActive=!1,O.stream.hasAudio=!1,O.stream.outboundStreamOpts.publisherProperties.publishAudio=!1,O.stream.outboundStreamOpts.publisherProperties.audioSource=!1),O.screenShareResizeInterval=setInterval(function(){var re=j.getVideoTracks()[0].getSettings(),X=re.width,q=re.height,J=X!=null&&X!==O.stream.videoDimensions.width,Z=q!=null&&q!==O.stream.videoDimensions.height;O.stream.isLocalStreamPublished&&(J||Z)&&O.openvidu.sendVideoDimensionsChangedEvent(O,"screenResized",O.stream.videoDimensions.width,O.stream.videoDimensions.height,X||0,q||0)},650)),O.stream.isLocalStreamReadyToPublish=!0,O.stream.ee.emitEvent("stream-ready-to-publish",[])}):(O.stream.isLocalStreamReadyToPublish=!0,O.stream.ee.emitEvent("stream-ready-to-publish",[])),C()},T=function(j,$){return k(O,void 0,void 0,function(){var F,G;return y(this,function(M){switch(M.label){case 0:if(this.clearPermissionDialogTimer(I,l),!(this.stream.isSendScreen()&&this.properties.audioSource!=="screen"&&this.stream.isSendAudio()))return[3,5];e.audio=$,e.video=!1,I=Date.now(),this.setPermissionDialogTimer(l),M.label=1;case 1:return M.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia(e)];case 2:return F=M.sent(),this.clearPermissionDialogTimer(I,l),j.addTrack(F.getAudioTracks()[0]),g(j),[3,4];case 3:return G=M.sent(),this.clearPermissionDialogTimer(I,l),j.getAudioTracks().forEach(function(z){z.stop()}),j.getVideoTracks().forEach(function(z){z.stop()}),t(this.openvidu.generateAudioDeviceError(G,b)),[2];case 4:return[3,6];case 5:g(j),M.label=6;case 6:return[2]}})})},L=function(j){return k(O,void 0,void 0,function(){var $,F,G,z,M,z,H;return y(this,function(Q){switch(Q.label){case 0:switch(_.error("getMediaError: ".concat(j.toString())),this.clearPermissionDialogTimer(I,l),j.name==="Error"&&(j.name=j.constructor.name),G=j.name.toLowerCase(),G){case"notfounderror":return[3,1];case"notallowederror":return[3,5];case"overconstrainederror":return[3,6];case"aborterror":return[3,10];case"notreadableerror":return[3,10]}return[3,11];case 1:return Q.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:b.video})];case 2:return z=Q.sent(),z.getVideoTracks().forEach(function(K){K.stop()}),$=i.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,F=j.toString(),t(new i.OpenViduError($,F)),[3,4];case 3:return M=Q.sent(),$=i.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,F=M.toString(),t(new i.OpenViduError($,F)),[3,4];case 4:return[3,12];case 5:return $=this.stream.isSendScreen()?i.OpenViduErrorName.SCREEN_CAPTURE_DENIED:i.OpenViduErrorName.DEVICE_ACCESS_DENIED,F=j.toString(),t(new i.OpenViduError($,F)),[3,12];case 6:return Q.trys.push([6,8,,9]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:b.video})];case 7:return z=Q.sent(),z.getVideoTracks().forEach(function(K){K.stop()}),j.constraint.toLowerCase()==="deviceid"?($=i.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,F="Audio input device with deviceId '"+b.audio.deviceId.exact+"' not found"):($=i.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,F="Audio input device doesn't support the value passed for constraint '"+j.constraint+"'"),t(new i.OpenViduError($,F)),[3,9];case 8:return H=Q.sent(),H.constraint.toLowerCase()==="deviceid"?($=i.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,F="Video input device with deviceId '"+b.video.deviceId.exact+"' not found"):($=i.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,F="Video input device doesn't support the value passed for constraint '"+H.constraint+"'"),t(new i.OpenViduError($,F)),[3,9];case 9:return[3,12];case 10:return $=i.OpenViduErrorName.DEVICE_ALREADY_IN_USE,F=j.toString(),t(new i.OpenViduError($,F)),[3,12];case 11:return $=i.OpenViduErrorName.GENERIC_ERROR,F=j.toString(),t(new i.OpenViduError($,F)),[3,12];case 12:return[2]}})})},B.label=1;case 1:return B.trys.push([1,14,,15]),[4,this.openvidu.generateMediaConstraints(this.properties)];case 2:return D=B.sent(),D.videoTrack&&D.audioTrack||D.audioTrack&&((A=D.constraints)===null||A===void 0?void 0:A.video)===!1||D.videoTrack&&((V=D.constraints)===null||V===void 0?void 0:V.audio)===!1?(g(this.openvidu.addAlreadyProvidedTracks(D,new MediaStream,this.stream)),[3,13]):[3,3];case 3:b=D.constraints,r={mediaConstraints:b,publisherProperties:this.properties},this.stream.setOutboundStreamOptions(r),S=b.audio===void 0?!0:b.audio,e.audio=this.stream.isSendScreen()?!1:S,e.video=b.video,I=Date.now(),this.setPermissionDialogTimer(l),B.label=4;case 4:return B.trys.push([4,11,,13]),this.stream.isSendScreen()&&navigator.mediaDevices.getDisplayMedia&&!h.isElectron()?[4,navigator.mediaDevices.getDisplayMedia({video:!0,audio:this.properties.audioSource==="screen"})]:[3,7];case 5:return N=B.sent(),this.openvidu.addAlreadyProvidedTracks(D,N),[4,T(N,S)];case 6:return B.sent(),[3,10];case 7:return this.stream.lastVideoTrackConstraints=e.video,[4,navigator.mediaDevices.getUserMedia(e)];case 8:return N=B.sent(),this.openvidu.addAlreadyProvidedTracks(D,N,this.stream),[4,T(N,S)];case 9:B.sent(),B.label=10;case 10:return[3,13];case 11:return R=B.sent(),[4,L(R)];case 12:return B.sent(),[3,13];case 13:return[3,15];case 14:return m=B.sent(),t(m),[3,15];case 15:return[2]}})})})},u.prototype.replaceTrackAux=function(s,C){return k(this,void 0,void 0,function(){var x,b;return y(this,function(e){switch(e.label){case 0:x=s.enabled,s.kind==="video"?s.enabled=this.stream.videoActive:s.kind==="audio"&&(s.enabled=this.stream.audioActive),e.label=1;case 1:return e.trys.push([1,5,,6]),this.stream.isLocalStreamPublished?(this.replaceTrackInMediaStream(s,C),[4,this.replaceTrackInRtcRtpSender(s)]):[3,3];case 2:return[2,e.sent()];case 3:return[2,this.replaceTrackInMediaStream(s,C)];case 4:return[3,6];case 5:throw b=e.sent(),s.enabled=x,b;case 6:return[2]}})})},u.prototype.getVideoDimensions=function(){var s=this;return new Promise(function(C,x){var b=(h.isIonicIos()||h.isIOSWithSafari())&&s.videoReference.readyState<1,e,l=function(){var I,t;if(typeof s.stream.getMediaStream().getVideoTracks()[0].getSettings=="function"){var g=s.stream.getMediaStream().getVideoTracks()[0].getSettings();I=g.width||s.videoReference.videoWidth,t=g.height||s.videoReference.videoHeight}else _.warn("MediaStreamTrack does not have getSettings method on "+h.getDescription()),I=s.videoReference.videoWidth,t=s.videoReference.videoHeight;return e!=null&&s.videoReference.removeEventListener("loadedmetadata",e),b&&document.body.removeChild(s.videoReference),C({width:I,height:t})};s.videoReference.readyState>=1?l():(e=function(){if(s.videoReference.videoWidth)l();else var I=setInterval(function(){s.videoReference.videoWidth&&(clearInterval(I),l())},40)},s.videoReference.addEventListener("loadedmetadata",e),b&&document.body.appendChild(s.videoReference))})},u.prototype.reestablishStreamPlayingEvent=function(){this.ee.getListeners("streamPlaying").length>0&&this.addPlayEventToFirstVideo()},u.prototype.initializeVideoReference=function(s){this.videoReference=document.createElement("video"),this.videoReference.style.display="none",this.videoReference.muted=!0,this.videoReference.autoplay=!0,this.videoReference.controls=!1,(h.isSafariBrowser()||h.isIPhoneOrIPad()&&(h.isChromeMobileBrowser()||h.isEdgeMobileBrowser()||h.isOperaMobileBrowser()||h.isFirefoxMobileBrowser()))&&(this.videoReference.playsInline=!0),this.stream.setMediaStream(s),this.firstVideoElement&&this.createVideoElement(this.firstVideoElement.targetElement,this.properties.insertMode),this.videoReference.srcObject=this.stream.getMediaStream()},u.prototype.replaceTrackInMediaStream=function(s,C){var x=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream(),b;s.kind==="video"?(b=x.getVideoTracks()[0],C&&(this.stream.lastVideoTrackConstraints=s.getConstraints())):b=x.getAudioTracks()[0],b.enabled=!1,b.stop(),x.removeTrack(b),x.addTrack(s);var e={oldLabel:(b==null?void 0:b.label)||"",newLabel:(s==null?void 0:s.label)||""};s.kind==="video"&&C?(this.openvidu.sendNewVideoDimensionsIfRequired(this,"trackReplaced",50,30),this.openvidu.sendTrackChangedEvent(this,e.oldLabel,e.newLabel,"videoTrack"),this.stream.isLocalStreamPublished&&this.session.sendVideoData(this.stream.streamManager,5,!0,5)):s.kind==="audio"&&C&&this.openvidu.sendTrackChangedEvent(this,e.oldLabel,e.newLabel,"audioTrack"),s.kind==="audio"&&(this.stream.disableHarkSpeakingEvent(!1),this.stream.disableHarkStoppedSpeakingEvent(!1),this.stream.disableHarkVolumeChangeEvent(!1),this.stream.initHarkEvents())},u.prototype.setPermissionDialogTimer=function(s){var C=this;this.permissionDialogTimeout=setTimeout(function(){C.emitEvent("accessDialogOpened",[])},s)},u.prototype.clearPermissionDialogTimer=function(s,C){clearTimeout(this.permissionDialogTimeout),Date.now()-s>C&&this.emitEvent("accessDialogClosed",[])},u.prototype.replaceTrackInRtcRtpSender=function(s){return k(this,void 0,void 0,function(){var C,x;return y(this,function(b){switch(b.label){case 0:if(C=this.stream.getRTCPeerConnection().getSenders(),s.kind==="video"){if(x=C.find(function(e){return!!e.track&&e.track.kind==="video"}),!x)throw new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")}else if(s.kind==="audio"){if(x=C.find(function(e){return!!e.track&&e.track.kind==="audio"}),!x)throw new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")}else throw new Error("Unknown track kind "+s.kind);return[4,x.replaceTrack(s)];case 1:return b.sent(),[2]}})})},u}(c.StreamManager);return de.Publisher=P,de}var jt={},wr;function Wi(){if(wr)return jt;wr=1,globalThis.getScreenId=function(c,o,a){if(navigator.userAgent.indexOf("Edge")!==-1&&(navigator.msSaveOrOpenBlob||navigator.msSaveBlob)){o({video:!0});return}if(navigator.mozGetUserMedia){o(null,"firefox",{video:{mozMediaSource:c,mediaSource:c}});return}globalThis.addEventListener("message",i);function i(n){n.data&&(n.data.chromeMediaSourceId&&(n.data.chromeMediaSourceId==="PermissionDeniedError"?o("permission-denied"):o(null,n.data.chromeMediaSourceId,p(null,n.data.chromeMediaSourceId,n.data.canRequestAudioTrack)),globalThis.removeEventListener("message",i)),n.data.chromeExtensionStatus&&(o(n.data.chromeExtensionStatus,null,p(n.data.chromeExtensionStatus)),globalThis.removeEventListener("message",i)))}setTimeout(a?function(){k(a)}:k,100)};function p(c,o,a){var i={audio:!1,video:{mandatory:{chromeMediaSource:c?"screen":"desktop",maxWidth:globalThis.screen.width>1920?globalThis.screen.width:1920,maxHeight:globalThis.screen.height>1080?globalThis.screen.height:1080},optional:[]}};return a&&(i.audio={mandatory:{chromeMediaSource:c?"screen":"desktop"},optional:[]}),o&&(i.video.mandatory.chromeMediaSourceId=o,i.audio&&i.audio.mandatory&&(i.audio.mandatory.chromeMediaSourceId=o)),i}function k(c){if(!y){f(function(){k(c)});return}if(!y.isLoaded){setTimeout(function(){k(c)},100);return}c?c.forEach?y.contentWindow.postMessage({captureCustomSourceId:c},"*"):y.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):y.contentWindow.postMessage({captureSourceId:!0},"*")}var y;globalThis.getScreenConstraints=function(c){f(function(){getScreenId(function(o,a,i){i||(i={video:!0}),c(o,i.video)})})};function f(c){if(y){c();return}y=document.createElement("iframe"),y.onload=function(){y.isLoaded=!0,c()},y.src="https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/",y.style.display="none",(document.body||document.documentElement).appendChild(y)}globalThis.getChromeExtensionStatus=function(c){if(navigator.mozGetUserMedia){c("installed-enabled");return}globalThis.addEventListener("message",o);function o(a){a.data&&a.data.chromeExtensionStatus&&(c(a.data.chromeExtensionStatus),globalThis.removeEventListener("message",o))}setTimeout(d,100)};function d(){if(!y){f(d);return}if(!y.isLoaded){setTimeout(d,100);return}y.contentWindow.postMessage({getChromeExtensionStatus:!0},"*")}return jt.getScreenId=globalThis.getScreenId,jt}var Le={},Or;function $i(){if(Or)return Le;Or=1;var p="screen",k,y;if(typeof window<"u"&&typeof navigator<"u"&&typeof navigator.userAgent<"u"){var f=typeof window.InstallTrigger<"u";window.opera||navigator.userAgent.indexOf(" OPR/")>=0,window.addEventListener("message",function(w){w.origin==window.location.origin&&d(w.data)})}function d(w){if(w=="PermissionDeniedError"){if(y)return y("PermissionDeniedError");throw new Error("PermissionDeniedError")}w=="rtcmulticonnection-extension-loaded"&&(p="desktop"),w.sourceId&&y&&y(k=w.sourceId,w.canRequestAudioTrack===!0)}function c(w){if(w){if(p=="desktop")return w(!0);window.postMessage("are-you-there","*"),setTimeout(function(){p=="screen"?w(!1):w(!0)},2e3)}}function o(w){if(!w)throw'"callback" parameter is mandatory.';if(k)return w(k);y=w,window.postMessage("get-sourceId","*")}function a(w){if(!w)throw'"callback" parameter is mandatory.';if(k)return w(k);y=w,window.postMessage("audio-plus-tab","*")}function i(w,_){if(f)return _("not-chrome");arguments.length!=2&&(_=w,w="lfcgfepafnobdloecchnfaclibenjold");var h=document.createElement("img");h.src="chrome-extension://"+w+"/icon.png",h.onload=function(){p="screen",window.postMessage("are-you-there","*"),setTimeout(function(){p=="screen"?_("installed-disabled"):_("installed-enabled")},2e3)},h.onerror=function(){_("not-installed")}}function n(w){E(w,!0)}function E(w,_){k="";var h={mozMediaSource:"window",mediaSource:"window"};if(f)return w(null,h);var P={mandatory:{chromeMediaSource:p,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};if(p=="desktop"&&!k){_?a(function(v,u){P.mandatory.chromeMediaSourceId=v,u&&(P.canRequestAudioTrack=!0),w(v=="PermissionDeniedError"?v:null,P)}):o(function(v){P.mandatory.chromeMediaSourceId=v,w(v=="PermissionDeniedError"?v:null,P)});return}p=="desktop"&&(P.mandatory.chromeMediaSourceId=k),w(null,P)}return Le.getScreenConstraints=E,Le.getScreenConstraintsWithAudio=n,Le.isChromeExtensionAvailable=c,Le.getChromeExtensionStatus=i,Le.getSourceId=o,Le}var ut={exports:{}},Rr;function Hi(){if(Rr)return ut.exports;Rr=1;var p=typeof Reflect=="object"?Reflect:null,k=p&&typeof p.apply=="function"?p.apply:function(e,l,I){return Function.prototype.apply.call(e,l,I)},y;p&&typeof p.ownKeys=="function"?y=p.ownKeys:Object.getOwnPropertySymbols?y=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:y=function(e){return Object.getOwnPropertyNames(e)};function f(b){console&&console.warn&&console.warn(b)}var d=Number.isNaN||function(e){return e!==e};function c(){c.init.call(this)}ut.exports=c,ut.exports.once=s,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||d(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),c.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||d(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function i(b){return b._maxListeners===void 0?c.defaultMaxListeners:b._maxListeners}c.prototype.getMaxListeners=function(){return i(this)},c.prototype.emit=function(e){for(var l=[],I=1;I<arguments.length;I++)l.push(arguments[I]);var t=e==="error",g=this._events;if(g!==void 0)t=t&&g.error===void 0;else if(!t)return!1;if(t){var T;if(l.length>0&&(T=l[0]),T instanceof Error)throw T;var L=new Error("Unhandled error."+(T?" ("+T.message+")":""));throw L.context=T,L}var D=g[e];if(D===void 0)return!1;if(typeof D=="function")k(D,this,l);else for(var r=D.length,S=P(D,r),I=0;I<r;++I)k(S[I],this,l);return!0};function n(b,e,l,I){var t,g,T;if(a(l),g=b._events,g===void 0?(g=b._events=Object.create(null),b._eventsCount=0):(g.newListener!==void 0&&(b.emit("newListener",e,l.listener?l.listener:l),g=b._events),T=g[e]),T===void 0)T=g[e]=l,++b._eventsCount;else if(typeof T=="function"?T=g[e]=I?[l,T]:[T,l]:I?T.unshift(l):T.push(l),t=i(b),t>0&&T.length>t&&!T.warned){T.warned=!0;var L=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");L.name="MaxListenersExceededWarning",L.emitter=b,L.type=e,L.count=T.length,f(L)}return b}c.prototype.addListener=function(e,l){return n(this,e,l,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,l){return n(this,e,l,!0)};function E(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function w(b,e,l){var I={fired:!1,wrapFn:void 0,target:b,type:e,listener:l},t=E.bind(I);return t.listener=l,I.wrapFn=t,t}c.prototype.once=function(e,l){return a(l),this.on(e,w(this,e,l)),this},c.prototype.prependOnceListener=function(e,l){return a(l),this.prependListener(e,w(this,e,l)),this},c.prototype.removeListener=function(e,l){var I,t,g,T,L;if(a(l),t=this._events,t===void 0)return this;if(I=t[e],I===void 0)return this;if(I===l||I.listener===l)--this._eventsCount===0?this._events=Object.create(null):(delete t[e],t.removeListener&&this.emit("removeListener",e,I.listener||l));else if(typeof I!="function"){for(g=-1,T=I.length-1;T>=0;T--)if(I[T]===l||I[T].listener===l){L=I[T].listener,g=T;break}if(g<0)return this;g===0?I.shift():v(I,g),I.length===1&&(t[e]=I[0]),t.removeListener!==void 0&&this.emit("removeListener",e,L||l)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var l,I,t;if(I=this._events,I===void 0)return this;if(I.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):I[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete I[e]),this;if(arguments.length===0){var g=Object.keys(I),T;for(t=0;t<g.length;++t)T=g[t],T!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(l=I[e],typeof l=="function")this.removeListener(e,l);else if(l!==void 0)for(t=l.length-1;t>=0;t--)this.removeListener(e,l[t]);return this};function _(b,e,l){var I=b._events;if(I===void 0)return[];var t=I[e];return t===void 0?[]:typeof t=="function"?l?[t.listener||t]:[t]:l?u(t):P(t,t.length)}c.prototype.listeners=function(e){return _(this,e,!0)},c.prototype.rawListeners=function(e){return _(this,e,!1)},c.listenerCount=function(b,e){return typeof b.listenerCount=="function"?b.listenerCount(e):h.call(b,e)},c.prototype.listenerCount=h;function h(b){var e=this._events;if(e!==void 0){var l=e[b];if(typeof l=="function")return 1;if(l!==void 0)return l.length}return 0}c.prototype.eventNames=function(){return this._eventsCount>0?y(this._events):[]};function P(b,e){for(var l=new Array(e),I=0;I<e;++I)l[I]=b[I];return l}function v(b,e){for(;e+1<b.length;e++)b[e]=b[e+1];b.pop()}function u(b){for(var e=new Array(b.length),l=0;l<e.length;++l)e[l]=b[l].listener||b[l];return e}function s(b,e){return new Promise(function(l,I){function t(T){b.removeListener(e,g),I(T)}function g(){typeof b.removeListener=="function"&&b.removeListener("error",t),l([].slice.call(arguments))}x(b,e,g,{once:!0}),e!=="error"&&C(b,t,{once:!0})})}function C(b,e,l){typeof b.on=="function"&&x(b,"error",e,l)}function x(b,e,l,I){if(typeof b.on=="function")I.once?b.once(e,l):b.on(e,l);else if(typeof b.addEventListener=="function")b.addEventListener(e,function t(g){I.once&&b.removeEventListener(e,t),l(g)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return ut.exports}var dt={exports:{}},Cr;function Gi(){return Cr||(Cr=1,typeof Object.create=="function"?dt.exports=function(k,y){y&&(k.super_=y,k.prototype=Object.create(y.prototype,{constructor:{value:k,enumerable:!1,writable:!0,configurable:!0}}))}:dt.exports=function(k,y){if(y){k.super_=y;var f=function(){};f.prototype=y.prototype,k.prototype=new f,k.prototype.constructor=k}}),dt.exports}var lt={},ft={},_r;function zi(){if(_r)return ft;_r=1;function p(y,f){var d={jsonrpc:"2.0"};if(y.method)d.method=y.method,y.params&&(d.params=y.params),f!=null&&(d.id=f);else if(f!=null){if(y.error){if(y.result!==void 0)throw new TypeError("Both result and error are defined");d.error=y.error}else if(y.result!==void 0)d.result=y.result;else throw new TypeError("No result or error is defined");d.id=f}return JSON.stringify(d)}function k(y){var f=y;(typeof y=="string"||y instanceof String)&&(f=JSON.parse(y));var d=f.jsonrpc;if(d!=="2.0")throw new TypeError("Invalid JsonRPC version '"+d+"': "+y);if(f.method==null){if(f.id==null)throw new TypeError("Invalid message: "+y);var c=f.result!==void 0,o=f.error!==void 0;if(c&&o)throw new TypeError("Both result and error are defined: "+y);if(!c&&!o)throw new TypeError("No result or error is defined: "+y);f.ack=f.id,delete f.id}return f}return ft.pack=p,ft.unpack=k,ft}var ht={},Ir;function Xi(){if(Ir)return ht;Ir=1;function p(y){throw new TypeError("Not yet implemented")}function k(y){throw new TypeError("Not yet implemented")}return ht.pack=p,ht.unpack=k,ht}var Pr;function Ji(){if(Pr)return lt;Pr=1;var p=zi(),k=Xi();return lt.JsonRPC=p,lt.XmlRPC=k,lt}var qt,Tr;function Ki(){if(Tr)return qt;Tr=1;function p(){var k={};this.forEach=function(y){for(var f in k){var d=k[f];for(var c in d)y(d[c])}},this.get=function(y,f){var d=k[f];if(d!=null)return d[y]},this.remove=function(y,f){var d=k[f];if(d!=null){delete d[y];for(var c in d)return!1;delete k[f]}},this.set=function(y,f,d){if(y==null)return this.remove(f,d);var c=k[d];c==null&&(k[d]=c={}),c[f]=y}}return p.prototype.pop=function(k,y){var f=this.get(k,y);if(f!=null)return this.remove(k,y),f},qt=p,qt}var Ft={},Ut,kr;function si(){if(kr)return Ut;kr=1;var p=oe().OpenViduLogger,k=p.getInstance(),y=2e3,f=3e3,d=3;function c(o){var a=!1,i,n=o.uri,E=!1,w=new WebSocket(n);w.onopen=function(){k.debug("WebSocket connected to "+n),o.onconnected&&o.onconnected()},w.onerror=function(u){k.error("Could not connect to "+n+" (invoking onerror if defined)",u),o.onerror&&o.onerror(u)};var _=function(){w.readyState===d?a?k.debug("Connection closed by user"):o.ismasternodecrashed()?k.error("Master Node has crashed. Stopping reconnection process"):(k.debug("Connection closed unexpectedly. Reconnecting..."),h(y,1)):k.debug("Close callback from previous websocket. Ignoring it")};w.onclose=_;function h(u,s){if(k.debug("reconnect (attempt #"+s+", max="+u+")"),s===1){if(E){k.warn("Trying to reconnect when already reconnecting... Ignoring this reconnection.");return}else E=!0;o.onreconnecting&&o.onreconnecting()}v(u,s)}function P(u){var s=new URLSearchParams(new URL(u).search);return s.has("reconnect")||(u=Array.from(s).length>0?u+"&reconnect=true":u+"?reconnect=true"),u}function v(u,s){k.debug("Reconnection attempt #"+s),w.close(4104,"Connection closed for reconnection"),n=P(n),w=new WebSocket(n),w.onopen=function(){k.debug("Reconnected to "+n+" after "+s+" attempts..."),E=!1,i(),o.onreconnected&&o.onreconnected(),w.onclose=_},w.onerror=function(C){k.warn("Reconnection error: ",C),s===u?o.ondisconnect&&o.ondisconnect():setTimeout(function(){h(u,s+1)},f)}}this.close=function(u,s){a=!0,w.close(u,s)},this.reconnectWs=function(){k.debug("reconnectWs"),h(y,1)},this.send=function(u){w.send(u)},this.addEventListener=function(u,s){i=function(){w.addEventListener(u,s)},i()},this.getReadyState=function(){return w.readyState}}return Ut=c,Ut}var Wt,xr;function Yi(){if(xr)return Wt;xr=1;var p=ai(),k=si(),y=oe().OpenViduLogger;Date.now=Date.now||function(){return+new Date};var f=5e3,d="RECONNECTING",c="CONNECTED",o="DISCONNECTED",a=y.getInstance();function i(n){var E=this,w=n.ws,_=-1,h=0,P=!0,v=!1,u,s=o,C=w.onreconnecting,x=w.onreconnected,b=w.onconnected,e=w.onerror;n.rpc.pull=function(r,S){S.reply(null,"push")},w.onreconnecting=function(){if(a.debug("--------- ONRECONNECTING -----------"),s===d){a.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it");return}D(),s=d,C&&C()},w.onreconnected=function(){if(a.debug("--------- ONRECONNECTED -----------"),s===c){a.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it");return}s=c,g(),x&&x()},w.onconnected=function(){if(a.debug("--------- ONCONNECTED -----------"),s===c){a.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it");return}s=c,P=!0,L(),b&&b()},w.onerror=function(r){a.debug("--------- ONERROR -----------"),s=o,D(),e&&e(r)};var l=new k(w);a.debug("Connecting websocket to URI: "+w.uri);var I={request_timeout:n.rpc.requestTimeout,ping_request_timeout:n.rpc.heartbeatRequestTimeout},t=new p(p.packers.JsonRPC,I,l,function(r){a.debug("Received request: "+JSON.stringify(r));try{var S=n.rpc[r.method];S===void 0?a.error("Method "+r.method+" not registered in client"):S(r.params,r)}catch(N){a.error("Exception processing request: "+JSON.stringify(r)),a.error(N)}});this.send=function(r,S,N){var R=Date.now();t.encode(r,S,function(m,O){if(m){try{a.error("ERROR:"+m.message+" in Request: method:"+r+" params:"+JSON.stringify(S)+" request:"+m.request),m.data&&a.error("ERROR DATA:"+JSON.stringify(m.data))}catch{}m.requestTime=R}N&&(O!=null&&O.value!=="pong"&&a.debug("Response: "+JSON.stringify(O)),N(m,O))})};function g(){a.debug("notReconnectIfNumLessThan = "+h+" (old="+_+")"),_=h}function T(){if(P){var r=null;(h==0||h==_)&&(r={interval:n.heartbeat||f}),h++,E.send("ping",r,function(S){return function(N,R){N&&(a.debug("Error in ping request #"+S+" ("+N.message+")"),S>_&&(P=!1,g(),a.debug("Server did not respond to ping message #"+S+". Reconnecting... "),l.reconnectWs()))}}(h))}else a.debug("Trying to send ping, but ping is not enabled")}function L(){v||(a.debug("Starting ping (if configured)"),v=!0,n.heartbeat!=null&&(u=setInterval(T,n.heartbeat),T()))}function D(){clearInterval(u),v=!1,P=!1,h=-1,t.cancel()}this.close=function(r,S){a.debug("Closing  with code: "+r+" because: "+S),u!=null&&(a.debug("Clearing ping interval"),clearInterval(u)),v=!1,P=!1,l.close(r,S)},this.reconnect=function(){l.reconnectWs()},this.resetPing=function(){P=!0,h=0,L()},this.getReadyState=function(){return l.getReadyState()}}return Wt=i,Wt}var Nr;function Qi(){if(Nr)return Ft;Nr=1;var p=Yi();return Ft.JsonRpcClient=p,Ft}var $t={},Lr;function Zi(){if(Lr)return $t;Lr=1;var p=si();return $t.WebSocketWithReconnection=p,$t}var Ht,Mr;function ai(){if(Mr)return Ht;Mr=1;var p=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch{p=!0}Function.prototype.bind||(Function.prototype.bind=function(_){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var h=Array.prototype.slice.call(arguments,1),P=this,v=function(){},u=function(){return P.apply(this instanceof v&&_?this:_,h.concat(Array.prototype.slice.call(arguments)))};return v.prototype=this.prototype,u.prototype=new v,u});var k=Hi().EventEmitter,y=Gi(),f=Ji(),d=Ki(),c=5e3;function o(_){if(!_)return{};for(var h in _){var P=_[h];typeof P=="string"&&(_[h]={response:P})}return _}function a(_){if(_){if(_ instanceof Function)return{send:_};if(_.send instanceof Function)return _;if(_.postMessage instanceof Function)return _.send=_.postMessage,_;if(_.write instanceof Function)return _.send=_.write,_;if(_.onmessage===void 0&&!(_.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function i(_,h){p?(this.method=_,this.params=h):(Object.defineProperty(this,"method",{value:_,enumerable:!0}),Object.defineProperty(this,"params",{value:h,enumerable:!0}))}function n(_,h,P,v){var u=this;if(!_)throw new SyntaxError("Packer is not defined");if(!_.pack||!_.unpack)throw new SyntaxError("Packer is invalid");var s=o(_.responseMethods);if(h instanceof Function){if(P!=null)throw new SyntaxError("There can't be parameters after onRequest");v=h,P=void 0,h=void 0}if(h&&h.send instanceof Function){if(P&&!(P instanceof Function))throw new SyntaxError("Only a function can be after transport");v=P,P=h,h=void 0}if(P instanceof Function){if(v!=null)throw new SyntaxError("There can't be parameters after onRequest");v=P,P=void 0}if(P&&P.send instanceof Function&&v&&!(v instanceof Function))throw new SyntaxError("Only a function can be after transport");h=h||{},k.call(this),v&&this.on("request",v),p?this.peerID=h.peerID:Object.defineProperty(this,"peerID",{value:h.peerID});var C=h.max_retries||0;function x(m){u.decode(m.data||m)}this.getTransport=function(){return P},this.setTransport=function(m){P&&(P.removeEventListener?P.removeEventListener("message",x):P.removeListener&&P.removeListener("data",x)),m&&(m.addEventListener?m.addEventListener("message",x):m.addListener&&m.addListener("data",x)),P=a(m)},p||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(P);var b=h.request_timeout||c,e=h.ping_request_timeout||b,l=h.response_timeout||c,I=h.duplicates_timeout||c,t=0,g=new d,T=new d,L=new d,D={};function r(m,O,A){var V={message:m,timeout:setTimeout(function(){T.remove(O,A)},l)};T.set(V,O,A)}function S(m,O){var A=setTimeout(function(){L.remove(m,O)},I);L.set(A,m,O)}function N(m,O,A,V,B){i.call(this,m,O),this.getTransport=function(){return B},this.setTransport=function(F){B=a(F)},p||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var j=T.get(A,V);B||u.getTransport()||(p?this.duplicated=!!j:Object.defineProperty(this,"duplicated",{value:!!j}));var $=s[m];this.pack=_.pack.bind(_,this,A),this.reply=function(F,G,M){if(F instanceof Function||F&&F.send instanceof Function){if(G!=null)throw new SyntaxError("There can't be parameters after callback");M=F,G=null,F=void 0}else if(G instanceof Function||G&&G.send instanceof Function){if(M!=null)throw new SyntaxError("There can't be parameters after callback");M=G,G=null}M=a(M),j&&clearTimeout(j.timeout),V!=null&&(F&&(F.dest=V),G&&(G.dest=V));var z;if(F||G!=null){if(u.peerID!=null&&(F?F.from=u.peerID:G.from=u.peerID),$)if($.error==null&&F)z={error:F};else{var H=F?$.error:$.response;z={method:H,params:F||G}}else z={error:F,result:G};z=_.pack(z,A)}else j?z=j.message:z=_.pack({result:null},A);return r(z,A,V),M=M||this.getTransport()||u.getTransport(),M?M.send(z):z}}y(N,i);function R(m){var O=D[m];if(O){delete D[m];var A=g.pop(O.id,O.dest);A&&(clearTimeout(A.timeout),S(O.id,O.dest))}}this.cancel=function(m){if(m)return R(m);for(var m in D)R(m)},this.close=function(){var m=this.getTransport();m&&m.close&&m.close(4003,"Cancel request"),this.cancel(),L.forEach(clearTimeout),T.forEach(function(O){clearTimeout(O.timeout)})},this.encode=function(m,O,A,V,B){if(O instanceof Function){if(A!=null)throw new SyntaxError("There can't be parameters after callback");B=O,V=void 0,A=void 0,O=void 0}else if(A instanceof Function){if(V!=null)throw new SyntaxError("There can't be parameters after callback");B=A,V=void 0,A=void 0}else if(V instanceof Function){if(B!=null)throw new SyntaxError("There can't be parameters after callback");B=V,V=void 0}u.peerID!=null&&(O=O||{},O.from=u.peerID),A!=null&&(O=O||{},O.dest=A);var j={method:m,params:O};if(B){let z=function(U,re){u.cancel(j),B(U,re)},H=function(U){var re=m==="ping"?e:b;return G.timeout=setTimeout(K,re*Math.pow(2,F++)),D[j]={id:$,dest:A},g.set(G,$,A),U=U||M||u.getTransport(),U?U.send(j):j},Q=function(U){U=a(U),console.warn(F+" retry for request message:",j);var re=L.pop($,A);return clearTimeout(re),H(U)},K=function(){if(F<C)return Q(V);var U=new Error("Request has timed out");U.request=j,U.retry=Q,z(U)};var $=t++,F=0;j=_.pack(j,$);var G={message:j,callback:z,responseMethods:s[m]||{}},M=a(V);return H(V)}return j=_.pack(j),V=V||this.getTransport(),V?V.send(j):j},this.decode=function(m,O){if(!m)throw new TypeError("Message is not defined");try{m=_.unpack(m)}catch(q){return console.debug(q,m)}var A=m.id,V=m.ack,B=m.method,j=m.params||{},$=j.from,F=j.dest;if(u.peerID!=null&&$==u.peerID)return;if(A==null&&V==null){var G=new i(B,j);return u.emit("request",G)?void 0:G}function M(){if(O=a(O)||u.getTransport(),O){var q=T.get(A,$);if(q)return O.send(q.message)}var J=A??V,Z=new N(B,j,J,$,O);if(!u.emit("request",Z))return Z}function z(q,J,Z){q.callback(J,Z)}function H(q){console.warn("Response already processed",m),clearTimeout(q),S(V,$)}if(B){if(F==null||F==u.peerID){var X=g.get(V,$);if(X){var Q=X.responseMethods;return B==Q.error?z(X,j):B==Q.response?z(X,null,j):M()}var K=L.get(V,$);if(K)return H(K)}return M()}var U=m.error,re=m.result;if(!(U&&U.dest&&U.dest!=u.peerID)&&!(re&&re.dest&&re.dest!=u.peerID)){var X=g.get(V,$);if(!X){var K=L.get(V,$);return K?H(K):console.warn("No callback was defined for this message",m)}z(X,U,re)}}}y(n,k),n.RpcNotification=i,Ht=n;var E=Qi(),w=Zi();return n.clients=E,n.clients.transports=w,n.packers=f,Ht}const eo="2.31.0",to={version:eo};var Ar;function no(){if(Ar)return fe;Ar=1;var p=fe&&fe.__awaiter||function(b,e,l,I){function t(g){return g instanceof l?g:new l(function(T){T(g)})}return new(l||(l=Promise))(function(g,T){function L(S){try{r(I.next(S))}catch(N){T(N)}}function D(S){try{r(I.throw(S))}catch(N){T(N)}}function r(S){S.done?g(S.value):t(S.value).then(L,D)}r((I=I.apply(b,e||[])).next())})},k=fe&&fe.__generator||function(b,e){var l={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},I,t,g,T;return T={next:L(0),throw:L(1),return:L(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function L(r){return function(S){return D([r,S])}}function D(r){if(I)throw new TypeError("Generator is already executing.");for(;T&&(T=0,r[0]&&(l=0)),l;)try{if(I=1,t&&(g=r[0]&2?t.return:r[0]?t.throw||((g=t.return)&&g.call(t),0):t.next)&&!(g=g.call(t,r[1])).done)return g;switch(t=0,g&&(r=[r[0]&2,g.value]),r[0]){case 0:case 1:g=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,t=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(g=l.trys,!(g=g.length>0&&g[g.length-1])&&(r[0]===6||r[0]===2)){l=0;continue}if(r[0]===3&&(!g||r[1]>g[0]&&r[1]<g[3])){l.label=r[1];break}if(r[0]===6&&l.label<g[1]){l.label=g[1],g=r;break}if(g&&l.label<g[2]){l.label=g[2],l.ops.push(r);break}g[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(b,l)}catch(S){r=[6,S],t=0}finally{I=g=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(fe,"__esModule",{value:!0}),fe.OpenVidu=void 0;var y=Ur(),f=rn(),d=Et(),c=tn(),o=Ae(),a=Ve(),i=vt(),n=oe(),E=me(),w=Wi(),_=$i(),h=Fr(),P=Xt(),v=ai(),u=to,s=n.OpenViduLogger.getInstance(),C,x=function(){function b(){var e=this;this.masterNodeHasCrashed=!1,this.publishers=[],this.secret="",this.recorder=!1,this.stt=!1,this.life=-1,this.advancedConfiguration={},this.webrtcStatsInterval=-1,this.sendBrowserLogs=h.OpenViduLoggerConfiguration.disabled,this.isAtLeastPro=!1,this.isEnterprise=!1,this.ee=new P,C=E.PlatformUtils.getInstance(),this.libraryVersion=u.version,s.info("OpenVidu initialized"),s.info("Platform detected: "+C.getDescription()),s.info("openvidu-browser version: "+this.libraryVersion),(C.isMobileDevice()||C.isReactNative())&&this.onOrientationChanged(function(){e.publishers.forEach(function(l){l.stream.isLocalStreamPublished&&l.stream&&l.stream.hasVideo&&e.sendNewVideoDimensionsIfRequired(l,"deviceRotated",75,10)})})}return b.prototype.initSession=function(){return this.session=new d.Session(this),this.session},b.prototype.initPublisher=function(e,l,I){var t;l&&typeof l!="function"?(t=l,t={audioSource:typeof t.audioSource<"u"?t.audioSource:void 0,frameRate:typeof MediaStreamTrack<"u"&&t.videoSource instanceof MediaStreamTrack?void 0:typeof t.frameRate<"u"?t.frameRate:void 0,insertMode:typeof t.insertMode<"u"?typeof t.insertMode=="string"?i.VideoInsertMode[t.insertMode]:t.insertMode:i.VideoInsertMode.APPEND,mirror:typeof t.mirror<"u"?t.mirror:!0,publishAudio:typeof t.publishAudio<"u"?t.publishAudio:!0,publishVideo:typeof t.publishVideo<"u"?t.publishVideo:!0,resolution:typeof MediaStreamTrack<"u"&&t.videoSource instanceof MediaStreamTrack?void 0:typeof t.resolution<"u"?t.resolution:"640x480",videoSource:typeof t.videoSource<"u"?t.videoSource:void 0,videoSimulcast:t.videoSimulcast,filter:t.filter}):t={insertMode:i.VideoInsertMode.APPEND,mirror:!0,publishAudio:!0,publishVideo:!0,resolution:"640x480"};var g=new f.Publisher(e,t,this),T;return l&&typeof l=="function"?T=l:I&&(T=I),g.initialize().then(function(){T!==void 0&&T(void 0),g.emitEvent("accessAllowed",[])}).catch(function(L){T!==void 0&&T(L),g.emitEvent("accessDenied",[L])}),this.publishers.push(g),g},b.prototype.initPublisherAsync=function(e,l){var I=this;return new Promise(function(t,g){var T,L=function(D){return D?g(D):t(T)};l?T=I.initPublisher(e,l,L):T=I.initPublisher(e,L)})},b.prototype.initLocalRecorder=function(e){return new y.LocalRecorder(e)},b.prototype.checkSystemRequirements=function(){return C.isIPhoneOrIPad()?C.isIOSWithSafari()||C.isChromeMobileBrowser()||C.isFirefoxMobileBrowser()||C.isOperaMobileBrowser()||C.isEdgeMobileBrowser()||C.isIonicIos():C.isChromeBrowser()||C.isChromeMobileBrowser()||C.isFirefoxBrowser()||C.isFirefoxMobileBrowser()||C.isOperaBrowser()||C.isOperaMobileBrowser()||C.isEdgeBrowser()||C.isEdgeMobileBrowser()||C.isSamsungBrowser()||C.isSafariBrowser()||C.isAndroidBrowser()||C.isElectron()||C.isNodeJs()||C.isMotorolaEdgeDevice()},b.prototype.checkScreenSharingCapabilities=function(){return C.canScreenShare()},b.prototype.getDevices=function(){return new Promise(function(e,l){navigator.mediaDevices.enumerateDevices().then(function(I){var t,g=[];if(C.isIonicAndroid()&&typeof cordova<"u"&&(!((t=cordova==null?void 0:cordova.plugins)===null||t===void 0)&&t.EnumerateDevicesPlugin))cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then(function(T){var L=[],D=[],r=[];return L=T.filter(function(S){return S.kind==="audioinput"}),D=I.filter(function(S){return S.kind==="videoinput"}),r=I.filter(function(S){return S.kind==="audioinput"}),D.forEach(function(S,N){if(S.label)g.push({kind:S.kind,deviceId:S.deviceId,label:S.label});else{var R="";N===0?R="Front Camera":N===1?R="Back Camera":R="Unknown Camera",g.push({kind:S.kind,deviceId:S.deviceId,label:R})}}),r.forEach(function(S,N){if(S.label)g.push({kind:S.kind,deviceId:S.deviceId,label:S.label});else{var R="";switch(N){case 0:R="Default";break;case 1:var m=L.filter(function(V){return V.label.includes("Built")})[0];R=m?m.label:"Built-in Microphone";break;case 2:var O=L.filter(function(V){return V.label.includes("Wired")})[0];O?R=O.label:R="Headset earpiece";break;case 3:var A=L.filter(function(V){return V.label.includes("Bluetooth")})[0];R=A?A.label:"Wireless";break;default:R="Unknown Microphone";break}g.push({kind:S.kind,deviceId:S.deviceId,label:R})}}),e(g)});else return I.forEach(function(T){(T.kind==="audioinput"||T.kind==="videoinput")&&g.push({kind:T.kind,deviceId:T.deviceId,label:T.label})}),e(g)}).catch(function(I){return s.error("Error getting devices",I),l(I)})})},b.prototype.getUserMedia=function(e){var l,I;return p(this,void 0,void 0,function(){var t,g,T,r,L,N,R,D,r,S,N,R,m,O=this;return k(this,function(A){switch(A.label){case 0:t=function(V,B){return p(O,void 0,void 0,function(){var j,$,F,G;return k(this,function(M){switch(M.label){case 0:j=B.audio===void 0?!0:B.audio,$={audio:j,video:!1},M.label=1;case 1:return M.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia($)];case 2:return F=M.sent(),V.addTrack(F.getAudioTracks()[0]),[2,V];case 3:throw G=M.sent(),V.getAudioTracks().forEach(function(z){z.stop()}),V.getVideoTracks().forEach(function(z){z.stop()}),this.generateAudioDeviceError(G,$);case 4:return[2]}})})},A.label=1;case 1:return A.trys.push([1,20,,21]),[4,this.generateMediaConstraints(e)];case 2:return g=A.sent(),g.videoTrack&&g.audioTrack||g.audioTrack&&((l=g.constraints)===null||l===void 0?void 0:l.video)===!1||g.videoTrack&&((I=g.constraints)===null||I===void 0?void 0:I.audio)===!1?[2,this.addAlreadyProvidedTracks(g,new MediaStream)]:[3,3];case 3:if(g.videoTrack&&delete g.constraints.video,g.audioTrack&&delete g.constraints.audio,T=!1,typeof e.videoSource!="string")return[3,12];if(!(e.videoSource==="screen"||e.videoSource==="window"||C.isElectron()&&e.videoSource.startsWith("screen:")))return[3,12];if(T=!g.audioTrack&&e.audioSource!==null&&e.audioSource!==!1,!(navigator.mediaDevices.getDisplayMedia&&!C.isElectron()))return[3,11];A.label=4;case 4:return A.trys.push([4,9,,10]),[4,navigator.mediaDevices.getDisplayMedia({video:!0,audio:e.audioSource==="screen"})];case 5:return r=A.sent(),this.addAlreadyProvidedTracks(g,r),T?[4,t(r,g.constraints)]:[3,7];case 6:return[2,A.sent()];case 7:return[2,r];case 8:return[3,10];case 9:throw L=A.sent(),N=a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,R=L.toString(),new a.OpenViduError(N,R);case 10:return[3,11];case 11:return[3,12];case 12:D=T?{video:g.constraints.video}:g.constraints,A.label=13;case 13:return A.trys.push([13,18,,19]),[4,navigator.mediaDevices.getUserMedia(D)];case 14:return r=A.sent(),this.addAlreadyProvidedTracks(g,r),T?[4,t(r,g.constraints)]:[3,16];case 15:return[2,A.sent()];case 16:return[2,r];case 17:return[3,19];case 18:throw S=A.sent(),N=void 0,R=S.toString(),e.videoSource!=="screen"?N=a.OpenViduErrorName.DEVICE_ACCESS_DENIED:N=a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,new a.OpenViduError(N,R);case 19:return[3,21];case 20:throw m=A.sent(),m;case 21:return[2]}})})},b.prototype.enableProdMode=function(){s.enableProdMode()},b.prototype.setAdvancedConfiguration=function(e){this.advancedConfiguration=e},b.prototype.onOrientationChanged=function(e){globalThis.addEventListener("orientationchange",e)},b.prototype.sendNewVideoDimensionsIfRequired=function(e,l,I,t){var g=this,T,L,D,r,S=0,N=((L=(T=e==null?void 0:e.stream)===null||T===void 0?void 0:T.videoDimensions)===null||L===void 0?void 0:L.width)||0,R=((r=(D=e==null?void 0:e.stream)===null||D===void 0?void 0:D.videoDimensions)===null||r===void 0?void 0:r.height)||0,m=setInterval(function(){S++,S>t&&clearTimeout(m),e.getVideoDimensions().then(function(O){(O.width!==N||O.height!==R)&&(clearTimeout(m),g.sendVideoDimensionsChangedEvent(e,l,N,R,O.width,O.height))})},I)},b.prototype.sendVideoDimensionsChangedEvent=function(e,l,I,t,g,T){var L=this;e.stream.videoDimensions={width:g||0,height:T||0},this.sendRequest("streamPropertyChanged",{streamId:e.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(e.stream.videoDimensions),reason:l},function(D,r){D?s.error("Error sending 'streamPropertyChanged' event",D):(L.session.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(L.session,e.stream,"videoDimensions",e.stream.videoDimensions,{width:I,height:t},l)]),e.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(e,e.stream,"videoDimensions",e.stream.videoDimensions,{width:I,height:t},l)]),L.session.sendVideoData(e))})},b.prototype.sendTrackChangedEvent=function(e,l,I,t){var g=this,T={label:l},L={label:I},D="trackReplaced";e.stream.isLocalStreamPublished?this.sendRequest("streamPropertyChanged",{streamId:e.stream.streamId,property:t,newValue:L,reason:D},function(r,S){r?s.error("Error sending 'streamPropertyChanged' event",r):(g.session.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(g.session,e.stream,t,L,T,D)]),e.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(e,e.stream,t,L,T,D)]))}):(this.session.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(this.session,e.stream,t,L,T,D)]),e.emitEvent("streamPropertyChanged",[new o.StreamPropertyChangedEvent(e,e.stream,t,L,T,D)]))},b.prototype.generateMediaConstraints=function(e){var l=this;return new Promise(function(I,t){var g={audioTrack:void 0,videoTrack:void 0,constraints:{audio:void 0,video:void 0}},T=e.audioSource,L=e.videoSource;if((T===null||T===!1)&&(g.constraints.audio=!1),(L===null||L===!1)&&(g.constraints.video=!1),g.constraints.audio===!1&&g.constraints.video===!1)return t(new a.OpenViduError(a.OpenViduErrorName.NO_INPUT_SOURCE_SET,"Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time"));if(typeof MediaStreamTrack<"u"&&T instanceof MediaStreamTrack&&(g.audioTrack=T),typeof MediaStreamTrack<"u"&&L instanceof MediaStreamTrack&&(g.videoTrack=L),T===void 0&&(g.constraints.audio=!0),L===void 0&&(g.constraints.video={width:{ideal:640},height:{ideal:480}}),L!==null&&L!==!1){if(e.resolution){var D=e.resolution.toLowerCase().split("x"),r=Number(D[0]),S=Number(D[1]);g.constraints.video={width:{ideal:r},height:{ideal:S}}}e.frameRate&&(g.constraints.video.frameRate={ideal:e.frameRate})}return l.configureDeviceIdOrScreensharing(g,e,I,t),I(g)})},b.prototype.startWs=function(e){var l={heartbeat:5e3,ws:{uri:this.wsUri+"?sessionId="+this.session.sessionId,onconnected:e,ondisconnect:this.disconnectCallback.bind(this),onreconnecting:this.reconnectingCallback.bind(this),onreconnected:this.reconnectedCallback.bind(this),ismasternodecrashed:this.isMasterNodeCrashed.bind(this)},rpc:{requestTimeout:1e4,heartbeatRequestTimeout:5e3,participantJoined:this.session.onParticipantJoined.bind(this.session),participantPublished:this.session.onParticipantPublished.bind(this.session),participantUnpublished:this.session.onParticipantUnpublished.bind(this.session),participantLeft:this.session.onParticipantLeft.bind(this.session),participantEvicted:this.session.onParticipantEvicted.bind(this.session),recordingStarted:this.session.onRecordingStarted.bind(this.session),recordingStopped:this.session.onRecordingStopped.bind(this.session),broadcastStarted:this.session.onBroadcastStarted.bind(this.session),broadcastStopped:this.session.onBroadcastStopped.bind(this.session),sendMessage:this.session.onNewMessage.bind(this.session),streamPropertyChanged:this.session.onStreamPropertyChanged.bind(this.session),connectionPropertyChanged:this.session.onConnectionPropertyChanged.bind(this.session),networkQualityLevelChanged:this.session.onNetworkQualityLevelChangedChanged.bind(this.session),filterEventDispatched:this.session.onFilterEventDispatched.bind(this.session),iceCandidate:this.session.recvIceCandidate.bind(this.session),mediaError:this.session.onMediaError.bind(this.session),masterNodeCrashedNotification:this.onMasterNodeCrashedNotification.bind(this),forciblyReconnectSubscriber:this.session.onForciblyReconnectSubscriber.bind(this.session),speechToTextMessage:this.session.onSpeechToTextMessage.bind(this.session),speechToTextDisconnected:this.session.onSpeechToTextDisconnected.bind(this.session)}};this.jsonRpcClient=new v.clients.JsonRpcClient(l)},b.prototype.onMasterNodeCrashedNotification=function(e){console.error("Master Node has crashed"),this.masterNodeHasCrashed=!0,this.session.onLostConnection("nodeCrashed"),this.jsonRpcClient.close(4103,"Master Node has crashed")},b.prototype.getWsReadyState=function(){return this.jsonRpcClient.getReadyState()},b.prototype.closeWs=function(){this.jsonRpcClient.close(4102,"Connection closed by client")},b.prototype.sendRequest=function(e,l,I){var t;l&&l instanceof Function&&(I=l,l={}),s.debug('Sending request: {method:"'+e+'", params: '+JSON.stringify(l)+"}"),(t=this.jsonRpcClient)===null||t===void 0||t.send(e,l,I)},b.prototype.getWsUri=function(){return this.wsUri},b.prototype.getSecret=function(){return this.secret},b.prototype.getRecorder=function(){return this.recorder},b.prototype.getStt=function(){return this.stt},b.prototype.generateAudioDeviceError=function(e,l){e.name==="Error"&&(e.name=e.constructor.name);var I,t;switch(e.name.toLowerCase()){case"notfounderror":return I=a.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,t=e.toString(),new a.OpenViduError(I,t);case"notallowederror":return I=a.OpenViduErrorName.DEVICE_ACCESS_DENIED,t=e.toString(),new a.OpenViduError(I,t);case"overconstrainederror":return e.constraint.toLowerCase()==="deviceid"?(I=a.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,t="Audio input device with deviceId '"+l.audio.deviceId.exact+"' not found"):(I=a.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,t="Audio input device doesn't support the value passed for constraint '"+e.constraint+"'"),new a.OpenViduError(I,t);case"notreadableerror":return I=a.OpenViduErrorName.DEVICE_ALREADY_IN_USE,t=e.toString(),new a.OpenViduError(I,t);default:return new a.OpenViduError(a.OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR,e.toString())}},b.prototype.addAlreadyProvidedTracks=function(e,l,I){return e.videoTrack&&(l.addTrack(e.videoTrack),I&&(e.constraints.video?I.lastVideoTrackConstraints=e.constraints.video:I.lastVideoTrackConstraints=e.videoTrack.getConstraints())),e.audioTrack&&l.addTrack(e.audioTrack),l},b.prototype.configureDeviceIdOrScreensharing=function(e,l,I,t){var g=this,T=l.audioSource,L=l.videoSource;if(typeof T=="string"&&T!=="screen"&&(e.constraints.audio={deviceId:{exact:T}}),typeof L=="string")if(!this.isScreenShare(L))this.setVideoSource(e,L),T==="screen"&&(s.warn('Parameter "audioSource" is set to "screen", which means rquesting audio from screen sharing source. But "videoSource" is not set to "screen". No audio source will be requested'),e.constraints.audio=!1);else if(this.checkScreenSharingCapabilities())if(C.isElectron()){var r="screen:",S=L,N=S.substr(S.indexOf(r)+r.length);return e.constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:N}},I(e)}else if(this.advancedConfiguration.screenShareChromeExtension&&!(C.isFirefoxBrowser()||C.isFirefoxMobileBrowser())&&!navigator.mediaDevices.getDisplayMedia){_.getScreenConstraints(function(m,O){if(m||O.mandatory&&O.mandatory.chromeMediaSource==="screen")if(m==="permission-denied"||m==="PermissionDeniedError"){var A=new a.OpenViduError(a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");return s.error(A),t(A)}else{var V=g.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim();_.getChromeExtensionStatus(V,function(B){if(B==="installed-disabled"){var j=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");return s.error(j),t(j)}if(B==="not-installed"){var $=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,g.advancedConfiguration.screenShareChromeExtension);return s.error($),t($)}});return}else return e.constraints.video=O,I(e)});return}else{if(navigator.mediaDevices.getDisplayMedia)return I(e);var R=C.isFirefoxBrowser()||C.isFirefoxMobileBrowser()?l.videoSource:void 0;w.getScreenId(R,function(m,O,A){if(m)if(m==="not-installed"){var V=g.advancedConfiguration.screenShareChromeExtension?g.advancedConfiguration.screenShareChromeExtension:"https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",B=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,V);return s.error(B),t(B)}else if(m==="installed-disabled"){var B=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");return s.error(B),t(B)}else if(m==="permission-denied"){var B=new a.OpenViduError(a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");return s.error(B),t(B)}else{var B=new a.OpenViduError(a.OpenViduErrorName.GENERIC_ERROR,"Unknown error when accessing screen share");return s.error(B),s.error(m),t(B)}else return e.constraints.video=A.video,I(e)});return}else{var D=new a.OpenViduError(a.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED,"You can only screen share in desktop Chrome, Firefox, Opera, Safari (>=13.0), Edge (>= 80) or Electron. Detected client: "+C.getName()+" "+C.getVersion());return s.error(D),t(D)}},b.prototype.setVideoSource=function(e,l){e.constraints.video||(e.constraints.video={}),e.constraints.video.deviceId={exact:l}},b.prototype.disconnectCallback=function(){s.warn("Websocket connection lost"),this.isRoomAvailable()?this.session.onLostConnection("networkDisconnect"):alert("Connection error. Please reload page.")},b.prototype.reconnectingCallback=function(){s.warn("Websocket connection lost (reconnecting)"),this.isRoomAvailable()?this.session.emitEvent("reconnecting",[]):alert("Connection error. Please reload page.")},b.prototype.reconnectWebsocketThroughRpcConnectMethod=function(e){var l=this;this.sendRequest("connect",{sessionId:e,reconnect:!0},function(I,t){if(I)if(l.isMasterNodeCrashed())s.warn("Master Node has crashed!");else{s.error(I);var g=function(L,D){s.warn(D),l.session.onLostConnection(L),l.jsonRpcClient.close(4101,"Reconnection fault: "+D)},T=function(){l.life===-1?g("networkDisconnect","WS successfully reconnected but the user was already evicted due to timeout"):l.sendRequest("sessionStatus",{sessionId:l.session.sessionId},function(L,D){L!=null?console.error("Error checking session status",L):l.life===D.life?g("networkDisconnect","WS successfully reconnected but the user was already evicted due to timeout"):g("nodeCrashed","WS successfully reconnected to OpenVidu Server but your Master Node crashed")})};I.code===40007&&I.message==="reconnection error"&&console.error("Invalid RPC sessionId. Client network disconnection or Master Node crash"),T()}else l.jsonRpcClient.resetPing(),l.session.onRecoveredConnection()})},b.prototype.reconnectedCallback=function(){if(s.warn("Websocket reconnected"),this.isRoomAvailable())if(this.session.connection)this.reconnectWebsocketThroughRpcConnectMethod(this.session.connection.rpcSessionId);else{s.warn("There was no previous connection when running reconnection callback");var e=new c.SessionDisconnectedEvent(this.session,"networkDisconnect");this.session.ee.emitEvent("sessionDisconnected",[e]),e.callDefaultBehavior()}else alert("Connection error. Please reload page.")},b.prototype.isMasterNodeCrashed=function(){return this.masterNodeHasCrashed},b.prototype.isRoomAvailable=function(){return this.session!==void 0&&this.session instanceof d.Session?!0:(s.warn("Session instance not found"),!1)},b.prototype.isScreenShare=function(e){return e==="screen"||e==="window"||C.isElectron()&&e.startsWith("screen:")},b}();return fe.OpenVidu=x,fe}var Gt={},Vr;function ro(){return Vr||(Vr=1,Object.defineProperty(Gt,"__esModule",{value:!0})),Gt}var Dr;function io(){return Dr||(Dr=1,function(p){var k=ge&&ge.__createBinding||(Object.create?function(m,O,A,V){V===void 0&&(V=A);var B=Object.getOwnPropertyDescriptor(O,A);(!B||("get"in B?!O.__esModule:B.writable||B.configurable))&&(B={enumerable:!0,get:function(){return O[A]}}),Object.defineProperty(m,V,B)}:function(m,O,A,V){V===void 0&&(V=A),m[V]=O[A]}),y=ge&&ge.__exportStar||function(m,O){for(var A in m)A!=="default"&&!Object.prototype.hasOwnProperty.call(O,A)&&k(O,m,A)};Object.defineProperty(p,"__esModule",{value:!0}),p.EventDispatcher=p.ExceptionEventName=p.ExceptionEvent=p.SpeechToTextEvent=p.NetworkQualityLevelChangedEvent=p.FilterEvent=p.ConnectionPropertyChangedEvent=p.StreamPropertyChangedEvent=p.VideoElementEvent=p.StreamManagerEvent=p.StreamEvent=p.SignalEvent=p.SessionDisconnectedEvent=p.RecordingEvent=p.PublisherSpeakingEvent=p.ConnectionEvent=p.Event=p.VideoInsertMode=p.TypeOfVideo=p.OpenViduErrorName=p.OpenViduError=p.LocalRecorderState=p.Filter=p.LocalRecorder=p.Connection=p.Stream=p.StreamManager=p.Subscriber=p.Publisher=p.Session=p.OpenVidu=void 0;var f=jr(),d=no();Object.defineProperty(p,"OpenVidu",{enumerable:!0,get:function(){return d.OpenVidu}});var c=Et();Object.defineProperty(p,"Session",{enumerable:!0,get:function(){return c.Session}});var o=rn();Object.defineProperty(p,"Publisher",{enumerable:!0,get:function(){return o.Publisher}});var a=Qt();Object.defineProperty(p,"Subscriber",{enumerable:!0,get:function(){return a.Subscriber}});var i=Yt();Object.defineProperty(p,"StreamManager",{enumerable:!0,get:function(){return i.StreamManager}});var n=en();Object.defineProperty(p,"Stream",{enumerable:!0,get:function(){return n.Stream}});var E=Jr();Object.defineProperty(p,"Connection",{enumerable:!0,get:function(){return E.Connection}});var w=Ur();Object.defineProperty(p,"LocalRecorder",{enumerable:!0,get:function(){return w.LocalRecorder}});var _=zt();Object.defineProperty(p,"Filter",{enumerable:!0,get:function(){return _.Filter}});var h=qr();Object.defineProperty(p,"LocalRecorderState",{enumerable:!0,get:function(){return h.LocalRecorderState}});var P=Ve();Object.defineProperty(p,"OpenViduError",{enumerable:!0,get:function(){return P.OpenViduError}}),Object.defineProperty(p,"OpenViduErrorName",{enumerable:!0,get:function(){return P.OpenViduErrorName}});var v=Zt();Object.defineProperty(p,"TypeOfVideo",{enumerable:!0,get:function(){return v.TypeOfVideo}});var u=vt();Object.defineProperty(p,"VideoInsertMode",{enumerable:!0,get:function(){return u.VideoInsertMode}});var s=ae();Object.defineProperty(p,"Event",{enumerable:!0,get:function(){return s.Event}});var C=Kr();Object.defineProperty(p,"ConnectionEvent",{enumerable:!0,get:function(){return C.ConnectionEvent}});var x=Xr();Object.defineProperty(p,"PublisherSpeakingEvent",{enumerable:!0,get:function(){return x.PublisherSpeakingEvent}});var b=Qr();Object.defineProperty(p,"RecordingEvent",{enumerable:!0,get:function(){return b.RecordingEvent}});var e=tn();Object.defineProperty(p,"SessionDisconnectedEvent",{enumerable:!0,get:function(){return e.SessionDisconnectedEvent}});var l=Zr();Object.defineProperty(p,"SignalEvent",{enumerable:!0,get:function(){return l.SignalEvent}});var I=nn();Object.defineProperty(p,"StreamEvent",{enumerable:!0,get:function(){return I.StreamEvent}});var t=Kt();Object.defineProperty(p,"StreamManagerEvent",{enumerable:!0,get:function(){return t.StreamManagerEvent}});var g=Wr();Object.defineProperty(p,"VideoElementEvent",{enumerable:!0,get:function(){return g.VideoElementEvent}});var T=Ae();Object.defineProperty(p,"StreamPropertyChangedEvent",{enumerable:!0,get:function(){return T.StreamPropertyChangedEvent}});var L=ti();Object.defineProperty(p,"ConnectionPropertyChangedEvent",{enumerable:!0,get:function(){return L.ConnectionPropertyChangedEvent}});var D=Yr();Object.defineProperty(p,"FilterEvent",{enumerable:!0,get:function(){return D.FilterEvent}});var r=ni();Object.defineProperty(p,"NetworkQualityLevelChangedEvent",{enumerable:!0,get:function(){return r.NetworkQualityLevelChangedEvent}});var S=ei();Object.defineProperty(p,"SpeechToTextEvent",{enumerable:!0,get:function(){return S.SpeechToTextEvent}});var N=De();Object.defineProperty(p,"ExceptionEvent",{enumerable:!0,get:function(){return N.ExceptionEvent}}),Object.defineProperty(p,"ExceptionEventName",{enumerable:!0,get:function(){return N.ExceptionEventName}});var R=Jt();Object.defineProperty(p,"EventDispatcher",{enumerable:!0,get:function(){return R.EventDispatcher}}),y(ro(),p),f.JL.setOptions({enabled:!1})}(ge)),ge}var oo=io();const Br="https://moim.o-r.kr";function ao(){const[p,k]=ce.useState(null),[y,f]=ce.useState(null),[d,c]=ce.useState([]),[o,a]=ce.useState(""),[i,n]=ce.useState(!1),[E,w]=ce.useState(""),[_,h]=ce.useState(!0),[P,v]=ce.useState(!0),u=ce.useRef(null),s=async t=>{try{const g=await fetch(`${Br}/api/sessions/${t}/connections`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(g.ok){const T=await g.text();return console.log("토큰 받음:",T),T}else{const T=await g.text();throw console.error("토큰 생성 실패 응답:",T),new Error(`토큰 생성 실패: ${g.status} ${T}`)}}catch(g){throw console.error("토큰 생성 오류:",g),g}},C=ce.useCallback(t=>{if(console.log("새로운 스트림 생성됨"),p){const g=p.subscribe(t.stream,void 0);c(T=>[...T,g])}else console.warn("세션이 아직 준비되지 않아 구독할 수 없습니다.")},[p]),x=ce.useCallback(t=>{console.log("스트림 제거됨"),c(g=>g.filter(T=>T!==t.stream.streamManager))},[]),b=()=>{if(y){const t=!_;y.publishAudio(t),h(t),console.log(`마이크 ${t?"켜짐":"꺼짐"}`)}},e=()=>{if(y){const t=!P;y.publishVideo(t),v(t),console.log(`비디오 ${t?"켜짐":"꺼짐"}`)}};ce.useEffect(()=>{y&&u.current&&(console.log("Publisher 비디오 요소 연결 중..."),y.addVideoElement(u.current),console.log("Publisher 비디오 요소 연결 완료"))},[y]),ce.useEffect(()=>{if(p)return p.on("streamCreated",C),p.on("streamDestroyed",x),()=>{p.off("streamCreated",C),p.off("streamDestroyed",x)}},[p,C,x]);const l=async()=>{try{const t=E||"test-room-123",g=await fetch(`${Br}/api/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customSessionId:t})});if(!g.ok){const N=await g.text();throw console.error("세션 생성 실패 응답:",N),new Error(`세션 생성 실패: ${g.status} ${N}`)}const T=await g.text();a(T),console.log("세션 생성됨:",T);const L=new oo.OpenVidu,D=L.initSession();k(D);const r=await s(T);await D.connect(r);const S=L.initPublisher(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,resolution:"1280x720",frameRate:30,insertMode:"APPEND",mirror:!1});await D.publish(S),f(S),n(!0),console.log("화상통화 연결 완료!")}catch(t){console.error("화상통화 연결 실패:",t),p&&p.disconnect(),k(null),f(null),c([]),n(!1),a(""),alert(`화상통화 연결에 실패했습니다: ${t.message}`)}},I=()=>{p&&p.disconnect(),k(null),f(null),c([]),n(!1),a(""),w(""),h(!0),v(!0),console.log("화상통화 종료됨")};return te.createElement("div",{style:{padding:"20px"}},te.createElement("h1",null,"MOIM 화상통화"),i?te.createElement("div",null,te.createElement("div",{style:{marginBottom:"20px"}},te.createElement("button",{onClick:b,style:{padding:"10px 15px",marginRight:"10px",backgroundColor:_?"#28a745":"#dc3545",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"}},_?"🎤 마이크 켜짐":"🔇 마이크 꺼짐"),te.createElement("button",{onClick:e,style:{padding:"10px 15px",marginRight:"10px",backgroundColor:P?"#28a745":"#dc3545",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"}},P?"📹 비디오 켜짐":"📵 비디오 꺼짐"),te.createElement("button",{onClick:I,style:{padding:"10px 20px",fontSize:"16px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"}},"화상통화 종료")),te.createElement("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap"}},y&&te.createElement("div",null,te.createElement("h3",null,"내 화면"),te.createElement("video",{ref:u,autoPlay:!0,muted:!0,style:{width:"320px",height:"240px",backgroundColor:"#000",border:"2px solid #007bff",objectFit:"contain"}})),...d.map((t,g)=>te.createElement("div",{key:t.stream.streamId||g},te.createElement("h3",null,`참가자 ${g+1}`),te.createElement("video",{ref:T=>{T&&t&&(console.log(`Subscriber ${g} 비디오 요소 연결 중 (streamId: ${t.stream.streamId})...`),t.addVideoElement(T),console.log(`Subscriber ${g} 비디오 요소 연결 완료`))},autoPlay:!0,style:{width:"320px",height:"240px",backgroundColor:"#000",border:"2px solid #28a745",objectFit:"contain"}})))),te.createElement("p",{style:{marginTop:"20px",color:"#666"}},`현재 방: ${o}`)):te.createElement("div",null,te.createElement("input",{type:"text",placeholder:"방 이름을 입력하세요 (예: room-123) 또는 비워두세요",value:E,onChange:t=>w(t.target.value),style:{padding:"10px",marginRight:"10px",width:"300px",fontSize:"14px",border:"1px solid #ccc",borderRadius:"5px"}}),te.createElement("button",{onClick:l,style:{padding:"10px 20px",fontSize:"16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"}},"화상통화 시작"),te.createElement("p",{style:{marginTop:"10px",color:"#666",fontSize:"14px"}},"같은 방 이름을 입력한 사람들끼리 화상통화가 됩니다.",te.createElement("br"),"비워두면 기본 방(test-room-123)에 입장합니다.")))}export{ao as V};
